<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>harp Tutorial</title>
  <meta name="description" content="This will form the harp tutorial / book." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="harp Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This will form the harp tutorial / book." />
  <meta name="github-repo" content="andrew-MET/harpTutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="harp Tutorial" />
  
  <meta name="twitter:description" content="This will form the harp tutorial / book." />
  

<meta name="author" content="Andrew Singleton" />


<meta name="date" content="2020-06-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="0.1" data-path=""><a href="#system-requirements"><i class="fa fa-check"></i><b>0.1</b> System Requirements</a><ul>
<li class="chapter" data-level="0.1.1" data-path=""><a href="#r"><i class="fa fa-check"></i><b>0.1.1</b> R</a></li>
<li class="chapter" data-level="0.1.2" data-path=""><a href="#system-libraries"><i class="fa fa-check"></i><b>0.1.2</b> System libraries</a></li>
<li class="chapter" data-level="0.1.3" data-path=""><a href="#rstudio"><i class="fa fa-check"></i><b>0.1.3</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path=""><a href="#installation"><i class="fa fa-check"></i><b>0.2</b> Installation</a></li>
<li class="chapter" data-level="0.3" data-path=""><a href="#setting-up-a-project"><i class="fa fa-check"></i><b>0.3</b> Setting up a project</a><ul>
<li class="chapter" data-level="0.3.1" data-path=""><a href="#rstudio-1"><i class="fa fa-check"></i><b>0.3.1</b> RStudio</a></li>
<li class="chapter" data-level="0.3.2" data-path=""><a href="#from-the-terminal"><i class="fa fa-check"></i><b>0.3.2</b> From the terminal</a></li>
<li class="chapter" data-level="0.3.3" data-path=""><a href="#linking-to-the-data"><i class="fa fa-check"></i><b>0.3.3</b> Linking to the data</a></li>
</ul></li>
<li class="chapter" data-level="0.4" data-path=""><a href="#learning-r"><i class="fa fa-check"></i><b>0.4</b> Learning R</a></li>
<li class="chapter" data-level="0.5" data-path=""><a href="#isolating-harp"><i class="fa fa-check"></i><b>0.5</b> Isolating harp</a><ul>
<li class="chapter" data-level="0.5.1" data-path=""><a href="#introduction"><i class="fa fa-check"></i><b>0.5.1</b> Introduction</a></li>
<li class="chapter" data-level="0.5.2" data-path=""><a href="#file-templates"><i class="fa fa-check"></i><b>0.5.2</b> File templates</a></li>
<li class="chapter" data-level="0.5.3" data-path=""><a href="#deterministic-forecast-data"><i class="fa fa-check"></i><b>0.5.3</b> Deterministic forecast data</a></li>
<li class="chapter" data-level="0.5.4" data-path=""><a href="#introduction-1"><i class="fa fa-check"></i><b>0.5.4</b> Introduction</a></li>
<li class="chapter" data-level="0.5.5" data-path=""><a href="#read-and-interpolate-2m-temperature"><i class="fa fa-check"></i><b>0.5.5</b> Read and interpolate 2m temperature</a></li>
<li class="chapter" data-level="0.5.6" data-path=""><a href="#lagged-ensembles"><i class="fa fa-check"></i><b>0.5.6</b> Lagged ensembles</a></li>
<li class="chapter" data-level="0.5.7" data-path=""><a href="#introduction-2"><i class="fa fa-check"></i><b>0.5.7</b> Introduction</a></li>
<li class="chapter" data-level="0.5.8" data-path=""><a href="#converting-observations-to-sqlite"><i class="fa fa-check"></i><b>0.5.8</b> Converting observations to SQLite</a></li>
<li class="chapter" data-level="0.5.9" data-path=""><a href="#introduction-3"><i class="fa fa-check"></i><b>0.5.9</b> Introduction</a></li>
<li class="chapter" data-level="0.5.10" data-path=""><a href="#deterministic-data"><i class="fa fa-check"></i><b>0.5.10</b> Deterministic data</a></li>
<li class="chapter" data-level="0.5.11" data-path=""><a href="#introduction-4"><i class="fa fa-check"></i><b>0.5.11</b> Introduction</a></li>
<li class="chapter" data-level="0.5.12" data-path=""><a href="#reading-in-ensemble-data"><i class="fa fa-check"></i><b>0.5.12</b> Reading in ensemble data</a></li>
<li class="chapter" data-level="0.5.13" data-path=""><a href="#verification"><i class="fa fa-check"></i><b>0.5.13</b> Verification</a></li>
</ul></li>
<li class="chapter" data-level="0.6" data-path=""><a href="#to-be-added"><i class="fa fa-check"></i><b>0.6</b> TO BE ADDED</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">harp Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">harp Tutorial</h1>
<p class="author"><em>Andrew Singleton</em></p>
<p class="date"><em>2020-06-22</em></p>
</div>
<div id="system-requirements" class="section level2">
<h2><span class="header-section-number">0.1</span> System Requirements</h2>
<div id="r" class="section level3">
<h3><span class="header-section-number">0.1.1</span> R</h3>
<p>harp has been tested on Linux platforms with R versions going back to R 3.3.1. At the time of writing, the current version of R is R 4.0.1. See <a href="https://cran.r-project.org/" class="uri">https://cran.r-project.org/</a> for details on how to download and install R.</p>
</div>
<div id="system-libraries" class="section level3">
<h3><span class="header-section-number">0.1.2</span> System libraries</h3>
<p>harp depends on some system libraries that may not be installed by default. We are working on identifying all of these, but the most common missing library is <a href="https://proj.org">PROJ</a>. On Ubuntu this can be installed with</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">sudo</span> apt-get update</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">sudo</span> apt-get install libproj-dev</span></code></pre></div>
<p>If you do not have sudo rights, speak to your system administrator, or install proj in a location that is writable to you following the instructions at <a href="https://proj.org/install.html" class="uri">https://proj.org/install.html</a>. Note that for guaranteed performance you should use version 4.9.3.</p>
<p>If you wish to use NetCDF files with harp you will also need to install libnetcdf-dev using apt-get install or the equivalent for your system. If you wish to use grib files you will need to install eccodes - for Ubuntu 18 and newer, this is available via apt-get install libeccodes-dev, otherwise see <a href="https://confluence.ecmwf.int/display/ECC" class="uri">https://confluence.ecmwf.int/display/ECC</a>.</p>
</div>
<div id="rstudio" class="section level3">
<h3><span class="header-section-number">0.1.3</span> RStudio</h3>
<p>RStudio is an IDE for R that makes working in R much easier. It is recommended that you work with RStudio for harp, though it is possible to work in a terminal and use any editor for writing scripts. Go to <a href="https://rstudio.com/products/rstudio/" class="uri">https://rstudio.com/products/rstudio/</a> to download RStudio.</p>
</div>
</div>
<div id="installation" class="section level2">
<h2><span class="header-section-number">0.2</span> Installation</h2>
<p>harp is stored on Github, which makes installation within R straightforward. There are a number of dependencies that need to be downloaded and compiled, so if you have a new R installation the process can take some time. First you need to start R, or RStudio and install the <code>"remotes"</code> package using <code>install.packages</code>.</p>
<p>If you are concerned about updating R packages that you use for other projects then skip the rest of this section and go to the section on <a href="#isolating-harp">Isolating harp</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span></code></pre></div>
<p>Then we can use the remotes package to install harp from Github:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;andrew-MET/harp&quot;</span>)</span></code></pre></div>
<p>Note that “andrew-MET” is a development location for harp, and the recommended place to download from will soon change.
If you encounter problems with system libraries, the missing libraries will make themselves known at this stage. If you have system libraries installed in non-standard locations, you can specify those locations using the <code>configure.args</code> argument in combination with the R package that needs the system library. For example, if you have PROJ, which is required by the <code>meteogrid</code> package, installed in a non-standard location, you would do the following:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="st">&quot;andrew-MET/harp&quot;</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="dt">configure.args =</span> <span class="kw">c</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="dt">meteogrid =</span> <span class="st">&quot;--with-proj=/path/to/proj&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  )</span>
<span id="cb4-6"><a href="#cb4-6"></a>)</span></code></pre></div>
<p>where <code>/path/to/proj</code> is the full path to your PROJ installation.</p>
</div>
<div id="setting-up-a-project" class="section level2">
<h2><span class="header-section-number">0.3</span> Setting up a project</h2>
<p>To follow the tutorial, you will need to download the data. These data are found in the harpData package, which can also be installed from Github:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;andrew-MET/harpData&quot;</span>)</span></code></pre></div>
<p>For the tutorial you should set up a project in clean directory. There are slightly different approaches depending on whether you’re using <a href="#rstudio-1">RStudio</a> or R <a href="#from-the-terminal">from the terminal</a></p>
<div id="rstudio-1" class="section level3">
<h3><span class="header-section-number">0.3.1</span> RStudio</h3>
<p>Click on:
| File &gt; New Project
Select:
| - New Directory
| - New Project
Choose a directory name (e.g. harp_tutorial)
Browse to a directory under which your project should reside
Click on:
| Create Project</p>
</div>
<div id="from-the-terminal" class="section level3">
<h3><span class="header-section-number">0.3.2</span> From the terminal</h3>
<p>Open R and do the following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>project_dir &lt;-<span class="st"> &quot;/path/to/harp_tutorial&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">dir.create</span>(project_dir, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">setwd</span>(project_dir)</span></code></pre></div>
<p>Alternatively, you can create the directory outside of R and start R from that directory.</p>
</div>
<div id="linking-to-the-data" class="section level3">
<h3><span class="header-section-number">0.3.3</span> Linking to the data</h3>
<p>We will use the <code>here</code> package to set the base directory of our project. This means that whatever directory we are currently in within the project, we can set relative paths to any files and directories in the project. We also make use of the tidyverse for some data manipulation functions.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;here&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">library</span>(here)</span></code></pre></div>
<p>Now will create a data directory and link the contents of the harpData package to the data directory. We will do this by making a vector of the directories we want and loop over the vector and create the directories. Don’t worry too much about the syntax at this stage.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">dir.create</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="cf">for</span> (data_dir <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;grib&quot;</span>, <span class="st">&quot;netcdf&quot;</span>, <span class="st">&quot;vfld&quot;</span>, <span class="st">&quot;vobs&quot;</span>)) {</span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="kw">file.symlink</span>(<span class="dt">from =</span> <span class="kw">system.file</span>(data_dir, <span class="dt">package =</span> <span class="st">&quot;harpData&quot;</span>), <span class="dt">to =</span> <span class="kw">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb9-4"><a href="#cb9-4"></a>}</span></code></pre></div>
<p>You are now ready to start the first tutorial!</p>
</div>
</div>
<div id="learning-r" class="section level2">
<h2><span class="header-section-number">0.4</span> Learning R</h2>
<p>It is not the purpose of this tutorial to teach R, but rather to teach the usage of harp in R. While it is not necessary to know R to learn how to use harp, a basic understanding of the language would be useful. One of the best resources for getting started with R is the book “R for Data Science” by Hadley Wickham, which is available for free online at <a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>. This book makes use of what is known as the “tidyverse” in R, and harp follows many of the same principles so the book is an extremely useful learning resource for harp.</p>
</div>
<div id="isolating-harp" class="section level2">
<h2><span class="header-section-number">0.5</span> Isolating harp</h2>
<p>If you use R for other projects that are sensitive to package versions, and thus don’t want to risk updating those packages when you install harp, you can install harp as a project with its own package repository. This is done using the renv package.</p>
<p>In RStudio this is straightforward - when you create the project, tick the box labeled “Use renv with this project” (for older versions of RStudio this will be “Use Packrat with this project”) before clicking on the final “Create Project” button.</p>
<p>If you are using R from the terminal, before installing harp create the project directory as described in R <a href="#from-the-terminal">from the terminal</a> and navigate to it using <code>setwd</code>. Then use renv to create the isolated environment:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;renv&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>renv<span class="op">::</span><span class="kw">init</span>()</span>
<span id="cb10-3"><a href="#cb10-3"></a>renv<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;andrew-MET/harp&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a>renv<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>renv<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;here&quot;</span>)</span>
<span id="cb10-6"><a href="#cb10-6"></a>renv<span class="op">::</span><span class="kw">snapshot</span>()</span></code></pre></div>
<p>You will need to do this for every harp based project, but it will ensure that you do not overwrite any version sensitive packages.</p>

<div id="introduction" class="section level3">
<h3><span class="header-section-number">0.5.1</span> Introduction</h3>
<p>The “internal” file format for harp is SQLite. SQLite allows fast access to the data and the ability to filter exactly what you want to read. Once our data are in SQLite format, we don’t have to convert them again.</p>
<p>In most cases you also need to interpolate forecast data to station locations, and harp enables you to read the data, interpolate it, and write the interpolated data in one function. This can be done for grib files, FA files, netcdf files (from MET Norway) and vfld files (which are already interpolated). All of the file IO in harp is handled by the package harpIO.</p>
</div>
<div id="file-templates" class="section level3">
<h3><span class="header-section-number">0.5.2</span> File templates</h3>
<p>NWP files typically have information from any of the date, lead time, parameter, member number (for ensemble forecasts) and potentially more in the file name and / or directory structure. This means that the exact file names are never the same though they will always have the same structure. harp provides functionality for using templates for file names, and also has a number of built in templates for known formats. You can list these using <code>show_file_templates()</code> and see the way that the templates are built.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">library</span>(harp)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">library</span>(here)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">show_file_templates</span>()</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">## # A tibble: 31 x 2</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">##    template_name         template                                                                                         </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">##    &lt;chr&gt;                 &lt;chr&gt;                                                                                            </span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">##  1 arome_arctic_extract… /lustre/storeB/immutable/archive/projects/metproduction/DNMI_AROME_ARCTIC/{YYYY}/{MM}/{DD}/arome…</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">##  2 arome_arctic_full     /lustre/storeB/immutable/archive/projects/metproduction/DNMI_AROME_ARCTIC/{YYYY}/{MM}/{DD}/arome…</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">##  3 arome_arctic_sfx      /lustre/storeB/immutable/archive/projects/metproduction/DNMI_AROME_ARCTIC/{YYYY}/{MM}/{DD}/arome…</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">##  4 fctable               {file_path}/{fcst_model}/{YYYY}/{MM}/FCTABLE_{parameter}_{YYYY}{MM}_{HH}.sqlite                  </span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">##  5 fctable_det           {file_path}/{det_model}/{YYYY}/{MM}/FCTABLE_{parameter}_{YYYY}{MM}_{HH}.sqlite                   </span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">##  6 fctable_eps           {file_path}/{eps_model}/{YYYY}/{MM}/FCTABLE_{parameter}_{YYYY}{MM}_{HH}+{LDT3}.sqlite            </span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">##  7 fctable_eps_all_cycl… {file_path}/{eps_model}/{YYYY}/{MM}/FCTABLE_{parameter}_{YYYY}{MM}+{LDT3}.sqlite                 </span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">##  8 fctable_eps_all_leads {file_path}/{eps_model}/{YYYY}/{MM}/FCTABLE_{parameter}_{YYYY}{MM}_{HH}.sqlite                   </span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">##  9 glameps_grib          {file_path}/{eps_model}/{sub_model}/{YYYY}/{MM}/{DD}/{HH}/mbr{MBR3}/fc{YYYY}{MM}{DD}_{HH}+{LDT3}…</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">## 10 harmoneps_grib        {file_path}/{YYYY}/{MM}/{DD}/{HH}/mbr{MBR3}/fc{YYYY}{MM}{DD}{HH}+{LDT3}grib                      </span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">## 11 harmoneps_grib_fp     {file_path}/{YYYY}/{MM}/{DD}/{HH}/mbr{MBR3}/fc{YYYY}{MM}{DD}{HH}+{LDT3}grib_fp                   </span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">## 12 harmoneps_grib_sfx    {file_path}/{YYYY}/{MM}/{DD}/{HH}/mbr{MBR3}/fc{YYYY}{MM}{DD}{HH}+{LDT3}grib_sfx                  </span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">## 13 harmonie_grib         {file_path}/{YYYY}/{MM}/{DD}/{HH}/fc{YYYY}{MM}{DD}{HH}+{LDT3}grib                                </span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">## 14 harmonie_grib_fp      {file_path}/{YYYY}/{MM}/{DD}/{HH}/fc{YYYY}{MM}{DD}{HH}+{LDT3}grib_fp                             </span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="co">## 15 harmonie_grib_sfx     {file_path}/{YYYY}/{MM}/{DD}/{HH}/fc{YYYY}{MM}{DD}{HH}+{LDT3}grib_sfx                            </span></span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="co">## 16 meps_cntrl_extracted  /lustre/storeB/immutable/archive/projects/metproduction/MEPS/{YYYY}/{MM}/{DD}/meps_mbr0_extracte…</span></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co">## 17 meps_cntrl_sfx        /lustre/storeB/immutable/archive/projects/metproduction/MEPS/{YYYY}/{MM}/{DD}/meps_mbr0_sfx_2_5k…</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co">## 18 meps_extracted        /lustre/storeB/immutable/archive/projects/metproduction/MEPS/{YYYY}/{MM}/{DD}/meps_extracted_2_5…</span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="co">## 19 meps_full             /lustre/storeB/immutable/archive/projects/metproduction/MEPS/{YYYY}/{MM}/{DD}/meps_full_2_5km_{Y…</span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co">## 20 meps_sfx              /lustre/storeB/immutable/archive/projects/metproduction/MEPS/{YYYY}/{MM}/{DD}/meps_sfx_2_5km_{YY…</span></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="co">## 21 meps_subset           /lustre/storeB/immutable/archive/projects/metproduction/MEPS/{YYYY}/{MM}/{DD}/meps_subset_2_5km_…</span></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="co">## 22 obstable              {file_path}/OBSTABLE_{YYYY}.sqlite                                                               </span></span>
<span id="cb11-29"><a href="#cb11-29"></a><span class="co">## 23 vfld                  {file_path}/{fcst_model}/vfld{fcst_model}{YYYY}{MM}{DD}{HH}{LDT2}                                </span></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="co">## 24 vfld_det              {file_path}/{det_model}/vfld{det_model}{YYYY}{MM}{DD}{HH}{LDT2}                                  </span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="co">## 25 vfld_det_noexp        {file_path}/{det_model}/vfld{YYYY}{MM}{DD}{HH}{LDT2}                                             </span></span>
<span id="cb11-32"><a href="#cb11-32"></a><span class="co">## 26 vfld_eps              {file_path}/{sub_model}/vfld{sub_model}mbr{MBR3}{YYYY}{MM}{DD}{HH}{LDT2}                         </span></span>
<span id="cb11-33"><a href="#cb11-33"></a><span class="co">## 27 vfld_eps_noexp        {file_path}/{sub_model}/vfldmbr{MBR3}{YYYY}{MM}{DD}{HH}{LDT2}                                    </span></span>
<span id="cb11-34"><a href="#cb11-34"></a><span class="co">## 28 vfld_multimodel       {file_path}/{sub_model}/vfld{sub_model}mbr{MBR3}{YYYY}{MM}{DD}{HH}{LDT2}                         </span></span>
<span id="cb11-35"><a href="#cb11-35"></a><span class="co">## 29 vfld_multimodel_noexp {file_path}/{sub_model}/vfldmbr{MBR3}{YYYY}{MM}{DD}{HH}{LDT2}                                    </span></span>
<span id="cb11-36"><a href="#cb11-36"></a><span class="co">## 30 vfld_noexp            {file_path}/{fcst_model}/vfldmbr{MBR3}{YYYY}{MM}{DD}{HH}{LDT2}                                   </span></span>
<span id="cb11-37"><a href="#cb11-37"></a><span class="co">## 31 vobs                  {file_path}/vobs{YYYY}{MM}{DD}{HH}</span></span></code></pre></div>
<p>Since the output is typically truncated you can see one of the templates in full by supplying the row number in the original output. For example, to see the template for vfld files</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">show_file_templates</span>(<span class="dv">23</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">## </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">## template_name:</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">##  vfld </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">##  </span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">## template:</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">##  {file_path}/{fcst_model}/vfld{fcst_model}{YYYY}{MM}{DD}{HH}{LDT2}</span></span></code></pre></div>
</div>
<div id="deterministic-forecast-data" class="section level3">
<h3><span class="header-section-number">0.5.3</span> Deterministic forecast data</h3>
<p>Let’s go ahead and read some data. In the data directory you will find a vfld directory and there you will find a directory for AROME_Arctic_prod. Under that directory you will find vfld files for one day of forecasts. To read the date we will use the function <code>read_forecast</code>. Each of the arguments are annotated so that you understand what they are for.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,           <span class="co"># the first forecast for which we have data</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,           <span class="co"># the last forecast for which we have data</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="dt">fcst_model     =</span> <span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="co"># the name of the deterministic model as in the file name</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,                <span class="co"># We are going to read 2m temperature</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">48</span>, <span class="dv">3</span>),        <span class="co"># We have data for lead times 0 - 48 at 3 hour intervals</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,                 <span class="co"># We have forecasts every 6 hours</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    <span class="co"># We don&#39;t include AROME_Arctic_prod in the path...</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="dt">file_template =</span> <span class="st">&quot;vfld&quot;</span>,               <span class="co"># ...because it&#39;s in the template</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="dt">return_data   =</span> <span class="ot">TRUE</span>                  <span class="co"># We want to get some data back - by default nothing is returned</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>)</span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">## # A tibble: 16,796 x 10</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle AROME_Arctic_prod_det</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;                      &lt;dbl&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                          270.</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1002  80.1 16.2  K     2019-02-17 00:00:00 00                          250.</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1003  77   15.5  K     2019-02-17 00:00:00 00                          253.</span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1004  78.9 11.9  K     2019-02-17 00:00:00 00                          251.</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1006  78.3 22.8  K     2019-02-17 00:00:00 00                          244.</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1007  78.9 11.9  K     2019-02-17 00:00:00 00                          251.</span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1008  78.2 15.5  K     2019-02-17 00:00:00 00                          252.</span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1009  80.7 25.0  K     2019-02-17 00:00:00 00                          246.</span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                          275.</span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1011  80.1 31.5  K     2019-02-17 00:00:00 00                          241.</span></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co">## # … with 16,786 more rows</span></span></code></pre></div>
<p>We don’t have to only handle one model at a time, as long as they have the same file format and fit the same template. We also have data for MEPS, which is an ensemble, but we can just read member 0 by setting the correct template. When there are different options for each fcst_model they can be passed as a named list as below:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="dt">fcst_model    =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),  </span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,                </span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">48</span>, <span class="dv">3</span>), </span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="dt">file_template =</span> <span class="kw">list</span>(</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="dt">AROME_Arctic_prod =</span> <span class="st">&quot;vfld&quot;</span>, </span>
<span id="cb14-11"><a href="#cb14-11"></a>    <span class="dt">MEPS_prod         =</span> <span class="st">&quot;{fcst_model}/vfld{fcst_model}mbr000{YYYY}{MM}{DD}{HH}{LDT2}&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  ),</span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="dt">return_data   =</span> <span class="ot">TRUE</span>                  </span>
<span id="cb14-14"><a href="#cb14-14"></a>)</span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">## # A tibble: 16,796 x 10</span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle AROME_Arctic_prod_det</span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;                      &lt;dbl&gt;</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                          270.</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1002  80.1 16.2  K     2019-02-17 00:00:00 00                          250.</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1003  77   15.5  K     2019-02-17 00:00:00 00                          253.</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1004  78.9 11.9  K     2019-02-17 00:00:00 00                          251.</span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1006  78.3 22.8  K     2019-02-17 00:00:00 00                          244.</span></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1007  78.9 11.9  K     2019-02-17 00:00:00 00                          251.</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1008  78.2 15.5  K     2019-02-17 00:00:00 00                          252.</span></span>
<span id="cb14-26"><a href="#cb14-26"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1009  80.7 25.0  K     2019-02-17 00:00:00 00                          246.</span></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                          275.</span></span>
<span id="cb14-28"><a href="#cb14-28"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1011  80.1 31.5  K     2019-02-17 00:00:00 00                          241.</span></span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="co">## # … with 16,786 more rows</span></span>
<span id="cb14-30"><a href="#cb14-30"></a><span class="co">## </span></span>
<span id="cb14-31"><a href="#cb14-31"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb14-32"><a href="#cb14-32"></a><span class="co">## # A tibble: 78,132 x 10</span></span>
<span id="cb14-33"><a href="#cb14-33"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle MEPS_prod_det</span></span>
<span id="cb14-34"><a href="#cb14-34"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span id="cb14-35"><a href="#cb14-35"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                  268.</span></span>
<span id="cb14-36"><a href="#cb14-36"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                  275.</span></span>
<span id="cb14-37"><a href="#cb14-37"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1014  69.2 17.9  K     2019-02-17 00:00:00 00                  273.</span></span>
<span id="cb14-38"><a href="#cb14-38"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1015  69.6 17.8  K     2019-02-17 00:00:00 00                  275.</span></span>
<span id="cb14-39"><a href="#cb14-39"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1018  69.2 16.0  K     2019-02-17 00:00:00 00                  271.</span></span>
<span id="cb14-40"><a href="#cb14-40"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1023  69.1 18.5  K     2019-02-17 00:00:00 00                  272.</span></span>
<span id="cb14-41"><a href="#cb14-41"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1025  69.7 18.9  K     2019-02-17 00:00:00 00                  272.</span></span>
<span id="cb14-42"><a href="#cb14-42"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1026  69.7 18.9  K     2019-02-17 00:00:00 00                  272.</span></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1027  69.7 18.9  K     2019-02-17 00:00:00 00                  273.</span></span>
<span id="cb14-44"><a href="#cb14-44"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1033  70.2 19.5  K     2019-02-17 00:00:00 00                  274.</span></span>
<span id="cb14-45"><a href="#cb14-45"></a><span class="co">## # … with 78,122 more rows</span></span></code></pre></div>
<p>If we want to write the data to sqlite files we need to tell it a path to write the data to. If the directories do not exist, they will be created. Let’s write the data to “data/FCTABLE”. We use FCTABLE as the directory name since in harp we refer to the SQLite files created by this process as FCTABLE files. We tell <code>read_forecast</code> that we want to output the data to files by setting <code>output_file_opts</code> to something. For SQLite files we can use the <code>sqlite_opts</code> function to set the options we need - usually you only need to set the path to the data using the <code>path</code> argument. Let’s get the vertical temperature profiles as well as the 2m temperature. You can see the parameter names that harp understands by running the function <code>show_harp_parameters</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">show_harp_parameters</span>()</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">## # A tibble: 21 x 2</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">##    harp_parameter_name description                                                          </span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">##    &lt;chr&gt;               &lt;chr&gt;                                                                </span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">##  1 AccPcp12h           Accumulated precipitation over e.g. 12 hours                         </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">##  2 Cbase               Height of cloud base                                                 </span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">##  3 CChigh              High level cloud cover                                               </span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">##  4 CClow               Low level cloud cover                                                </span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">##  5 CCmed               Medium level cloud cover                                             </span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">##  6 CCtot               Total cloud cover                                                    </span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">##  7 D10m                10m wind direction                                                   </span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">##  8 G10m                10m wind gust - period depends on input data                         </span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">##  9 Gmax                10m maximum wind gust - period depends on input data                 </span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co">## 10 Pcp                 Precipitation direct from model - usually accumulated from start time</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co">## 11 Pmsl                Pressure at mean sea level                                           </span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="co">## 12 Ps                  Pressure at surface                                                  </span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="co">## 13 Q2m                 2m specific humidity                                                 </span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="co">## 14 RH2m                2m relative humidity                                                 </span></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co">## 15 S10m                10m wind speed                                                       </span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">## 16 Smax                Maximum 10m wind speed - period depends on input data                </span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">## 17 T2m                 2m temperature                                                       </span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">## 18 Td2m                2m dewpoint temperature                                              </span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co">## 19 Tmax                Maximum 2m temperature                                               </span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="co">## 20 Tmin                Minimum 2m temperature                                               </span></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="co">## 21 vis                 Horizontal visibility                                                </span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="co">## </span></span>
<span id="cb15-27"><a href="#cb15-27"></a><span class="co">##  For upper air parameters, Z, T, RH, D, S, Q, and Td are available. Follow the</span></span>
<span id="cb15-28"><a href="#cb15-28"></a><span class="co">##  letter with a number to denote pressure level, e.g. T850, S925, Z300 etc.</span></span></code></pre></div>
<p>So the upper air parameter for temperture is T.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="dt">start_date       =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="dt">end_date         =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="dt">fcst_model       =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),  </span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="dt">parameter        =</span> <span class="kw">c</span>(<span class="st">&quot;T2m&quot;</span>, <span class="st">&quot;T&quot;</span>),                </span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="dt">lead_time        =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">48</span>, <span class="dv">3</span>),</span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="dt">by               =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="dt">file_path        =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="dt">file_template    =</span> <span class="kw">list</span>(</span>
<span id="cb16-10"><a href="#cb16-10"></a>    <span class="dt">AROME_Arctic_prod =</span> <span class="st">&quot;vfld&quot;</span>, </span>
<span id="cb16-11"><a href="#cb16-11"></a>    <span class="dt">MEPS_prod         =</span> <span class="st">&quot;{fcst_model}/vfld{fcst_model}mbr000{YYYY}{MM}{DD}{HH}{LDT2}&quot;</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>  ),</span>
<span id="cb16-13"><a href="#cb16-13"></a>  <span class="dt">output_file_opts =</span> <span class="kw">sqlite_opts</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>))</span>
<span id="cb16-14"><a href="#cb16-14"></a>)</span></code></pre></div>
<p>The function tells you where the data were written to, but you can also look under the ./data/FCTABLE/deterministic directory and see for yourself. By default <code>read_forecast</code> uses the “fctable” template, but this can be changed using the <code>template</code> argument in <code>sqlite_opts</code>. However, you should always keep the parameter name in the template.</p>
<p>There are a number of options in <code>read_forecast</code> that can be explored by looking at the help page for the function.</p>
<p>Your turn:</p>
<ul>
<li>2m temperature is, by default, corrected for the difference in elevation between the model and observation site. Create sqlite files for uncorrected 2m temperature for AROME_Arctic_prod and MEPS_prod (member 0)</li>
<li>Create sqlite files for 10m wind speed and dew point temperature for the upper air for AROME_Arctic_prod and MEPS_prod (member 0)</li>
</ul>
<p>Solutions</p>
<ul>
<li>Create sqlite files for uncorrected 2m temperature for AROME_Arctic_prod and MEPS_prod (member 0)</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="dt">start_date          =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="dt">end_date            =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="dt">fcst_model          =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),  </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="dt">parameter           =</span> <span class="st">&quot;T2m&quot;</span>,                </span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="dt">lead_time           =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">48</span>, <span class="dv">3</span>), </span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="dt">by                  =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="dt">file_path           =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="dt">file_template       =</span> <span class="kw">list</span>(</span>
<span id="cb17-10"><a href="#cb17-10"></a>    <span class="dt">AROME_Arctic_prod =</span> <span class="st">&quot;vfld&quot;</span>, </span>
<span id="cb17-11"><a href="#cb17-11"></a>    <span class="dt">MEPS_prod         =</span> <span class="st">&quot;{fcst_model}/vfld{fcst_model}mbr000{YYYY}{MM}{DD}{HH}{LDT2}&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>  ),</span>
<span id="cb17-13"><a href="#cb17-13"></a>  <span class="dt">output_file_opts    =</span> <span class="kw">sqlite_opts</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>)),</span>
<span id="cb17-14"><a href="#cb17-14"></a>  <span class="dt">transformation_opts =</span> <span class="kw">interpolate_opts</span>(<span class="dt">keep_model_t2m =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-15"><a href="#cb17-15"></a>)</span></code></pre></div>
<ul>
<li>Create sqlite files for 10m wind speed and dew point temperature for the upper air for AROME_Arctic_prod and MEPS_prod (member 0)</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="dt">start_date       =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="dt">end_date         =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="dt">fcst_model       =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),  </span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="dt">parameter        =</span> <span class="kw">c</span>(<span class="st">&quot;S10m&quot;</span>, <span class="st">&quot;Td&quot;</span>),                </span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="dt">lead_time        =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">48</span>, <span class="dv">3</span>),        </span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="dt">by               =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="dt">file_path        =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="dt">file_template    =</span> <span class="kw">list</span>(</span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="dt">AROME_Arctic_prod =</span> <span class="st">&quot;vfld&quot;</span>, </span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="dt">MEPS_prod         =</span> <span class="st">&quot;{fcst_model}/vfld{fcst_model}mbr000{YYYY}{MM}{DD}{HH}{LDT2}&quot;</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>  ),</span>
<span id="cb18-13"><a href="#cb18-13"></a>  <span class="dt">output_file_opts =</span>  <span class="kw">sqlite_opts</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>))</span>
<span id="cb18-14"><a href="#cb18-14"></a>)</span></code></pre></div>

</div>
<div id="introduction-1" class="section level3">
<h3><span class="header-section-number">0.5.4</span> Introduction</h3>
<p>The interpolation of EPS model data works in much the same way as for deterministic model data, using the <code>read_forecast</code> function. By adding the members argument, we tell <code>read_forecast</code> that we are reading ensemble data.</p>
</div>
<div id="read-and-interpolate-2m-temperature" class="section level3">
<h3><span class="header-section-number">0.5.5</span> Read and interpolate 2m temperature</h3>
<p>As mentioned in the deterministic section, there are vfld files for MEPS in the data directory. There are 10 members numbered from 0 to 9, but we only have up to a lead time of 12 hours. As for the deterministic model, let’s first get the 2m temperature</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">library</span>(here)</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="kw">library</span>(harpIO)</span>
<span id="cb19-4"><a href="#cb19-4"></a></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="kw">read_forecast</span>(</span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="dt">fcst_model    =</span> <span class="kw">c</span>(<span class="st">&quot;MEPS_prod&quot;</span>),  </span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,                </span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="dt">members       =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">9</span>), </span>
<span id="cb19-12"><a href="#cb19-12"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb19-13"><a href="#cb19-13"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb19-14"><a href="#cb19-14"></a>  <span class="dt">file_template =</span> <span class="st">&quot;vfld_eps&quot;</span>,</span>
<span id="cb19-15"><a href="#cb19-15"></a>  <span class="dt">return_data   =</span> <span class="ot">TRUE</span>                  </span>
<span id="cb19-16"><a href="#cb19-16"></a>)</span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="co">## # A tibble: 22,980 x 19</span></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle MEPS_prod_mbr000</span></span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;                 &lt;dbl&gt;</span></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                     268.</span></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                     275.</span></span>
<span id="cb19-23"><a href="#cb19-23"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1014  69.2 17.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb19-24"><a href="#cb19-24"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1015  69.6 17.8  K     2019-02-17 00:00:00 00                     275.</span></span>
<span id="cb19-25"><a href="#cb19-25"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1018  69.2 16.0  K     2019-02-17 00:00:00 00                     271.</span></span>
<span id="cb19-26"><a href="#cb19-26"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1023  69.1 18.5  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb19-27"><a href="#cb19-27"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1025  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb19-28"><a href="#cb19-28"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1026  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb19-29"><a href="#cb19-29"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1027  69.7 18.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb19-30"><a href="#cb19-30"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1033  70.2 19.5  K     2019-02-17 00:00:00 00                     274.</span></span>
<span id="cb19-31"><a href="#cb19-31"></a><span class="co">## # … with 22,970 more rows, and 9 more variables: MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;,</span></span>
<span id="cb19-32"><a href="#cb19-32"></a><span class="co">## #   MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;,</span></span>
<span id="cb19-33"><a href="#cb19-33"></a><span class="co">## #   MEPS_prod_mbr008 &lt;dbl&gt;, MEPS_prod_mbr009 &lt;dbl&gt;</span></span></code></pre></div>
<p>You will see that there are a few extra columns in the data. There is both fcst_model and sub_model. This is in case we are dealing with a multi model ensemble. There is also a column for member, and members_out. This is if you want to renumber the members for the sqlite files. Finally there is a lag column. This has information for lagged ensembles.</p>
<p>Let’s now try reading two models - the AROME_Arctic_prod deterministic model and the MEPS_prod ensemble. But how do we specify the members for more than one model? In this case we use a named list, with one element of the list for each model - and we can do the same for the file template. By setting the members to NA for AROME_Arctic_prod we tell read_forecast that it is deterministic - you could also set it to a numeric value and it would treat the AROME_Arctic_prod as a single member ensemble. We’ll just take the first 3 members from MEPS_prod for speed.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="dt">fcst_model    =</span> <span class="kw">c</span>(<span class="st">&quot;MEPS_prod&quot;</span>, <span class="st">&quot;AROME_Arctic_prod&quot;</span>),  </span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,                </span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="dt">members       =</span> <span class="kw">list</span>(<span class="dt">MEPS_prod =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">AROME_Arctic_prod =</span> <span class="ot">NA</span>), </span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="dt">file_template =</span> <span class="kw">list</span>(<span class="dt">MEPS_prod =</span> <span class="st">&quot;vfld_eps&quot;</span>, <span class="dt">AROME_Arctic_prod =</span> <span class="st">&quot;vfld&quot;</span>),</span>
<span id="cb20-11"><a href="#cb20-11"></a>  <span class="dt">return_data   =</span> <span class="ot">TRUE</span>                  </span>
<span id="cb20-12"><a href="#cb20-12"></a>)</span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="co">## # A tibble: 4,940 x 10</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle AROME_Arctic_prod_det</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;                      &lt;dbl&gt;</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                          270.</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1002  80.1 16.2  K     2019-02-17 00:00:00 00                          250.</span></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1003  77   15.5  K     2019-02-17 00:00:00 00                          253.</span></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1004  78.9 11.9  K     2019-02-17 00:00:00 00                          251.</span></span>
<span id="cb20-21"><a href="#cb20-21"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1006  78.3 22.8  K     2019-02-17 00:00:00 00                          244.</span></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1007  78.9 11.9  K     2019-02-17 00:00:00 00                          251.</span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1008  78.2 15.5  K     2019-02-17 00:00:00 00                          252.</span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1009  80.7 25.0  K     2019-02-17 00:00:00 00                          246.</span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                          275.</span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1011  80.1 31.5  K     2019-02-17 00:00:00 00                          241.</span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="co">## # … with 4,930 more rows</span></span>
<span id="cb20-28"><a href="#cb20-28"></a><span class="co">## </span></span>
<span id="cb20-29"><a href="#cb20-29"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb20-30"><a href="#cb20-30"></a><span class="co">## # A tibble: 22,980 x 12</span></span>
<span id="cb20-31"><a href="#cb20-31"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle MEPS_prod_mbr000</span></span>
<span id="cb20-32"><a href="#cb20-32"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;                 &lt;dbl&gt;</span></span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                     268.</span></span>
<span id="cb20-34"><a href="#cb20-34"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                     275.</span></span>
<span id="cb20-35"><a href="#cb20-35"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1014  69.2 17.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb20-36"><a href="#cb20-36"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1015  69.6 17.8  K     2019-02-17 00:00:00 00                     275.</span></span>
<span id="cb20-37"><a href="#cb20-37"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1018  69.2 16.0  K     2019-02-17 00:00:00 00                     271.</span></span>
<span id="cb20-38"><a href="#cb20-38"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1023  69.1 18.5  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb20-39"><a href="#cb20-39"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1025  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb20-40"><a href="#cb20-40"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1026  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb20-41"><a href="#cb20-41"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1027  69.7 18.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb20-42"><a href="#cb20-42"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1033  70.2 19.5  K     2019-02-17 00:00:00 00                     274.</span></span>
<span id="cb20-43"><a href="#cb20-43"></a><span class="co">## # … with 22,970 more rows, and 2 more variables: MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;</span></span></code></pre></div>
<p>We could also generate a multimodel ensemble. Here we use a named nested list for members and a named list for fcst_model. Note also that we have to set custom template for AROME_Arctic_prod since for multimodel ensembles to work, {sub_model} needs to be a part of the file template.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="dt">start_date        =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="dt">end_date          =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="dt">fcst_model        =</span> <span class="kw">list</span>(<span class="dt">awesome_multimodel_eps =</span> <span class="kw">c</span>(<span class="st">&quot;MEPS_prod&quot;</span>, <span class="st">&quot;AROME_Arctic_prod&quot;</span>)),  </span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="dt">parameter         =</span> <span class="st">&quot;T2m&quot;</span>,                </span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="dt">lead_time         =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="dt">members           =</span> <span class="kw">list</span>(<span class="dt">awesome_multimodel_eps =</span> <span class="kw">list</span>(<span class="dt">MEPS_prod =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">AROME_Arctic_prod =</span> <span class="dv">0</span>)), </span>
<span id="cb21-8"><a href="#cb21-8"></a>  <span class="dt">by                =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="dt">file_path         =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="dt">file_template     =</span> <span class="kw">list</span>(</span>
<span id="cb21-11"><a href="#cb21-11"></a>    <span class="dt">awesome_mutlimodel_eps =</span> <span class="kw">list</span>(</span>
<span id="cb21-12"><a href="#cb21-12"></a>      <span class="dt">MEPS_prod         =</span> <span class="st">&quot;vfld_multimodel&quot;</span>, </span>
<span id="cb21-13"><a href="#cb21-13"></a>      <span class="dt">AROME_Arctic_prod =</span> <span class="st">&quot;{sub_model}/vfld{sub_model}{YYYY}{MM}{DD}{HH}{LDT2}&quot;</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>    )</span>
<span id="cb21-15"><a href="#cb21-15"></a>  ),</span>
<span id="cb21-16"><a href="#cb21-16"></a>  <span class="dt">return_data       =</span> <span class="ot">TRUE</span>, </span>
<span id="cb21-17"><a href="#cb21-17"></a>)</span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="co">## ● awesome_multimodel_eps</span></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="co">## # A tibble: 23,340 x 13</span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle AROME_Arctic_pr…</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;                 &lt;dbl&gt;</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                     270.</span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                     275.</span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1014  69.2 17.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1015  69.6 17.8  K     2019-02-17 00:00:00 00                     274.</span></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1018  69.2 16.0  K     2019-02-17 00:00:00 00                     271.</span></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1023  69.1 18.5  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb21-28"><a href="#cb21-28"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1025  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb21-29"><a href="#cb21-29"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1026  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb21-30"><a href="#cb21-30"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1027  69.7 18.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1033  70.2 19.5  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="co">## # … with 23,330 more rows, and 3 more variables: MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;</span></span></code></pre></div>
<p>You will see that the members are named differently for each of the models in the ensemble. You can also use the <code>split_multimodel</code> function to separate out each of the sub models into their own data frames in the harp_fcst list.</p>
<p>Your turn:</p>
<ul>
<li>Create sqlite files for all members of MEPS_prod for lead times 0, 3, 6, 9 and 12 for 2m temperature (both corrected and uncorrected), 10m wind speed and temperature and dew point temperature for the upper air.</li>
<li>Make a multimodel ensemble with members 0-5 of MEPS_prod and AROME_Arctic_prod as a single member ensemble and write out the output to sqlite files for the same lead times and parameters as above. Note that to ensure unique rows in the sqlite files we cannot write out the model elevation. See <code>?sqlite_opts</code> for how to control this behaviour.</li>
</ul>
<p>Solutions</p>
<ul>
<li>Create sqlite files for all members of MEPS_prod for lead times 0, 3, 6, 9 and 12 for 2m temperature (both corrected and uncorrected), 10m wind speed and temperature and dew point temperature for the upper air.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="dt">start_date          =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="dt">end_date            =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="dt">fcst_model          =</span> <span class="st">&quot;MEPS_prod&quot;</span>,  </span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="dt">parameter           =</span> <span class="kw">c</span>(<span class="st">&quot;T2m&quot;</span>, <span class="st">&quot;S10m&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;Td&quot;</span>),                </span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="dt">lead_time           =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="dt">members             =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">9</span>), </span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="dt">by                  =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="dt">file_path           =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="dt">file_template       =</span> <span class="st">&quot;vfld_eps&quot;</span>,</span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="dt">transformation_opts =</span> <span class="kw">interpolate_opts</span>(<span class="dt">keep_model_t2m =</span> <span class="ot">TRUE</span>),</span>
<span id="cb22-12"><a href="#cb22-12"></a>  <span class="dt">output_file_opts    =</span> <span class="kw">sqlite_opts</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>))</span>
<span id="cb22-13"><a href="#cb22-13"></a>)</span></code></pre></div>
<ul>
<li>Make a multimodel ensemble with members 0-5 of MEPS_prod and AROME_Arctic_prod and write out the output to sqlite files for the same lead times and parameters as above.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="dt">start_date        =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="dt">end_date          =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="dt">fcst_model        =</span> <span class="kw">list</span>(<span class="dt">awesome_multimodel_eps =</span> <span class="kw">c</span>(<span class="st">&quot;MEPS_prod&quot;</span>, <span class="st">&quot;AROME_Arctic_prod&quot;</span>)),  </span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="dt">parameter         =</span> <span class="kw">c</span>(<span class="st">&quot;T2m&quot;</span>, <span class="st">&quot;S10m&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;Td&quot;</span>),                </span>
<span id="cb23-6"><a href="#cb23-6"></a>  <span class="dt">lead_time         =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="dt">members           =</span> <span class="kw">list</span>(<span class="dt">awesome_multimodel_eps =</span> <span class="kw">list</span>(<span class="dt">MEPS_prod =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">AROME_Arctic_prod =</span> <span class="dv">0</span>)), </span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="dt">by                =</span> <span class="st">&quot;6h&quot;</span>,                </span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="dt">file_path         =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb23-10"><a href="#cb23-10"></a>  <span class="dt">file_template     =</span> <span class="kw">list</span>(</span>
<span id="cb23-11"><a href="#cb23-11"></a>    <span class="dt">awesome_multimodel_eps =</span> <span class="kw">list</span>(</span>
<span id="cb23-12"><a href="#cb23-12"></a>      <span class="dt">MEPS_prod         =</span> <span class="st">&quot;vfld_multimodel&quot;</span>,</span>
<span id="cb23-13"><a href="#cb23-13"></a>      <span class="dt">AROME_Arctic_prod =</span> <span class="st">&quot;{sub_model}/vfld{sub_model}{YYYY}{MM}{DD}{HH}{LDT2}&quot;</span></span>
<span id="cb23-14"><a href="#cb23-14"></a>    )</span>
<span id="cb23-15"><a href="#cb23-15"></a>  ),</span>
<span id="cb23-16"><a href="#cb23-16"></a>  <span class="dt">transformation_opts =</span> <span class="kw">interpolate_opts</span>(<span class="dt">keep_model_t2m =</span> <span class="ot">TRUE</span>),</span>
<span id="cb23-17"><a href="#cb23-17"></a>  <span class="dt">output_file_opts    =</span> <span class="kw">sqlite_opts</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>), <span class="dt">remove_model_elev =</span> <span class="ot">TRUE</span>)</span>
<span id="cb23-18"><a href="#cb23-18"></a>)</span></code></pre></div>
</div>
<div id="lagged-ensembles" class="section level3">
<h3><span class="header-section-number">0.5.6</span> Lagged ensembles</h3>
<p>In a number of Hirlam institutes (MetCoOp and DMI) “continuous” ensembles are being run. With these a small number of members are run each hour and the full ensemble is constructed by lagging these hourly members. In MetCoOp this ensemble is known as CMEPS and is currently running in test mode. We have some vfld files for CMEPS_prod in the data directory for the same dates as the other modelling systems. Each member runs every three hours, with members 1 and 2 at 00, 03…, 21; members 5 and 6 at 01, 04…, 22; and members 3 and 4 at 02, 05…, 23. To construct the ensemble for 03, we need members from 03, 02 and 01. We specifiy what lags we need as a named list that is the same length as the members argument.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;CMEPS_prod&quot;</span>, </span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,                </span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="dt">members       =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb24-8"><a href="#cb24-8"></a>  <span class="dt">lags          =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="dt">by            =</span> <span class="st">&quot;3h&quot;</span>,                </span>
<span id="cb24-10"><a href="#cb24-10"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="dt">file_template =</span> <span class="st">&quot;vfld_eps&quot;</span>,</span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="dt">return_data   =</span> <span class="ot">TRUE</span>                  </span>
<span id="cb24-13"><a href="#cb24-13"></a>)</span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="co">## ● CMEPS_prod</span></span>
<span id="cb24-15"><a href="#cb24-15"></a><span class="co">## # A tibble: 40,215 x 15</span></span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="co">##    fcdate              lead_time parameter   SID   lat   lon units validdate           fcst_cycle CMEPS_prod_mbr0…</span></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="co">##    &lt;dttm&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;                 &lt;dbl&gt;</span></span>
<span id="cb24-18"><a href="#cb24-18"></a><span class="co">##  1 2019-02-17 00:00:00         0 T2m        1001  70.9 -8.67 K     2019-02-17 00:00:00 00                     269.</span></span>
<span id="cb24-19"><a href="#cb24-19"></a><span class="co">##  2 2019-02-17 00:00:00         0 T2m        1010  69.3 16.1  K     2019-02-17 00:00:00 00                     275.</span></span>
<span id="cb24-20"><a href="#cb24-20"></a><span class="co">##  3 2019-02-17 00:00:00         0 T2m        1014  69.2 17.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb24-21"><a href="#cb24-21"></a><span class="co">##  4 2019-02-17 00:00:00         0 T2m        1015  69.6 17.8  K     2019-02-17 00:00:00 00                     275.</span></span>
<span id="cb24-22"><a href="#cb24-22"></a><span class="co">##  5 2019-02-17 00:00:00         0 T2m        1018  69.2 16.0  K     2019-02-17 00:00:00 00                     271.</span></span>
<span id="cb24-23"><a href="#cb24-23"></a><span class="co">##  6 2019-02-17 00:00:00         0 T2m        1023  69.1 18.5  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb24-24"><a href="#cb24-24"></a><span class="co">##  7 2019-02-17 00:00:00         0 T2m        1025  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb24-25"><a href="#cb24-25"></a><span class="co">##  8 2019-02-17 00:00:00         0 T2m        1026  69.7 18.9  K     2019-02-17 00:00:00 00                     272.</span></span>
<span id="cb24-26"><a href="#cb24-26"></a><span class="co">##  9 2019-02-17 00:00:00         0 T2m        1027  69.7 18.9  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb24-27"><a href="#cb24-27"></a><span class="co">## 10 2019-02-17 00:00:00         0 T2m        1033  70.2 19.5  K     2019-02-17 00:00:00 00                     273.</span></span>
<span id="cb24-28"><a href="#cb24-28"></a><span class="co">## # … with 40,205 more rows, and 5 more variables: CMEPS_prod_mbr001 &lt;dbl&gt;, CMEPS_prod_mbr003_lag2h &lt;dbl&gt;,</span></span>
<span id="cb24-29"><a href="#cb24-29"></a><span class="co">## #   CMEPS_prod_mbr004_lag2h &lt;dbl&gt;, CMEPS_prod_mbr005_lag1h &lt;dbl&gt;, CMEPS_prod_mbr006_lag1h &lt;dbl&gt;</span></span></code></pre></div>
<p>Your turn</p>
<ul>
<li>Get CMEPS_prod data for all of the same parameters as before and write to SQLite files</li>
<li>Do the same for precipitation (“Pcp”) for both CMEPS_prod and MEPS_prod</li>
</ul>
<p>Solutions</p>
<ul>
<li>Get CMEPS_prod data for all of the same parameters as before and write to SQLite files</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="dt">start_date          =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="dt">end_date            =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="dt">fcst_model          =</span> <span class="st">&quot;CMEPS_prod&quot;</span>, </span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="dt">parameter           =</span> <span class="kw">c</span>(<span class="st">&quot;T2m&quot;</span>, <span class="st">&quot;S10m&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;Td&quot;</span>),                 </span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="dt">lead_time           =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="dt">members             =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="dt">lags                =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="dt">by                  =</span> <span class="st">&quot;3h&quot;</span>,                </span>
<span id="cb25-10"><a href="#cb25-10"></a>  <span class="dt">file_path           =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb25-11"><a href="#cb25-11"></a>  <span class="dt">file_template       =</span> <span class="st">&quot;vfld_eps&quot;</span>,</span>
<span id="cb25-12"><a href="#cb25-12"></a>  <span class="dt">transformation_opts =</span> <span class="kw">interpolate_opts</span>(<span class="dt">keep_model_t2m  =</span> <span class="ot">TRUE</span>),</span>
<span id="cb25-13"><a href="#cb25-13"></a>  <span class="dt">output_file_opts    =</span> <span class="kw">sqlite_opts</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>))</span>
<span id="cb25-14"><a href="#cb25-14"></a>)</span></code></pre></div>
<ul>
<li>Do the same for precipitation (“Pcp”) for both CMEPS_prod and MEPS_prod</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">read_forecast</span>(</span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="dt">start_date      =</span> <span class="dv">2019021700</span>,           </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="dt">end_date        =</span> <span class="dv">2019021718</span>,           </span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="dt">fcst_model      =</span> <span class="kw">c</span>(<span class="st">&quot;MEPS_prod&quot;</span>, <span class="st">&quot;CMEPS_prod&quot;</span>), </span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="dt">parameter       =</span> <span class="st">&quot;Pcp&quot;</span>,                 </span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="dt">lead_time       =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>), </span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="dt">members         =</span> <span class="kw">list</span>(<span class="dt">MEPS_prod =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">9</span>), <span class="dt">CMEPS_prod =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="dt">lags            =</span> <span class="kw">list</span>(<span class="dt">CMEPS_prod =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="dt">by              =</span> <span class="st">&quot;3h&quot;</span>,                </span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="dt">file_path       =</span> <span class="kw">here</span>(<span class="st">&quot;data/vfld&quot;</span>),    </span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="dt">file_template   =</span> <span class="st">&quot;vfld_eps&quot;</span>,</span>
<span id="cb26-12"><a href="#cb26-12"></a>  <span class="dt">output_file_opts =</span> <span class="kw">sqlite_opts</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>)), </span>
<span id="cb26-13"><a href="#cb26-13"></a>)</span></code></pre></div>

</div>
<div id="introduction-2" class="section level3">
<h3><span class="header-section-number">0.5.7</span> Introduction</h3>
<p>Point observations also come in many formats. For Hirlam, that format is vobs. Currently this is the only point observations format that harp can deal with. vobs are pretty much the same format as vfld, with files for every observation time. This is considerable file IO if you want a season’s worth of data, for example. Again in harp we use sqlite to store point observations, making it quick and easy to access exactly what you want.</p>
</div>
<div id="converting-observations-to-sqlite" class="section level3">
<h3><span class="header-section-number">0.5.8</span> Converting observations to SQLite</h3>
<p>The harp function for converting observations is <code>read_obs_convert</code>. It works similarly to the <code>read_forecast</code> function, but has fewer arguments. In the data directory is a vobs directory containing the vobs files. We have hourly data here from 00 UTC 17 Feb 2019 to 23 UTC 20 Feb. Let’s read them in:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">library</span>(here)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="kw">library</span>(harpIO)</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="kw">read_obs_convert</span>(</span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="dt">start_date  =</span> <span class="dv">2019021700</span>,</span>
<span id="cb27-7"><a href="#cb27-7"></a>  <span class="dt">end_date    =</span> <span class="dv">2019022023</span>,</span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="dt">by          =</span> <span class="st">&quot;1h&quot;</span>,</span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="dt">obs_path    =</span> <span class="kw">here</span>(<span class="st">&quot;data/vobs&quot;</span>),</span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="dt">return_data =</span> <span class="ot">TRUE</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>)</span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="co">## $synop</span></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co">## # A tibble: 324,138 x 24</span></span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="co">##    validdate   SID   lat   lon  elev CCtot  D10m  S10m   T2m  Td2m  RH2m      Q2m    Ps  Pmsl   vis AccPcp3h AccPcp6h</span></span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="co">##        &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="co">##  1    1.55e9  1001  70.9 -8.67     9  8      202   8.8  270.  268.  85.3  2.47e-3 1007. 1009. 10000     NA        0  </span></span>
<span id="cb27-17"><a href="#cb27-17"></a><span class="co">##  2    1.55e9  1002  80.1 16.2      8 NA      330  13    248.  246   81.0  4.03e-4 1010. 1011.    NA     NA       NA  </span></span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="co">##  3    1.55e9  1003  77   15.5     10  1.04    30   2    252.  245.  52.1  3.64e-4 1010. 1011. 50000     NA        0  </span></span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="co">##  4    1.55e9  1006  78.3 22.8     14 NA       20   3    247.  244.  78.5  3.42e-4 1008. 1010.    NA     NA       NA  </span></span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="co">##  5    1.55e9  1007  78.9 11.9      8 NA      350   5    250.   NA   NA   NA       1013. 1014.    NA     NA       NA  </span></span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="co">##  6    1.55e9  1008  78.2 15.5     27  7.04   298   7.6  251.  246   61.9  4.04e-4 1008. 1012. 30000     NA       NA  </span></span>
<span id="cb27-22"><a href="#cb27-22"></a><span class="co">##  7    1.55e9  1009  80.7 25.0      5 NA      330  12    244.  241.  76.5  2.62e-4 1006. 1007     NA     NA       NA  </span></span>
<span id="cb27-23"><a href="#cb27-23"></a><span class="co">##  8    1.55e9  1010  69.3 16.1     13 NA      340  11.3  274.  268.  59.9  2.48e-3 1003  1005.    NA      0.6      0.9</span></span>
<span id="cb27-24"><a href="#cb27-24"></a><span class="co">##  9    1.55e9  1011  80.1 31.5      9 NA      352  11.4  240.  236.  68.9  1.50e-4 1004. 1005     NA     NA       NA  </span></span>
<span id="cb27-25"><a href="#cb27-25"></a><span class="co">## 10    1.55e9  1013  78.1 13.6    -99 NA       NA  NA     NA    NA   NA   NA         NA    NA     NA      0       NA  </span></span>
<span id="cb27-26"><a href="#cb27-26"></a><span class="co">## # … with 324,128 more rows, and 7 more variables: AccPcp24h &lt;dbl&gt;, N75 &lt;int&gt;, CClow &lt;int&gt;, Cbase &lt;int&gt;, AccPcp1h &lt;dbl&gt;,</span></span>
<span id="cb27-27"><a href="#cb27-27"></a><span class="co">## #   Gmax &lt;dbl&gt;, AccPcp12h &lt;dbl&gt;</span></span>
<span id="cb27-28"><a href="#cb27-28"></a><span class="co">## </span></span>
<span id="cb27-29"><a href="#cb27-29"></a><span class="co">## $temp</span></span>
<span id="cb27-30"><a href="#cb27-30"></a><span class="co">## # A tibble: 110,568 x 13</span></span>
<span id="cb27-31"><a href="#cb27-31"></a><span class="co">##     validdate   SID   lat   lon  elev     p     Z     T    RH     D     S           Q    Td</span></span>
<span id="cb27-32"><a href="#cb27-32"></a><span class="co">##         &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb27-33"><a href="#cb27-33"></a><span class="co">##  1 1550361600  1001  70.9 -8.67     9  1000    64  269.  83.3   202     3  0.00229     266.</span></span>
<span id="cb27-34"><a href="#cb27-34"></a><span class="co">##  2 1550361600  1001  70.9 -8.67     9   925   672  264. 100     205     8  0.00200     264.</span></span>
<span id="cb27-35"><a href="#cb27-35"></a><span class="co">##  3 1550361600  1001  70.9 -8.67     9   850  1322  262.  86.4   161     3  0.00162     260 </span></span>
<span id="cb27-36"><a href="#cb27-36"></a><span class="co">##  4 1550361600  1001  70.9 -8.67     9   700  2792  254.  32     251     4  0.000388    242.</span></span>
<span id="cb27-37"><a href="#cb27-37"></a><span class="co">##  5 1550361600  1001  70.9 -8.67     9   500  5224  240.   8.7   270    18  0.0000382   218.</span></span>
<span id="cb27-38"><a href="#cb27-38"></a><span class="co">##  6 1550361600  1001  70.9 -8.67     9   400  6762  230.  28.1   275    32  0.0000568   219.</span></span>
<span id="cb27-39"><a href="#cb27-39"></a><span class="co">##  7 1550361600  1001  70.9 -8.67     9   300  8656  218   38.6   269    43  0.0000262   211.</span></span>
<span id="cb27-40"><a href="#cb27-40"></a><span class="co">##  8 1550361600  1001  70.9 -8.67     9   250    NA   NA   NA      NA    NA NA            NA </span></span>
<span id="cb27-41"><a href="#cb27-41"></a><span class="co">##  9 1550361600  1001  70.9 -8.67     9   200 11220  218.   2.9   262    28  0.00000288  193.</span></span>
<span id="cb27-42"><a href="#cb27-42"></a><span class="co">## 10 1550361600  1001  70.9 -8.67     9   150 13048  217.   2.5   257    21  0.00000310  192.</span></span>
<span id="cb27-43"><a href="#cb27-43"></a><span class="co">## # … with 110,558 more rows</span></span>
<span id="cb27-44"><a href="#cb27-44"></a><span class="co">## </span></span>
<span id="cb27-45"><a href="#cb27-45"></a><span class="co">## $synop_params</span></span>
<span id="cb27-46"><a href="#cb27-46"></a><span class="co">##    parameter accum_hours   units</span></span>
<span id="cb27-47"><a href="#cb27-47"></a><span class="co">## 1      CCtot           0   oktas</span></span>
<span id="cb27-48"><a href="#cb27-48"></a><span class="co">## 2       D10m           0 degrees</span></span>
<span id="cb27-49"><a href="#cb27-49"></a><span class="co">## 3       S10m           0     m/s</span></span>
<span id="cb27-50"><a href="#cb27-50"></a><span class="co">## 4        T2m           0       K</span></span>
<span id="cb27-51"><a href="#cb27-51"></a><span class="co">## 5       Td2m           0       K</span></span>
<span id="cb27-52"><a href="#cb27-52"></a><span class="co">## 6       RH2m           0 percent</span></span>
<span id="cb27-53"><a href="#cb27-53"></a><span class="co">## 7        Q2m           0   kg/kg</span></span>
<span id="cb27-54"><a href="#cb27-54"></a><span class="co">## 8         Ps           0     hPa</span></span>
<span id="cb27-55"><a href="#cb27-55"></a><span class="co">## 9       Pmsl           0     hPa</span></span>
<span id="cb27-56"><a href="#cb27-56"></a><span class="co">## 10       vis           0       m</span></span>
<span id="cb27-57"><a href="#cb27-57"></a><span class="co">## 11  AccPcp3h           3  kg/m^2</span></span>
<span id="cb27-58"><a href="#cb27-58"></a><span class="co">## 12  AccPcp6h           6  kg/m^2</span></span>
<span id="cb27-59"><a href="#cb27-59"></a><span class="co">## 13 AccPcp24h          24  kg/m^2</span></span>
<span id="cb27-60"><a href="#cb27-60"></a><span class="co">## 14       N75           0   oktas</span></span>
<span id="cb27-61"><a href="#cb27-61"></a><span class="co">## 15     CClow           0   oktas</span></span>
<span id="cb27-62"><a href="#cb27-62"></a><span class="co">## 16     Cbase           0       m</span></span>
<span id="cb27-63"><a href="#cb27-63"></a><span class="co">## 17  AccPcp1h           1  kg/m^2</span></span>
<span id="cb27-64"><a href="#cb27-64"></a><span class="co">## 18      Gmax           0     m/s</span></span>
<span id="cb27-65"><a href="#cb27-65"></a><span class="co">## 19 AccPcp12h          12  kg/m^2</span></span>
<span id="cb27-66"><a href="#cb27-66"></a><span class="co">## </span></span>
<span id="cb27-67"><a href="#cb27-67"></a><span class="co">## $temp_params</span></span>
<span id="cb27-68"><a href="#cb27-68"></a><span class="co">##   parameter accum_hours   units</span></span>
<span id="cb27-69"><a href="#cb27-69"></a><span class="co">## 1         p           0     hPa</span></span>
<span id="cb27-70"><a href="#cb27-70"></a><span class="co">## 2         Z           0       m</span></span>
<span id="cb27-71"><a href="#cb27-71"></a><span class="co">## 3         T           0       K</span></span>
<span id="cb27-72"><a href="#cb27-72"></a><span class="co">## 4        RH           0 percent</span></span>
<span id="cb27-73"><a href="#cb27-73"></a><span class="co">## 5         D           0 degrees</span></span>
<span id="cb27-74"><a href="#cb27-74"></a><span class="co">## 6         S           0     m/s</span></span>
<span id="cb27-75"><a href="#cb27-75"></a><span class="co">## 7         Q           0   kg/kg</span></span>
<span id="cb27-76"><a href="#cb27-76"></a><span class="co">## 8        Td           0       K</span></span></code></pre></div>
<p>Your turn:</p>
<ul>
<li>Write the observations to SQLite files in the directory data/OBSTABLE</li>
</ul>
<p>Solution</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">read_obs_convert</span>(</span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="dt">start_date  =</span> <span class="dv">2019021700</span>,</span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="dt">end_date    =</span> <span class="dv">2019022023</span>,</span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="dt">by          =</span> <span class="st">&quot;1h&quot;</span>,</span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="dt">obs_path    =</span> <span class="kw">here</span>(<span class="st">&quot;data/vobs&quot;</span>),</span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="dt">sqlite_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>)</span>
<span id="cb28-7"><a href="#cb28-7"></a>)</span></code></pre></div>

</div>
<div id="introduction-3" class="section level3">
<h3><span class="header-section-number">0.5.9</span> Introduction</h3>
<p>We now have all of our data prepared for harp and we aer ready to work with. That work includes undertsanding how harp data are structured, how to plot forecast data, how to manipulate the data, and verification.</p>
<p>We’ll be making use of all of the harp packages in this section, so we can just attach the full set of harp packages (and as always tidyverse and here)</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">library</span>(harp)</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="kw">library</span>(here)</span></code></pre></div>
</div>
<div id="deterministic-data" class="section level3">
<h3><span class="header-section-number">0.5.10</span> Deterministic data</h3>
<p>Let’s start with our deterministic data from the AROME Arctic model and member 0 of MEPS. First we load the data into our environment with the function <code>read_point_forecast</code>. As with other functions, we need to tell the function the start and end dates that we want, the names of the models, the parameter, the frequency of the forecasts, the path to the data and whether it is deterministic or ensemble data.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="dt">start_date =</span> <span class="dv">2019021700</span>,</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="dt">end_date   =</span> <span class="dv">2019021718</span>,</span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="dt">fcst_model =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="dt">fcst_type  =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="dt">parameter  =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="dt">by         =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="dt">file_path  =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>)</span>
<span id="cb30-9"><a href="#cb30-9"></a>)</span>
<span id="cb30-10"><a href="#cb30-10"></a>s10m</span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="co">## # A tibble: 17,612 x 10</span></span>
<span id="cb30-13"><a href="#cb30-13"></a><span class="co">##        fcdate fcst_cycle leadtime model_elevation     p parameter   SID units  validdate AROME_Arctic_prod_det</span></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="co">##         &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt;                 &lt;dbl&gt;</span></span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="co">##  1 1550361600 00                0            63.9    NA S10m       1001 m/s   1550361600                  7.49</span></span>
<span id="cb30-16"><a href="#cb30-16"></a><span class="co">##  2 1550361600 00                0             1.4    NA S10m       1002 m/s   1550361600                 13.6 </span></span>
<span id="cb30-17"><a href="#cb30-17"></a><span class="co">##  3 1550361600 00                0            24.9    NA S10m       1003 m/s   1550361600                  7.50</span></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="co">##  4 1550361600 00                0           162.     NA S10m       1004 m/s   1550361600                  9.69</span></span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="co">##  5 1550361600 00                0            -2.7    NA S10m       1006 m/s   1550361600                  4.52</span></span>
<span id="cb30-20"><a href="#cb30-20"></a><span class="co">##  6 1550361600 00                0            21.6    NA S10m       1007 m/s   1550361600                  9.88</span></span>
<span id="cb30-21"><a href="#cb30-21"></a><span class="co">##  7 1550361600 00                0            67.2    NA S10m       1008 m/s   1550361600                  8.43</span></span>
<span id="cb30-22"><a href="#cb30-22"></a><span class="co">##  8 1550361600 00                0             1.2    NA S10m       1009 m/s   1550361600                 13.1 </span></span>
<span id="cb30-23"><a href="#cb30-23"></a><span class="co">##  9 1550361600 00                0             3.3    NA S10m       1010 m/s   1550361600                 11.3 </span></span>
<span id="cb30-24"><a href="#cb30-24"></a><span class="co">## 10 1550361600 00                0            20.7    NA S10m       1011 m/s   1550361600                  6.46</span></span>
<span id="cb30-25"><a href="#cb30-25"></a><span class="co">## # … with 17,602 more rows</span></span>
<span id="cb30-26"><a href="#cb30-26"></a><span class="co">## </span></span>
<span id="cb30-27"><a href="#cb30-27"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="co">## # A tibble: 81,804 x 10</span></span>
<span id="cb30-29"><a href="#cb30-29"></a><span class="co">##        fcdate fcst_cycle leadtime model_elevation     p parameter   SID units  validdate MEPS_prod_det</span></span>
<span id="cb30-30"><a href="#cb30-30"></a><span class="co">##         &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt;         &lt;dbl&gt;</span></span>
<span id="cb30-31"><a href="#cb30-31"></a><span class="co">##  1 1550361600 00                0            36.4    NA S10m       1001 m/s   1550361600          4.22</span></span>
<span id="cb30-32"><a href="#cb30-32"></a><span class="co">##  2 1550361600 00                0             4.1    NA S10m       1010 m/s   1550361600         11.9 </span></span>
<span id="cb30-33"><a href="#cb30-33"></a><span class="co">##  3 1550361600 00                0            29.1    NA S10m       1014 m/s   1550361600          4.99</span></span>
<span id="cb30-34"><a href="#cb30-34"></a><span class="co">##  4 1550361600 00                0             2.6    NA S10m       1015 m/s   1550361600         11.3 </span></span>
<span id="cb30-35"><a href="#cb30-35"></a><span class="co">##  5 1550361600 00                0           152.     NA S10m       1018 m/s   1550361600          9.09</span></span>
<span id="cb30-36"><a href="#cb30-36"></a><span class="co">##  6 1550361600 00                0            16.4    NA S10m       1021 m/s   1550361600          7.48</span></span>
<span id="cb30-37"><a href="#cb30-37"></a><span class="co">##  7 1550361600 00                0            39.5    NA S10m       1022 m/s   1550361600          6.77</span></span>
<span id="cb30-38"><a href="#cb30-38"></a><span class="co">##  8 1550361600 00                0            69.1    NA S10m       1023 m/s   1550361600          6.42</span></span>
<span id="cb30-39"><a href="#cb30-39"></a><span class="co">##  9 1550361600 00                0             8.1    NA S10m       1025 m/s   1550361600          5.24</span></span>
<span id="cb30-40"><a href="#cb30-40"></a><span class="co">## 10 1550361600 00                0             5.2    NA S10m       1026 m/s   1550361600          4.74</span></span>
<span id="cb30-41"><a href="#cb30-41"></a><span class="co">## # … with 81,794 more rows</span></span></code></pre></div>
<p>You will see that data are in two data frames in a list. This list is actually an object of class harp_fcst. Many of the functions in harp only work on harp_fcst objects. Many of the dplyr methods also work on harp_fcst objects. The forecast data are in the last column with the suffix "_det".</p>
<p>Let’s take a look at some of the things you can do with harp_fcst objects. First <code>expand_data</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">expand_date</span>(s10m, fcdate)</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="co">## # A tibble: 17,612 x 15</span></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate AROME_Arctic_pr… fc_year fc_month</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co">##  1 1.55e9 00                0            63.9    NA S10m       1001 m/s      1.55e9             7.49    2019        2</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co">##  2 1.55e9 00                0             1.4    NA S10m       1002 m/s      1.55e9            13.6     2019        2</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co">##  3 1.55e9 00                0            24.9    NA S10m       1003 m/s      1.55e9             7.50    2019        2</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="co">##  4 1.55e9 00                0           162.     NA S10m       1004 m/s      1.55e9             9.69    2019        2</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="co">##  5 1.55e9 00                0            -2.7    NA S10m       1006 m/s      1.55e9             4.52    2019        2</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co">##  6 1.55e9 00                0            21.6    NA S10m       1007 m/s      1.55e9             9.88    2019        2</span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="co">##  7 1.55e9 00                0            67.2    NA S10m       1008 m/s      1.55e9             8.43    2019        2</span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="co">##  8 1.55e9 00                0             1.2    NA S10m       1009 m/s      1.55e9            13.1     2019        2</span></span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="co">##  9 1.55e9 00                0             3.3    NA S10m       1010 m/s      1.55e9            11.3     2019        2</span></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co">## 10 1.55e9 00                0            20.7    NA S10m       1011 m/s      1.55e9             6.46    2019        2</span></span>
<span id="cb31-16"><a href="#cb31-16"></a><span class="co">## # … with 17,602 more rows, and 3 more variables: fc_day &lt;int&gt;, fc_hour &lt;int&gt;, fc_minute &lt;int&gt;</span></span>
<span id="cb31-17"><a href="#cb31-17"></a><span class="co">## </span></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb31-19"><a href="#cb31-19"></a><span class="co">## # A tibble: 81,804 x 15</span></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_det fc_year fc_month fc_day</span></span>
<span id="cb31-21"><a href="#cb31-21"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;         &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;int&gt;</span></span>
<span id="cb31-22"><a href="#cb31-22"></a><span class="co">##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s      1.55e9          4.22    2019        2     17</span></span>
<span id="cb31-23"><a href="#cb31-23"></a><span class="co">##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s      1.55e9         11.9     2019        2     17</span></span>
<span id="cb31-24"><a href="#cb31-24"></a><span class="co">##  3 1.55e9 00                0            29.1    NA S10m       1014 m/s      1.55e9          4.99    2019        2     17</span></span>
<span id="cb31-25"><a href="#cb31-25"></a><span class="co">##  4 1.55e9 00                0             2.6    NA S10m       1015 m/s      1.55e9         11.3     2019        2     17</span></span>
<span id="cb31-26"><a href="#cb31-26"></a><span class="co">##  5 1.55e9 00                0           152.     NA S10m       1018 m/s      1.55e9          9.09    2019        2     17</span></span>
<span id="cb31-27"><a href="#cb31-27"></a><span class="co">##  6 1.55e9 00                0            16.4    NA S10m       1021 m/s      1.55e9          7.48    2019        2     17</span></span>
<span id="cb31-28"><a href="#cb31-28"></a><span class="co">##  7 1.55e9 00                0            39.5    NA S10m       1022 m/s      1.55e9          6.77    2019        2     17</span></span>
<span id="cb31-29"><a href="#cb31-29"></a><span class="co">##  8 1.55e9 00                0            69.1    NA S10m       1023 m/s      1.55e9          6.42    2019        2     17</span></span>
<span id="cb31-30"><a href="#cb31-30"></a><span class="co">##  9 1.55e9 00                0             8.1    NA S10m       1025 m/s      1.55e9          5.24    2019        2     17</span></span>
<span id="cb31-31"><a href="#cb31-31"></a><span class="co">## 10 1.55e9 00                0             5.2    NA S10m       1026 m/s      1.55e9          4.74    2019        2     17</span></span>
<span id="cb31-32"><a href="#cb31-32"></a><span class="co">## # … with 81,794 more rows, and 2 more variables: fc_hour &lt;int&gt;, fc_minute &lt;int&gt;</span></span>
<span id="cb31-33"><a href="#cb31-33"></a><span class="kw">expand_date</span>(s10m, validdate)</span>
<span id="cb31-34"><a href="#cb31-34"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb31-35"><a href="#cb31-35"></a><span class="co">## # A tibble: 17,612 x 15</span></span>
<span id="cb31-36"><a href="#cb31-36"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate AROME_Arctic_pr… valid_year</span></span>
<span id="cb31-37"><a href="#cb31-37"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb31-38"><a href="#cb31-38"></a><span class="co">##  1 1.55e9 00                0            63.9    NA S10m       1001 m/s      1.55e9             7.49       2019</span></span>
<span id="cb31-39"><a href="#cb31-39"></a><span class="co">##  2 1.55e9 00                0             1.4    NA S10m       1002 m/s      1.55e9            13.6        2019</span></span>
<span id="cb31-40"><a href="#cb31-40"></a><span class="co">##  3 1.55e9 00                0            24.9    NA S10m       1003 m/s      1.55e9             7.50       2019</span></span>
<span id="cb31-41"><a href="#cb31-41"></a><span class="co">##  4 1.55e9 00                0           162.     NA S10m       1004 m/s      1.55e9             9.69       2019</span></span>
<span id="cb31-42"><a href="#cb31-42"></a><span class="co">##  5 1.55e9 00                0            -2.7    NA S10m       1006 m/s      1.55e9             4.52       2019</span></span>
<span id="cb31-43"><a href="#cb31-43"></a><span class="co">##  6 1.55e9 00                0            21.6    NA S10m       1007 m/s      1.55e9             9.88       2019</span></span>
<span id="cb31-44"><a href="#cb31-44"></a><span class="co">##  7 1.55e9 00                0            67.2    NA S10m       1008 m/s      1.55e9             8.43       2019</span></span>
<span id="cb31-45"><a href="#cb31-45"></a><span class="co">##  8 1.55e9 00                0             1.2    NA S10m       1009 m/s      1.55e9            13.1        2019</span></span>
<span id="cb31-46"><a href="#cb31-46"></a><span class="co">##  9 1.55e9 00                0             3.3    NA S10m       1010 m/s      1.55e9            11.3        2019</span></span>
<span id="cb31-47"><a href="#cb31-47"></a><span class="co">## 10 1.55e9 00                0            20.7    NA S10m       1011 m/s      1.55e9             6.46       2019</span></span>
<span id="cb31-48"><a href="#cb31-48"></a><span class="co">## # … with 17,602 more rows, and 4 more variables: valid_month &lt;dbl&gt;, valid_day &lt;int&gt;, valid_hour &lt;int&gt;, valid_minute &lt;int&gt;</span></span>
<span id="cb31-49"><a href="#cb31-49"></a><span class="co">## </span></span>
<span id="cb31-50"><a href="#cb31-50"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb31-51"><a href="#cb31-51"></a><span class="co">## # A tibble: 81,804 x 15</span></span>
<span id="cb31-52"><a href="#cb31-52"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_det valid_year valid_month</span></span>
<span id="cb31-53"><a href="#cb31-53"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;         &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb31-54"><a href="#cb31-54"></a><span class="co">##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s      1.55e9          4.22       2019           2</span></span>
<span id="cb31-55"><a href="#cb31-55"></a><span class="co">##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s      1.55e9         11.9        2019           2</span></span>
<span id="cb31-56"><a href="#cb31-56"></a><span class="co">##  3 1.55e9 00                0            29.1    NA S10m       1014 m/s      1.55e9          4.99       2019           2</span></span>
<span id="cb31-57"><a href="#cb31-57"></a><span class="co">##  4 1.55e9 00                0             2.6    NA S10m       1015 m/s      1.55e9         11.3        2019           2</span></span>
<span id="cb31-58"><a href="#cb31-58"></a><span class="co">##  5 1.55e9 00                0           152.     NA S10m       1018 m/s      1.55e9          9.09       2019           2</span></span>
<span id="cb31-59"><a href="#cb31-59"></a><span class="co">##  6 1.55e9 00                0            16.4    NA S10m       1021 m/s      1.55e9          7.48       2019           2</span></span>
<span id="cb31-60"><a href="#cb31-60"></a><span class="co">##  7 1.55e9 00                0            39.5    NA S10m       1022 m/s      1.55e9          6.77       2019           2</span></span>
<span id="cb31-61"><a href="#cb31-61"></a><span class="co">##  8 1.55e9 00                0            69.1    NA S10m       1023 m/s      1.55e9          6.42       2019           2</span></span>
<span id="cb31-62"><a href="#cb31-62"></a><span class="co">##  9 1.55e9 00                0             8.1    NA S10m       1025 m/s      1.55e9          5.24       2019           2</span></span>
<span id="cb31-63"><a href="#cb31-63"></a><span class="co">## 10 1.55e9 00                0             5.2    NA S10m       1026 m/s      1.55e9          4.74       2019           2</span></span>
<span id="cb31-64"><a href="#cb31-64"></a><span class="co">## # … with 81,794 more rows, and 3 more variables: valid_day &lt;int&gt;, valid_hour &lt;int&gt;, valid_minute &lt;int&gt;</span></span></code></pre></div>
<p>With the year, month, day, hour and minute now available, it’s easier to filter the data if you’d like. For example, if you just want the forecast wind speed at 15:00 UTC on 17 Feb 2019 for station ID 1010, which we is on Andøya, we could do something like</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">expand_date</span>(s10m, validdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb32-3"><a href="#cb32-3"></a>    SID         <span class="op">==</span><span class="st"> </span><span class="dv">1010</span>, </span>
<span id="cb32-4"><a href="#cb32-4"></a>    valid_year  <span class="op">==</span><span class="st"> </span><span class="dv">2019</span>, </span>
<span id="cb32-5"><a href="#cb32-5"></a>    valid_month <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, </span>
<span id="cb32-6"><a href="#cb32-6"></a>    valid_day   <span class="op">==</span><span class="st"> </span><span class="dv">17</span>, </span>
<span id="cb32-7"><a href="#cb32-7"></a>    valid_hour  <span class="op">==</span><span class="st"> </span><span class="dv">15</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>  )</span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="co">## # A tibble: 3 x 15</span></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="co">##   fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate AROME_Arctic_pr… valid_year valid_month</span></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co">##    &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co">## 1 1.55e9 00               15             3.3    NA S10m       1010 m/s      1.55e9             3.75       2019           2</span></span>
<span id="cb32-14"><a href="#cb32-14"></a><span class="co">## 2 1.55e9 06                9             3.3    NA S10m       1010 m/s      1.55e9             3.19       2019           2</span></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="co">## 3 1.55e9 12                3             3.3    NA S10m       1010 m/s      1.55e9             1.38       2019           2</span></span>
<span id="cb32-16"><a href="#cb32-16"></a><span class="co">## # … with 3 more variables: valid_day &lt;int&gt;, valid_hour &lt;int&gt;, valid_minute &lt;int&gt;</span></span>
<span id="cb32-17"><a href="#cb32-17"></a><span class="co">## </span></span>
<span id="cb32-18"><a href="#cb32-18"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb32-19"><a href="#cb32-19"></a><span class="co">## # A tibble: 3 x 15</span></span>
<span id="cb32-20"><a href="#cb32-20"></a><span class="co">##   fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_det valid_year valid_month</span></span>
<span id="cb32-21"><a href="#cb32-21"></a><span class="co">##    &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;         &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="co">## 1 1.55e9 00               15             4.1    NA S10m       1010 m/s      1.55e9          5.99       2019           2</span></span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="co">## 2 1.55e9 06                9             4.1    NA S10m       1010 m/s      1.55e9          4.58       2019           2</span></span>
<span id="cb32-24"><a href="#cb32-24"></a><span class="co">## 3 1.55e9 12                3             4.1    NA S10m       1010 m/s      1.55e9          3.30       2019           2</span></span>
<span id="cb32-25"><a href="#cb32-25"></a><span class="co">## # … with 3 more variables: valid_day &lt;int&gt;, valid_hour &lt;int&gt;, valid_minute &lt;int&gt;</span></span></code></pre></div>
<p>Equally, we could just get the data for one forecast</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">expand_date</span>(s10m, fcdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb33-3"><a href="#cb33-3"></a>    SID      <span class="op">==</span><span class="st"> </span><span class="dv">1010</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a>    fc_year  <span class="op">==</span><span class="st"> </span><span class="dv">2019</span>,</span>
<span id="cb33-5"><a href="#cb33-5"></a>    fc_month <span class="op">==</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb33-6"><a href="#cb33-6"></a>    fc_day   <span class="op">==</span><span class="st"> </span><span class="dv">17</span>,</span>
<span id="cb33-7"><a href="#cb33-7"></a>    fc_hour  <span class="op">==</span><span class="st"> </span><span class="dv">12</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate))</span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="co">## # A tibble: 17 x 15</span></span>
<span id="cb33-12"><a href="#cb33-12"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate           AROME_Arctic_pr… fc_year</span></span>
<span id="cb33-13"><a href="#cb33-13"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt; &lt;dttm&gt;                         &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb33-14"><a href="#cb33-14"></a><span class="co">##  1 1.55e9 12                0             3.3    NA S10m       1010 m/s   2019-02-17 12:00:00             1.54    2019</span></span>
<span id="cb33-15"><a href="#cb33-15"></a><span class="co">##  2 1.55e9 12                3             3.3    NA S10m       1010 m/s   2019-02-17 15:00:00             1.38    2019</span></span>
<span id="cb33-16"><a href="#cb33-16"></a><span class="co">##  3 1.55e9 12                6             3.3    NA S10m       1010 m/s   2019-02-17 18:00:00             6.14    2019</span></span>
<span id="cb33-17"><a href="#cb33-17"></a><span class="co">##  4 1.55e9 12                9             3.3    NA S10m       1010 m/s   2019-02-17 21:00:00             6.60    2019</span></span>
<span id="cb33-18"><a href="#cb33-18"></a><span class="co">##  5 1.55e9 12               12             3.3    NA S10m       1010 m/s   2019-02-18 00:00:00             5.95    2019</span></span>
<span id="cb33-19"><a href="#cb33-19"></a><span class="co">##  6 1.55e9 12               15             3.3    NA S10m       1010 m/s   2019-02-18 03:00:00             6.08    2019</span></span>
<span id="cb33-20"><a href="#cb33-20"></a><span class="co">##  7 1.55e9 12               18             3.3    NA S10m       1010 m/s   2019-02-18 06:00:00             5.85    2019</span></span>
<span id="cb33-21"><a href="#cb33-21"></a><span class="co">##  8 1.55e9 12               21             3.3    NA S10m       1010 m/s   2019-02-18 09:00:00             6.77    2019</span></span>
<span id="cb33-22"><a href="#cb33-22"></a><span class="co">##  9 1.55e9 12               24             3.3    NA S10m       1010 m/s   2019-02-18 12:00:00             6.14    2019</span></span>
<span id="cb33-23"><a href="#cb33-23"></a><span class="co">## 10 1.55e9 12               27             3.3    NA S10m       1010 m/s   2019-02-18 15:00:00             8.25    2019</span></span>
<span id="cb33-24"><a href="#cb33-24"></a><span class="co">## 11 1.55e9 12               30             3.3    NA S10m       1010 m/s   2019-02-18 18:00:00             8.33    2019</span></span>
<span id="cb33-25"><a href="#cb33-25"></a><span class="co">## 12 1.55e9 12               33             3.3    NA S10m       1010 m/s   2019-02-18 21:00:00             9.22    2019</span></span>
<span id="cb33-26"><a href="#cb33-26"></a><span class="co">## 13 1.55e9 12               36             3.3    NA S10m       1010 m/s   2019-02-19 00:00:00            11.8     2019</span></span>
<span id="cb33-27"><a href="#cb33-27"></a><span class="co">## 14 1.55e9 12               39             3.3    NA S10m       1010 m/s   2019-02-19 03:00:00            14.5     2019</span></span>
<span id="cb33-28"><a href="#cb33-28"></a><span class="co">## 15 1.55e9 12               42             3.3    NA S10m       1010 m/s   2019-02-19 06:00:00            17.1     2019</span></span>
<span id="cb33-29"><a href="#cb33-29"></a><span class="co">## 16 1.55e9 12               45             3.3    NA S10m       1010 m/s   2019-02-19 09:00:00            16.0     2019</span></span>
<span id="cb33-30"><a href="#cb33-30"></a><span class="co">## 17 1.55e9 12               48             3.3    NA S10m       1010 m/s   2019-02-19 12:00:00            16.1     2019</span></span>
<span id="cb33-31"><a href="#cb33-31"></a><span class="co">## # … with 4 more variables: fc_month &lt;dbl&gt;, fc_day &lt;int&gt;, fc_hour &lt;int&gt;, fc_minute &lt;int&gt;</span></span>
<span id="cb33-32"><a href="#cb33-32"></a><span class="co">## </span></span>
<span id="cb33-33"><a href="#cb33-33"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb33-34"><a href="#cb33-34"></a><span class="co">## # A tibble: 17 x 15</span></span>
<span id="cb33-35"><a href="#cb33-35"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate           MEPS_prod_det fc_year</span></span>
<span id="cb33-36"><a href="#cb33-36"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt; &lt;dttm&gt;                      &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb33-37"><a href="#cb33-37"></a><span class="co">##  1 1.55e9 12                0             4.1    NA S10m       1010 m/s   2019-02-17 12:00:00          2.30    2019</span></span>
<span id="cb33-38"><a href="#cb33-38"></a><span class="co">##  2 1.55e9 12                3             4.1    NA S10m       1010 m/s   2019-02-17 15:00:00          3.30    2019</span></span>
<span id="cb33-39"><a href="#cb33-39"></a><span class="co">##  3 1.55e9 12                6             4.1    NA S10m       1010 m/s   2019-02-17 18:00:00          6.34    2019</span></span>
<span id="cb33-40"><a href="#cb33-40"></a><span class="co">##  4 1.55e9 12                9             4.1    NA S10m       1010 m/s   2019-02-17 21:00:00          8.06    2019</span></span>
<span id="cb33-41"><a href="#cb33-41"></a><span class="co">##  5 1.55e9 12               12             4.1    NA S10m       1010 m/s   2019-02-18 00:00:00          6.79    2019</span></span>
<span id="cb33-42"><a href="#cb33-42"></a><span class="co">##  6 1.55e9 12               15             4.1    NA S10m       1010 m/s   2019-02-18 03:00:00          5.95    2019</span></span>
<span id="cb33-43"><a href="#cb33-43"></a><span class="co">##  7 1.55e9 12               18             4.1    NA S10m       1010 m/s   2019-02-18 06:00:00          5.87    2019</span></span>
<span id="cb33-44"><a href="#cb33-44"></a><span class="co">##  8 1.55e9 12               21             4.1    NA S10m       1010 m/s   2019-02-18 09:00:00          7.46    2019</span></span>
<span id="cb33-45"><a href="#cb33-45"></a><span class="co">##  9 1.55e9 12               24             4.1    NA S10m       1010 m/s   2019-02-18 12:00:00          6.33    2019</span></span>
<span id="cb33-46"><a href="#cb33-46"></a><span class="co">## 10 1.55e9 12               27             4.1    NA S10m       1010 m/s   2019-02-18 15:00:00          8.35    2019</span></span>
<span id="cb33-47"><a href="#cb33-47"></a><span class="co">## 11 1.55e9 12               30             4.1    NA S10m       1010 m/s   2019-02-18 18:00:00          9.69    2019</span></span>
<span id="cb33-48"><a href="#cb33-48"></a><span class="co">## 12 1.55e9 12               33             4.1    NA S10m       1010 m/s   2019-02-18 21:00:00          9.66    2019</span></span>
<span id="cb33-49"><a href="#cb33-49"></a><span class="co">## 13 1.55e9 12               36             4.1    NA S10m       1010 m/s   2019-02-19 00:00:00         11.1     2019</span></span>
<span id="cb33-50"><a href="#cb33-50"></a><span class="co">## 14 1.55e9 12               39             4.1    NA S10m       1010 m/s   2019-02-19 03:00:00         12.8     2019</span></span>
<span id="cb33-51"><a href="#cb33-51"></a><span class="co">## 15 1.55e9 12               42             4.1    NA S10m       1010 m/s   2019-02-19 06:00:00         14.9     2019</span></span>
<span id="cb33-52"><a href="#cb33-52"></a><span class="co">## 16 1.55e9 12               45             4.1    NA S10m       1010 m/s   2019-02-19 09:00:00         17.6     2019</span></span>
<span id="cb33-53"><a href="#cb33-53"></a><span class="co">## 17 1.55e9 12               48             4.1    NA S10m       1010 m/s   2019-02-19 12:00:00         16.9     2019</span></span>
<span id="cb33-54"><a href="#cb33-54"></a><span class="co">## # … with 4 more variables: fc_month &lt;dbl&gt;, fc_day &lt;int&gt;, fc_hour &lt;int&gt;, fc_minute &lt;int&gt;</span></span></code></pre></div>
<p>harp doesn’t yet include any functions for plotting deterministic forecasts, but we can easily make the data into a single data frame using <code>bind_fcst</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">bind_rows</span>(</span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="dt">AROME_Arctic_prod =</span> <span class="kw">rename</span>(s10m<span class="op">$</span>AROME_Arctic_prod, <span class="dt">forecast =</span> AROME_Arctic_prod_det),</span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="dt">MEPS_prod         =</span> <span class="kw">rename</span>(s10m<span class="op">$</span>MEPS_prod, <span class="dt">forecast =</span> MEPS_prod_det),</span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="dt">.id =</span> <span class="st">&quot;mname&quot;</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>)</span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co">## # A tibble: 99,416 x 11</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="co">##    mname                 fcdate fcst_cycle leadtime model_elevation     p parameter   SID units  validdate forecast</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">##    &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt;    &lt;dbl&gt;</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">##  1 AROME_Arctic_prod 1550361600 00                0            63.9    NA S10m       1001 m/s   1550361600     7.49</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">##  2 AROME_Arctic_prod 1550361600 00                0             1.4    NA S10m       1002 m/s   1550361600    13.6 </span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co">##  3 AROME_Arctic_prod 1550361600 00                0            24.9    NA S10m       1003 m/s   1550361600     7.50</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="co">##  4 AROME_Arctic_prod 1550361600 00                0           162.     NA S10m       1004 m/s   1550361600     9.69</span></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="co">##  5 AROME_Arctic_prod 1550361600 00                0            -2.7    NA S10m       1006 m/s   1550361600     4.52</span></span>
<span id="cb34-14"><a href="#cb34-14"></a><span class="co">##  6 AROME_Arctic_prod 1550361600 00                0            21.6    NA S10m       1007 m/s   1550361600     9.88</span></span>
<span id="cb34-15"><a href="#cb34-15"></a><span class="co">##  7 AROME_Arctic_prod 1550361600 00                0            67.2    NA S10m       1008 m/s   1550361600     8.43</span></span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="co">##  8 AROME_Arctic_prod 1550361600 00                0             1.2    NA S10m       1009 m/s   1550361600    13.1 </span></span>
<span id="cb34-17"><a href="#cb34-17"></a><span class="co">##  9 AROME_Arctic_prod 1550361600 00                0             3.3    NA S10m       1010 m/s   1550361600    11.3 </span></span>
<span id="cb34-18"><a href="#cb34-18"></a><span class="co">## 10 AROME_Arctic_prod 1550361600 00                0            20.7    NA S10m       1011 m/s   1550361600     6.46</span></span>
<span id="cb34-19"><a href="#cb34-19"></a><span class="co">## # … with 99,406 more rows</span></span></code></pre></div>
<p>You will also find in R directory a function, <code>bind_fcst</code> that does this binding for you - this function will be part of harp soon.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">bind_fcst</span>(s10m)</span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co">## # A tibble: 99,416 x 11</span></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co">##    mname                 fcdate fcst_cycle leadtime model_elevation     p parameter   SID units  validdate forecast</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co">##    &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt;    &lt;dbl&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co">##  1 AROME_Arctic_prod 1550361600 00                0            63.9    NA S10m       1001 m/s   1550361600     7.49</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co">##  2 AROME_Arctic_prod 1550361600 00                0             1.4    NA S10m       1002 m/s   1550361600    13.6 </span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="co">##  3 AROME_Arctic_prod 1550361600 00                0            24.9    NA S10m       1003 m/s   1550361600     7.50</span></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="co">##  4 AROME_Arctic_prod 1550361600 00                0           162.     NA S10m       1004 m/s   1550361600     9.69</span></span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="co">##  5 AROME_Arctic_prod 1550361600 00                0            -2.7    NA S10m       1006 m/s   1550361600     4.52</span></span>
<span id="cb35-10"><a href="#cb35-10"></a><span class="co">##  6 AROME_Arctic_prod 1550361600 00                0            21.6    NA S10m       1007 m/s   1550361600     9.88</span></span>
<span id="cb35-11"><a href="#cb35-11"></a><span class="co">##  7 AROME_Arctic_prod 1550361600 00                0            67.2    NA S10m       1008 m/s   1550361600     8.43</span></span>
<span id="cb35-12"><a href="#cb35-12"></a><span class="co">##  8 AROME_Arctic_prod 1550361600 00                0             1.2    NA S10m       1009 m/s   1550361600    13.1 </span></span>
<span id="cb35-13"><a href="#cb35-13"></a><span class="co">##  9 AROME_Arctic_prod 1550361600 00                0             3.3    NA S10m       1010 m/s   1550361600    11.3 </span></span>
<span id="cb35-14"><a href="#cb35-14"></a><span class="co">## 10 AROME_Arctic_prod 1550361600 00                0            20.7    NA S10m       1011 m/s   1550361600     6.46</span></span>
<span id="cb35-15"><a href="#cb35-15"></a><span class="co">## # … with 99,406 more rows</span></span></code></pre></div>
<p>Your turn:</p>
<ul>
<li>Plot the the forecast wind speed at REIPA for both AROME_Arctic_prod and MEPS_prod for each fcst_cycle as a function of validdate. [You can get the SID for REIPA from the built in list of stations which is in the variable station_list]</li>
</ul>
<p>Solution:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>reipa_sid &lt;-<span class="st"> </span><span class="kw">filter</span>(station_list, name <span class="op">==</span><span class="st"> &quot;REIPA&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="st">  </span><span class="kw">pull</span>(SID)</span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="kw">bind_fcst</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span>reipa_sid) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(validdate, forecast, <span class="dt">colour =</span> fcst_cycle)) <span class="op">+</span></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(mname), <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="st">    </span><span class="kw">scale_x_datetime</span>(</span>
<span id="cb36-10"><a href="#cb36-10"></a>      <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">ymd_hm</span>(<span class="kw">seq_dates</span>(<span class="dv">2019021706</span>, <span class="dv">2019021918</span>, <span class="st">&quot;12h&quot;</span>))</span>
<span id="cb36-11"><a href="#cb36-11"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb36-12"><a href="#cb36-12"></a><span class="st">    </span><span class="kw">labs</span>(</span>
<span id="cb36-13"><a href="#cb36-13"></a>      <span class="dt">x      =</span> <span class="st">&quot;Date-time&quot;</span>,</span>
<span id="cb36-14"><a href="#cb36-14"></a>      <span class="dt">y      =</span> <span class="kw">bquote</span>(<span class="st">&quot;Wind speed [ms&quot;</span><span class="op">^-</span><span class="dv">1</span><span class="op">*</span><span class="st">&quot;]&quot;</span>),</span>
<span id="cb36-15"><a href="#cb36-15"></a>      <span class="dt">colour =</span> <span class="st">&quot;Forecast cycle&quot;</span>,</span>
<span id="cb36-16"><a href="#cb36-16"></a>      <span class="dt">title  =</span> <span class="st">&quot;Forecast Wind Speed at REIPA&quot;</span></span>
<span id="cb36-17"><a href="#cb36-17"></a>    ) <span class="op">+</span></span>
<span id="cb36-18"><a href="#cb36-18"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb36-19"><a href="#cb36-19"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-27-1.png" width="912" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="kw">bind_fcst</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span>reipa_sid) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(validdate, forecast, <span class="dt">colour =</span> mname)) <span class="op">+</span></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(fcst_cycle), <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="st">    </span><span class="kw">scale_x_datetime</span>(</span>
<span id="cb37-9"><a href="#cb37-9"></a>      <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">ymd_hm</span>(<span class="kw">seq_dates</span>(<span class="dv">2019021706</span>, <span class="dv">2019021918</span>, <span class="st">&quot;12h&quot;</span>))</span>
<span id="cb37-10"><a href="#cb37-10"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="st">    </span><span class="kw">labs</span>(</span>
<span id="cb37-12"><a href="#cb37-12"></a>      <span class="dt">x      =</span> <span class="st">&quot;Date-time&quot;</span>,</span>
<span id="cb37-13"><a href="#cb37-13"></a>      <span class="dt">y      =</span> <span class="kw">bquote</span>(<span class="st">&quot;Wind speed [ms&quot;</span><span class="op">^-</span><span class="dv">1</span><span class="op">*</span><span class="st">&quot;]&quot;</span>),</span>
<span id="cb37-14"><a href="#cb37-14"></a>      <span class="dt">colour =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb37-15"><a href="#cb37-15"></a>      <span class="dt">title  =</span> <span class="st">&quot;Forecast Wind Speed at REIPA&quot;</span></span>
<span id="cb37-16"><a href="#cb37-16"></a>    ) <span class="op">+</span></span>
<span id="cb37-17"><a href="#cb37-17"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb37-18"><a href="#cb37-18"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-27-2.png" width="912" /></p>
<p>Now let’s read in some observations. To make sure we get the correct dates for the observations we can get the first and last validdates from the forecast. We could also extract the station IDs from the forecasts - which we can do with a little bit of “functional programming”.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>station_ids &lt;-<span class="st"> </span><span class="kw">map</span>(s10m, pull, SID) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="st">  </span><span class="kw">reduce</span>(union)</span>
<span id="cb38-3"><a href="#cb38-3"></a>obs &lt;-<span class="st"> </span><span class="kw">read_point_obs</span>(</span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="dt">start_date =</span> <span class="kw">first_validdate</span>(s10m),</span>
<span id="cb38-5"><a href="#cb38-5"></a>  <span class="dt">end_date   =</span> <span class="kw">last_validdate</span>(s10m),</span>
<span id="cb38-6"><a href="#cb38-6"></a>  <span class="dt">stations   =</span> station_ids,</span>
<span id="cb38-7"><a href="#cb38-7"></a>  <span class="dt">parameter  =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb38-8"><a href="#cb38-8"></a>  <span class="dt">obs_path   =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>) </span>
<span id="cb38-9"><a href="#cb38-9"></a>)</span></code></pre></div>
<p>Now that we have the observations we can join them to our forecast data using the function <code>join_to_fcst</code>. This will take each of the data frames in our forecast list and perform an inner join with the observations - that means that only rows that are common to both data frames are kept.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(s10m, obs)</span></code></pre></div>
<p>We have now added an observations column to each of the forecasts, so we could also include the observations in our plots.</p>
<p>Your turn:</p>
<ul>
<li>Add observations as a geom_point to your plots. [hint: you can map an aesthetic to an individual geom]</li>
</ul>
<p>Solution:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">bind_fcst</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span>reipa_sid) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(validdate, forecast, <span class="dt">colour =</span> mname)) <span class="op">+</span></span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb40-6"><a href="#cb40-6"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> S10m, <span class="dt">shape =</span> <span class="st">&quot;Observation&quot;</span>), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(fcst_cycle), <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="st">    </span><span class="kw">scale_x_datetime</span>(</span>
<span id="cb40-10"><a href="#cb40-10"></a>      <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">ymd_hm</span>(<span class="kw">seq_dates</span>(<span class="dv">2019021706</span>, <span class="dv">2019021918</span>, <span class="st">&quot;12h&quot;</span>))</span>
<span id="cb40-11"><a href="#cb40-11"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="st">    </span><span class="kw">labs</span>(</span>
<span id="cb40-13"><a href="#cb40-13"></a>      <span class="dt">x      =</span> <span class="st">&quot;Date-time&quot;</span>,</span>
<span id="cb40-14"><a href="#cb40-14"></a>      <span class="dt">y      =</span> <span class="kw">bquote</span>(<span class="st">&quot;Wind speed [ms&quot;</span><span class="op">^-</span><span class="dv">1</span><span class="op">*</span><span class="st">&quot;]&quot;</span>),</span>
<span id="cb40-15"><a href="#cb40-15"></a>      <span class="dt">colour =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb40-16"><a href="#cb40-16"></a>      <span class="dt">title  =</span> <span class="st">&quot;Forecast Wind Speed at REIPA&quot;</span>,</span>
<span id="cb40-17"><a href="#cb40-17"></a>      <span class="dt">shape  =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb40-18"><a href="#cb40-18"></a>    ) <span class="op">+</span></span>
<span id="cb40-19"><a href="#cb40-19"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb40-20"><a href="#cb40-20"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-30-1.png" width="912" /></p>
<div id="verifying-deterministic-forecasts" class="section level4">
<h4><span class="header-section-number">0.5.10.1</span> Verifying deterministic forecasts</h4>
<p>Now that we have both forecasts and observations we can verify the forecasts. This is very simple in harp - we just run the function <code>det_verify</code> giving that data and telling it which column has the observations:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw">det_verify</span>(s10m, S10m)</span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="co">## $det_summary_scores</span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="co">## # A tibble: 34 x 7</span></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co">##    mname             leadtime num_cases   bias  rmse   mae  stde</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="co">##    &lt;chr&gt;                &lt;int&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="co">##  1 AROME_Arctic_prod        0       629 0.137   2.57  1.80  2.57</span></span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="co">##  2 AROME_Arctic_prod        3       679 0.0580  2.34  1.60  2.34</span></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="co">##  3 AROME_Arctic_prod        6       622 0.0390  2.38  1.65  2.38</span></span>
<span id="cb41-9"><a href="#cb41-9"></a><span class="co">##  4 AROME_Arctic_prod        9       679 0.0942  2.08  1.42  2.08</span></span>
<span id="cb41-10"><a href="#cb41-10"></a><span class="co">##  5 AROME_Arctic_prod       12       628 0.169   2.24  1.53  2.24</span></span>
<span id="cb41-11"><a href="#cb41-11"></a><span class="co">##  6 AROME_Arctic_prod       15       675 0.295   2.17  1.53  2.15</span></span>
<span id="cb41-12"><a href="#cb41-12"></a><span class="co">##  7 AROME_Arctic_prod       18       630 0.319   2.22  1.53  2.20</span></span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="co">##  8 AROME_Arctic_prod       21       676 0.480   2.23  1.61  2.17</span></span>
<span id="cb41-14"><a href="#cb41-14"></a><span class="co">##  9 AROME_Arctic_prod       24       628 0.388   2.34  1.61  2.31</span></span>
<span id="cb41-15"><a href="#cb41-15"></a><span class="co">## 10 AROME_Arctic_prod       27       674 0.538   2.39  1.69  2.33</span></span>
<span id="cb41-16"><a href="#cb41-16"></a><span class="co">## # … with 24 more rows</span></span>
<span id="cb41-17"><a href="#cb41-17"></a><span class="co">## </span></span>
<span id="cb41-18"><a href="#cb41-18"></a><span class="co">## $det_threshold_scores</span></span>
<span id="cb41-19"><a href="#cb41-19"></a><span class="co">## data frame with 0 columns and 0 rows</span></span>
<span id="cb41-20"><a href="#cb41-20"></a><span class="co">## </span></span>
<span id="cb41-21"><a href="#cb41-21"></a><span class="co">## attr(,&quot;parameter&quot;)</span></span>
<span id="cb41-22"><a href="#cb41-22"></a><span class="co">## [1] &quot;S10m&quot;</span></span>
<span id="cb41-23"><a href="#cb41-23"></a><span class="co">## attr(,&quot;start_date&quot;)</span></span>
<span id="cb41-24"><a href="#cb41-24"></a><span class="co">## [1] &quot;2019021700&quot;</span></span>
<span id="cb41-25"><a href="#cb41-25"></a><span class="co">## attr(,&quot;end_date&quot;)</span></span>
<span id="cb41-26"><a href="#cb41-26"></a><span class="co">## [1] &quot;2019021718&quot;</span></span>
<span id="cb41-27"><a href="#cb41-27"></a><span class="co">## attr(,&quot;num_stations&quot;)</span></span>
<span id="cb41-28"><a href="#cb41-28"></a><span class="co">## [1] 828</span></span></code></pre></div>
<p>You will see that the output is a list of two data frames - one fore summary scores and one for threshold scores. The threshold scores data frame contains only missing data as we didn’t give the function any thresholds to verify for. However, that is easily done:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">det_verify</span>(s10m, S10m, <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="fl">2.5</span>, <span class="fl">12.5</span>, <span class="fl">2.5</span>))</span>
<span id="cb42-2"><a href="#cb42-2"></a>verif_s10m</span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="co">## $det_summary_scores</span></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="co">## # A tibble: 34 x 7</span></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="co">##    mname             leadtime num_cases   bias  rmse   mae  stde</span></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="co">##    &lt;chr&gt;                &lt;int&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7"></a><span class="co">##  1 AROME_Arctic_prod        0       629 0.137   2.57  1.80  2.57</span></span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="co">##  2 AROME_Arctic_prod        3       679 0.0580  2.34  1.60  2.34</span></span>
<span id="cb42-9"><a href="#cb42-9"></a><span class="co">##  3 AROME_Arctic_prod        6       622 0.0390  2.38  1.65  2.38</span></span>
<span id="cb42-10"><a href="#cb42-10"></a><span class="co">##  4 AROME_Arctic_prod        9       679 0.0942  2.08  1.42  2.08</span></span>
<span id="cb42-11"><a href="#cb42-11"></a><span class="co">##  5 AROME_Arctic_prod       12       628 0.169   2.24  1.53  2.24</span></span>
<span id="cb42-12"><a href="#cb42-12"></a><span class="co">##  6 AROME_Arctic_prod       15       675 0.295   2.17  1.53  2.15</span></span>
<span id="cb42-13"><a href="#cb42-13"></a><span class="co">##  7 AROME_Arctic_prod       18       630 0.319   2.22  1.53  2.20</span></span>
<span id="cb42-14"><a href="#cb42-14"></a><span class="co">##  8 AROME_Arctic_prod       21       676 0.480   2.23  1.61  2.17</span></span>
<span id="cb42-15"><a href="#cb42-15"></a><span class="co">##  9 AROME_Arctic_prod       24       628 0.388   2.34  1.61  2.31</span></span>
<span id="cb42-16"><a href="#cb42-16"></a><span class="co">## 10 AROME_Arctic_prod       27       674 0.538   2.39  1.69  2.33</span></span>
<span id="cb42-17"><a href="#cb42-17"></a><span class="co">## # … with 24 more rows</span></span>
<span id="cb42-18"><a href="#cb42-18"></a><span class="co">## </span></span>
<span id="cb42-19"><a href="#cb42-19"></a><span class="co">## $det_threshold_scores</span></span>
<span id="cb42-20"><a href="#cb42-20"></a><span class="co">## # A tibble: 170 x 40</span></span>
<span id="cb42-21"><a href="#cb42-21"></a><span class="co">##    mname leadtime threshold num_cases_for_t… num_cases_for_t… num_cases_for_t… cont_tab threat_score hit_rate miss_rate</span></span>
<span id="cb42-22"><a href="#cb42-22"></a><span class="co">##    &lt;chr&gt;    &lt;int&gt;     &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt; &lt;list&gt;          &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb42-23"><a href="#cb42-23"></a><span class="co">##  1 AROM…        0       2.5              461              418              421 &lt;tibble…        0.820    0.904    0.0957</span></span>
<span id="cb42-24"><a href="#cb42-24"></a><span class="co">##  2 AROM…        3       2.5              482              418              436 &lt;tibble…        0.772    0.890    0.110 </span></span>
<span id="cb42-25"><a href="#cb42-25"></a><span class="co">##  3 AROM…        6       2.5              410              348              358 &lt;tibble…        0.722    0.851    0.149 </span></span>
<span id="cb42-26"><a href="#cb42-26"></a><span class="co">##  4 AROM…        9       2.5              449              365              403 &lt;tibble…        0.710    0.874    0.126 </span></span>
<span id="cb42-27"><a href="#cb42-27"></a><span class="co">##  5 AROM…       12       2.5              410              328              363 &lt;tibble…        0.685    0.857    0.143 </span></span>
<span id="cb42-28"><a href="#cb42-28"></a><span class="co">##  6 AROM…       15       2.5              459              358              422 &lt;tibble…        0.699    0.897    0.103 </span></span>
<span id="cb42-29"><a href="#cb42-29"></a><span class="co">##  7 AROM…       18       2.5              437              338              389 &lt;tibble…        0.664    0.858    0.142 </span></span>
<span id="cb42-30"><a href="#cb42-30"></a><span class="co">##  8 AROM…       21       2.5              497              374              466 &lt;tibble…        0.690    0.917    0.0829</span></span>
<span id="cb42-31"><a href="#cb42-31"></a><span class="co">##  9 AROM…       24       2.5              452              348              413 &lt;tibble…        0.684    0.888    0.112 </span></span>
<span id="cb42-32"><a href="#cb42-32"></a><span class="co">## 10 AROM…       27       2.5              496              374              471 &lt;tibble…        0.704    0.933    0.0668</span></span>
<span id="cb42-33"><a href="#cb42-33"></a><span class="co">## # … with 160 more rows, and 30 more variables: false_alarm_rate &lt;dbl&gt;, false_alarm_ratio &lt;dbl&gt;, heidke_skill_score &lt;dbl&gt;,</span></span>
<span id="cb42-34"><a href="#cb42-34"></a><span class="co">## #   pierce_skill_score &lt;dbl&gt;, kuiper_skill_score &lt;dbl&gt;, percent_correct &lt;dbl&gt;, frequency_bias &lt;dbl&gt;,</span></span>
<span id="cb42-35"><a href="#cb42-35"></a><span class="co">## #   equitable_threat_score &lt;dbl&gt;, odds_ratio &lt;dbl&gt;, log_odds_ratio &lt;dbl&gt;, odds_ratio_skill_score &lt;dbl&gt;,</span></span>
<span id="cb42-36"><a href="#cb42-36"></a><span class="co">## #   extreme_dependency_score &lt;dbl&gt;, symmetric_eds &lt;dbl&gt;, extreme_dependency_index &lt;dbl&gt;, symmetric_edi &lt;dbl&gt;,</span></span>
<span id="cb42-37"><a href="#cb42-37"></a><span class="co">## #   threat_score_std_error &lt;dbl&gt;, hit_rate_std_error &lt;dbl&gt;, false_alarm_rate_std_error &lt;dbl&gt;,</span></span>
<span id="cb42-38"><a href="#cb42-38"></a><span class="co">## #   false_alarm_ratio_std_error &lt;dbl&gt;, heidke_skill_score_std_error &lt;dbl&gt;, pierce_skill_score_std_error &lt;dbl&gt;,</span></span>
<span id="cb42-39"><a href="#cb42-39"></a><span class="co">## #   percent_correct_std_error &lt;dbl&gt;, equitable_threat_score_std_error &lt;dbl&gt;, log_odds_ratio_std_error &lt;dbl&gt;,</span></span>
<span id="cb42-40"><a href="#cb42-40"></a><span class="co">## #   log_odds_ratio_degrees_of_freedom &lt;dbl&gt;, odds_ratio_skill_score_std_error &lt;dbl&gt;,</span></span>
<span id="cb42-41"><a href="#cb42-41"></a><span class="co">## #   extreme_dependency_score_std_error &lt;dbl&gt;, symmetric_eds_std_error &lt;dbl&gt;, extreme_dependency_index_std_error &lt;dbl&gt;,</span></span>
<span id="cb42-42"><a href="#cb42-42"></a><span class="co">## #   symmetric_edi_std_error &lt;dbl&gt;</span></span>
<span id="cb42-43"><a href="#cb42-43"></a><span class="co">## </span></span>
<span id="cb42-44"><a href="#cb42-44"></a><span class="co">## attr(,&quot;parameter&quot;)</span></span>
<span id="cb42-45"><a href="#cb42-45"></a><span class="co">## [1] &quot;S10m&quot;</span></span>
<span id="cb42-46"><a href="#cb42-46"></a><span class="co">## attr(,&quot;start_date&quot;)</span></span>
<span id="cb42-47"><a href="#cb42-47"></a><span class="co">## [1] &quot;2019021700&quot;</span></span>
<span id="cb42-48"><a href="#cb42-48"></a><span class="co">## attr(,&quot;end_date&quot;)</span></span>
<span id="cb42-49"><a href="#cb42-49"></a><span class="co">## [1] &quot;2019021718&quot;</span></span>
<span id="cb42-50"><a href="#cb42-50"></a><span class="co">## attr(,&quot;num_stations&quot;)</span></span>
<span id="cb42-51"><a href="#cb42-51"></a><span class="co">## [1] 828</span></span></code></pre></div>
<p>As you can see, a very large number of scores are computed. harp has a function for plotting point verification scores, <code>plot_point_verif</code>. For summary scores, you just need to give it the verification data and tell it which score you’d like to plot, as well as tell the function that it is deterministic verification data.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, bias, <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>One thing you’ll immediately notice is that the number of cases for MEPS_prod is much larger than for AROME_Arctic_prod. This means that in this verification we are not making a fair comparison - we should actually only be verifying the dates and locations that are common to both systems. harp provides the function <code>common_cases()</code> to do just that!</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">common_cases</span>(s10m)</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="co">## # A tibble: 10,170 x 14</span></span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate AROME_Arctic_pr…   lon   lat  elev</span></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="co">##  1 1.55e9 00                0            63.9    NA S10m       1001 m/s      1.55e9             7.49 -8.67  70.9     9</span></span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="co">##  2 1.55e9 00                0             3.3    NA S10m       1010 m/s      1.55e9            11.3  16.1   69.3    13</span></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="co">##  3 1.55e9 00                0             0.5    NA S10m       1015 m/s      1.55e9            11.2  17.8   69.6    14</span></span>
<span id="cb44-9"><a href="#cb44-9"></a><span class="co">##  4 1.55e9 00                0           169.     NA S10m       1018 m/s      1.55e9             8.43 16.0   69.2   436</span></span>
<span id="cb44-10"><a href="#cb44-10"></a><span class="co">##  5 1.55e9 00                0            73.5    NA S10m       1023 m/s      1.55e9             5.08 18.5   69.1    77</span></span>
<span id="cb44-11"><a href="#cb44-11"></a><span class="co">##  6 1.55e9 00                0            22.2    NA S10m       1025 m/s      1.55e9             6.78 18.9   69.7     9</span></span>
<span id="cb44-12"><a href="#cb44-12"></a><span class="co">##  7 1.55e9 00                0            14.4    NA S10m       1026 m/s      1.55e9             6.18 18.9   69.7   115</span></span>
<span id="cb44-13"><a href="#cb44-13"></a><span class="co">##  8 1.55e9 00                0            -2.6    NA S10m       1033 m/s      1.55e9            10.9  19.5   70.2    21</span></span>
<span id="cb44-14"><a href="#cb44-14"></a><span class="co">##  9 1.55e9 00                0           125.     NA S10m       1036 m/s      1.55e9             8.56 20.4   69.6   700</span></span>
<span id="cb44-15"><a href="#cb44-15"></a><span class="co">## 10 1.55e9 00                0           160.     NA S10m       1037 m/s      1.55e9             9.69 20.3   69.4    20</span></span>
<span id="cb44-16"><a href="#cb44-16"></a><span class="co">## # … with 10,160 more rows, and 1 more variable: S10m &lt;dbl&gt;</span></span>
<span id="cb44-17"><a href="#cb44-17"></a><span class="co">## </span></span>
<span id="cb44-18"><a href="#cb44-18"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb44-19"><a href="#cb44-19"></a><span class="co">## # A tibble: 10,170 x 14</span></span>
<span id="cb44-20"><a href="#cb44-20"></a><span class="co">##     fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_det   lon   lat  elev  S10m</span></span>
<span id="cb44-21"><a href="#cb44-21"></a><span class="co">##      &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb44-22"><a href="#cb44-22"></a><span class="co">##  1  1.55e9 00                0            36.4    NA S10m       1001 m/s      1.55e9          4.22 -8.67  70.9     9   8.8</span></span>
<span id="cb44-23"><a href="#cb44-23"></a><span class="co">##  2  1.55e9 00                0             4.1    NA S10m       1010 m/s      1.55e9         11.9  16.1   69.3    13  11.3</span></span>
<span id="cb44-24"><a href="#cb44-24"></a><span class="co">##  3  1.55e9 00                0             2.6    NA S10m       1015 m/s      1.55e9         11.3  17.8   69.6    14  14  </span></span>
<span id="cb44-25"><a href="#cb44-25"></a><span class="co">##  4  1.55e9 00                0           152.     NA S10m       1018 m/s      1.55e9          9.09 16.0   69.2   436  12  </span></span>
<span id="cb44-26"><a href="#cb44-26"></a><span class="co">##  5  1.55e9 00                0            69.1    NA S10m       1023 m/s      1.55e9          6.42 18.5   69.1    77   7.4</span></span>
<span id="cb44-27"><a href="#cb44-27"></a><span class="co">##  6  1.55e9 00                0             8.1    NA S10m       1025 m/s      1.55e9          5.24 18.9   69.7     9   8.8</span></span>
<span id="cb44-28"><a href="#cb44-28"></a><span class="co">##  7  1.55e9 00                0             5.2    NA S10m       1026 m/s      1.55e9          4.74 18.9   69.7   115   4.9</span></span>
<span id="cb44-29"><a href="#cb44-29"></a><span class="co">##  8  1.55e9 00                0            28.5    NA S10m       1033 m/s      1.55e9         10.1  19.5   70.2    21  16  </span></span>
<span id="cb44-30"><a href="#cb44-30"></a><span class="co">##  9  1.55e9 00                0           129      NA S10m       1036 m/s      1.55e9          8.64 20.4   69.6   700   8  </span></span>
<span id="cb44-31"><a href="#cb44-31"></a><span class="co">## 10  1.55e9 00                0            94.5    NA S10m       1037 m/s      1.55e9          9.47 20.3   69.4    20   3  </span></span>
<span id="cb44-32"><a href="#cb44-32"></a><span class="co">## # … with 10,160 more rows</span></span>
<span id="cb44-33"><a href="#cb44-33"></a>s10m &lt;-<span class="st"> </span><span class="kw">common_cases</span>(s10m)</span></code></pre></div>
<p>You will see that now both AROME_Arctic_prod and MEPS_prod have the exact same number of rows in their data. Now if we run the verfication again and plot the same score we will see that both forecasting systems have the same number of cases.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">det_verify</span>(s10m, S10m, <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="fl">2.5</span>, <span class="fl">12.5</span>, <span class="fl">2.5</span>))</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="kw">plot_point_verif</span>(verif_s10m, bias, <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Try plotting one of the threshold scores (frequency_bias, for example). Try to figure out wht the plot looks so weird</li>
</ul>
<p>Solution:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, frequency_bias, <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>The plot looks weird becasue it’s attempting to plot scores for all thresholds at the same time.</p>
<p>When we have more than one threshold, we need to tell <code>plot_point_verif</code> what to do - there are 2 options - to facet or to filter, with the arguments <code>facet_by</code> or <code>filter_by</code>. These arguments work in pretty much the same way as <code>facet_wrap</code>. For example if we wanted the facet the scores by threshold, we would do</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb47-2"><a href="#cb47-2"></a>  verif_s10m, </span>
<span id="cb47-3"><a href="#cb47-3"></a>  frequency_bias, </span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="dt">facet_by   =</span> <span class="kw">vars</span>(threshold)</span>
<span id="cb47-6"><a href="#cb47-6"></a>) </span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Or, if we just wanted the plot for a threshold of 7.5 ms<sup>-1</sup>, we would use <code>filter_by</code></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb48-2"><a href="#cb48-2"></a>  verif_s10m, </span>
<span id="cb48-3"><a href="#cb48-3"></a>  frequency_bias, </span>
<span id="cb48-4"><a href="#cb48-4"></a>  <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb48-5"><a href="#cb48-5"></a>  <span class="dt">filter_by  =</span> <span class="kw">vars</span>(threshold <span class="op">==</span><span class="st"> </span><span class="fl">7.5</span>)</span>
<span id="cb48-6"><a href="#cb48-6"></a>) </span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
<div id="verification-by-group" class="section level4">
<h4><span class="header-section-number">0.5.10.2</span> Verification by group</h4>
<p>The default behaviour of harp verification functions is to compute the verification metrics for each lead time. However, you can also compute the scores for any groups of data, much in the same way as <code>group_by</code> enables you to do. In this case groups are specified in the <code>groupings</code> argument to the verification function, and unlike <code>group_by</code> the column names you wish to use for grouping variables must be quoted (this may change in the future for consistency with <code>group_by</code>) and if there are more than one in a charcater vector. We could for example compute scores for each valid time:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>(verif_s10m &lt;-<span class="st"> </span><span class="kw">det_verify</span>(s10m, S10m, <span class="dt">groupings =</span> <span class="st">&quot;validdate&quot;</span>))</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co">## $det_summary_scores</span></span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="co">## # A tibble: 46 x 7</span></span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="co">##    mname              validdate num_cases    bias  rmse   mae  stde</span></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="co">##    &lt;chr&gt;                  &lt;int&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="co">##  1 AROME_Arctic_prod 1550361600       147  0.276   3.04  2.28  3.04</span></span>
<span id="cb49-7"><a href="#cb49-7"></a><span class="co">##  2 AROME_Arctic_prod 1550372400       155  0.121   2.90  2.11  2.91</span></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="co">##  3 AROME_Arctic_prod 1550383200       270  0.0203  2.68  1.81  2.68</span></span>
<span id="cb49-9"><a href="#cb49-9"></a><span class="co">##  4 AROME_Arctic_prod 1550394000       312 -0.295   1.95  1.35  1.93</span></span>
<span id="cb49-10"><a href="#cb49-10"></a><span class="co">##  5 AROME_Arctic_prod 1550404800       459 -0.235   2.07  1.44  2.06</span></span>
<span id="cb49-11"><a href="#cb49-11"></a><span class="co">##  6 AROME_Arctic_prod 1550415600       468 -0.112   1.95  1.26  1.95</span></span>
<span id="cb49-12"><a href="#cb49-12"></a><span class="co">##  7 AROME_Arctic_prod 1550426400       572 -0.0128  1.84  1.30  1.84</span></span>
<span id="cb49-13"><a href="#cb49-13"></a><span class="co">##  8 AROME_Arctic_prod 1550437200       628  0.192   2.05  1.39  2.05</span></span>
<span id="cb49-14"><a href="#cb49-14"></a><span class="co">##  9 AROME_Arctic_prod 1550448000       560 -0.0470  2.25  1.53  2.25</span></span>
<span id="cb49-15"><a href="#cb49-15"></a><span class="co">## 10 AROME_Arctic_prod 1550458800       620  0.126   2.04  1.45  2.03</span></span>
<span id="cb49-16"><a href="#cb49-16"></a><span class="co">## # … with 36 more rows</span></span>
<span id="cb49-17"><a href="#cb49-17"></a><span class="co">## </span></span>
<span id="cb49-18"><a href="#cb49-18"></a><span class="co">## $det_threshold_scores</span></span>
<span id="cb49-19"><a href="#cb49-19"></a><span class="co">## data frame with 0 columns and 0 rows</span></span>
<span id="cb49-20"><a href="#cb49-20"></a><span class="co">## </span></span>
<span id="cb49-21"><a href="#cb49-21"></a><span class="co">## attr(,&quot;parameter&quot;)</span></span>
<span id="cb49-22"><a href="#cb49-22"></a><span class="co">## [1] &quot;S10m&quot;</span></span>
<span id="cb49-23"><a href="#cb49-23"></a><span class="co">## attr(,&quot;start_date&quot;)</span></span>
<span id="cb49-24"><a href="#cb49-24"></a><span class="co">## [1] &quot;2019021700&quot;</span></span>
<span id="cb49-25"><a href="#cb49-25"></a><span class="co">## attr(,&quot;end_date&quot;)</span></span>
<span id="cb49-26"><a href="#cb49-26"></a><span class="co">## [1] &quot;2019021718&quot;</span></span>
<span id="cb49-27"><a href="#cb49-27"></a><span class="co">## attr(,&quot;num_stations&quot;)</span></span>
<span id="cb49-28"><a href="#cb49-28"></a><span class="co">## [1] 167</span></span></code></pre></div>
<p>To plot the score, we then need to tell plot_point_verif to use validdate as the x-axis (the default is lead time)</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, bias, <span class="dt">x_axis =</span> validdate)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>If you want to change the date into a readable format, you can use the <code>mutate_list</code> function.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="kw">mutate_list</span>(verif_s10m, <span class="dt">date_time =</span> <span class="kw">unix2datetime</span>(validdate)), </span>
<span id="cb51-3"><a href="#cb51-3"></a>  bias, </span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="dt">x_axis =</span> date_time</span>
<span id="cb51-5"><a href="#cb51-5"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Compute verification scores for stations with elevations <span class="math inline">\(\geqslant 300 m\)</span> and those <span class="math inline">\(\lt 300 m\)</span>. for each lead time and thresholds of 2.5 - 12.5 ms<sup>-1</sup> every 2.5 ms<sup>-1</sup>. To classify the station heights, you can use</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>stations &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb52-2"><a href="#cb52-2"></a>  station_list, </span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="dt">station_height =</span> <span class="kw">cut</span>(elev, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">300</span>, <span class="ot">Inf</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;lt_300m&quot;</span>, <span class="st">&quot;ge_300m&quot;</span>))</span>
<span id="cb52-4"><a href="#cb52-4"></a>)</span>
<span id="cb52-5"><a href="#cb52-5"></a>s10m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(s10m, stations, <span class="dt">force_join =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<ul>
<li>Plot the equitable threat score for each threshold and station height group.</li>
</ul>
<p>Solutions</p>
<ul>
<li>Compute verification scores for stations with elevations <span class="math inline">\(\geqslant 300 m\)</span> and those <span class="math inline">\(\lt 300 m\)</span>. for each lead time and thresholds of 2.5 - 12.5 ms<sup>-1</sup> every 2.5 ms<sup>-1</sup>.</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>stations &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb53-2"><a href="#cb53-2"></a>  station_list, </span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="dt">station_height =</span> <span class="kw">cut</span>(elev, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">300</span>, <span class="ot">Inf</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&gt; 300m&quot;</span>, <span class="st">&quot;&gt;= 300m&quot;</span>))</span>
<span id="cb53-4"><a href="#cb53-4"></a>)</span>
<span id="cb53-5"><a href="#cb53-5"></a>(verif_s10m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(s10m, stations, <span class="dt">force_join =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-6"><a href="#cb53-6"></a><span class="st">  </span><span class="kw">det_verify</span>(S10m, <span class="dt">groupings =</span> <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;station_height&quot;</span>), <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="fl">2.5</span>, <span class="fl">12.5</span>, <span class="fl">2.5</span>)))</span>
<span id="cb53-7"><a href="#cb53-7"></a><span class="co">## $det_summary_scores</span></span>
<span id="cb53-8"><a href="#cb53-8"></a><span class="co">## # A tibble: 0 x 8</span></span>
<span id="cb53-9"><a href="#cb53-9"></a><span class="co">## # … with 8 variables: mname &lt;chr&gt;, leadtime &lt;int&gt;, station_height &lt;fct&gt;, num_cases &lt;int&gt;, bias &lt;dbl&gt;, rmse &lt;dbl&gt;,</span></span>
<span id="cb53-10"><a href="#cb53-10"></a><span class="co">## #   mae &lt;dbl&gt;, stde &lt;dbl&gt;</span></span>
<span id="cb53-11"><a href="#cb53-11"></a><span class="co">## </span></span>
<span id="cb53-12"><a href="#cb53-12"></a><span class="co">## $det_threshold_scores</span></span>
<span id="cb53-13"><a href="#cb53-13"></a><span class="co">## # A tibble: 0 x 41</span></span>
<span id="cb53-14"><a href="#cb53-14"></a><span class="co">## # … with 41 variables: mname &lt;chr&gt;, leadtime &lt;int&gt;, station_height &lt;fct&gt;, threshold &lt;dbl&gt;,</span></span>
<span id="cb53-15"><a href="#cb53-15"></a><span class="co">## #   num_cases_for_threshold_total &lt;dbl&gt;, num_cases_for_threshold_observed &lt;dbl&gt;, num_cases_for_threshold_forecast &lt;dbl&gt;,</span></span>
<span id="cb53-16"><a href="#cb53-16"></a><span class="co">## #   cont_tab &lt;list&gt;, threat_score &lt;dbl&gt;, hit_rate &lt;dbl&gt;, miss_rate &lt;dbl&gt;, false_alarm_rate &lt;dbl&gt;,</span></span>
<span id="cb53-17"><a href="#cb53-17"></a><span class="co">## #   false_alarm_ratio &lt;dbl&gt;, heidke_skill_score &lt;dbl&gt;, pierce_skill_score &lt;dbl&gt;, kuiper_skill_score &lt;dbl&gt;,</span></span>
<span id="cb53-18"><a href="#cb53-18"></a><span class="co">## #   percent_correct &lt;dbl&gt;, frequency_bias &lt;dbl&gt;, equitable_threat_score &lt;dbl&gt;, odds_ratio &lt;dbl&gt;, log_odds_ratio &lt;dbl&gt;,</span></span>
<span id="cb53-19"><a href="#cb53-19"></a><span class="co">## #   odds_ratio_skill_score &lt;dbl&gt;, extreme_dependency_score &lt;dbl&gt;, symmetric_eds &lt;dbl&gt;, extreme_dependency_index &lt;dbl&gt;,</span></span>
<span id="cb53-20"><a href="#cb53-20"></a><span class="co">## #   symmetric_edi &lt;dbl&gt;, threat_score_std_error &lt;dbl&gt;, hit_rate_std_error &lt;dbl&gt;, false_alarm_rate_std_error &lt;dbl&gt;,</span></span>
<span id="cb53-21"><a href="#cb53-21"></a><span class="co">## #   false_alarm_ratio_std_error &lt;dbl&gt;, heidke_skill_score_std_error &lt;dbl&gt;, pierce_skill_score_std_error &lt;dbl&gt;,</span></span>
<span id="cb53-22"><a href="#cb53-22"></a><span class="co">## #   percent_correct_std_error &lt;dbl&gt;, equitable_threat_score_std_error &lt;dbl&gt;, log_odds_ratio_std_error &lt;dbl&gt;,</span></span>
<span id="cb53-23"><a href="#cb53-23"></a><span class="co">## #   log_odds_ratio_degrees_of_freedom &lt;dbl&gt;, odds_ratio_skill_score_std_error &lt;dbl&gt;,</span></span>
<span id="cb53-24"><a href="#cb53-24"></a><span class="co">## #   extreme_dependency_score_std_error &lt;dbl&gt;, symmetric_eds_std_error &lt;dbl&gt;, extreme_dependency_index_std_error &lt;dbl&gt;,</span></span>
<span id="cb53-25"><a href="#cb53-25"></a><span class="co">## #   symmetric_edi_std_error &lt;dbl&gt;</span></span>
<span id="cb53-26"><a href="#cb53-26"></a><span class="co">## </span></span>
<span id="cb53-27"><a href="#cb53-27"></a><span class="co">## attr(,&quot;parameter&quot;)</span></span>
<span id="cb53-28"><a href="#cb53-28"></a><span class="co">## [1] &quot;S10m&quot;</span></span>
<span id="cb53-29"><a href="#cb53-29"></a><span class="co">## attr(,&quot;start_date&quot;)</span></span>
<span id="cb53-30"><a href="#cb53-30"></a><span class="co">## [1] &quot;NANANANA&quot;</span></span>
<span id="cb53-31"><a href="#cb53-31"></a><span class="co">## attr(,&quot;end_date&quot;)</span></span>
<span id="cb53-32"><a href="#cb53-32"></a><span class="co">## [1] &quot;NANANANA&quot;</span></span>
<span id="cb53-33"><a href="#cb53-33"></a><span class="co">## attr(,&quot;num_stations&quot;)</span></span>
<span id="cb53-34"><a href="#cb53-34"></a><span class="co">## [1] 0</span></span></code></pre></div>
<ul>
<li>Plot the equitable threat score for each threshold and station height group.</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb54-2"><a href="#cb54-2"></a>  <span class="kw">mutate_list</span>(</span>
<span id="cb54-3"><a href="#cb54-3"></a>    verif_s10m,</span>
<span id="cb54-4"><a href="#cb54-4"></a>    <span class="dt">threshold =</span> <span class="kw">paste</span>(<span class="st">&quot;Wind speed &gt;=&quot;</span>, threshold, <span class="st">&quot;m/s&quot;</span>),</span>
<span id="cb54-5"><a href="#cb54-5"></a>    <span class="dt">station_height =</span> <span class="kw">paste</span>(<span class="st">&quot;Station altitude&quot;</span>, station_height)</span>
<span id="cb54-6"><a href="#cb54-6"></a>  ),</span>
<span id="cb54-7"><a href="#cb54-7"></a>  equitable_threat_score,</span>
<span id="cb54-8"><a href="#cb54-8"></a>  <span class="dt">facet_by =</span> <span class="kw">vars</span>(<span class="kw">fct_inorder</span>(threshold), station_height), </span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="dt">num_facet_cols =</span> <span class="dv">2</span></span>
<span id="cb54-10"><a href="#cb54-10"></a>)</span>
<span id="cb54-11"><a href="#cb54-11"></a><span class="co">## NULL</span></span></code></pre></div>
<p>Bearing in mind the <code>plot_point_verif</code> uses ggplot, you could also do the faceting yourself and have more control - for example, you coud use <code>facet_grid</code></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="kw">mutate_list</span>(</span>
<span id="cb55-3"><a href="#cb55-3"></a>    verif_s10m,</span>
<span id="cb55-4"><a href="#cb55-4"></a>    <span class="dt">threshold =</span> <span class="kw">paste</span>(<span class="st">&quot;S10m &gt;=&quot;</span>, threshold, <span class="st">&quot;m/s&quot;</span>),</span>
<span id="cb55-5"><a href="#cb55-5"></a>    <span class="dt">station_height =</span> <span class="kw">paste</span>(<span class="st">&quot;Station altitude&quot;</span>, station_height)</span>
<span id="cb55-6"><a href="#cb55-6"></a>  ),</span>
<span id="cb55-7"><a href="#cb55-7"></a>  equitable_threat_score</span>
<span id="cb55-8"><a href="#cb55-8"></a>) <span class="op">+</span></span>
<span id="cb55-9"><a href="#cb55-9"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">cols =</span> <span class="kw">vars</span>(station_height), <span class="dt">rows =</span> <span class="kw">vars</span>(<span class="kw">fct_inorder</span>(threshold)))</span>
<span id="cb55-10"><a href="#cb55-10"></a><span class="co">## NULL</span></span></code></pre></div>
</div>
<div id="vertical-profiles" class="section level4">
<h4><span class="header-section-number">0.5.10.3</span> Vertical profiles</h4>
<p>When we converted our data to sqlite, we also converted some upper air data for temperature and dew point temperature. To read in upper air data, we need to tell <code>read_point_forecast</code> and <code>read_point_obs</code> what the vertical coordinate is.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>(t_upper &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb56-2"><a href="#cb56-2"></a>  <span class="dt">start_date          =</span> <span class="dv">2019021700</span>,</span>
<span id="cb56-3"><a href="#cb56-3"></a>  <span class="dt">end_date            =</span> <span class="dv">2019021718</span>,</span>
<span id="cb56-4"><a href="#cb56-4"></a>  <span class="dt">fcst_model          =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb56-5"><a href="#cb56-5"></a>  <span class="dt">fcst_type           =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb56-6"><a href="#cb56-6"></a>  <span class="dt">parameter           =</span> <span class="st">&quot;T&quot;</span>,</span>
<span id="cb56-7"><a href="#cb56-7"></a>  <span class="dt">file_path           =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>),</span>
<span id="cb56-8"><a href="#cb56-8"></a>  <span class="dt">vertical_coordinate =</span> <span class="st">&quot;pressure&quot;</span></span>
<span id="cb56-9"><a href="#cb56-9"></a>))</span>
<span id="cb56-10"><a href="#cb56-10"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb56-11"><a href="#cb56-11"></a><span class="co">## # A tibble: 6,967 x 10</span></span>
<span id="cb56-12"><a href="#cb56-12"></a><span class="co">##        fcdate fcst_cycle leadtime model_elevation     p parameter   SID units  validdate AROME_Arctic_prod_det</span></span>
<span id="cb56-13"><a href="#cb56-13"></a><span class="co">##         &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt;                 &lt;dbl&gt;</span></span>
<span id="cb56-14"><a href="#cb56-14"></a><span class="co">##  1 1550361600 00                0            50.6    50 T          1001 K     1550361600                  207.</span></span>
<span id="cb56-15"><a href="#cb56-15"></a><span class="co">##  2 1550361600 00                0            50.6   100 T          1001 K     1550361600                  212.</span></span>
<span id="cb56-16"><a href="#cb56-16"></a><span class="co">##  3 1550361600 00                0            50.6   150 T          1001 K     1550361600                  217.</span></span>
<span id="cb56-17"><a href="#cb56-17"></a><span class="co">##  4 1550361600 00                0            50.6   200 T          1001 K     1550361600                  218 </span></span>
<span id="cb56-18"><a href="#cb56-18"></a><span class="co">##  5 1550361600 00                0            50.6   250 T          1001 K     1550361600                  214.</span></span>
<span id="cb56-19"><a href="#cb56-19"></a><span class="co">##  6 1550361600 00                0            50.6   300 T          1001 K     1550361600                  218.</span></span>
<span id="cb56-20"><a href="#cb56-20"></a><span class="co">##  7 1550361600 00                0            50.6   400 T          1001 K     1550361600                  230.</span></span>
<span id="cb56-21"><a href="#cb56-21"></a><span class="co">##  8 1550361600 00                0            50.6   500 T          1001 K     1550361600                  240.</span></span>
<span id="cb56-22"><a href="#cb56-22"></a><span class="co">##  9 1550361600 00                0            50.6   700 T          1001 K     1550361600                  254.</span></span>
<span id="cb56-23"><a href="#cb56-23"></a><span class="co">## 10 1550361600 00                0            50.6   850 T          1001 K     1550361600                  262.</span></span>
<span id="cb56-24"><a href="#cb56-24"></a><span class="co">## # … with 6,957 more rows</span></span>
<span id="cb56-25"><a href="#cb56-25"></a><span class="co">## </span></span>
<span id="cb56-26"><a href="#cb56-26"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb56-27"><a href="#cb56-27"></a><span class="co">## # A tibble: 29,956 x 10</span></span>
<span id="cb56-28"><a href="#cb56-28"></a><span class="co">##        fcdate fcst_cycle leadtime model_elevation     p parameter   SID units  validdate MEPS_prod_det</span></span>
<span id="cb56-29"><a href="#cb56-29"></a><span class="co">##         &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt;         &lt;dbl&gt;</span></span>
<span id="cb56-30"><a href="#cb56-30"></a><span class="co">##  1 1550361600 00                0            55.6    50 T          1001 K     1550361600          206.</span></span>
<span id="cb56-31"><a href="#cb56-31"></a><span class="co">##  2 1550361600 00                0            55.6   100 T          1001 K     1550361600          212.</span></span>
<span id="cb56-32"><a href="#cb56-32"></a><span class="co">##  3 1550361600 00                0            55.6   150 T          1001 K     1550361600          217.</span></span>
<span id="cb56-33"><a href="#cb56-33"></a><span class="co">##  4 1550361600 00                0            55.6   200 T          1001 K     1550361600          218.</span></span>
<span id="cb56-34"><a href="#cb56-34"></a><span class="co">##  5 1550361600 00                0            55.6   250 T          1001 K     1550361600          214.</span></span>
<span id="cb56-35"><a href="#cb56-35"></a><span class="co">##  6 1550361600 00                0            55.6   300 T          1001 K     1550361600          218.</span></span>
<span id="cb56-36"><a href="#cb56-36"></a><span class="co">##  7 1550361600 00                0            55.6   400 T          1001 K     1550361600          230.</span></span>
<span id="cb56-37"><a href="#cb56-37"></a><span class="co">##  8 1550361600 00                0            55.6   500 T          1001 K     1550361600          240.</span></span>
<span id="cb56-38"><a href="#cb56-38"></a><span class="co">##  9 1550361600 00                0            55.6   700 T          1001 K     1550361600          254.</span></span>
<span id="cb56-39"><a href="#cb56-39"></a><span class="co">## 10 1550361600 00                0            55.6   850 T          1001 K     1550361600          261.</span></span>
<span id="cb56-40"><a href="#cb56-40"></a><span class="co">## # … with 29,946 more rows</span></span>
<span id="cb56-41"><a href="#cb56-41"></a></span>
<span id="cb56-42"><a href="#cb56-42"></a>td_upper &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb56-43"><a href="#cb56-43"></a>  <span class="dt">start_date          =</span> <span class="dv">2019021700</span>,</span>
<span id="cb56-44"><a href="#cb56-44"></a>  <span class="dt">end_date            =</span> <span class="dv">2019021718</span>,</span>
<span id="cb56-45"><a href="#cb56-45"></a>  <span class="dt">fcst_model          =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb56-46"><a href="#cb56-46"></a>  <span class="dt">fcst_type           =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb56-47"><a href="#cb56-47"></a>  <span class="dt">parameter           =</span> <span class="st">&quot;Td&quot;</span>,</span>
<span id="cb56-48"><a href="#cb56-48"></a>  <span class="dt">file_path           =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>),</span>
<span id="cb56-49"><a href="#cb56-49"></a>  <span class="dt">vertical_coordinate =</span> <span class="st">&quot;pressure&quot;</span></span>
<span id="cb56-50"><a href="#cb56-50"></a>)</span></code></pre></div>
<p>harp has a function for plotting vertical profile, that allows you compare the profiles from different models - but only for the same parameter.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb57-2"><a href="#cb57-2"></a>  t_upper, </span>
<span id="cb57-3"><a href="#cb57-3"></a>  <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb57-4"><a href="#cb57-4"></a>  <span class="dt">fcdate    =</span> <span class="dv">2019021712</span>,</span>
<span id="cb57-5"><a href="#cb57-5"></a>  <span class="dt">lead_time =</span> <span class="dv">24</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>You can also plot the profiles on skew-t / log P grid by setting <code>skew_t = TRUE</code>. However, it should be noted that temperatures need to be in °C rather than Kelvin. We can convert the units by using <code>scale_point_forecast</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="kw">scale_point_forecast</span>(t_upper, <span class="fl">-273.15</span>, <span class="dt">new_units =</span> <span class="st">&quot;degC&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="st">  </span><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb58-3"><a href="#cb58-3"></a>    <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb58-4"><a href="#cb58-4"></a>    <span class="dt">fcdate    =</span> <span class="dv">2019021712</span>,</span>
<span id="cb58-5"><a href="#cb58-5"></a>    <span class="dt">lead_time =</span> <span class="dv">24</span>,</span>
<span id="cb58-6"><a href="#cb58-6"></a>    <span class="dt">skew_t    =</span> <span class="ot">TRUE</span></span>
<span id="cb58-7"><a href="#cb58-7"></a>  )</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>You can specify more than 1 station, date, and / or lead time in <code>plot_vertical_profile</code>. Experiment with making some multi panel plots.</li>
<li>Can you figure out how you would add the dew point temperature to the plots?</li>
</ul>
<p>Solution</p>
<ul>
<li>Experiment with making some multi panel plots.</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb59-2"><a href="#cb59-2"></a>  t_upper, </span>
<span id="cb59-3"><a href="#cb59-3"></a>  <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb59-4"><a href="#cb59-4"></a>  <span class="dt">fcdate    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb59-5"><a href="#cb59-5"></a>  <span class="dt">lead_time =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">6</span>),</span>
<span id="cb59-6"><a href="#cb59-6"></a>  <span class="dt">facet_by  =</span> <span class="kw">vars</span>(leadtime)</span>
<span id="cb59-7"><a href="#cb59-7"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<ul>
<li>Can you figure out how you would add the dew point temperature to the plots?</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb60-2"><a href="#cb60-2"></a>  t_upper, </span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="dt">fcdate    =</span> <span class="dv">2019021712</span>,</span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="dt">lead_time =</span> <span class="dv">24</span></span>
<span id="cb60-6"><a href="#cb60-6"></a>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="st">  </span><span class="kw">geom_path</span>(</span>
<span id="cb60-8"><a href="#cb60-8"></a>    <span class="dt">data =</span> <span class="kw">filter</span>(</span>
<span id="cb60-9"><a href="#cb60-9"></a>      <span class="kw">bind_fcst</span>(td_upper), </span>
<span id="cb60-10"><a href="#cb60-10"></a>      SID      <span class="op">==</span><span class="st"> </span><span class="dv">22113</span>, </span>
<span id="cb60-11"><a href="#cb60-11"></a>      fcdate   <span class="op">==</span><span class="st"> </span><span class="kw">str_datetime_to_unixtime</span>(<span class="dv">2019021712</span>), </span>
<span id="cb60-12"><a href="#cb60-12"></a>      leadtime <span class="op">==</span><span class="st"> </span><span class="dv">24</span></span>
<span id="cb60-13"><a href="#cb60-13"></a>    ), </span>
<span id="cb60-14"><a href="#cb60-14"></a>    <span class="kw">aes</span>(<span class="dt">linetype =</span> <span class="st">&quot;Dew Point&quot;</span>)</span>
<span id="cb60-15"><a href="#cb60-15"></a>  ) <span class="op">+</span></span>
<span id="cb60-16"><a href="#cb60-16"></a><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">values =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>

</div>
</div>
<div id="introduction-4" class="section level3">
<h3><span class="header-section-number">0.5.11</span> Introduction</h3>
<p>Now we have seen harp in action with deterministic data, let’s move on to ensemble data. harp’s origins are in verification of ensemble data, so the functionality here is a little more mature. Many of the same functions that were introduced in the deterministic section can be used for ensemble data as well. There are also functions that currently only work with ensemble data and are in the process of being upgraded to handle deterministic forecasts as well.</p>
</div>
<div id="reading-in-ensemble-data" class="section level3">
<h3><span class="header-section-number">0.5.12</span> Reading in ensemble data</h3>
<p>We can use the same <code>read_point_forecast</code> function to read in ensemble data - we just need to tell it that we are reading ensemble data by setting <code>fcst_type = "eps"</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="kw">library</span>(here)</span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="kw">library</span>(harp)</span>
<span id="cb61-4"><a href="#cb61-4"></a>(t2m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb61-5"><a href="#cb61-5"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb61-6"><a href="#cb61-6"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb61-7"><a href="#cb61-7"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;MEPS_prod&quot;</span>,</span>
<span id="cb61-8"><a href="#cb61-8"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb61-9"><a href="#cb61-9"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb61-10"><a href="#cb61-10"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb61-11"><a href="#cb61-11"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb61-12"><a href="#cb61-12"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb61-13"><a href="#cb61-13"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb61-14"><a href="#cb61-14"></a>))</span>
<span id="cb61-15"><a href="#cb61-15"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb61-16"><a href="#cb61-16"></a><span class="co">## # A tibble: 22,980 x 19</span></span>
<span id="cb61-17"><a href="#cb61-17"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb61-18"><a href="#cb61-18"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb61-19"><a href="#cb61-19"></a><span class="co">##  1 1.55e9 00                0            36.4    NA T2m        1001 K        1.55e9             268.             269.</span></span>
<span id="cb61-20"><a href="#cb61-20"></a><span class="co">##  2 1.55e9 00                0             4.1    NA T2m        1010 K        1.55e9             275.             276.</span></span>
<span id="cb61-21"><a href="#cb61-21"></a><span class="co">##  3 1.55e9 00                0            29.1    NA T2m        1014 K        1.55e9             273.             273.</span></span>
<span id="cb61-22"><a href="#cb61-22"></a><span class="co">##  4 1.55e9 00                0             2.6    NA T2m        1015 K        1.55e9             275.             276.</span></span>
<span id="cb61-23"><a href="#cb61-23"></a><span class="co">##  5 1.55e9 00                0           152.     NA T2m        1018 K        1.55e9             271.             272.</span></span>
<span id="cb61-24"><a href="#cb61-24"></a><span class="co">##  6 1.55e9 00                0            69.1    NA T2m        1023 K        1.55e9             272.             272.</span></span>
<span id="cb61-25"><a href="#cb61-25"></a><span class="co">##  7 1.55e9 00                0             8.1    NA T2m        1025 K        1.55e9             272.             273.</span></span>
<span id="cb61-26"><a href="#cb61-26"></a><span class="co">##  8 1.55e9 00                0             5.2    NA T2m        1026 K        1.55e9             272.             272.</span></span>
<span id="cb61-27"><a href="#cb61-27"></a><span class="co">##  9 1.55e9 00                0             5.2    NA T2m        1027 K        1.55e9             273.             273.</span></span>
<span id="cb61-28"><a href="#cb61-28"></a><span class="co">## 10 1.55e9 00                0            28.5    NA T2m        1033 K        1.55e9             274.             274.</span></span>
<span id="cb61-29"><a href="#cb61-29"></a><span class="co">## # … with 22,970 more rows, and 8 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb61-30"><a href="#cb61-30"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb61-31"><a href="#cb61-31"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;</span></span></code></pre></div>
<p>You will see that each ensemble member gets its own column in the data frame. This isn’t really tidy data - for the data to be tidy, the ensemble member would be a variable as well. However, when ensembles become large the slightly untidy format is advantageous - firstly, many of the verification functions we use expect the ensemble data as a matrix and continual pivoting slows these function down a lot and secondly, this format takes up less space in memory. We can, however, convert the data to a tidy format with the function <code>gather_members()</code></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="kw">gather_members</span>(t2m)</span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="co">## # A tibble: 229,800 x 12</span></span>
<span id="cb62-4"><a href="#cb62-4"></a><span class="co">##        fcdate fcst_cycle leadtime model_elevation     p parameter   SID units  validdate member forecast sub_model</span></span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="co">##         &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span id="cb62-6"><a href="#cb62-6"></a><span class="co">##  1 1550361600 00                0            36.4    NA T2m        1001 K     1550361600 mbr000     268. MEPS_prod</span></span>
<span id="cb62-7"><a href="#cb62-7"></a><span class="co">##  2 1550361600 00                0             4.1    NA T2m        1010 K     1550361600 mbr000     275. MEPS_prod</span></span>
<span id="cb62-8"><a href="#cb62-8"></a><span class="co">##  3 1550361600 00                0            29.1    NA T2m        1014 K     1550361600 mbr000     273. MEPS_prod</span></span>
<span id="cb62-9"><a href="#cb62-9"></a><span class="co">##  4 1550361600 00                0             2.6    NA T2m        1015 K     1550361600 mbr000     275. MEPS_prod</span></span>
<span id="cb62-10"><a href="#cb62-10"></a><span class="co">##  5 1550361600 00                0           152.     NA T2m        1018 K     1550361600 mbr000     271. MEPS_prod</span></span>
<span id="cb62-11"><a href="#cb62-11"></a><span class="co">##  6 1550361600 00                0            69.1    NA T2m        1023 K     1550361600 mbr000     272. MEPS_prod</span></span>
<span id="cb62-12"><a href="#cb62-12"></a><span class="co">##  7 1550361600 00                0             8.1    NA T2m        1025 K     1550361600 mbr000     272. MEPS_prod</span></span>
<span id="cb62-13"><a href="#cb62-13"></a><span class="co">##  8 1550361600 00                0             5.2    NA T2m        1026 K     1550361600 mbr000     272. MEPS_prod</span></span>
<span id="cb62-14"><a href="#cb62-14"></a><span class="co">##  9 1550361600 00                0             5.2    NA T2m        1027 K     1550361600 mbr000     273. MEPS_prod</span></span>
<span id="cb62-15"><a href="#cb62-15"></a><span class="co">## 10 1550361600 00                0            28.5    NA T2m        1033 K     1550361600 mbr000     274. MEPS_prod</span></span>
<span id="cb62-16"><a href="#cb62-16"></a><span class="co">## # … with 229,790 more rows</span></span></code></pre></div>
<p>With the members gathered together we can use <code>bind_fcst</code> in order to make basic plots from the data using ggplot.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="kw">bind_fcst</span>(t2m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span><span class="dv">1492</span>, fcdate <span class="op">==</span><span class="st"> </span><span class="kw">str_datetime_to_unixtime</span>(<span class="dv">2019021712</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">unix2datetime</span>(validdate), <span class="dt">y =</span> forecast, <span class="dt">colour =</span> member)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="kw">bind_fcst</span>(t2m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">leadtime =</span> <span class="kw">fct_inorder</span>(<span class="kw">paste0</span>(<span class="st">&quot;Lead time: &quot;</span>, leadtime, <span class="st">&quot;h&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(forecast, <span class="dt">colour =</span> leadtime, <span class="dt">fill =</span> leadtime)) <span class="op">+</span></span>
<span id="cb64-5"><a href="#cb64-5"></a><span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(leadtime)) <span class="op">+</span></span>
<span id="cb64-7"><a href="#cb64-7"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-53-2.png" width="672" /></p>
<p>There are also a number of different ways you can plot time series of ensemble forecasts for a station. This can be done with the function <code>plot_station_eps</code>. You give it the harp_fcst object and tell it what station and forecast start time you want the plot for, and optionally what sort of plot you want.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>)</span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">type =</span> <span class="st">&quot;boxplot&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-54-1.png" width="672" /><img src="harp-book_files/figure-html/unnamed-chunk-54-2.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">type =</span> <span class="st">&quot;spaghetti&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-54-3.png" width="672" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">type =</span> <span class="st">&quot;ridge&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-54-4.png" width="672" /></p>
<p>There are other types of plot that are more suited to truncated distributions such as those that are bound at 0 for wind speed and precipitation. When we converted the precipitation data to SQLite, we do not take any accout of accumulation times - the data are as they are output from in the model as accumulation since the model start time. We can do the accumulation when we read in the data using <code>read_point_forecast</code> by prefixing the parameter name with “Acc” for accumulated and suffixing it with the accumulation time in hours, e.g. “6h”.</p>
<p>Your turn:</p>
<ul>
<li>Read in 3h accumulated precipitatino from MEPS. Use <code>show_harp_parameters()</code> if you need some guidance.</li>
<li>Find the time and station with the heighest forecast precipitation, and which forecast it s for.</li>
</ul>
<p>Solution:</p>
<ul>
<li>Read in 3h accumulated precipitatino from MEPS. Use <code>show_harp_parameters()</code> if you need some guidance.</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>(precip_3h &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb68-2"><a href="#cb68-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb68-3"><a href="#cb68-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb68-4"><a href="#cb68-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;MEPS_prod&quot;</span>,</span>
<span id="cb68-5"><a href="#cb68-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb68-6"><a href="#cb68-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;AccPcp3h&quot;</span>,</span>
<span id="cb68-7"><a href="#cb68-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb68-8"><a href="#cb68-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb68-9"><a href="#cb68-9"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb68-10"><a href="#cb68-10"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb68-11"><a href="#cb68-11"></a>))</span>
<span id="cb68-12"><a href="#cb68-12"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb68-13"><a href="#cb68-13"></a><span class="co">## # A tibble: 19,248 x 18</span></span>
<span id="cb68-14"><a href="#cb68-14"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb68-15"><a href="#cb68-15"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb68-16"><a href="#cb68-16"></a><span class="co">##  1 1.55e9 00                3           -24.7 Pcp        1320 kg/m…    1.55e9        0                   0     </span></span>
<span id="cb68-17"><a href="#cb68-17"></a><span class="co">##  2 1.55e9 00                3           -12.1 Pcp        1043 kg/m…    1.55e9        0.453               0.0918</span></span>
<span id="cb68-18"><a href="#cb68-18"></a><span class="co">##  3 1.55e9 00                3           -10.7 Pcp        1193 kg/m…    1.55e9        0.0831              0.0868</span></span>
<span id="cb68-19"><a href="#cb68-19"></a><span class="co">##  4 1.55e9 00                3            -7   Pcp        1117 kg/m…    1.55e9        0.103               0.228 </span></span>
<span id="cb68-20"><a href="#cb68-20"></a><span class="co">##  5 1.55e9 00                3            -6.7 Pcp        1112 kg/m…    1.55e9        2.39                0.572 </span></span>
<span id="cb68-21"><a href="#cb68-21"></a><span class="co">##  6 1.55e9 00                3            -5.8 Pcp        1161 kg/m…    1.55e9        0                   0.0109</span></span>
<span id="cb68-22"><a href="#cb68-22"></a><span class="co">##  7 1.55e9 00                3            -4.7 Pcp        1098 kg/m…    1.55e9        0.302               0.335 </span></span>
<span id="cb68-23"><a href="#cb68-23"></a><span class="co">##  8 1.55e9 00                3            -4.7 Pcp        1162 kg/m…    1.55e9        0                   0     </span></span>
<span id="cb68-24"><a href="#cb68-24"></a><span class="co">##  9 1.55e9 00                3            -3.4 Pcp        3007 kg/m…    1.55e9        0.0000792           0.348 </span></span>
<span id="cb68-25"><a href="#cb68-25"></a><span class="co">## 10 1.55e9 00                3            -2.7 Pcp        1476 kg/m…    1.55e9        0                   0     </span></span>
<span id="cb68-26"><a href="#cb68-26"></a><span class="co">## # … with 19,238 more rows, and 8 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb68-27"><a href="#cb68-27"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb68-28"><a href="#cb68-28"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;</span></span></code></pre></div>
<ul>
<li>Find the time and station with the heighest forecast precipitation</li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">bind_fcst</span>(precip_3h) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="st">  </span><span class="kw">group_by</span>(SID, fcdate, validdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">max_precip =</span> <span class="kw">max</span>(forecast)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(max_precip)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fcdate =</span> <span class="kw">unix2datetime</span>(fcdate), <span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate))</span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="co">## # A tibble: 19,248 x 4</span></span>
<span id="cb69-8"><a href="#cb69-8"></a><span class="co">##      SID fcdate              validdate           max_precip</span></span>
<span id="cb69-9"><a href="#cb69-9"></a><span class="co">##    &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;                   &lt;dbl&gt;</span></span>
<span id="cb69-10"><a href="#cb69-10"></a><span class="co">##  1  1106 2019-02-17 06:00:00 2019-02-17 09:00:00      10.3 </span></span>
<span id="cb69-11"><a href="#cb69-11"></a><span class="co">##  2  1107 2019-02-17 06:00:00 2019-02-17 09:00:00      10.3 </span></span>
<span id="cb69-12"><a href="#cb69-12"></a><span class="co">##  3  1121 2019-02-17 00:00:00 2019-02-17 03:00:00       7.46</span></span>
<span id="cb69-13"><a href="#cb69-13"></a><span class="co">##  4 22113 2019-02-17 00:00:00 2019-02-17 06:00:00       6.16</span></span>
<span id="cb69-14"><a href="#cb69-14"></a><span class="co">##  5  1611 2019-02-17 00:00:00 2019-02-17 03:00:00       6.13</span></span>
<span id="cb69-15"><a href="#cb69-15"></a><span class="co">##  6  1015 2019-02-17 12:00:00 2019-02-17 21:00:00       5.77</span></span>
<span id="cb69-16"><a href="#cb69-16"></a><span class="co">##  7  1201 2019-02-17 12:00:00 2019-02-17 21:00:00       5.65</span></span>
<span id="cb69-17"><a href="#cb69-17"></a><span class="co">##  8  1611 2019-02-17 18:00:00 2019-02-18 06:00:00       5.64</span></span>
<span id="cb69-18"><a href="#cb69-18"></a><span class="co">##  9  1014 2019-02-17 06:00:00 2019-02-17 18:00:00       5.28</span></span>
<span id="cb69-19"><a href="#cb69-19"></a><span class="co">## 10  1122 2019-02-17 00:00:00 2019-02-17 03:00:00       5.27</span></span>
<span id="cb69-20"><a href="#cb69-20"></a><span class="co">## # … with 19,238 more rows</span></span></code></pre></div>
<p>Let’s plot a time series for that forecast.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="kw">plot_station_eps</span>(precip_3h, <span class="dv">1106</span>, <span class="dv">2019021706</span>, <span class="dt">type =</span> <span class="st">&quot;boxplot&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="kw">plot_station_eps</span>(precip_3h, <span class="dv">1106</span>, <span class="dv">2019021706</span>, <span class="dt">type =</span> <span class="st">&quot;stacked_prob&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-57-2.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Observations are read in the same way as we did for deterministic forecasts. Read in the observations for 2m temperature and 3h accumulated precipitation and join to the forecasts.</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>(t2m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb72-2"><a href="#cb72-2"></a>  t2m, </span>
<span id="cb72-3"><a href="#cb72-3"></a>  <span class="kw">read_point_obs</span>(</span>
<span id="cb72-4"><a href="#cb72-4"></a>    <span class="kw">first_validdate</span>(t2m),</span>
<span id="cb72-5"><a href="#cb72-5"></a>    <span class="kw">last_validdate</span>(t2m),</span>
<span id="cb72-6"><a href="#cb72-6"></a>    <span class="dt">parameter =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb72-7"><a href="#cb72-7"></a>    <span class="dt">obs_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>)</span>
<span id="cb72-8"><a href="#cb72-8"></a>  )</span>
<span id="cb72-9"><a href="#cb72-9"></a>))</span>
<span id="cb72-10"><a href="#cb72-10"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb72-11"><a href="#cb72-11"></a><span class="co">## # A tibble: 15,963 x 23</span></span>
<span id="cb72-12"><a href="#cb72-12"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb72-13"><a href="#cb72-13"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb72-14"><a href="#cb72-14"></a><span class="co">##  1 1.55e9 00                0            36.4    NA T2m        1001 K        1.55e9             268.             269.</span></span>
<span id="cb72-15"><a href="#cb72-15"></a><span class="co">##  2 1.55e9 00                0             4.1    NA T2m        1010 K        1.55e9             275.             276.</span></span>
<span id="cb72-16"><a href="#cb72-16"></a><span class="co">##  3 1.55e9 00                0             2.6    NA T2m        1015 K        1.55e9             275.             276.</span></span>
<span id="cb72-17"><a href="#cb72-17"></a><span class="co">##  4 1.55e9 00                0           152.     NA T2m        1018 K        1.55e9             271.             272.</span></span>
<span id="cb72-18"><a href="#cb72-18"></a><span class="co">##  5 1.55e9 00                0            69.1    NA T2m        1023 K        1.55e9             272.             272.</span></span>
<span id="cb72-19"><a href="#cb72-19"></a><span class="co">##  6 1.55e9 00                0             8.1    NA T2m        1025 K        1.55e9             272.             273.</span></span>
<span id="cb72-20"><a href="#cb72-20"></a><span class="co">##  7 1.55e9 00                0             5.2    NA T2m        1026 K        1.55e9             272.             272.</span></span>
<span id="cb72-21"><a href="#cb72-21"></a><span class="co">##  8 1.55e9 00                0             5.2    NA T2m        1027 K        1.55e9             273.             273.</span></span>
<span id="cb72-22"><a href="#cb72-22"></a><span class="co">##  9 1.55e9 00                0            28.5    NA T2m        1033 K        1.55e9             274.             274.</span></span>
<span id="cb72-23"><a href="#cb72-23"></a><span class="co">## 10 1.55e9 00                0           734.     NA T2m        1035 K        1.55e9             268.             268.</span></span>
<span id="cb72-24"><a href="#cb72-24"></a><span class="co">## # … with 15,953 more rows, and 12 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb72-25"><a href="#cb72-25"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb72-26"><a href="#cb72-26"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;</span></span>
<span id="cb72-27"><a href="#cb72-27"></a>(precip_3h &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb72-28"><a href="#cb72-28"></a>  precip_3h, </span>
<span id="cb72-29"><a href="#cb72-29"></a>  <span class="kw">read_point_obs</span>(</span>
<span id="cb72-30"><a href="#cb72-30"></a>    <span class="kw">first_validdate</span>(precip_3h),</span>
<span id="cb72-31"><a href="#cb72-31"></a>    <span class="kw">last_validdate</span>(precip_3h),</span>
<span id="cb72-32"><a href="#cb72-32"></a>    <span class="dt">parameter =</span> <span class="st">&quot;AccPcp3h&quot;</span>,</span>
<span id="cb72-33"><a href="#cb72-33"></a>    <span class="dt">obs_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>)</span>
<span id="cb72-34"><a href="#cb72-34"></a>  )</span>
<span id="cb72-35"><a href="#cb72-35"></a>))</span>
<span id="cb72-36"><a href="#cb72-36"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb72-37"><a href="#cb72-37"></a><span class="co">## # A tibble: 6,369 x 22</span></span>
<span id="cb72-38"><a href="#cb72-38"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb72-39"><a href="#cb72-39"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb72-40"><a href="#cb72-40"></a><span class="co">##  1 1.55e9 00                3            -7   Pcp        1117 kg/m…    1.55e9          0.103            0.228  </span></span>
<span id="cb72-41"><a href="#cb72-41"></a><span class="co">##  2 1.55e9 00                3            -4.7 Pcp        1098 kg/m…    1.55e9          0.302            0.335  </span></span>
<span id="cb72-42"><a href="#cb72-42"></a><span class="co">##  3 1.55e9 00                3            -1.7 Pcp        6249 kg/m…    1.55e9          0                0      </span></span>
<span id="cb72-43"><a href="#cb72-43"></a><span class="co">##  4 1.55e9 00                3            -1.4 Pcp        6286 kg/m…    1.55e9          0                0      </span></span>
<span id="cb72-44"><a href="#cb72-44"></a><span class="co">##  5 1.55e9 00                3            -0.9 Pcp        2976 kg/m…    1.55e9          0                0      </span></span>
<span id="cb72-45"><a href="#cb72-45"></a><span class="co">##  6 1.55e9 00                3            -0.8 Pcp        2382 kg/m…    1.55e9          0                0      </span></span>
<span id="cb72-46"><a href="#cb72-46"></a><span class="co">##  7 1.55e9 00                3            -0.8 Pcp        2575 kg/m…    1.55e9          0.00935          0.0423 </span></span>
<span id="cb72-47"><a href="#cb72-47"></a><span class="co">##  8 1.55e9 00                3            -0.8 Pcp        2667 kg/m…    1.55e9          0.00190          0.00911</span></span>
<span id="cb72-48"><a href="#cb72-48"></a><span class="co">##  9 1.55e9 00                3            -0.8 Pcp        2964 kg/m…    1.55e9          0                0      </span></span>
<span id="cb72-49"><a href="#cb72-49"></a><span class="co">## 10 1.55e9 00                3            -0.7 Pcp        2498 kg/m…    1.55e9          0                0      </span></span>
<span id="cb72-50"><a href="#cb72-50"></a><span class="co">## # … with 6,359 more rows, and 12 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb72-51"><a href="#cb72-51"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb72-52"><a href="#cb72-52"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, AccPcp3h &lt;dbl&gt;</span></span></code></pre></div>
<p>We can now add the observations to our plots</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">obs_column =</span> T2m, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>)</span></code></pre></div>
<p>Note this function still needs more work, and doesn’t work well in all cases!</p>
<p>We can also make scatter plots of how forecasts compare with observations. They are made with hexbin plots and it is posisible to compare the whole ensemble with the observations or each ensemble member. The function is <code>plot_scatter</code> .</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="kw">plot_scatter</span>(t2m, <span class="st">&quot;MEPS_prod&quot;</span>, T2m)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Can you work out how to combine all members inta a single scatter plot. Check the help and note that the explanations are not complete!</li>
<li>Make a scatter plots for each member for observed 3h precipitation &gt; 0.25 mm.</li>
</ul>
<p>Solutions:</p>
<ul>
<li>Can you work out how to combine all members inta a single scatter plot. Check the help and note that the explanations are not complete!</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw">plot_scatter</span>(t2m, <span class="st">&quot;MEPS_prod&quot;</span>, T2m, <span class="dt">facet_members =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<ul>
<li>Make a scatter plots for each member for observed 3h precipitation &gt; 0.25 mm.</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">plot_scatter</span>(<span class="kw">filter</span>(precip_3h, AccPcp3h <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.25</span>), <span class="st">&quot;MEPS_prod&quot;</span>, AccPcp3h)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<div id="multi-model-ensembles" class="section level4">
<h4><span class="header-section-number">0.5.12.1</span> Multi model ensembles</h4>
<p>When we generated SQLite FCTABLE files for a fake multimodel ensemble we needed to specify a lot of details about the ensemble, such as the names and member numbers for each sub model. When we read those data in from the FCTABLE files, that information is already there. So, let’s read in our multi model ensemble and see what we get.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="kw">read_point_forecast</span>(</span>
<span id="cb77-2"><a href="#cb77-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb77-3"><a href="#cb77-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb77-4"><a href="#cb77-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;awesome_multimodel_eps&quot;</span>,</span>
<span id="cb77-5"><a href="#cb77-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb77-6"><a href="#cb77-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb77-7"><a href="#cb77-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb77-8"><a href="#cb77-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb77-9"><a href="#cb77-9"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb77-10"><a href="#cb77-10"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb77-11"><a href="#cb77-11"></a>)</span>
<span id="cb77-12"><a href="#cb77-12"></a><span class="co">## ● awesome_multimodel_eps</span></span>
<span id="cb77-13"><a href="#cb77-13"></a><span class="co">## ● AROME_Arctic_prod</span></span>
<span id="cb77-14"><a href="#cb77-14"></a><span class="co">## # A tibble: 4,580 x 6</span></span>
<span id="cb77-15"><a href="#cb77-15"></a><span class="co">##      SID     fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mbr000</span></span>
<span id="cb77-16"><a href="#cb77-16"></a><span class="co">##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;</span></span>
<span id="cb77-17"><a href="#cb77-17"></a><span class="co">##  1  1001 1550361600        0 1550361600 00                             270.</span></span>
<span id="cb77-18"><a href="#cb77-18"></a><span class="co">##  2  1010 1550361600        0 1550361600 00                             275.</span></span>
<span id="cb77-19"><a href="#cb77-19"></a><span class="co">##  3  1014 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb77-20"><a href="#cb77-20"></a><span class="co">##  4  1015 1550361600        0 1550361600 00                             274.</span></span>
<span id="cb77-21"><a href="#cb77-21"></a><span class="co">##  5  1018 1550361600        0 1550361600 00                             271.</span></span>
<span id="cb77-22"><a href="#cb77-22"></a><span class="co">##  6  1023 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb77-23"><a href="#cb77-23"></a><span class="co">##  7  1025 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb77-24"><a href="#cb77-24"></a><span class="co">##  8  1026 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb77-25"><a href="#cb77-25"></a><span class="co">##  9  1027 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb77-26"><a href="#cb77-26"></a><span class="co">## 10  1033 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb77-27"><a href="#cb77-27"></a><span class="co">## # … with 4,570 more rows</span></span>
<span id="cb77-28"><a href="#cb77-28"></a><span class="co">## </span></span>
<span id="cb77-29"><a href="#cb77-29"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb77-30"><a href="#cb77-30"></a><span class="co">## # A tibble: 4,580 x 8</span></span>
<span id="cb77-31"><a href="#cb77-31"></a><span class="co">##      SID     fcdate leadtime  validdate fcst_cycle MEPS_prod_mbr000 MEPS_prod_mbr001 MEPS_prod_mbr002</span></span>
<span id="cb77-32"><a href="#cb77-32"></a><span class="co">##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb77-33"><a href="#cb77-33"></a><span class="co">##  1  1001 1550361600        0 1550361600 00                     268.             269.             268.</span></span>
<span id="cb77-34"><a href="#cb77-34"></a><span class="co">##  2  1010 1550361600        0 1550361600 00                     275.             276.             274.</span></span>
<span id="cb77-35"><a href="#cb77-35"></a><span class="co">##  3  1014 1550361600        0 1550361600 00                     273.             273.             273.</span></span>
<span id="cb77-36"><a href="#cb77-36"></a><span class="co">##  4  1015 1550361600        0 1550361600 00                     275.             276.             274.</span></span>
<span id="cb77-37"><a href="#cb77-37"></a><span class="co">##  5  1018 1550361600        0 1550361600 00                     271.             272.             271.</span></span>
<span id="cb77-38"><a href="#cb77-38"></a><span class="co">##  6  1023 1550361600        0 1550361600 00                     272.             272.             272.</span></span>
<span id="cb77-39"><a href="#cb77-39"></a><span class="co">##  7  1025 1550361600        0 1550361600 00                     272.             273.             272.</span></span>
<span id="cb77-40"><a href="#cb77-40"></a><span class="co">##  8  1026 1550361600        0 1550361600 00                     272.             272.             272.</span></span>
<span id="cb77-41"><a href="#cb77-41"></a><span class="co">##  9  1027 1550361600        0 1550361600 00                     273.             273.             273.</span></span>
<span id="cb77-42"><a href="#cb77-42"></a><span class="co">## 10  1033 1550361600        0 1550361600 00                     274.             274.             273.</span></span>
<span id="cb77-43"><a href="#cb77-43"></a><span class="co">## # … with 4,570 more rows</span></span></code></pre></div>
<p>As you can see we get the two sub models - AROME_Arctic_prod with one member, and MEPS_prod with 3 members - but not the full ensemble. However, we can create the full ensemble with the function <code>merge_multimodel</code>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>(t2m_mm &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb78-2"><a href="#cb78-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb78-3"><a href="#cb78-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb78-4"><a href="#cb78-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;awesome_multimodel_eps&quot;</span>,</span>
<span id="cb78-5"><a href="#cb78-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb78-6"><a href="#cb78-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb78-7"><a href="#cb78-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb78-8"><a href="#cb78-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb78-9"><a href="#cb78-9"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb78-10"><a href="#cb78-10"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb78-11"><a href="#cb78-11"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-12"><a href="#cb78-12"></a><span class="st">  </span><span class="kw">merge_multimodel</span>())</span>
<span id="cb78-13"><a href="#cb78-13"></a><span class="co">## ● awesome_multimodel_eps</span></span>
<span id="cb78-14"><a href="#cb78-14"></a><span class="co">## # A tibble: 4,580 x 9</span></span>
<span id="cb78-15"><a href="#cb78-15"></a><span class="co">##      SID    fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mb… MEPS_prod_mbr000 MEPS_prod_mbr001 MEPS_prod_mbr002</span></span>
<span id="cb78-16"><a href="#cb78-16"></a><span class="co">##    &lt;int&gt;     &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb78-17"><a href="#cb78-17"></a><span class="co">##  1  1001    1.55e9        0 1550361600 00                          270.             268.             269.             268.</span></span>
<span id="cb78-18"><a href="#cb78-18"></a><span class="co">##  2  1010    1.55e9        0 1550361600 00                          275.             275.             276.             274.</span></span>
<span id="cb78-19"><a href="#cb78-19"></a><span class="co">##  3  1014    1.55e9        0 1550361600 00                          273.             273.             273.             273.</span></span>
<span id="cb78-20"><a href="#cb78-20"></a><span class="co">##  4  1015    1.55e9        0 1550361600 00                          274.             275.             276.             274.</span></span>
<span id="cb78-21"><a href="#cb78-21"></a><span class="co">##  5  1018    1.55e9        0 1550361600 00                          271.             271.             272.             271.</span></span>
<span id="cb78-22"><a href="#cb78-22"></a><span class="co">##  6  1023    1.55e9        0 1550361600 00                          272.             272.             272.             272.</span></span>
<span id="cb78-23"><a href="#cb78-23"></a><span class="co">##  7  1025    1.55e9        0 1550361600 00                          272.             272.             273.             272.</span></span>
<span id="cb78-24"><a href="#cb78-24"></a><span class="co">##  8  1026    1.55e9        0 1550361600 00                          272.             272.             272.             272.</span></span>
<span id="cb78-25"><a href="#cb78-25"></a><span class="co">##  9  1027    1.55e9        0 1550361600 00                          273.             273.             273.             273.</span></span>
<span id="cb78-26"><a href="#cb78-26"></a><span class="co">## 10  1033    1.55e9        0 1550361600 00                          273.             274.             274.             273.</span></span>
<span id="cb78-27"><a href="#cb78-27"></a><span class="co">## # … with 4,570 more rows</span></span>
<span id="cb78-28"><a href="#cb78-28"></a><span class="co">## </span></span>
<span id="cb78-29"><a href="#cb78-29"></a><span class="co">## ● AROME_Arctic_prod(awesome_multimodel_eps)</span></span>
<span id="cb78-30"><a href="#cb78-30"></a><span class="co">## # A tibble: 4,580 x 6</span></span>
<span id="cb78-31"><a href="#cb78-31"></a><span class="co">##      SID     fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mbr000</span></span>
<span id="cb78-32"><a href="#cb78-32"></a><span class="co">##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;</span></span>
<span id="cb78-33"><a href="#cb78-33"></a><span class="co">##  1  1001 1550361600        0 1550361600 00                             270.</span></span>
<span id="cb78-34"><a href="#cb78-34"></a><span class="co">##  2  1010 1550361600        0 1550361600 00                             275.</span></span>
<span id="cb78-35"><a href="#cb78-35"></a><span class="co">##  3  1014 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb78-36"><a href="#cb78-36"></a><span class="co">##  4  1015 1550361600        0 1550361600 00                             274.</span></span>
<span id="cb78-37"><a href="#cb78-37"></a><span class="co">##  5  1018 1550361600        0 1550361600 00                             271.</span></span>
<span id="cb78-38"><a href="#cb78-38"></a><span class="co">##  6  1023 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb78-39"><a href="#cb78-39"></a><span class="co">##  7  1025 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb78-40"><a href="#cb78-40"></a><span class="co">##  8  1026 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb78-41"><a href="#cb78-41"></a><span class="co">##  9  1027 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb78-42"><a href="#cb78-42"></a><span class="co">## 10  1033 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb78-43"><a href="#cb78-43"></a><span class="co">## # … with 4,570 more rows</span></span>
<span id="cb78-44"><a href="#cb78-44"></a><span class="co">## </span></span>
<span id="cb78-45"><a href="#cb78-45"></a><span class="co">## ● MEPS_prod(awesome_multimodel_eps)</span></span>
<span id="cb78-46"><a href="#cb78-46"></a><span class="co">## # A tibble: 4,580 x 8</span></span>
<span id="cb78-47"><a href="#cb78-47"></a><span class="co">##      SID     fcdate leadtime  validdate fcst_cycle MEPS_prod_mbr000 MEPS_prod_mbr001 MEPS_prod_mbr002</span></span>
<span id="cb78-48"><a href="#cb78-48"></a><span class="co">##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb78-49"><a href="#cb78-49"></a><span class="co">##  1  1001 1550361600        0 1550361600 00                     268.             269.             268.</span></span>
<span id="cb78-50"><a href="#cb78-50"></a><span class="co">##  2  1010 1550361600        0 1550361600 00                     275.             276.             274.</span></span>
<span id="cb78-51"><a href="#cb78-51"></a><span class="co">##  3  1014 1550361600        0 1550361600 00                     273.             273.             273.</span></span>
<span id="cb78-52"><a href="#cb78-52"></a><span class="co">##  4  1015 1550361600        0 1550361600 00                     275.             276.             274.</span></span>
<span id="cb78-53"><a href="#cb78-53"></a><span class="co">##  5  1018 1550361600        0 1550361600 00                     271.             272.             271.</span></span>
<span id="cb78-54"><a href="#cb78-54"></a><span class="co">##  6  1023 1550361600        0 1550361600 00                     272.             272.             272.</span></span>
<span id="cb78-55"><a href="#cb78-55"></a><span class="co">##  7  1025 1550361600        0 1550361600 00                     272.             273.             272.</span></span>
<span id="cb78-56"><a href="#cb78-56"></a><span class="co">##  8  1026 1550361600        0 1550361600 00                     272.             272.             272.</span></span>
<span id="cb78-57"><a href="#cb78-57"></a><span class="co">##  9  1027 1550361600        0 1550361600 00                     273.             273.             273.</span></span>
<span id="cb78-58"><a href="#cb78-58"></a><span class="co">## 10  1033 1550361600        0 1550361600 00                     274.             274.             273.</span></span>
<span id="cb78-59"><a href="#cb78-59"></a><span class="co">## # … with 4,570 more rows</span></span></code></pre></div>
<p>Now we have the full multimodel ensemble and the two sub models, all as separate models in the harp_fcst object. You can, if you prefer, discard the sub models by setting <code>keep_sub_models = FALSE</code> in <code>merge_multimodel</code>.</p>
<p>Now we have two harp_fcst objects for 2m temperature, t2m and t2m_mm. We can easily combine them into a single harp_fcst using the standard concatenate function, <code>c</code></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="kw">c</span>(t2m, t2m_mm)</span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="co">## # A tibble: 15,963 x 23</span></span>
<span id="cb79-4"><a href="#cb79-4"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb79-5"><a href="#cb79-5"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="co">##  1 1.55e9 00                0            36.4    NA T2m        1001 K        1.55e9             268.             269.</span></span>
<span id="cb79-7"><a href="#cb79-7"></a><span class="co">##  2 1.55e9 00                0             4.1    NA T2m        1010 K        1.55e9             275.             276.</span></span>
<span id="cb79-8"><a href="#cb79-8"></a><span class="co">##  3 1.55e9 00                0             2.6    NA T2m        1015 K        1.55e9             275.             276.</span></span>
<span id="cb79-9"><a href="#cb79-9"></a><span class="co">##  4 1.55e9 00                0           152.     NA T2m        1018 K        1.55e9             271.             272.</span></span>
<span id="cb79-10"><a href="#cb79-10"></a><span class="co">##  5 1.55e9 00                0            69.1    NA T2m        1023 K        1.55e9             272.             272.</span></span>
<span id="cb79-11"><a href="#cb79-11"></a><span class="co">##  6 1.55e9 00                0             8.1    NA T2m        1025 K        1.55e9             272.             273.</span></span>
<span id="cb79-12"><a href="#cb79-12"></a><span class="co">##  7 1.55e9 00                0             5.2    NA T2m        1026 K        1.55e9             272.             272.</span></span>
<span id="cb79-13"><a href="#cb79-13"></a><span class="co">##  8 1.55e9 00                0             5.2    NA T2m        1027 K        1.55e9             273.             273.</span></span>
<span id="cb79-14"><a href="#cb79-14"></a><span class="co">##  9 1.55e9 00                0            28.5    NA T2m        1033 K        1.55e9             274.             274.</span></span>
<span id="cb79-15"><a href="#cb79-15"></a><span class="co">## 10 1.55e9 00                0           734.     NA T2m        1035 K        1.55e9             268.             268.</span></span>
<span id="cb79-16"><a href="#cb79-16"></a><span class="co">## # … with 15,953 more rows, and 12 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb79-17"><a href="#cb79-17"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb79-18"><a href="#cb79-18"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;</span></span>
<span id="cb79-19"><a href="#cb79-19"></a><span class="co">## </span></span>
<span id="cb79-20"><a href="#cb79-20"></a><span class="co">## ● awesome_multimodel_eps</span></span>
<span id="cb79-21"><a href="#cb79-21"></a><span class="co">## # A tibble: 4,580 x 9</span></span>
<span id="cb79-22"><a href="#cb79-22"></a><span class="co">##      SID    fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mb… MEPS_prod_mbr000 MEPS_prod_mbr001 MEPS_prod_mbr002</span></span>
<span id="cb79-23"><a href="#cb79-23"></a><span class="co">##    &lt;int&gt;     &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb79-24"><a href="#cb79-24"></a><span class="co">##  1  1001    1.55e9        0 1550361600 00                          270.             268.             269.             268.</span></span>
<span id="cb79-25"><a href="#cb79-25"></a><span class="co">##  2  1010    1.55e9        0 1550361600 00                          275.             275.             276.             274.</span></span>
<span id="cb79-26"><a href="#cb79-26"></a><span class="co">##  3  1014    1.55e9        0 1550361600 00                          273.             273.             273.             273.</span></span>
<span id="cb79-27"><a href="#cb79-27"></a><span class="co">##  4  1015    1.55e9        0 1550361600 00                          274.             275.             276.             274.</span></span>
<span id="cb79-28"><a href="#cb79-28"></a><span class="co">##  5  1018    1.55e9        0 1550361600 00                          271.             271.             272.             271.</span></span>
<span id="cb79-29"><a href="#cb79-29"></a><span class="co">##  6  1023    1.55e9        0 1550361600 00                          272.             272.             272.             272.</span></span>
<span id="cb79-30"><a href="#cb79-30"></a><span class="co">##  7  1025    1.55e9        0 1550361600 00                          272.             272.             273.             272.</span></span>
<span id="cb79-31"><a href="#cb79-31"></a><span class="co">##  8  1026    1.55e9        0 1550361600 00                          272.             272.             272.             272.</span></span>
<span id="cb79-32"><a href="#cb79-32"></a><span class="co">##  9  1027    1.55e9        0 1550361600 00                          273.             273.             273.             273.</span></span>
<span id="cb79-33"><a href="#cb79-33"></a><span class="co">## 10  1033    1.55e9        0 1550361600 00                          273.             274.             274.             273.</span></span>
<span id="cb79-34"><a href="#cb79-34"></a><span class="co">## # … with 4,570 more rows</span></span>
<span id="cb79-35"><a href="#cb79-35"></a><span class="co">## </span></span>
<span id="cb79-36"><a href="#cb79-36"></a><span class="co">## ● AROME_Arctic_prod(awesome_multimodel_eps)</span></span>
<span id="cb79-37"><a href="#cb79-37"></a><span class="co">## # A tibble: 4,580 x 6</span></span>
<span id="cb79-38"><a href="#cb79-38"></a><span class="co">##      SID     fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mbr000</span></span>
<span id="cb79-39"><a href="#cb79-39"></a><span class="co">##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;</span></span>
<span id="cb79-40"><a href="#cb79-40"></a><span class="co">##  1  1001 1550361600        0 1550361600 00                             270.</span></span>
<span id="cb79-41"><a href="#cb79-41"></a><span class="co">##  2  1010 1550361600        0 1550361600 00                             275.</span></span>
<span id="cb79-42"><a href="#cb79-42"></a><span class="co">##  3  1014 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb79-43"><a href="#cb79-43"></a><span class="co">##  4  1015 1550361600        0 1550361600 00                             274.</span></span>
<span id="cb79-44"><a href="#cb79-44"></a><span class="co">##  5  1018 1550361600        0 1550361600 00                             271.</span></span>
<span id="cb79-45"><a href="#cb79-45"></a><span class="co">##  6  1023 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb79-46"><a href="#cb79-46"></a><span class="co">##  7  1025 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb79-47"><a href="#cb79-47"></a><span class="co">##  8  1026 1550361600        0 1550361600 00                             272.</span></span>
<span id="cb79-48"><a href="#cb79-48"></a><span class="co">##  9  1027 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb79-49"><a href="#cb79-49"></a><span class="co">## 10  1033 1550361600        0 1550361600 00                             273.</span></span>
<span id="cb79-50"><a href="#cb79-50"></a><span class="co">## # … with 4,570 more rows</span></span>
<span id="cb79-51"><a href="#cb79-51"></a><span class="co">## </span></span>
<span id="cb79-52"><a href="#cb79-52"></a><span class="co">## ● MEPS_prod(awesome_multimodel_eps)</span></span>
<span id="cb79-53"><a href="#cb79-53"></a><span class="co">## # A tibble: 4,580 x 8</span></span>
<span id="cb79-54"><a href="#cb79-54"></a><span class="co">##      SID     fcdate leadtime  validdate fcst_cycle MEPS_prod_mbr000 MEPS_prod_mbr001 MEPS_prod_mbr002</span></span>
<span id="cb79-55"><a href="#cb79-55"></a><span class="co">##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb79-56"><a href="#cb79-56"></a><span class="co">##  1  1001 1550361600        0 1550361600 00                     268.             269.             268.</span></span>
<span id="cb79-57"><a href="#cb79-57"></a><span class="co">##  2  1010 1550361600        0 1550361600 00                     275.             276.             274.</span></span>
<span id="cb79-58"><a href="#cb79-58"></a><span class="co">##  3  1014 1550361600        0 1550361600 00                     273.             273.             273.</span></span>
<span id="cb79-59"><a href="#cb79-59"></a><span class="co">##  4  1015 1550361600        0 1550361600 00                     275.             276.             274.</span></span>
<span id="cb79-60"><a href="#cb79-60"></a><span class="co">##  5  1018 1550361600        0 1550361600 00                     271.             272.             271.</span></span>
<span id="cb79-61"><a href="#cb79-61"></a><span class="co">##  6  1023 1550361600        0 1550361600 00                     272.             272.             272.</span></span>
<span id="cb79-62"><a href="#cb79-62"></a><span class="co">##  7  1025 1550361600        0 1550361600 00                     272.             273.             272.</span></span>
<span id="cb79-63"><a href="#cb79-63"></a><span class="co">##  8  1026 1550361600        0 1550361600 00                     272.             272.             272.</span></span>
<span id="cb79-64"><a href="#cb79-64"></a><span class="co">##  9  1027 1550361600        0 1550361600 00                     273.             273.             273.</span></span>
<span id="cb79-65"><a href="#cb79-65"></a><span class="co">## 10  1033 1550361600        0 1550361600 00                     274.             274.             273.</span></span>
<span id="cb79-66"><a href="#cb79-66"></a><span class="co">## # … with 4,570 more rows</span></span></code></pre></div>
</div>
<div id="lagged-ensembles-1" class="section level4">
<h4><span class="header-section-number">0.5.12.2</span> Lagged ensembles</h4>
<p>Reading lagged ensembles from FCTABLE files is also easier than in the conversion to SQLite step. Since FCTABLE files were saved for each forecast cycle, and the members for that cycle in the file, all we need to do is tell read_point_forecast the appropriate lags. Here we need to be a bit careful about what we’re doing, especially if we are reading in data from other models at the same. In the case of CMEPS there is a new set of ensemble members every three hours, but if we want to compare it with MEPS, which has a full set of members every six hours, which should set the <code>by = "6h"</code> and use our lags specification to ensure we read in the correct amount of data for CMEPS, by ensuring there are lags from zero to five hours. This probably becomes clearer with an example…</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>(t2m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb80-2"><a href="#cb80-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb80-3"><a href="#cb80-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb80-4"><a href="#cb80-4"></a>  <span class="dt">fcst_model    =</span> <span class="kw">c</span>(<span class="st">&quot;CMEPS_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb80-5"><a href="#cb80-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb80-6"><a href="#cb80-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb80-7"><a href="#cb80-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb80-8"><a href="#cb80-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb80-9"><a href="#cb80-9"></a>  <span class="dt">lags          =</span> <span class="kw">list</span>(</span>
<span id="cb80-10"><a href="#cb80-10"></a>    <span class="dt">CMEPS_prod =</span> <span class="kw">paste0</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="st">&quot;h&quot;</span>),</span>
<span id="cb80-11"><a href="#cb80-11"></a>    <span class="dt">MEPS_prod  =</span> <span class="st">&quot;0h&quot;</span></span>
<span id="cb80-12"><a href="#cb80-12"></a>  ),</span>
<span id="cb80-13"><a href="#cb80-13"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb80-14"><a href="#cb80-14"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span>,</span>
<span id="cb80-15"><a href="#cb80-15"></a>  <span class="dt">merge_lags    =</span> <span class="ot">FALSE</span> </span>
<span id="cb80-16"><a href="#cb80-16"></a>))</span>
<span id="cb80-17"><a href="#cb80-17"></a><span class="co">## ● CMEPS_prod</span></span>
<span id="cb80-18"><a href="#cb80-18"></a><span class="co">## # A tibble: 110,304 x 15</span></span>
<span id="cb80-19"><a href="#cb80-19"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate CMEPS_prod_mbr0… CMEPS_prod_mbr0…</span></span>
<span id="cb80-20"><a href="#cb80-20"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb80-21"><a href="#cb80-21"></a><span class="co">##  1 1.55e9 00                0            36.4    NA T2m        1001 K        1.55e9             269.             270.</span></span>
<span id="cb80-22"><a href="#cb80-22"></a><span class="co">##  2 1.55e9 00                0             4.1    NA T2m        1010 K        1.55e9             275.             275.</span></span>
<span id="cb80-23"><a href="#cb80-23"></a><span class="co">##  3 1.55e9 00                0            29.1    NA T2m        1014 K        1.55e9             273.             273.</span></span>
<span id="cb80-24"><a href="#cb80-24"></a><span class="co">##  4 1.55e9 00                0             2.6    NA T2m        1015 K        1.55e9             275.             275.</span></span>
<span id="cb80-25"><a href="#cb80-25"></a><span class="co">##  5 1.55e9 00                0           152.     NA T2m        1018 K        1.55e9             271.             271.</span></span>
<span id="cb80-26"><a href="#cb80-26"></a><span class="co">##  6 1.55e9 00                0            69.1    NA T2m        1023 K        1.55e9             272.             272.</span></span>
<span id="cb80-27"><a href="#cb80-27"></a><span class="co">##  7 1.55e9 00                0             8.1    NA T2m        1025 K        1.55e9             272.             272.</span></span>
<span id="cb80-28"><a href="#cb80-28"></a><span class="co">##  8 1.55e9 00                0             5.2    NA T2m        1026 K        1.55e9             272.             271.</span></span>
<span id="cb80-29"><a href="#cb80-29"></a><span class="co">##  9 1.55e9 00                0             5.2    NA T2m        1027 K        1.55e9             273.             272.</span></span>
<span id="cb80-30"><a href="#cb80-30"></a><span class="co">## 10 1.55e9 00                0            28.5    NA T2m        1033 K        1.55e9             273.             274.</span></span>
<span id="cb80-31"><a href="#cb80-31"></a><span class="co">## # … with 110,294 more rows, and 4 more variables: CMEPS_prod_mbr003 &lt;dbl&gt;, CMEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb80-32"><a href="#cb80-32"></a><span class="co">## #   CMEPS_prod_mbr005 &lt;dbl&gt;, CMEPS_prod_mbr006 &lt;dbl&gt;</span></span>
<span id="cb80-33"><a href="#cb80-33"></a><span class="co">## </span></span>
<span id="cb80-34"><a href="#cb80-34"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb80-35"><a href="#cb80-35"></a><span class="co">## # A tibble: 22,980 x 19</span></span>
<span id="cb80-36"><a href="#cb80-36"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb80-37"><a href="#cb80-37"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb80-38"><a href="#cb80-38"></a><span class="co">##  1 1.55e9 00                0            36.4    NA T2m        1001 K        1.55e9             268.             269.</span></span>
<span id="cb80-39"><a href="#cb80-39"></a><span class="co">##  2 1.55e9 00                0             4.1    NA T2m        1010 K        1.55e9             275.             276.</span></span>
<span id="cb80-40"><a href="#cb80-40"></a><span class="co">##  3 1.55e9 00                0            29.1    NA T2m        1014 K        1.55e9             273.             273.</span></span>
<span id="cb80-41"><a href="#cb80-41"></a><span class="co">##  4 1.55e9 00                0             2.6    NA T2m        1015 K        1.55e9             275.             276.</span></span>
<span id="cb80-42"><a href="#cb80-42"></a><span class="co">##  5 1.55e9 00                0           152.     NA T2m        1018 K        1.55e9             271.             272.</span></span>
<span id="cb80-43"><a href="#cb80-43"></a><span class="co">##  6 1.55e9 00                0            69.1    NA T2m        1023 K        1.55e9             272.             272.</span></span>
<span id="cb80-44"><a href="#cb80-44"></a><span class="co">##  7 1.55e9 00                0             8.1    NA T2m        1025 K        1.55e9             272.             273.</span></span>
<span id="cb80-45"><a href="#cb80-45"></a><span class="co">##  8 1.55e9 00                0             5.2    NA T2m        1026 K        1.55e9             272.             272.</span></span>
<span id="cb80-46"><a href="#cb80-46"></a><span class="co">##  9 1.55e9 00                0             5.2    NA T2m        1027 K        1.55e9             273.             273.</span></span>
<span id="cb80-47"><a href="#cb80-47"></a><span class="co">## 10 1.55e9 00                0            28.5    NA T2m        1033 K        1.55e9             274.             274.</span></span>
<span id="cb80-48"><a href="#cb80-48"></a><span class="co">## # … with 22,970 more rows, and 8 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb80-49"><a href="#cb80-49"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb80-50"><a href="#cb80-50"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;</span></span></code></pre></div>
<p>There was a warning about missing files. This is because we didn’t generate any FCTABLE files for the 21 cycle on the 16 Feb 2019 and they were also not uploaded to this project! However, this illustrates that when lagging is used, you have to be very clear in your mind exactly what you need to get the lagged ensemble you want.</p>
<p>You will also see that there a are lot of missing data - this is immediately apparent for members 5 and 6. This is becasuse, since we set merge_lags = FALSE, we have only read in lagged data, but haven’t created the lagged ensemble yet. We create the lagged ensemble with the function <code>lag_forecast</code>. We tell the function which cycles you want to be the “parent” cycles and the function will shift all of the members between the parent cycles to the parent cycle. By default, children are found by looking backwards in time, as would happen in an operational setting - for example, if the parent cycles are 0, 6, 12 and 18, the child cycles for the parent at 6 are at 5, 4, 3, 2, and 1, and so on for the other parents. You can look for children in the other direction by setting <code>direction = -1</code>. Note that when merge_lags = TRUE, the ensemble is created with the parent cycles set to be those generated from the start_date, end_date and by arguments.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="kw">lag_forecast</span>(</span>
<span id="cb81-2"><a href="#cb81-2"></a>  t2m, </span>
<span id="cb81-3"><a href="#cb81-3"></a>  <span class="dt">fcst_model =</span> <span class="st">&quot;CMEPS_prod&quot;</span>, </span>
<span id="cb81-4"><a href="#cb81-4"></a>  <span class="dt">parent_cycles =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">3</span>)</span>
<span id="cb81-5"><a href="#cb81-5"></a>)</span>
<span id="cb81-6"><a href="#cb81-6"></a><span class="co">## ● CMEPS_prod</span></span>
<span id="cb81-7"><a href="#cb81-7"></a><span class="co">## # A tibble: 36,768 x 14</span></span>
<span id="cb81-8"><a href="#cb81-8"></a><span class="co">##    fcst_cycle fcdate leadtime model_elevation parameter   SID units validdate CMEPS_prod_mbr0… CMEPS_prod_mbr0…</span></span>
<span id="cb81-9"><a href="#cb81-9"></a><span class="co">##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb81-10"><a href="#cb81-10"></a><span class="co">##  1 00         1.55e9        0            36.4 T2m        1001 K        1.55e9             269.             270.</span></span>
<span id="cb81-11"><a href="#cb81-11"></a><span class="co">##  2 00         1.55e9        0             4.1 T2m        1010 K        1.55e9             275.             275.</span></span>
<span id="cb81-12"><a href="#cb81-12"></a><span class="co">##  3 00         1.55e9        0            29.1 T2m        1014 K        1.55e9             273.             273.</span></span>
<span id="cb81-13"><a href="#cb81-13"></a><span class="co">##  4 00         1.55e9        0             2.6 T2m        1015 K        1.55e9             275.             275.</span></span>
<span id="cb81-14"><a href="#cb81-14"></a><span class="co">##  5 00         1.55e9        0           152.  T2m        1018 K        1.55e9             271.             271.</span></span>
<span id="cb81-15"><a href="#cb81-15"></a><span class="co">##  6 00         1.55e9        0            69.1 T2m        1023 K        1.55e9             272.             272.</span></span>
<span id="cb81-16"><a href="#cb81-16"></a><span class="co">##  7 00         1.55e9        0             8.1 T2m        1025 K        1.55e9             272.             272.</span></span>
<span id="cb81-17"><a href="#cb81-17"></a><span class="co">##  8 00         1.55e9        0             5.2 T2m        1026 K        1.55e9             272.             271.</span></span>
<span id="cb81-18"><a href="#cb81-18"></a><span class="co">##  9 00         1.55e9        0             5.2 T2m        1027 K        1.55e9             273.             272.</span></span>
<span id="cb81-19"><a href="#cb81-19"></a><span class="co">## 10 00         1.55e9        0            28.5 T2m        1033 K        1.55e9             273.             274.</span></span>
<span id="cb81-20"><a href="#cb81-20"></a><span class="co">## # … with 36,758 more rows, and 4 more variables: CMEPS_prod_mbr003 &lt;dbl&gt;, CMEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb81-21"><a href="#cb81-21"></a><span class="co">## #   CMEPS_prod_mbr005 &lt;dbl&gt;, CMEPS_prod_mbr006 &lt;dbl&gt;</span></span>
<span id="cb81-22"><a href="#cb81-22"></a><span class="co">## </span></span>
<span id="cb81-23"><a href="#cb81-23"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb81-24"><a href="#cb81-24"></a><span class="co">## # A tibble: 22,980 x 19</span></span>
<span id="cb81-25"><a href="#cb81-25"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb81-26"><a href="#cb81-26"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb81-27"><a href="#cb81-27"></a><span class="co">##  1 1.55e9 00                0            36.4    NA T2m        1001 K        1.55e9             268.             269.</span></span>
<span id="cb81-28"><a href="#cb81-28"></a><span class="co">##  2 1.55e9 00                0             4.1    NA T2m        1010 K        1.55e9             275.             276.</span></span>
<span id="cb81-29"><a href="#cb81-29"></a><span class="co">##  3 1.55e9 00                0            29.1    NA T2m        1014 K        1.55e9             273.             273.</span></span>
<span id="cb81-30"><a href="#cb81-30"></a><span class="co">##  4 1.55e9 00                0             2.6    NA T2m        1015 K        1.55e9             275.             276.</span></span>
<span id="cb81-31"><a href="#cb81-31"></a><span class="co">##  5 1.55e9 00                0           152.     NA T2m        1018 K        1.55e9             271.             272.</span></span>
<span id="cb81-32"><a href="#cb81-32"></a><span class="co">##  6 1.55e9 00                0            69.1    NA T2m        1023 K        1.55e9             272.             272.</span></span>
<span id="cb81-33"><a href="#cb81-33"></a><span class="co">##  7 1.55e9 00                0             8.1    NA T2m        1025 K        1.55e9             272.             273.</span></span>
<span id="cb81-34"><a href="#cb81-34"></a><span class="co">##  8 1.55e9 00                0             5.2    NA T2m        1026 K        1.55e9             272.             272.</span></span>
<span id="cb81-35"><a href="#cb81-35"></a><span class="co">##  9 1.55e9 00                0             5.2    NA T2m        1027 K        1.55e9             273.             273.</span></span>
<span id="cb81-36"><a href="#cb81-36"></a><span class="co">## 10 1.55e9 00                0            28.5    NA T2m        1033 K        1.55e9             274.             274.</span></span>
<span id="cb81-37"><a href="#cb81-37"></a><span class="co">## # … with 22,970 more rows, and 8 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb81-38"><a href="#cb81-38"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb81-39"><a href="#cb81-39"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;</span></span></code></pre></div>
<p>Your turn:</p>
<ul>
<li>Use <code>pull(.fcst, fcst_cycle) %&gt;% map(unique) %&gt;% map(sort)</code> to see which cycles you are left with when you try different <code>parent_cycles</code> and <code>direction = 1</code> or <code>direction = -1</code>. Try to remember what we actually did when we ran <code>read_eps_interpolate</code> for CMEPS</li>
<li>Combine 2m temperature forecasts for the multimodel ensemble (including sub models), MEPS_prod and CMEPS(with parent_cycles of 6, 12 and 18) and select the common cases and join the observations (note you will have to run <code>set_units(t2m_mm, "K")</code> due to a bug in <code>read_point_forecast</code> that drops that units column for multi model ensembles)</li>
</ul>
<p>Solutions</p>
<ul>
<li>Use <code>pull(.fcst, fcst_cycle) %&gt;% map(unique) %&gt;% map(sort)</code> to see which cycles you are left with when you try different <code>parent_cycles</code> and <code>direction = 1</code> or <code>direction = -1</code>.</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="kw">pull</span>(t2m, fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="co">## $CMEPS_prod</span></span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="co">##  [1] &quot;00&quot; &quot;01&quot; &quot;02&quot; &quot;03&quot; &quot;04&quot; &quot;05&quot; &quot;06&quot; &quot;07&quot; &quot;08&quot; &quot;09&quot; &quot;10&quot; &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;22&quot; &quot;23&quot;</span></span>
<span id="cb82-4"><a href="#cb82-4"></a><span class="co">## </span></span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="co">## $MEPS_prod</span></span>
<span id="cb82-6"><a href="#cb82-6"></a><span class="co">## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</span></span>
<span id="cb82-7"><a href="#cb82-7"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">6</span>)), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span>
<span id="cb82-8"><a href="#cb82-8"></a><span class="co">## $CMEPS_prod</span></span>
<span id="cb82-9"><a href="#cb82-9"></a><span class="co">## [1] &quot;06&quot; &quot;12&quot; &quot;18&quot;</span></span>
<span id="cb82-10"><a href="#cb82-10"></a><span class="co">## </span></span>
<span id="cb82-11"><a href="#cb82-11"></a><span class="co">## $MEPS_prod</span></span>
<span id="cb82-12"><a href="#cb82-12"></a><span class="co">## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</span></span>
<span id="cb82-13"><a href="#cb82-13"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">3</span>)), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span>
<span id="cb82-14"><a href="#cb82-14"></a><span class="co">## $CMEPS_prod</span></span>
<span id="cb82-15"><a href="#cb82-15"></a><span class="co">## [1] &quot;00&quot; &quot;03&quot; &quot;06&quot; &quot;09&quot; &quot;12&quot; &quot;15&quot; &quot;18&quot;</span></span>
<span id="cb82-16"><a href="#cb82-16"></a><span class="co">## </span></span>
<span id="cb82-17"><a href="#cb82-17"></a><span class="co">## $MEPS_prod</span></span>
<span id="cb82-18"><a href="#cb82-18"></a><span class="co">## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</span></span>
<span id="cb82-19"><a href="#cb82-19"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">6</span>), <span class="dt">direction =</span> <span class="dv">-1</span>), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span>
<span id="cb82-20"><a href="#cb82-20"></a><span class="co">## $CMEPS_prod</span></span>
<span id="cb82-21"><a href="#cb82-21"></a><span class="co">## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot;</span></span>
<span id="cb82-22"><a href="#cb82-22"></a><span class="co">## </span></span>
<span id="cb82-23"><a href="#cb82-23"></a><span class="co">## $MEPS_prod</span></span>
<span id="cb82-24"><a href="#cb82-24"></a><span class="co">## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</span></span>
<span id="cb82-25"><a href="#cb82-25"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">3</span>), <span class="dt">direction =</span> <span class="dv">-1</span>), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span>
<span id="cb82-26"><a href="#cb82-26"></a><span class="co">## $CMEPS_prod</span></span>
<span id="cb82-27"><a href="#cb82-27"></a><span class="co">## [1] &quot;00&quot; &quot;03&quot; &quot;06&quot; &quot;09&quot; &quot;12&quot; &quot;15&quot;</span></span>
<span id="cb82-28"><a href="#cb82-28"></a><span class="co">## </span></span>
<span id="cb82-29"><a href="#cb82-29"></a><span class="co">## $MEPS_prod</span></span>
<span id="cb82-30"><a href="#cb82-30"></a><span class="co">## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</span></span></code></pre></div>
<ul>
<li>Combine 2m temperature forecasts for the multimodel ensemble (including sub models), MEPS_prod and CMEPS(with parent_cycles of 0, 6, 12 and 18) and select the common cases</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>(t2m &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">set_units</span>(t2m_mm, <span class="st">&quot;K&quot;</span>), <span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">6</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="st">    </span><span class="kw">common_cases</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="st">    </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb83-4"><a href="#cb83-4"></a>      <span class="kw">read_point_obs</span>(</span>
<span id="cb83-5"><a href="#cb83-5"></a>        <span class="kw">first_validdate</span>(.),</span>
<span id="cb83-6"><a href="#cb83-6"></a>        <span class="kw">last_validdate</span>(.),</span>
<span id="cb83-7"><a href="#cb83-7"></a>        <span class="dt">parameter =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb83-8"><a href="#cb83-8"></a>        <span class="dt">obs_path  =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>) </span>
<span id="cb83-9"><a href="#cb83-9"></a>      )</span>
<span id="cb83-10"><a href="#cb83-10"></a>    )</span>
<span id="cb83-11"><a href="#cb83-11"></a>)</span>
<span id="cb83-12"><a href="#cb83-12"></a><span class="co">## ● awesome_multimodel_eps</span></span>
<span id="cb83-13"><a href="#cb83-13"></a><span class="co">## # A tibble: 1,955 x 14</span></span>
<span id="cb83-14"><a href="#cb83-14"></a><span class="co">##      SID fcdate leadtime validdate fcst_cycle units AROME_Arctic_pr… MEPS_prod_mbr000 MEPS_prod_mbr001 MEPS_prod_mbr002</span></span>
<span id="cb83-15"><a href="#cb83-15"></a><span class="co">##    &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb83-16"><a href="#cb83-16"></a><span class="co">##  1  1001 1.55e9        0    1.55e9 06         K                 271.             270.             270.             270.</span></span>
<span id="cb83-17"><a href="#cb83-17"></a><span class="co">##  2  1010 1.55e9        0    1.55e9 06         K                 273.             273.             273.             274.</span></span>
<span id="cb83-18"><a href="#cb83-18"></a><span class="co">##  3  1015 1.55e9        0    1.55e9 06         K                 274.             273.             273.             274.</span></span>
<span id="cb83-19"><a href="#cb83-19"></a><span class="co">##  4  1018 1.55e9        0    1.55e9 06         K                 268.             269.             269.             269.</span></span>
<span id="cb83-20"><a href="#cb83-20"></a><span class="co">##  5  1023 1.55e9        0    1.55e9 06         K                 269.             269.             269.             270.</span></span>
<span id="cb83-21"><a href="#cb83-21"></a><span class="co">##  6  1025 1.55e9        0    1.55e9 06         K                 270.             269.             270.             269.</span></span>
<span id="cb83-22"><a href="#cb83-22"></a><span class="co">##  7  1026 1.55e9        0    1.55e9 06         K                 269.             268.             269.             268.</span></span>
<span id="cb83-23"><a href="#cb83-23"></a><span class="co">##  8  1027 1.55e9        0    1.55e9 06         K                 270.             269.             270.             269.</span></span>
<span id="cb83-24"><a href="#cb83-24"></a><span class="co">##  9  1033 1.55e9        0    1.55e9 06         K                 272.             271.             271.             272.</span></span>
<span id="cb83-25"><a href="#cb83-25"></a><span class="co">## 10  1035 1.55e9        0    1.55e9 06         K                 265.             265.             265.             265.</span></span>
<span id="cb83-26"><a href="#cb83-26"></a><span class="co">## # … with 1,945 more rows, and 4 more variables: lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;</span></span>
<span id="cb83-27"><a href="#cb83-27"></a><span class="co">## </span></span>
<span id="cb83-28"><a href="#cb83-28"></a><span class="co">## ● AROME_Arctic_prod(awesome_multimodel_eps)</span></span>
<span id="cb83-29"><a href="#cb83-29"></a><span class="co">## # A tibble: 1,955 x 11</span></span>
<span id="cb83-30"><a href="#cb83-30"></a><span class="co">##      SID     fcdate leadtime  validdate fcst_cycle units AROME_Arctic_prod_mbr000   lon   lat  elev   T2m</span></span>
<span id="cb83-31"><a href="#cb83-31"></a><span class="co">##    &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb83-32"><a href="#cb83-32"></a><span class="co">##  1  1001 1550383200        0 1550383200 06         K                         271. -8.67  70.9     9  270 </span></span>
<span id="cb83-33"><a href="#cb83-33"></a><span class="co">##  2  1010 1550383200        0 1550383200 06         K                         273. 16.1   69.3    13  272.</span></span>
<span id="cb83-34"><a href="#cb83-34"></a><span class="co">##  3  1015 1550383200        0 1550383200 06         K                         274. 17.8   69.6    14  273.</span></span>
<span id="cb83-35"><a href="#cb83-35"></a><span class="co">##  4  1018 1550383200        0 1550383200 06         K                         268. 16.0   69.2   436  269.</span></span>
<span id="cb83-36"><a href="#cb83-36"></a><span class="co">##  5  1023 1550383200        0 1550383200 06         K                         269. 18.5   69.1    77  269.</span></span>
<span id="cb83-37"><a href="#cb83-37"></a><span class="co">##  6  1025 1550383200        0 1550383200 06         K                         270. 18.9   69.7     9  270.</span></span>
<span id="cb83-38"><a href="#cb83-38"></a><span class="co">##  7  1026 1550383200        0 1550383200 06         K                         269. 18.9   69.7   100  269.</span></span>
<span id="cb83-39"><a href="#cb83-39"></a><span class="co">##  8  1027 1550383200        0 1550383200 06         K                         270. 18.9   69.7    10  270.</span></span>
<span id="cb83-40"><a href="#cb83-40"></a><span class="co">##  9  1033 1550383200        0 1550383200 06         K                         272. 19.5   70.2    21  272.</span></span>
<span id="cb83-41"><a href="#cb83-41"></a><span class="co">## 10  1035 1550383200        0 1550383200 06         K                         265. 20.1   69.6   710  266.</span></span>
<span id="cb83-42"><a href="#cb83-42"></a><span class="co">## # … with 1,945 more rows</span></span>
<span id="cb83-43"><a href="#cb83-43"></a><span class="co">## </span></span>
<span id="cb83-44"><a href="#cb83-44"></a><span class="co">## ● MEPS_prod(awesome_multimodel_eps)</span></span>
<span id="cb83-45"><a href="#cb83-45"></a><span class="co">## # A tibble: 1,955 x 13</span></span>
<span id="cb83-46"><a href="#cb83-46"></a><span class="co">##      SID fcdate leadtime validdate fcst_cycle units MEPS_prod_mbr000 MEPS_prod_mbr001 MEPS_prod_mbr002   lon   lat  elev</span></span>
<span id="cb83-47"><a href="#cb83-47"></a><span class="co">##    &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb83-48"><a href="#cb83-48"></a><span class="co">##  1  1001 1.55e9        0    1.55e9 06         K                 270.             270.             270. -8.67  70.9     9</span></span>
<span id="cb83-49"><a href="#cb83-49"></a><span class="co">##  2  1010 1.55e9        0    1.55e9 06         K                 273.             273.             274. 16.1   69.3    13</span></span>
<span id="cb83-50"><a href="#cb83-50"></a><span class="co">##  3  1015 1.55e9        0    1.55e9 06         K                 273.             273.             274. 17.8   69.6    14</span></span>
<span id="cb83-51"><a href="#cb83-51"></a><span class="co">##  4  1018 1.55e9        0    1.55e9 06         K                 269.             269.             269. 16.0   69.2   436</span></span>
<span id="cb83-52"><a href="#cb83-52"></a><span class="co">##  5  1023 1.55e9        0    1.55e9 06         K                 269.             269.             270. 18.5   69.1    77</span></span>
<span id="cb83-53"><a href="#cb83-53"></a><span class="co">##  6  1025 1.55e9        0    1.55e9 06         K                 269.             270.             269. 18.9   69.7     9</span></span>
<span id="cb83-54"><a href="#cb83-54"></a><span class="co">##  7  1026 1.55e9        0    1.55e9 06         K                 268.             269.             268. 18.9   69.7   100</span></span>
<span id="cb83-55"><a href="#cb83-55"></a><span class="co">##  8  1027 1.55e9        0    1.55e9 06         K                 269.             270.             269. 18.9   69.7    10</span></span>
<span id="cb83-56"><a href="#cb83-56"></a><span class="co">##  9  1033 1.55e9        0    1.55e9 06         K                 271.             271.             272. 19.5   70.2    21</span></span>
<span id="cb83-57"><a href="#cb83-57"></a><span class="co">## 10  1035 1.55e9        0    1.55e9 06         K                 265.             265.             265. 20.1   69.6   710</span></span>
<span id="cb83-58"><a href="#cb83-58"></a><span class="co">## # … with 1,945 more rows, and 1 more variable: T2m &lt;dbl&gt;</span></span>
<span id="cb83-59"><a href="#cb83-59"></a><span class="co">## </span></span>
<span id="cb83-60"><a href="#cb83-60"></a><span class="co">## ● CMEPS_prod</span></span>
<span id="cb83-61"><a href="#cb83-61"></a><span class="co">## # A tibble: 1,955 x 24</span></span>
<span id="cb83-62"><a href="#cb83-62"></a><span class="co">##    fcst_cycle fcdate leadtime model_elevation parameter   SID units validdate CMEPS_prod_mbr0… CMEPS_prod_mbr0…</span></span>
<span id="cb83-63"><a href="#cb83-63"></a><span class="co">##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb83-64"><a href="#cb83-64"></a><span class="co">##  1 06         1.55e9        0            36.4 T2m        1001 K        1.55e9             269.             271.</span></span>
<span id="cb83-65"><a href="#cb83-65"></a><span class="co">##  2 06         1.55e9        0             4.1 T2m        1010 K        1.55e9             274.             273.</span></span>
<span id="cb83-66"><a href="#cb83-66"></a><span class="co">##  3 06         1.55e9        0             2.6 T2m        1015 K        1.55e9             273.             273.</span></span>
<span id="cb83-67"><a href="#cb83-67"></a><span class="co">##  4 06         1.55e9        0           152.  T2m        1018 K        1.55e9             269.             268.</span></span>
<span id="cb83-68"><a href="#cb83-68"></a><span class="co">##  5 06         1.55e9        0            69.1 T2m        1023 K        1.55e9             269.             270.</span></span>
<span id="cb83-69"><a href="#cb83-69"></a><span class="co">##  6 06         1.55e9        0             8.1 T2m        1025 K        1.55e9             270.             269.</span></span>
<span id="cb83-70"><a href="#cb83-70"></a><span class="co">##  7 06         1.55e9        0             5.2 T2m        1026 K        1.55e9             269.             269.</span></span>
<span id="cb83-71"><a href="#cb83-71"></a><span class="co">##  8 06         1.55e9        0             5.2 T2m        1027 K        1.55e9             270.             270.</span></span>
<span id="cb83-72"><a href="#cb83-72"></a><span class="co">##  9 06         1.55e9        0            28.5 T2m        1033 K        1.55e9             271.             271.</span></span>
<span id="cb83-73"><a href="#cb83-73"></a><span class="co">## 10 06         1.55e9        0           734.  T2m        1035 K        1.55e9             265.             265.</span></span>
<span id="cb83-74"><a href="#cb83-74"></a><span class="co">## # … with 1,945 more rows, and 14 more variables: CMEPS_prod_mbr003 &lt;dbl&gt;, CMEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb83-75"><a href="#cb83-75"></a><span class="co">## #   CMEPS_prod_mbr005 &lt;dbl&gt;, CMEPS_prod_mbr006 &lt;dbl&gt;, CMEPS_prod_mbr000_lag &lt;dbl&gt;, CMEPS_prod_mbr001_lag &lt;dbl&gt;,</span></span>
<span id="cb83-76"><a href="#cb83-76"></a><span class="co">## #   CMEPS_prod_mbr003_lag &lt;dbl&gt;, CMEPS_prod_mbr004_lag &lt;dbl&gt;, CMEPS_prod_mbr005_lag &lt;dbl&gt;, CMEPS_prod_mbr006_lag &lt;dbl&gt;,</span></span>
<span id="cb83-77"><a href="#cb83-77"></a><span class="co">## #   lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;</span></span>
<span id="cb83-78"><a href="#cb83-78"></a><span class="co">## </span></span>
<span id="cb83-79"><a href="#cb83-79"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb83-80"><a href="#cb83-80"></a><span class="co">## # A tibble: 1,955 x 23</span></span>
<span id="cb83-81"><a href="#cb83-81"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb83-82"><a href="#cb83-82"></a><span class="co">##     &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb83-83"><a href="#cb83-83"></a><span class="co">##  1 1.55e9 06                0            36.4    NA T2m        1001 K        1.55e9             270.             270.</span></span>
<span id="cb83-84"><a href="#cb83-84"></a><span class="co">##  2 1.55e9 06                0             4.1    NA T2m        1010 K        1.55e9             273.             273.</span></span>
<span id="cb83-85"><a href="#cb83-85"></a><span class="co">##  3 1.55e9 06                0             2.6    NA T2m        1015 K        1.55e9             273.             273.</span></span>
<span id="cb83-86"><a href="#cb83-86"></a><span class="co">##  4 1.55e9 06                0           152.     NA T2m        1018 K        1.55e9             269.             269.</span></span>
<span id="cb83-87"><a href="#cb83-87"></a><span class="co">##  5 1.55e9 06                0            69.1    NA T2m        1023 K        1.55e9             269.             269.</span></span>
<span id="cb83-88"><a href="#cb83-88"></a><span class="co">##  6 1.55e9 06                0             8.1    NA T2m        1025 K        1.55e9             269.             270.</span></span>
<span id="cb83-89"><a href="#cb83-89"></a><span class="co">##  7 1.55e9 06                0             5.2    NA T2m        1026 K        1.55e9             268.             269.</span></span>
<span id="cb83-90"><a href="#cb83-90"></a><span class="co">##  8 1.55e9 06                0             5.2    NA T2m        1027 K        1.55e9             269.             270.</span></span>
<span id="cb83-91"><a href="#cb83-91"></a><span class="co">##  9 1.55e9 06                0            28.5    NA T2m        1033 K        1.55e9             271.             271.</span></span>
<span id="cb83-92"><a href="#cb83-92"></a><span class="co">## 10 1.55e9 06                0           734.     NA T2m        1035 K        1.55e9             265.             265.</span></span>
<span id="cb83-93"><a href="#cb83-93"></a><span class="co">## # … with 1,945 more rows, and 12 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb83-94"><a href="#cb83-94"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb83-95"><a href="#cb83-95"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;</span></span></code></pre></div>
<p>Now we can try plotting the ensmeble temperature evolution for REIPA again</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="kw">plot_station_eps</span>(</span>
<span id="cb84-2"><a href="#cb84-2"></a>  t2m, </span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="dv">1114</span>, </span>
<span id="cb84-4"><a href="#cb84-4"></a>  <span class="dv">2019021706</span>, </span>
<span id="cb84-5"><a href="#cb84-5"></a>  <span class="dt">obs_column =</span> T2m, </span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb84-7"><a href="#cb84-7"></a>  <span class="dt">shape =</span> <span class="dv">21</span></span>
<span id="cb84-8"><a href="#cb84-8"></a>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb84-9"><a href="#cb84-9"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">9</span>, <span class="dv">3</span>))</span></code></pre></div>
<p>There are still a few problems with <code>plot_station_eps</code> so tread carefully!</p>
</div>
<div id="shifted-forecasts" class="section level4">
<h4><span class="header-section-number">0.5.12.3</span> Shifted forecasts</h4>
<p>Lets’s say you want to compare an ensmeble with another but with the time shifted. i.e. how does a forecast that is 6 hours old compare with the current forecast. We can do that by shifting the forecast - that means adjusting the forecast start time and the forecast lead time by 6 hours so the forecast appears to have been run at a different time. We can do this with <code>shift_forecast</code>.</p>
<p>To illustrate, we read in the MEPS_prod data, for 10m wind speed, just to be different!</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb85-2"><a href="#cb85-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb85-3"><a href="#cb85-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb85-4"><a href="#cb85-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;MEPS_prod&quot;</span>, </span>
<span id="cb85-5"><a href="#cb85-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb85-6"><a href="#cb85-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb85-7"><a href="#cb85-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb85-8"><a href="#cb85-8"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb85-9"><a href="#cb85-9"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb85-10"><a href="#cb85-10"></a>)</span></code></pre></div>
<p>And then we are going to create a new ensemble with MEPS_prod shifted by 6 hours, so the forecast that started at 00 UTC now appears to have started at 06 UTC etc. This means that the forecast with a lead time of 6 hours, that used to start at 00 UTC now appears to have started at 06 UTC and has a lead time of 0 hours.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>(s10m &lt;-<span class="st"> </span><span class="kw">shift_forecast</span>(</span>
<span id="cb86-2"><a href="#cb86-2"></a>  s10m,</span>
<span id="cb86-3"><a href="#cb86-3"></a>  <span class="dt">fcst_shifts    =</span> <span class="kw">list</span>(<span class="dt">MEPS_prod =</span> <span class="dv">6</span>),</span>
<span id="cb86-4"><a href="#cb86-4"></a>  <span class="dt">keep_unshifted =</span> <span class="ot">TRUE</span></span>
<span id="cb86-5"><a href="#cb86-5"></a>))</span>
<span id="cb86-6"><a href="#cb86-6"></a><span class="co">## ● MEPS_prod</span></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="co">## # A tibble: 24,060 x 19</span></span>
<span id="cb86-8"><a href="#cb86-8"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb86-9"><a href="#cb86-9"></a><span class="co">##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb86-10"><a href="#cb86-10"></a><span class="co">##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s      1.55e9             4.22             8.61</span></span>
<span id="cb86-11"><a href="#cb86-11"></a><span class="co">##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s      1.55e9            11.9             12.9 </span></span>
<span id="cb86-12"><a href="#cb86-12"></a><span class="co">##  3 1.55e9 00                0            29.1    NA S10m       1014 m/s      1.55e9             4.99             5.70</span></span>
<span id="cb86-13"><a href="#cb86-13"></a><span class="co">##  4 1.55e9 00                0             2.6    NA S10m       1015 m/s      1.55e9            11.3             14.8 </span></span>
<span id="cb86-14"><a href="#cb86-14"></a><span class="co">##  5 1.55e9 00                0           152.     NA S10m       1018 m/s      1.55e9             9.09             9.71</span></span>
<span id="cb86-15"><a href="#cb86-15"></a><span class="co">##  6 1.55e9 00                0            16.4    NA S10m       1021 m/s      1.55e9             7.48             7.58</span></span>
<span id="cb86-16"><a href="#cb86-16"></a><span class="co">##  7 1.55e9 00                0            39.5    NA S10m       1022 m/s      1.55e9             6.77             6.84</span></span>
<span id="cb86-17"><a href="#cb86-17"></a><span class="co">##  8 1.55e9 00                0            69.1    NA S10m       1023 m/s      1.55e9             6.42             7.31</span></span>
<span id="cb86-18"><a href="#cb86-18"></a><span class="co">##  9 1.55e9 00                0             8.1    NA S10m       1025 m/s      1.55e9             5.24             5.70</span></span>
<span id="cb86-19"><a href="#cb86-19"></a><span class="co">## 10 1.55e9 00                0             5.2    NA S10m       1026 m/s      1.55e9             4.74             4.99</span></span>
<span id="cb86-20"><a href="#cb86-20"></a><span class="co">## # … with 24,050 more rows, and 8 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb86-21"><a href="#cb86-21"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb86-22"><a href="#cb86-22"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;</span></span>
<span id="cb86-23"><a href="#cb86-23"></a><span class="co">## </span></span>
<span id="cb86-24"><a href="#cb86-24"></a><span class="co">## ● MEPS_prod_shifted_6h</span></span>
<span id="cb86-25"><a href="#cb86-25"></a><span class="co">## # A tibble: 14,436 x 19</span></span>
<span id="cb86-26"><a href="#cb86-26"></a><span class="co">##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units validdate MEPS_prod_mbr000 MEPS_prod_mbr001</span></span>
<span id="cb86-27"><a href="#cb86-27"></a><span class="co">##     &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb86-28"><a href="#cb86-28"></a><span class="co">##  1 1.55e9 06                0            36.4    NA S10m       1001 m/s      1.55e9             5.66             9.14</span></span>
<span id="cb86-29"><a href="#cb86-29"></a><span class="co">##  2 1.55e9 06                0             4.1    NA S10m       1010 m/s      1.55e9             5.42             8.27</span></span>
<span id="cb86-30"><a href="#cb86-30"></a><span class="co">##  3 1.55e9 06                0            29.1    NA S10m       1014 m/s      1.55e9             1.23             4.56</span></span>
<span id="cb86-31"><a href="#cb86-31"></a><span class="co">##  4 1.55e9 06                0             2.6    NA S10m       1015 m/s      1.55e9             7.92            11.7 </span></span>
<span id="cb86-32"><a href="#cb86-32"></a><span class="co">##  5 1.55e9 06                0           152.     NA S10m       1018 m/s      1.55e9             1.84             4.86</span></span>
<span id="cb86-33"><a href="#cb86-33"></a><span class="co">##  6 1.55e9 06                0            16.4    NA S10m       1021 m/s      1.55e9             4.30             8.36</span></span>
<span id="cb86-34"><a href="#cb86-34"></a><span class="co">##  7 1.55e9 06                0            39.5    NA S10m       1022 m/s      1.55e9             3.86             7.74</span></span>
<span id="cb86-35"><a href="#cb86-35"></a><span class="co">##  8 1.55e9 06                0            69.1    NA S10m       1023 m/s      1.55e9             1.85             2.41</span></span>
<span id="cb86-36"><a href="#cb86-36"></a><span class="co">##  9 1.55e9 06                0             8.1    NA S10m       1025 m/s      1.55e9             3.94            10.0 </span></span>
<span id="cb86-37"><a href="#cb86-37"></a><span class="co">## 10 1.55e9 06                0             5.2    NA S10m       1026 m/s      1.55e9             2.74             6.75</span></span>
<span id="cb86-38"><a href="#cb86-38"></a><span class="co">## # … with 14,426 more rows, and 8 more variables: MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;,</span></span>
<span id="cb86-39"><a href="#cb86-39"></a><span class="co">## #   MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,</span></span>
<span id="cb86-40"><a href="#cb86-40"></a><span class="co">## #   MEPS_prod_mbr009 &lt;dbl&gt;</span></span></code></pre></div>
<p>So now we have two ensembles in our data: MEPS_prod and MEPS_prod_shifted_6h. We can see that they are different by getting the start times (fcdate) and lead times from each of the forecasts.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="kw">transmute</span>(s10m, <span class="dt">fcdate =</span> <span class="kw">unix2datetime</span>(fcdate), leadtime) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(distinct)</span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="co">## $MEPS_prod</span></span>
<span id="cb87-3"><a href="#cb87-3"></a><span class="co">## # A tibble: 20 x 2</span></span>
<span id="cb87-4"><a href="#cb87-4"></a><span class="co">##    fcdate              leadtime</span></span>
<span id="cb87-5"><a href="#cb87-5"></a><span class="co">##    &lt;dttm&gt;                 &lt;int&gt;</span></span>
<span id="cb87-6"><a href="#cb87-6"></a><span class="co">##  1 2019-02-17 00:00:00        0</span></span>
<span id="cb87-7"><a href="#cb87-7"></a><span class="co">##  2 2019-02-17 00:00:00        3</span></span>
<span id="cb87-8"><a href="#cb87-8"></a><span class="co">##  3 2019-02-17 00:00:00        6</span></span>
<span id="cb87-9"><a href="#cb87-9"></a><span class="co">##  4 2019-02-17 00:00:00        9</span></span>
<span id="cb87-10"><a href="#cb87-10"></a><span class="co">##  5 2019-02-17 00:00:00       12</span></span>
<span id="cb87-11"><a href="#cb87-11"></a><span class="co">##  6 2019-02-17 06:00:00        0</span></span>
<span id="cb87-12"><a href="#cb87-12"></a><span class="co">##  7 2019-02-17 06:00:00        3</span></span>
<span id="cb87-13"><a href="#cb87-13"></a><span class="co">##  8 2019-02-17 06:00:00        6</span></span>
<span id="cb87-14"><a href="#cb87-14"></a><span class="co">##  9 2019-02-17 06:00:00        9</span></span>
<span id="cb87-15"><a href="#cb87-15"></a><span class="co">## 10 2019-02-17 06:00:00       12</span></span>
<span id="cb87-16"><a href="#cb87-16"></a><span class="co">## 11 2019-02-17 12:00:00        0</span></span>
<span id="cb87-17"><a href="#cb87-17"></a><span class="co">## 12 2019-02-17 12:00:00        3</span></span>
<span id="cb87-18"><a href="#cb87-18"></a><span class="co">## 13 2019-02-17 12:00:00        6</span></span>
<span id="cb87-19"><a href="#cb87-19"></a><span class="co">## 14 2019-02-17 12:00:00        9</span></span>
<span id="cb87-20"><a href="#cb87-20"></a><span class="co">## 15 2019-02-17 12:00:00       12</span></span>
<span id="cb87-21"><a href="#cb87-21"></a><span class="co">## 16 2019-02-17 18:00:00        0</span></span>
<span id="cb87-22"><a href="#cb87-22"></a><span class="co">## 17 2019-02-17 18:00:00        3</span></span>
<span id="cb87-23"><a href="#cb87-23"></a><span class="co">## 18 2019-02-17 18:00:00        6</span></span>
<span id="cb87-24"><a href="#cb87-24"></a><span class="co">## 19 2019-02-17 18:00:00        9</span></span>
<span id="cb87-25"><a href="#cb87-25"></a><span class="co">## 20 2019-02-17 18:00:00       12</span></span>
<span id="cb87-26"><a href="#cb87-26"></a><span class="co">## </span></span>
<span id="cb87-27"><a href="#cb87-27"></a><span class="co">## $MEPS_prod_shifted_6h</span></span>
<span id="cb87-28"><a href="#cb87-28"></a><span class="co">## # A tibble: 12 x 2</span></span>
<span id="cb87-29"><a href="#cb87-29"></a><span class="co">##    fcdate              leadtime</span></span>
<span id="cb87-30"><a href="#cb87-30"></a><span class="co">##    &lt;dttm&gt;                 &lt;dbl&gt;</span></span>
<span id="cb87-31"><a href="#cb87-31"></a><span class="co">##  1 2019-02-17 06:00:00        0</span></span>
<span id="cb87-32"><a href="#cb87-32"></a><span class="co">##  2 2019-02-17 06:00:00        3</span></span>
<span id="cb87-33"><a href="#cb87-33"></a><span class="co">##  3 2019-02-17 06:00:00        6</span></span>
<span id="cb87-34"><a href="#cb87-34"></a><span class="co">##  4 2019-02-17 12:00:00        0</span></span>
<span id="cb87-35"><a href="#cb87-35"></a><span class="co">##  5 2019-02-17 12:00:00        3</span></span>
<span id="cb87-36"><a href="#cb87-36"></a><span class="co">##  6 2019-02-17 12:00:00        6</span></span>
<span id="cb87-37"><a href="#cb87-37"></a><span class="co">##  7 2019-02-17 18:00:00        0</span></span>
<span id="cb87-38"><a href="#cb87-38"></a><span class="co">##  8 2019-02-17 18:00:00        3</span></span>
<span id="cb87-39"><a href="#cb87-39"></a><span class="co">##  9 2019-02-17 18:00:00        6</span></span>
<span id="cb87-40"><a href="#cb87-40"></a><span class="co">## 10 2019-02-18 00:00:00        0</span></span>
<span id="cb87-41"><a href="#cb87-41"></a><span class="co">## 11 2019-02-18 00:00:00        3</span></span>
<span id="cb87-42"><a href="#cb87-42"></a><span class="co">## 12 2019-02-18 00:00:00        6</span></span></code></pre></div>
<p>We’re going to want to verify s10m later, so let’s make sure we have the common cases and get the observations</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">common_cases</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="st">  </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb88-3"><a href="#cb88-3"></a>    <span class="kw">read_point_obs</span>(</span>
<span id="cb88-4"><a href="#cb88-4"></a>      <span class="kw">first_validdate</span>(s10m),</span>
<span id="cb88-5"><a href="#cb88-5"></a>      <span class="kw">last_validdate</span>(s10m),</span>
<span id="cb88-6"><a href="#cb88-6"></a>      <span class="dt">parameter =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb88-7"><a href="#cb88-7"></a>      <span class="dt">obs_path  =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>) </span>
<span id="cb88-8"><a href="#cb88-8"></a>    )</span>
<span id="cb88-9"><a href="#cb88-9"></a>  )</span></code></pre></div>
</div>
</div>
<div id="verification" class="section level3">
<h3><span class="header-section-number">0.5.13</span> Verification</h3>
<p>For ensemble verification, the main verification function is <code>ens_verify</code>. Similar to <code>det_verify</code>, you give it the data and the column name of the observations.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="kw">ens_verify</span>(t2m, T2m)</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="co">## $ens_summary_scores</span></span>
<span id="cb89-3"><a href="#cb89-3"></a><span class="co">## # A tibble: 16 x 12</span></span>
<span id="cb89-4"><a href="#cb89-4"></a><span class="co">##    mname leadtime num_cases mean_bias  stde  rmse spread spread_skill_ra… rank_histogram  crps crps_potential</span></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="co">##    &lt;chr&gt;    &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;            &lt;dbl&gt; &lt;list&gt;         &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span id="cb89-6"><a href="#cb89-6"></a><span class="co">##  1 awes…        0       467    0.177   1.40  1.41  0.744            0.526 &lt;tibble [5 × … 0.787          0.639</span></span>
<span id="cb89-7"><a href="#cb89-7"></a><span class="co">##  2 awes…        3       509    0.552   2.09  2.16  0.713            0.330 &lt;tibble [5 × … 1.23           0.901</span></span>
<span id="cb89-8"><a href="#cb89-8"></a><span class="co">##  3 awes…        6       472    0.596   2.34  2.42  0.710            0.294 &lt;tibble [5 × … 1.39           0.996</span></span>
<span id="cb89-9"><a href="#cb89-9"></a><span class="co">##  4 awes…        9       507    0.782   2.33  2.46  0.798            0.325 &lt;tibble [5 × … 1.43           1.01 </span></span>
<span id="cb89-10"><a href="#cb89-10"></a><span class="co">##  5 MEPS…        0       467    0.187   1.55  1.56  0.756            0.486 &lt;tibble [4 × … 0.932          0.702</span></span>
<span id="cb89-11"><a href="#cb89-11"></a><span class="co">##  6 MEPS…        3       509    0.572   2.09  2.16  0.754            0.348 &lt;tibble [4 × … 1.25           0.869</span></span>
<span id="cb89-12"><a href="#cb89-12"></a><span class="co">##  7 MEPS…        6       472    0.612   2.35  2.42  0.734            0.303 &lt;tibble [4 × … 1.41           0.980</span></span>
<span id="cb89-13"><a href="#cb89-13"></a><span class="co">##  8 MEPS…        9       507    0.798   2.32  2.45  0.811            0.330 &lt;tibble [4 × … 1.46           0.993</span></span>
<span id="cb89-14"><a href="#cb89-14"></a><span class="co">##  9 CMEP…        0       467    0.0678  1.67  1.67  0.686            0.410 &lt;tibble [13 ×… 0.952          0.813</span></span>
<span id="cb89-15"><a href="#cb89-15"></a><span class="co">## 10 CMEP…        3       509    0.344   2.11  2.14  0.729            0.341 &lt;tibble [13 ×… 1.22           0.999</span></span>
<span id="cb89-16"><a href="#cb89-16"></a><span class="co">## 11 CMEP…        6       472    0.470   2.33  2.37  0.766            0.323 &lt;tibble [13 ×… 1.34           1.08 </span></span>
<span id="cb89-17"><a href="#cb89-17"></a><span class="co">## 12 CMEP…        9       507    0.673   2.34  2.44  0.806            0.331 &lt;tibble [13 ×… 1.39           1.11 </span></span>
<span id="cb89-18"><a href="#cb89-18"></a><span class="co">## 13 MEPS…        0       467    0.139   1.55  1.56  0.618            0.397 &lt;tibble [11 ×… 0.895          0.753</span></span>
<span id="cb89-19"><a href="#cb89-19"></a><span class="co">## 14 MEPS…        3       509    0.457   2.06  2.11  0.722            0.342 &lt;tibble [11 ×… 1.18           0.959</span></span>
<span id="cb89-20"><a href="#cb89-20"></a><span class="co">## 15 MEPS…        6       472    0.498   2.30  2.35  0.770            0.327 &lt;tibble [11 ×… 1.34           1.05 </span></span>
<span id="cb89-21"><a href="#cb89-21"></a><span class="co">## 16 MEPS…        9       507    0.670   2.30  2.39  0.882            0.368 &lt;tibble [11 ×… 1.36           1.07 </span></span>
<span id="cb89-22"><a href="#cb89-22"></a><span class="co">## # … with 1 more variable: crps_reliability &lt;dbl&gt;</span></span>
<span id="cb89-23"><a href="#cb89-23"></a><span class="co">## </span></span>
<span id="cb89-24"><a href="#cb89-24"></a><span class="co">## $ens_threshold_scores</span></span>
<span id="cb89-25"><a href="#cb89-25"></a><span class="co">## data frame with 0 columns and 0 rows</span></span>
<span id="cb89-26"><a href="#cb89-26"></a><span class="co">## </span></span>
<span id="cb89-27"><a href="#cb89-27"></a><span class="co">## $det_summary_scores</span></span>
<span id="cb89-28"><a href="#cb89-28"></a><span class="co">## # A tibble: 120 x 9</span></span>
<span id="cb89-29"><a href="#cb89-29"></a><span class="co">##    mname                  leadtime member sub_model         num_cases    bias  rmse   mae  stde</span></span>
<span id="cb89-30"><a href="#cb89-30"></a><span class="co">##    &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;                 &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb89-31"><a href="#cb89-31"></a><span class="co">##  1 awesome_multimodel_eps        0 mbr000 AROME_Arctic_prod       467  0.145   1.12 0.738  1.11</span></span>
<span id="cb89-32"><a href="#cb89-32"></a><span class="co">##  2 awesome_multimodel_eps        3 mbr000 AROME_Arctic_prod       509  0.493   2.24 1.48   2.19</span></span>
<span id="cb89-33"><a href="#cb89-33"></a><span class="co">##  3 awesome_multimodel_eps        6 mbr000 AROME_Arctic_prod       472  0.550   2.49 1.65   2.43</span></span>
<span id="cb89-34"><a href="#cb89-34"></a><span class="co">##  4 awesome_multimodel_eps        9 mbr000 AROME_Arctic_prod       507  0.733   2.58 1.72   2.47</span></span>
<span id="cb89-35"><a href="#cb89-35"></a><span class="co">##  5 awesome_multimodel_eps        0 mbr000 MEPS_prod               467  0.155   1.55 1.09   1.55</span></span>
<span id="cb89-36"><a href="#cb89-36"></a><span class="co">##  6 awesome_multimodel_eps        3 mbr000 MEPS_prod               509  0.479   2.11 1.42   2.05</span></span>
<span id="cb89-37"><a href="#cb89-37"></a><span class="co">##  7 awesome_multimodel_eps        6 mbr000 MEPS_prod               472  0.525   2.32 1.55   2.26</span></span>
<span id="cb89-38"><a href="#cb89-38"></a><span class="co">##  8 awesome_multimodel_eps        9 mbr000 MEPS_prod               507  0.689   2.39 1.63   2.30</span></span>
<span id="cb89-39"><a href="#cb89-39"></a><span class="co">##  9 awesome_multimodel_eps        0 mbr001 MEPS_prod               467 -0.0784  1.59 1.17   1.59</span></span>
<span id="cb89-40"><a href="#cb89-40"></a><span class="co">## 10 awesome_multimodel_eps        3 mbr001 MEPS_prod               509  0.399   2.03 1.39   1.99</span></span>
<span id="cb89-41"><a href="#cb89-41"></a><span class="co">## # … with 110 more rows</span></span>
<span id="cb89-42"><a href="#cb89-42"></a><span class="co">## </span></span>
<span id="cb89-43"><a href="#cb89-43"></a><span class="co">## attr(,&quot;parameter&quot;)</span></span>
<span id="cb89-44"><a href="#cb89-44"></a><span class="co">## [1] &quot;T2m&quot;</span></span>
<span id="cb89-45"><a href="#cb89-45"></a><span class="co">## attr(,&quot;start_date&quot;)</span></span>
<span id="cb89-46"><a href="#cb89-46"></a><span class="co">## [1] &quot;2019021706&quot;</span></span>
<span id="cb89-47"><a href="#cb89-47"></a><span class="co">## attr(,&quot;end_date&quot;)</span></span>
<span id="cb89-48"><a href="#cb89-48"></a><span class="co">## [1] &quot;2019021718&quot;</span></span>
<span id="cb89-49"><a href="#cb89-49"></a><span class="co">## attr(,&quot;num_stations&quot;)</span></span>
<span id="cb89-50"><a href="#cb89-50"></a><span class="co">## [1] 180</span></span></code></pre></div>
<p>By default, summary deterministic verification scores will be computed for each member. We can also compute categorical ensemble scores based on thresholds (such as Brier Score, ROC, economic value etc.) if we pass some thresholds to the function</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(s10m, S10m, <span class="dt">thresholds =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>))</span></code></pre></div>
<p>You can also compute “fair” scores for CRPS and Brier Score, which take account differences in the number of members between ensembles by scaling them to an equal number of members. We do this by passing <code>num_ref_members</code>.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>verif_t2m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(</span>
<span id="cb91-2"><a href="#cb91-2"></a>  t2m, </span>
<span id="cb91-3"><a href="#cb91-3"></a>  T2m, </span>
<span id="cb91-4"><a href="#cb91-4"></a>  <span class="dt">thresholds      =</span> <span class="kw">seq</span>(<span class="dv">262</span>, <span class="dv">272</span>, <span class="dv">2</span>), </span>
<span id="cb91-5"><a href="#cb91-5"></a>  <span class="dt">num_ref_members =</span> <span class="dv">10</span></span>
<span id="cb91-6"><a href="#cb91-6"></a>)</span></code></pre></div>
<p>So now we can have a quick look at some score plots using <code>plot_point_verif</code> - the default for the type of verification is <code>verif_type = "ens"</code> so we don’t need to specify it (for now)</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, crps)</span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="kw">plot_point_verif</span>(verif_s10m, spread_skill)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, rank_histogram)</span>
<span id="cb93-2"><a href="#cb93-2"></a></span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="kw">plot_point_verif</span>(verif_t2m, spread_skill_ratio)</span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="kw">plot_point_verif</span>(verif_t2m, fair_crps)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-2.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb94-2"><a href="#cb94-2"></a>  verif_t2m, </span>
<span id="cb94-3"><a href="#cb94-3"></a>  rank_histogram, </span>
<span id="cb94-4"><a href="#cb94-4"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(leadtime), </span>
<span id="cb94-5"><a href="#cb94-5"></a>  <span class="dt">num_facet_cols  =</span> <span class="dv">2</span>, </span>
<span id="cb94-6"><a href="#cb94-6"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span></span>
<span id="cb94-7"><a href="#cb94-7"></a>) <span class="op">+</span></span>
<span id="cb94-8"><a href="#cb94-8"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-3.png" width="672" /></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="kw">plot_point_verif</span>(verif_t2m, brier_score, <span class="dt">facet_by =</span> <span class="kw">vars</span>(threshold))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-4.png" width="672" /></p>
<p>We can also set the colours / fill colours for our plots by passing a data frame with one column as mname and the other as colour. The easiest way to get the model names for the mname is either from the forecast object using names, or if that is not available at the time you can get if from the verification list.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="kw">names</span>(t2m)</span>
<span id="cb96-2"><a href="#cb96-2"></a><span class="co">## [1] &quot;awesome_multimodel_eps&quot;                    &quot;AROME_Arctic_prod(awesome_multimodel_eps)&quot;</span></span>
<span id="cb96-3"><a href="#cb96-3"></a><span class="co">## [3] &quot;MEPS_prod(awesome_multimodel_eps)&quot;         &quot;CMEPS_prod&quot;                               </span></span>
<span id="cb96-4"><a href="#cb96-4"></a><span class="co">## [5] &quot;MEPS_prod&quot;</span></span>
<span id="cb96-5"><a href="#cb96-5"></a><span class="kw">map</span>(verif_t2m, pull, mname) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(union)</span>
<span id="cb96-6"><a href="#cb96-6"></a><span class="co">## [1] &quot;awesome_multimodel_eps&quot;                    &quot;MEPS_prod(awesome_multimodel_eps)&quot;        </span></span>
<span id="cb96-7"><a href="#cb96-7"></a><span class="co">## [3] &quot;CMEPS_prod&quot;                                &quot;MEPS_prod&quot;                                </span></span>
<span id="cb96-8"><a href="#cb96-8"></a><span class="co">## [5] &quot;AROME_Arctic_prod(awesome_multimodel_eps)&quot;</span></span>
<span id="cb96-9"><a href="#cb96-9"></a>my_colours &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb96-10"><a href="#cb96-10"></a>  <span class="dt">mname =</span> <span class="kw">names</span>(t2m),</span>
<span id="cb96-11"><a href="#cb96-11"></a>  <span class="dt">colour =</span> <span class="kw">c</span>(<span class="st">&quot;darkblue&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;skyblue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>)</span>
<span id="cb96-12"><a href="#cb96-12"></a>)</span></code></pre></div>
<p>We can also plot the deterministic scores for each member. Here we need to tell <code>plot_point_verif</code> to do faceting by mname and to colour the lines according to the ensemble member.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb97-2"><a href="#cb97-2"></a>  verif_t2m, </span>
<span id="cb97-3"><a href="#cb97-3"></a>  mae, </span>
<span id="cb97-4"><a href="#cb97-4"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb97-5"><a href="#cb97-5"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb97-6"><a href="#cb97-6"></a>  <span class="dt">colour_by       =</span> member,</span>
<span id="cb97-7"><a href="#cb97-7"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb97-8"><a href="#cb97-8"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">20</span></span>
<span id="cb97-9"><a href="#cb97-9"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>We’ve got quite a lot going on there and it’s not a useful for plot, put we can clean it up by adding some more grouping variables. First let’s differentiate between the control members and the perturbed members.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a>verif_t2m<span class="op">$</span>det_summary_scores &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb98-2"><a href="#cb98-2"></a>  verif_t2m<span class="op">$</span>det_summary_scores,</span>
<span id="cb98-3"><a href="#cb98-3"></a>  <span class="dt">member_type =</span> <span class="kw">case_when</span>(</span>
<span id="cb98-4"><a href="#cb98-4"></a>    <span class="kw">grepl</span>(<span class="st">&quot;000&quot;</span>, member) <span class="op">~</span><span class="st"> &quot;control&quot;</span>,</span>
<span id="cb98-5"><a href="#cb98-5"></a>    <span class="ot">TRUE</span>                 <span class="op">~</span><span class="st"> &quot;perturbed&quot;</span></span>
<span id="cb98-6"><a href="#cb98-6"></a>  )</span>
<span id="cb98-7"><a href="#cb98-7"></a>)</span>
<span id="cb98-8"><a href="#cb98-8"></a></span>
<span id="cb98-9"><a href="#cb98-9"></a>member_colours &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb98-10"><a href="#cb98-10"></a>  <span class="op">~</span>member_type, <span class="op">~</span>colour,</span>
<span id="cb98-11"><a href="#cb98-11"></a>  <span class="st">&quot;control&quot;</span>, <span class="st">&quot;red&quot;</span>, </span>
<span id="cb98-12"><a href="#cb98-12"></a>  <span class="st">&quot;perturbed&quot;</span>, <span class="st">&quot;grey70&quot;</span></span>
<span id="cb98-13"><a href="#cb98-13"></a>)</span>
<span id="cb98-14"><a href="#cb98-14"></a></span>
<span id="cb98-15"><a href="#cb98-15"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb98-16"><a href="#cb98-16"></a>  verif_t2m, </span>
<span id="cb98-17"><a href="#cb98-17"></a>  mae, </span>
<span id="cb98-18"><a href="#cb98-18"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb98-19"><a href="#cb98-19"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb98-20"><a href="#cb98-20"></a>  <span class="dt">colour_by       =</span> member_type,</span>
<span id="cb98-21"><a href="#cb98-21"></a>  <span class="dt">colour_table    =</span> member_colours, </span>
<span id="cb98-22"><a href="#cb98-22"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb98-23"><a href="#cb98-23"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span>,</span>
<span id="cb98-24"><a href="#cb98-24"></a>  <span class="dt">group           =</span> member</span>
<span id="cb98-25"><a href="#cb98-25"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>And then we’re going to add an extra column to the data frame so that we can give lagged members a different line type</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>verif_t2m<span class="op">$</span>det_summary_scores &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb99-2"><a href="#cb99-2"></a>  verif_t2m<span class="op">$</span>det_summary_scores,</span>
<span id="cb99-3"><a href="#cb99-3"></a>  <span class="dt">lagging =</span> <span class="kw">case_when</span>(</span>
<span id="cb99-4"><a href="#cb99-4"></a>    <span class="kw">grepl</span>(<span class="st">&quot;_lag$&quot;</span>, member) <span class="op">~</span><span class="st"> &quot;lagged&quot;</span>,</span>
<span id="cb99-5"><a href="#cb99-5"></a>    <span class="ot">TRUE</span>                   <span class="op">~</span><span class="st"> &quot;unlagged&quot;</span></span>
<span id="cb99-6"><a href="#cb99-6"></a>  )</span>
<span id="cb99-7"><a href="#cb99-7"></a>)</span>
<span id="cb99-8"><a href="#cb99-8"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb99-9"><a href="#cb99-9"></a>  verif_t2m , </span>
<span id="cb99-10"><a href="#cb99-10"></a>  mae, </span>
<span id="cb99-11"><a href="#cb99-11"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb99-12"><a href="#cb99-12"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb99-13"><a href="#cb99-13"></a>  <span class="dt">colour_by       =</span> member_type,</span>
<span id="cb99-14"><a href="#cb99-14"></a>  <span class="dt">colour_table    =</span> member_colours, </span>
<span id="cb99-15"><a href="#cb99-15"></a>  <span class="dt">linetype_by     =</span> <span class="kw">fct_rev</span>(lagging), </span>
<span id="cb99-16"><a href="#cb99-16"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb99-17"><a href="#cb99-17"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span>,</span>
<span id="cb99-18"><a href="#cb99-18"></a>  <span class="dt">group           =</span> member</span>
<span id="cb99-19"><a href="#cb99-19"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>And finally, although our multi model ensemble plot looks strange, because it has 2 member 0s, that’s OK because we don’t need it as the data are in the plots for the sub models.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb100-2"><a href="#cb100-2"></a>  verif_t2m , </span>
<span id="cb100-3"><a href="#cb100-3"></a>  mae, </span>
<span id="cb100-4"><a href="#cb100-4"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb100-5"><a href="#cb100-5"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb100-6"><a href="#cb100-6"></a>  <span class="dt">colour_by       =</span> member_type,</span>
<span id="cb100-7"><a href="#cb100-7"></a>  <span class="dt">colour_table    =</span> member_colours, </span>
<span id="cb100-8"><a href="#cb100-8"></a>  <span class="dt">linetype_by     =</span> <span class="kw">fct_rev</span>(lagging), </span>
<span id="cb100-9"><a href="#cb100-9"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb100-10"><a href="#cb100-10"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span>,</span>
<span id="cb100-11"><a href="#cb100-11"></a>  <span class="dt">group           =</span> member,</span>
<span id="cb100-12"><a href="#cb100-12"></a>  <span class="dt">filter_by       =</span> <span class="kw">vars</span>(mname <span class="op">!=</span><span class="st"> &quot;awesome_multimodel_eps&quot;</span>),</span>
<span id="cb100-13"><a href="#cb100-13"></a>  <span class="dt">num_facet_cols  =</span> <span class="dv">2</span> </span>
<span id="cb100-14"><a href="#cb100-14"></a>) <span class="op">+</span></span>
<span id="cb100-15"><a href="#cb100-15"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">9</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<div id="verification-by-groups" class="section level4">
<h4><span class="header-section-number">0.5.13.1</span> Verification by groups</h4>
<p>As we mentioned in the deterministic section, we can compute verification scores for groups of data. So in our data we have forecasts from 3 different cycles: 06, 12, and 18 UTC. (Let’s forget for a moment that also means only 3 forecasts and assume that the data include forecasts from several days running with the same start times every day). We can use the <code>groupings</code> argument to say that we want to verify for each lead time for each forecast cycle.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="kw">ens_verify</span>(t2m, T2m, <span class="dt">groupings =</span> <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;fcst_cycle&quot;</span>))</span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="co">## $ens_summary_scores</span></span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="co">## # A tibble: 48 x 13</span></span>
<span id="cb101-4"><a href="#cb101-4"></a><span class="co">##    mname leadtime fcst_cycle num_cases mean_bias  stde  rmse spread spread_skill_ra… rank_histogram  crps crps_potential</span></span>
<span id="cb101-5"><a href="#cb101-5"></a><span class="co">##    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;            &lt;dbl&gt; &lt;list&gt;         &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span id="cb101-6"><a href="#cb101-6"></a><span class="co">##  1 awes…        0 06               147    0.0532  1.02  1.01  0.525            0.517 &lt;tibble [5 × … 0.566          0.475</span></span>
<span id="cb101-7"><a href="#cb101-7"></a><span class="co">##  2 awes…        0 12               166   -0.131   1.01  1.01  0.523            0.517 &lt;tibble [5 × … 0.587          0.470</span></span>
<span id="cb101-8"><a href="#cb101-8"></a><span class="co">##  3 awes…        0 18               154    0.626   1.90  1.99  1.06             0.531 &lt;tibble [5 × … 1.21           0.871</span></span>
<span id="cb101-9"><a href="#cb101-9"></a><span class="co">##  4 awes…        3 06               170   -0.0961  1.33  1.33  0.505            0.379 &lt;tibble [5 × … 0.827          0.615</span></span>
<span id="cb101-10"><a href="#cb101-10"></a><span class="co">##  5 awes…        3 12               169    0.825   1.76  1.93  0.542            0.280 &lt;tibble [5 × … 1.17           0.748</span></span>
<span id="cb101-11"><a href="#cb101-11"></a><span class="co">##  6 awes…        3 18               170    0.929   2.77  2.91  0.988            0.339 &lt;tibble [5 × … 1.70           1.22 </span></span>
<span id="cb101-12"><a href="#cb101-12"></a><span class="co">##  7 awes…        6 06               166   -0.337   1.22  1.26  0.499            0.397 &lt;tibble [5 × … 0.814          0.550</span></span>
<span id="cb101-13"><a href="#cb101-13"></a><span class="co">##  8 awes…        6 12               154    1.23    2.48  2.76  0.627            0.227 &lt;tibble [5 × … 1.81           1.08 </span></span>
<span id="cb101-14"><a href="#cb101-14"></a><span class="co">##  9 awes…        6 18               152    0.970   2.79  2.95  0.946            0.321 &lt;tibble [5 × … 1.60           1.12 </span></span>
<span id="cb101-15"><a href="#cb101-15"></a><span class="co">## 10 awes…        9 06               169    0.708   1.81  1.94  0.624            0.322 &lt;tibble [5 × … 1.20           0.784</span></span>
<span id="cb101-16"><a href="#cb101-16"></a><span class="co">## # … with 38 more rows, and 1 more variable: crps_reliability &lt;dbl&gt;</span></span>
<span id="cb101-17"><a href="#cb101-17"></a><span class="co">## </span></span>
<span id="cb101-18"><a href="#cb101-18"></a><span class="co">## $ens_threshold_scores</span></span>
<span id="cb101-19"><a href="#cb101-19"></a><span class="co">## data frame with 0 columns and 0 rows</span></span>
<span id="cb101-20"><a href="#cb101-20"></a><span class="co">## </span></span>
<span id="cb101-21"><a href="#cb101-21"></a><span class="co">## $det_summary_scores</span></span>
<span id="cb101-22"><a href="#cb101-22"></a><span class="co">## # A tibble: 360 x 10</span></span>
<span id="cb101-23"><a href="#cb101-23"></a><span class="co">##    mname                  leadtime fcst_cycle member sub_model         num_cases    bias  rmse   mae  stde</span></span>
<span id="cb101-24"><a href="#cb101-24"></a><span class="co">##    &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;                 &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb101-25"><a href="#cb101-25"></a><span class="co">##  1 awesome_multimodel_eps        0 06         mbr000 AROME_Arctic_prod       147  0.0882 0.836 0.526 0.834</span></span>
<span id="cb101-26"><a href="#cb101-26"></a><span class="co">##  2 awesome_multimodel_eps        3 06         mbr000 AROME_Arctic_prod       170 -0.139  1.36  1.03  1.36 </span></span>
<span id="cb101-27"><a href="#cb101-27"></a><span class="co">##  3 awesome_multimodel_eps        6 06         mbr000 AROME_Arctic_prod       166 -0.307  1.30  0.981 1.27 </span></span>
<span id="cb101-28"><a href="#cb101-28"></a><span class="co">##  4 awesome_multimodel_eps        9 06         mbr000 AROME_Arctic_prod       169  0.708  1.91  1.34  1.78 </span></span>
<span id="cb101-29"><a href="#cb101-29"></a><span class="co">##  5 awesome_multimodel_eps        0 12         mbr000 AROME_Arctic_prod       166  0.0626 0.825 0.560 0.825</span></span>
<span id="cb101-30"><a href="#cb101-30"></a><span class="co">##  6 awesome_multimodel_eps        3 12         mbr000 AROME_Arctic_prod       169  0.788  1.97  1.37  1.81 </span></span>
<span id="cb101-31"><a href="#cb101-31"></a><span class="co">##  7 awesome_multimodel_eps        6 12         mbr000 AROME_Arctic_prod       154  1.25   2.84  2.06  2.56 </span></span>
<span id="cb101-32"><a href="#cb101-32"></a><span class="co">##  8 awesome_multimodel_eps        9 12         mbr000 AROME_Arctic_prod       170  0.907  3.26  2.25  3.15 </span></span>
<span id="cb101-33"><a href="#cb101-33"></a><span class="co">##  9 awesome_multimodel_eps        0 18         mbr000 AROME_Arctic_prod       154  0.287  1.55  1.13  1.52 </span></span>
<span id="cb101-34"><a href="#cb101-34"></a><span class="co">## 10 awesome_multimodel_eps        3 18         mbr000 AROME_Arctic_prod       170  0.830  3.05  2.05  2.94 </span></span>
<span id="cb101-35"><a href="#cb101-35"></a><span class="co">## # … with 350 more rows</span></span>
<span id="cb101-36"><a href="#cb101-36"></a><span class="co">## </span></span>
<span id="cb101-37"><a href="#cb101-37"></a><span class="co">## attr(,&quot;parameter&quot;)</span></span>
<span id="cb101-38"><a href="#cb101-38"></a><span class="co">## [1] &quot;T2m&quot;</span></span>
<span id="cb101-39"><a href="#cb101-39"></a><span class="co">## attr(,&quot;start_date&quot;)</span></span>
<span id="cb101-40"><a href="#cb101-40"></a><span class="co">## [1] &quot;2019021706&quot;</span></span>
<span id="cb101-41"><a href="#cb101-41"></a><span class="co">## attr(,&quot;end_date&quot;)</span></span>
<span id="cb101-42"><a href="#cb101-42"></a><span class="co">## [1] &quot;2019021718&quot;</span></span>
<span id="cb101-43"><a href="#cb101-43"></a><span class="co">## attr(,&quot;num_stations&quot;)</span></span>
<span id="cb101-44"><a href="#cb101-44"></a><span class="co">## [1] 180</span></span></code></pre></div>
<p>But this only computes the scores for each forecast cycle and not for all of the cycles combined. We can rectify that by passing the groupings as a list with different grouping combinations</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>verif_t2m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(</span>
<span id="cb102-2"><a href="#cb102-2"></a>  t2m, </span>
<span id="cb102-3"><a href="#cb102-3"></a>  T2m, </span>
<span id="cb102-4"><a href="#cb102-4"></a>  <span class="dt">groupings  =</span> <span class="kw">list</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;fcst_cycle&quot;</span>)),</span>
<span id="cb102-5"><a href="#cb102-5"></a>  <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="dv">262</span>, <span class="dv">272</span>, <span class="dv">2</span>)</span>
<span id="cb102-6"><a href="#cb102-6"></a>)</span></code></pre></div>
<p>If we pull out the fcst_cycle column, we will see that we now have a new entry for all cycles.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="kw">pull</span>(verif_t2m<span class="op">$</span>ens_summary_scores, fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()</span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="co">## [1] &quot; 06; 12; 18&quot; &quot;06&quot;          &quot;12&quot;          &quot;18&quot;</span></span></code></pre></div>
<p>So we can plot for all forecast cycles</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb104-2"><a href="#cb104-2"></a>  verif_t2m, </span>
<span id="cb104-3"><a href="#cb104-3"></a>  brier_score_decomposition, </span>
<span id="cb104-4"><a href="#cb104-4"></a>  <span class="dt">facet_by =</span> <span class="kw">vars</span>(fcst_cycle, threshold),</span>
<span id="cb104-5"><a href="#cb104-5"></a>  <span class="dt">num_facet_cols =</span> <span class="dv">6</span></span>
<span id="cb104-6"><a href="#cb104-6"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-87-1.png" width="864" /></p>
<p>If we’ve computed some different verifications and we want to plot them together, we can join those score objects using <code>bind_point_verif</code>. We have done verification for 2m temperature and 10m wind speed, so we can bind those together.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(</span>
<span id="cb105-2"><a href="#cb105-2"></a>  s10m, </span>
<span id="cb105-3"><a href="#cb105-3"></a>  S10m, </span>
<span id="cb105-4"><a href="#cb105-4"></a>  <span class="dt">thresholds =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>),</span>
<span id="cb105-5"><a href="#cb105-5"></a>  <span class="dt">groupings  =</span> <span class="kw">list</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;fcst_cycle&quot;</span>))</span>
<span id="cb105-6"><a href="#cb105-6"></a>)</span>
<span id="cb105-7"><a href="#cb105-7"></a>verif_all &lt;-<span class="st"> </span><span class="kw">bind_point_verif</span>(verif_t2m, verif_s10m)</span></code></pre></div>
<p>And then we can plot those together with the same function</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb106-2"><a href="#cb106-2"></a>  verif_all, </span>
<span id="cb106-3"><a href="#cb106-3"></a>  crps, </span>
<span id="cb106-4"><a href="#cb106-4"></a>  <span class="dt">facet_by       =</span> <span class="kw">vars</span>(parameter, fcst_cycle),</span>
<span id="cb106-5"><a href="#cb106-5"></a>  <span class="dt">num_facet_cols =</span> <span class="dv">4</span></span>
<span id="cb106-6"><a href="#cb106-6"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
</div>
<div id="saving-the-verification-data" class="section level4">
<h4><span class="header-section-number">0.5.13.2</span> Saving the verification data</h4>
<p>You can save your verification data with the function <code>save_point_verif</code>. You simply give it the data and the directory you want to save in. The filenames are generated from the data, so although you can provide a template, it is best not to.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">save_point_verif</span>(verif_t2m, <span class="dt">verif_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/verification&quot;</span>))</span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="kw">save_point_verif</span>(verif_s10m, <span class="dt">verif_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/verification&quot;</span>))</span></code></pre></div>
<p>Once the data are saved you can use a browser based app to view and interact with the data. This app is created in the R package <code>shiny</code>, so to launch it you run the function <code>shiny_plot_point_verif</code> and give it the starting directory to look for data.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="kw">shiny_plot_point_verif</span>(<span class="kw">here</span>(<span class="st">&quot;data/verification&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
<div id="to-be-added" class="section level2">
<h2><span class="header-section-number">0.6</span> TO BE ADDED</h2>
<ul>
<li>vertical profiles</li>
<li>verification of vertical profiles</li>
<li>plot vertical verification</li>
<li>jitter forecast</li>
<li>conditional verification</li>
<li>joint probabilities (maybe)</li>
<li>bootstrapping</li>
<li>pooled bootstrapping</li>
</ul>

</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
