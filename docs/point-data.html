<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Point Data | harp Tutorial</title>
  <meta name="description" content="This will form the harp tutorial / book." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Point Data | harp Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This will form the harp tutorial / book." />
  <meta name="github-repo" content="harphub/harpTutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Point Data | harp Tutorial" />
  
  <meta name="twitter:description" content="This will form the harp tutorial / book." />
  

<meta name="author" content="Andrew Singleton" />


<meta name="date" content="2020-08-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="convert-observations-to-sqlite.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#system-requirements"><i class="fa fa-check"></i><b>1.1</b> System Requirements</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#r"><i class="fa fa-check"></i><b>1.1.1</b> R</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#system-libraries"><i class="fa fa-check"></i><b>1.1.2</b> System libraries</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#rstudio"><i class="fa fa-check"></i><b>1.1.3</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#setting-up-a-project"><i class="fa fa-check"></i><b>1.3</b> Setting up a project</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#rstudio-1"><i class="fa fa-check"></i><b>1.3.1</b> RStudio</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#from-the-terminal"><i class="fa fa-check"></i><b>1.3.2</b> From the terminal</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#linking-to-the-data"><i class="fa fa-check"></i><b>1.3.3</b> Linking to the data</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#learning-r"><i class="fa fa-check"></i><b>1.4</b> Learning R</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#isolating-harp"><i class="fa fa-check"></i><b>1.5</b> Isolating harp</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="interpolating-model-outputs.html"><a href="interpolating-model-outputs.html"><i class="fa fa-check"></i><b>2</b> Interpolating model outputs</a><ul>
<li class="chapter" data-level="2.1" data-path="interpolating-model-outputs.html"><a href="interpolating-model-outputs.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="interpolating-model-outputs.html"><a href="interpolating-model-outputs.html#file-templates"><i class="fa fa-check"></i><b>2.2</b> File templates</a></li>
<li class="chapter" data-level="2.3" data-path="interpolating-model-outputs.html"><a href="interpolating-model-outputs.html#deterministic-forecast-data"><i class="fa fa-check"></i><b>2.3</b> Deterministic forecast data</a></li>
<li class="chapter" data-level="2.4" data-path="interpolating-model-outputs.html"><a href="interpolating-model-outputs.html#ensemble-forecast-data"><i class="fa fa-check"></i><b>2.4</b> Ensemble forecast data</a><ul>
<li class="chapter" data-level="2.4.1" data-path="interpolating-model-outputs.html"><a href="interpolating-model-outputs.html#read-and-interpolate-2m-temperature"><i class="fa fa-check"></i><b>2.4.1</b> Read and interpolate 2m temperature</a></li>
<li class="chapter" data-level="2.4.2" data-path="interpolating-model-outputs.html"><a href="interpolating-model-outputs.html#lagged-ensembles"><i class="fa fa-check"></i><b>2.4.2</b> Lagged ensembles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="convert-observations-to-sqlite.html"><a href="convert-observations-to-sqlite.html"><i class="fa fa-check"></i><b>3</b> Convert observations to SQLite</a><ul>
<li class="chapter" data-level="3.1" data-path="convert-observations-to-sqlite.html"><a href="convert-observations-to-sqlite.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="convert-observations-to-sqlite.html"><a href="convert-observations-to-sqlite.html#converting-observations-to-sqlite"><i class="fa fa-check"></i><b>3.2</b> Converting observations to SQLite</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="point-data.html"><a href="point-data.html"><i class="fa fa-check"></i><b>4</b> Point Data</a><ul>
<li class="chapter" data-level="4.1" data-path="point-data.html"><a href="point-data.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="point-data.html"><a href="point-data.html#deterministic-data"><i class="fa fa-check"></i><b>4.2</b> Deterministic data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="point-data.html"><a href="point-data.html#verifying-deterministic-forecasts"><i class="fa fa-check"></i><b>4.2.1</b> Verifying deterministic forecasts</a></li>
<li class="chapter" data-level="4.2.2" data-path="point-data.html"><a href="point-data.html#verification-by-group"><i class="fa fa-check"></i><b>4.2.2</b> Verification by group</a></li>
<li class="chapter" data-level="4.2.3" data-path="point-data.html"><a href="point-data.html#vertical-profiles"><i class="fa fa-check"></i><b>4.2.3</b> Vertical profiles</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="point-data.html"><a href="point-data.html#reading-in-ensemble-data"><i class="fa fa-check"></i><b>4.3</b> Reading in ensemble data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="point-data.html"><a href="point-data.html#multi-model-ensembles"><i class="fa fa-check"></i><b>4.3.1</b> Multi model ensembles</a></li>
<li class="chapter" data-level="4.3.2" data-path="point-data.html"><a href="point-data.html#lagged-ensembles-1"><i class="fa fa-check"></i><b>4.3.2</b> Lagged ensembles</a></li>
<li class="chapter" data-level="4.3.3" data-path="point-data.html"><a href="point-data.html#shifted-forecasts"><i class="fa fa-check"></i><b>4.3.3</b> Shifted forecasts</a></li>
<li class="chapter" data-level="4.3.4" data-path="point-data.html"><a href="point-data.html#verification"><i class="fa fa-check"></i><b>4.3.4</b> Verification</a></li>
<li class="chapter" data-level="4.3.5" data-path="point-data.html"><a href="point-data.html#verification-by-groups"><i class="fa fa-check"></i><b>4.3.5</b> Verification by groups</a></li>
<li class="chapter" data-level="4.3.6" data-path="point-data.html"><a href="point-data.html#saving-the-verification-data"><i class="fa fa-check"></i><b>4.3.6</b> Saving the verification data</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="point-data.html"><a href="point-data.html#to-be-added"><i class="fa fa-check"></i><b>4.4</b> TO BE ADDED</a><ul>
<li class="chapter" data-level="4.4.1" data-path="point-data.html"><a href="point-data.html#vertical-profiles-1"><i class="fa fa-check"></i><b>4.4.1</b> vertical profiles</a></li>
<li class="chapter" data-level="4.4.2" data-path="point-data.html"><a href="point-data.html#verification-of-vertical-profiles"><i class="fa fa-check"></i><b>4.4.2</b> verification of vertical profiles</a></li>
<li class="chapter" data-level="4.4.3" data-path="point-data.html"><a href="point-data.html#plot-vertical-verification"><i class="fa fa-check"></i><b>4.4.3</b> plot vertical verification</a></li>
<li class="chapter" data-level="4.4.4" data-path="point-data.html"><a href="point-data.html#jitter-forecast"><i class="fa fa-check"></i><b>4.4.4</b> jitter forecast</a></li>
<li class="chapter" data-level="4.4.5" data-path="point-data.html"><a href="point-data.html#conditional-verification"><i class="fa fa-check"></i><b>4.4.5</b> conditional verification</a></li>
<li class="chapter" data-level="4.4.6" data-path="point-data.html"><a href="point-data.html#joint-probabilities-maybe"><i class="fa fa-check"></i><b>4.4.6</b> joint probabilities (maybe)</a></li>
<li class="chapter" data-level="4.4.7" data-path="point-data.html"><a href="point-data.html#bootstrapping"><i class="fa fa-check"></i><b>4.4.7</b> bootstrapping</a></li>
<li class="chapter" data-level="4.4.8" data-path="point-data.html"><a href="point-data.html#pooled-bootstrapping"><i class="fa fa-check"></i><b>4.4.8</b> pooled bootstrapping</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">harp Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="point-data" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Point Data</h1>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p>We now have all of our data prepared for harp and we are ready to work with. That work includes undertsanding how harp data are structured, how to plot forecast data, how to manipulate the data, and verification.</p>
<p>We’ll be making use of all of the harp packages in this section, so we can just attach the full set of harp packages (and as always tidyverse and here)</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="point-data.html#cb39-1"></a><span class="kw">library</span>(harp)</span>
<span id="cb39-2"><a href="point-data.html#cb39-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb39-3"><a href="point-data.html#cb39-3"></a><span class="kw">library</span>(here)</span></code></pre></div>
</div>
<div id="deterministic-data" class="section level2">
<h2><span class="header-section-number">4.2</span> Deterministic data</h2>
<p>Let’s start with our deterministic data from the AROME Arctic model and member 0 of MEPS. First we load the data into our environment with the function <code>read_point_forecast</code>. As with other functions, we need to tell the function the start and end dates that we want, the names of the models, the parameter, the frequency of the forecasts, the path to the data and whether it is deterministic or ensemble data.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="point-data.html#cb40-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb40-2"><a href="point-data.html#cb40-2"></a>  <span class="dt">start_date =</span> <span class="dv">2019021700</span>,</span>
<span id="cb40-3"><a href="point-data.html#cb40-3"></a>  <span class="dt">end_date   =</span> <span class="dv">2019021718</span>,</span>
<span id="cb40-4"><a href="point-data.html#cb40-4"></a>  <span class="dt">fcst_model =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb40-5"><a href="point-data.html#cb40-5"></a>  <span class="dt">fcst_type  =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb40-6"><a href="point-data.html#cb40-6"></a>  <span class="dt">parameter  =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb40-7"><a href="point-data.html#cb40-7"></a>  <span class="dt">by         =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb40-8"><a href="point-data.html#cb40-8"></a>  <span class="dt">file_path  =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>)</span>
<span id="cb40-9"><a href="point-data.html#cb40-9"></a>)</span>
<span id="cb40-10"><a href="point-data.html#cb40-10"></a>s10m</span></code></pre></div>
<pre><code>## ● AROME_Arctic_prod
## # A tibble: 17,612 x 10
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            63.9    NA S10m       1001 m/s  
##  2 1.55e9 00                0             1.4    NA S10m       1002 m/s  
##  3 1.55e9 00                0            24.9    NA S10m       1003 m/s  
##  4 1.55e9 00                0           162.     NA S10m       1004 m/s  
##  5 1.55e9 00                0            -2.7    NA S10m       1006 m/s  
##  6 1.55e9 00                0            21.6    NA S10m       1007 m/s  
##  7 1.55e9 00                0            67.2    NA S10m       1008 m/s  
##  8 1.55e9 00                0             1.2    NA S10m       1009 m/s  
##  9 1.55e9 00                0             3.3    NA S10m       1010 m/s  
## 10 1.55e9 00                0            20.7    NA S10m       1011 m/s  
## # … with 17,602 more rows, and 2 more variables: validdate &lt;int&gt;,
## #   AROME_Arctic_prod_det &lt;dbl&gt;
## 
## ● MEPS_prod
## # A tibble: 81,804 x 10
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s  
##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s  
##  3 1.55e9 00                0            29.1    NA S10m       1014 m/s  
##  4 1.55e9 00                0             2.6    NA S10m       1015 m/s  
##  5 1.55e9 00                0           152.     NA S10m       1018 m/s  
##  6 1.55e9 00                0            16.4    NA S10m       1021 m/s  
##  7 1.55e9 00                0            39.5    NA S10m       1022 m/s  
##  8 1.55e9 00                0            69.1    NA S10m       1023 m/s  
##  9 1.55e9 00                0             8.1    NA S10m       1025 m/s  
## 10 1.55e9 00                0             5.2    NA S10m       1026 m/s  
## # … with 81,794 more rows, and 2 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_det &lt;dbl&gt;</code></pre>
<p>You will see that data are in two data frames in a list. This list is actually an object of class harp_fcst. Many of the functions in harp only work on harp_fcst objects. Many of the dplyr methods also work on harp_fcst objects. The forecast data are in the last column with the suffix "_det".</p>
<p>Let’s take a look at some of the things you can do with harp_fcst objects. First <code>expand_data</code></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="point-data.html#cb42-1"></a><span class="kw">expand_date</span>(s10m, fcdate)</span></code></pre></div>
<pre><code>## ● AROME_Arctic_prod
## # A tibble: 17,612 x 15
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            63.9    NA S10m       1001 m/s  
##  2 1.55e9 00                0             1.4    NA S10m       1002 m/s  
##  3 1.55e9 00                0            24.9    NA S10m       1003 m/s  
##  4 1.55e9 00                0           162.     NA S10m       1004 m/s  
##  5 1.55e9 00                0            -2.7    NA S10m       1006 m/s  
##  6 1.55e9 00                0            21.6    NA S10m       1007 m/s  
##  7 1.55e9 00                0            67.2    NA S10m       1008 m/s  
##  8 1.55e9 00                0             1.2    NA S10m       1009 m/s  
##  9 1.55e9 00                0             3.3    NA S10m       1010 m/s  
## 10 1.55e9 00                0            20.7    NA S10m       1011 m/s  
## # … with 17,602 more rows, and 7 more variables: validdate &lt;int&gt;,
## #   AROME_Arctic_prod_det &lt;dbl&gt;, fc_year &lt;dbl&gt;, fc_month &lt;dbl&gt;, fc_day &lt;int&gt;,
## #   fc_hour &lt;int&gt;, fc_minute &lt;int&gt;
## 
## ● MEPS_prod
## # A tibble: 81,804 x 15
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s  
##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s  
##  3 1.55e9 00                0            29.1    NA S10m       1014 m/s  
##  4 1.55e9 00                0             2.6    NA S10m       1015 m/s  
##  5 1.55e9 00                0           152.     NA S10m       1018 m/s  
##  6 1.55e9 00                0            16.4    NA S10m       1021 m/s  
##  7 1.55e9 00                0            39.5    NA S10m       1022 m/s  
##  8 1.55e9 00                0            69.1    NA S10m       1023 m/s  
##  9 1.55e9 00                0             8.1    NA S10m       1025 m/s  
## 10 1.55e9 00                0             5.2    NA S10m       1026 m/s  
## # … with 81,794 more rows, and 7 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_det &lt;dbl&gt;, fc_year &lt;dbl&gt;, fc_month &lt;dbl&gt;, fc_day &lt;int&gt;,
## #   fc_hour &lt;int&gt;, fc_minute &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="point-data.html#cb44-1"></a><span class="kw">expand_date</span>(s10m, validdate)</span></code></pre></div>
<pre><code>## ● AROME_Arctic_prod
## # A tibble: 17,612 x 15
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            63.9    NA S10m       1001 m/s  
##  2 1.55e9 00                0             1.4    NA S10m       1002 m/s  
##  3 1.55e9 00                0            24.9    NA S10m       1003 m/s  
##  4 1.55e9 00                0           162.     NA S10m       1004 m/s  
##  5 1.55e9 00                0            -2.7    NA S10m       1006 m/s  
##  6 1.55e9 00                0            21.6    NA S10m       1007 m/s  
##  7 1.55e9 00                0            67.2    NA S10m       1008 m/s  
##  8 1.55e9 00                0             1.2    NA S10m       1009 m/s  
##  9 1.55e9 00                0             3.3    NA S10m       1010 m/s  
## 10 1.55e9 00                0            20.7    NA S10m       1011 m/s  
## # … with 17,602 more rows, and 7 more variables: validdate &lt;int&gt;,
## #   AROME_Arctic_prod_det &lt;dbl&gt;, valid_year &lt;dbl&gt;, valid_month &lt;dbl&gt;,
## #   valid_day &lt;int&gt;, valid_hour &lt;int&gt;, valid_minute &lt;int&gt;
## 
## ● MEPS_prod
## # A tibble: 81,804 x 15
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s  
##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s  
##  3 1.55e9 00                0            29.1    NA S10m       1014 m/s  
##  4 1.55e9 00                0             2.6    NA S10m       1015 m/s  
##  5 1.55e9 00                0           152.     NA S10m       1018 m/s  
##  6 1.55e9 00                0            16.4    NA S10m       1021 m/s  
##  7 1.55e9 00                0            39.5    NA S10m       1022 m/s  
##  8 1.55e9 00                0            69.1    NA S10m       1023 m/s  
##  9 1.55e9 00                0             8.1    NA S10m       1025 m/s  
## 10 1.55e9 00                0             5.2    NA S10m       1026 m/s  
## # … with 81,794 more rows, and 7 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_det &lt;dbl&gt;, valid_year &lt;dbl&gt;, valid_month &lt;dbl&gt;, valid_day &lt;int&gt;,
## #   valid_hour &lt;int&gt;, valid_minute &lt;int&gt;</code></pre>
<p>With the year, month, day, hour and minute now available, it’s easier to filter the data if you’d like. For example, if you just want the forecast wind speed at 15:00 UTC on 17 Feb 2019 for station ID 1010, which we is on Andøya, we could do something like</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="point-data.html#cb46-1"></a><span class="kw">expand_date</span>(s10m, validdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb46-2"><a href="point-data.html#cb46-2"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb46-3"><a href="point-data.html#cb46-3"></a>    SID         <span class="op">==</span><span class="st"> </span><span class="dv">1010</span>, </span>
<span id="cb46-4"><a href="point-data.html#cb46-4"></a>    valid_year  <span class="op">==</span><span class="st"> </span><span class="dv">2019</span>, </span>
<span id="cb46-5"><a href="point-data.html#cb46-5"></a>    valid_month <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, </span>
<span id="cb46-6"><a href="point-data.html#cb46-6"></a>    valid_day   <span class="op">==</span><span class="st"> </span><span class="dv">17</span>, </span>
<span id="cb46-7"><a href="point-data.html#cb46-7"></a>    valid_hour  <span class="op">==</span><span class="st"> </span><span class="dv">15</span></span>
<span id="cb46-8"><a href="point-data.html#cb46-8"></a>  )</span></code></pre></div>
<pre><code>## ● AROME_Arctic_prod
## # A tibble: 3 x 15
##   fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##    &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
## 1 1.55e9 00               15             3.3    NA S10m       1010 m/s  
## 2 1.55e9 06                9             3.3    NA S10m       1010 m/s  
## 3 1.55e9 12                3             3.3    NA S10m       1010 m/s  
## # … with 7 more variables: validdate &lt;int&gt;, AROME_Arctic_prod_det &lt;dbl&gt;,
## #   valid_year &lt;dbl&gt;, valid_month &lt;dbl&gt;, valid_day &lt;int&gt;, valid_hour &lt;int&gt;,
## #   valid_minute &lt;int&gt;
## 
## ● MEPS_prod
## # A tibble: 3 x 15
##   fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##    &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
## 1 1.55e9 00               15             4.1    NA S10m       1010 m/s  
## 2 1.55e9 06                9             4.1    NA S10m       1010 m/s  
## 3 1.55e9 12                3             4.1    NA S10m       1010 m/s  
## # … with 7 more variables: validdate &lt;int&gt;, MEPS_prod_det &lt;dbl&gt;,
## #   valid_year &lt;dbl&gt;, valid_month &lt;dbl&gt;, valid_day &lt;int&gt;, valid_hour &lt;int&gt;,
## #   valid_minute &lt;int&gt;</code></pre>
<p>Equally, we could just get the data for one forecast</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="point-data.html#cb48-1"></a><span class="kw">expand_date</span>(s10m, fcdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb48-2"><a href="point-data.html#cb48-2"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb48-3"><a href="point-data.html#cb48-3"></a>    SID      <span class="op">==</span><span class="st"> </span><span class="dv">1010</span>,</span>
<span id="cb48-4"><a href="point-data.html#cb48-4"></a>    fc_year  <span class="op">==</span><span class="st"> </span><span class="dv">2019</span>,</span>
<span id="cb48-5"><a href="point-data.html#cb48-5"></a>    fc_month <span class="op">==</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb48-6"><a href="point-data.html#cb48-6"></a>    fc_day   <span class="op">==</span><span class="st"> </span><span class="dv">17</span>,</span>
<span id="cb48-7"><a href="point-data.html#cb48-7"></a>    fc_hour  <span class="op">==</span><span class="st"> </span><span class="dv">12</span></span>
<span id="cb48-8"><a href="point-data.html#cb48-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb48-9"><a href="point-data.html#cb48-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate))</span></code></pre></div>
<pre><code>## ● AROME_Arctic_prod
## # A tibble: 17 x 15
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 12                0             3.3    NA S10m       1010 m/s  
##  2 1.55e9 12                3             3.3    NA S10m       1010 m/s  
##  3 1.55e9 12                6             3.3    NA S10m       1010 m/s  
##  4 1.55e9 12                9             3.3    NA S10m       1010 m/s  
##  5 1.55e9 12               12             3.3    NA S10m       1010 m/s  
##  6 1.55e9 12               15             3.3    NA S10m       1010 m/s  
##  7 1.55e9 12               18             3.3    NA S10m       1010 m/s  
##  8 1.55e9 12               21             3.3    NA S10m       1010 m/s  
##  9 1.55e9 12               24             3.3    NA S10m       1010 m/s  
## 10 1.55e9 12               27             3.3    NA S10m       1010 m/s  
## 11 1.55e9 12               30             3.3    NA S10m       1010 m/s  
## 12 1.55e9 12               33             3.3    NA S10m       1010 m/s  
## 13 1.55e9 12               36             3.3    NA S10m       1010 m/s  
## 14 1.55e9 12               39             3.3    NA S10m       1010 m/s  
## 15 1.55e9 12               42             3.3    NA S10m       1010 m/s  
## 16 1.55e9 12               45             3.3    NA S10m       1010 m/s  
## 17 1.55e9 12               48             3.3    NA S10m       1010 m/s  
## # … with 7 more variables: validdate &lt;dttm&gt;, AROME_Arctic_prod_det &lt;dbl&gt;,
## #   fc_year &lt;dbl&gt;, fc_month &lt;dbl&gt;, fc_day &lt;int&gt;, fc_hour &lt;int&gt;, fc_minute &lt;int&gt;
## 
## ● MEPS_prod
## # A tibble: 17 x 15
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 12                0             4.1    NA S10m       1010 m/s  
##  2 1.55e9 12                3             4.1    NA S10m       1010 m/s  
##  3 1.55e9 12                6             4.1    NA S10m       1010 m/s  
##  4 1.55e9 12                9             4.1    NA S10m       1010 m/s  
##  5 1.55e9 12               12             4.1    NA S10m       1010 m/s  
##  6 1.55e9 12               15             4.1    NA S10m       1010 m/s  
##  7 1.55e9 12               18             4.1    NA S10m       1010 m/s  
##  8 1.55e9 12               21             4.1    NA S10m       1010 m/s  
##  9 1.55e9 12               24             4.1    NA S10m       1010 m/s  
## 10 1.55e9 12               27             4.1    NA S10m       1010 m/s  
## 11 1.55e9 12               30             4.1    NA S10m       1010 m/s  
## 12 1.55e9 12               33             4.1    NA S10m       1010 m/s  
## 13 1.55e9 12               36             4.1    NA S10m       1010 m/s  
## 14 1.55e9 12               39             4.1    NA S10m       1010 m/s  
## 15 1.55e9 12               42             4.1    NA S10m       1010 m/s  
## 16 1.55e9 12               45             4.1    NA S10m       1010 m/s  
## 17 1.55e9 12               48             4.1    NA S10m       1010 m/s  
## # … with 7 more variables: validdate &lt;dttm&gt;, MEPS_prod_det &lt;dbl&gt;,
## #   fc_year &lt;dbl&gt;, fc_month &lt;dbl&gt;, fc_day &lt;int&gt;, fc_hour &lt;int&gt;, fc_minute &lt;int&gt;</code></pre>
<p>harp doesn’t yet include any functions for plotting deterministic forecasts, but we can easily make the data into a single data frame using <code>bind_fcst</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="point-data.html#cb50-1"></a><span class="kw">bind_rows</span>(</span>
<span id="cb50-2"><a href="point-data.html#cb50-2"></a>  <span class="dt">AROME_Arctic_prod =</span> <span class="kw">rename</span>(s10m<span class="op">$</span>AROME_Arctic_prod, <span class="dt">forecast =</span> AROME_Arctic_prod_det),</span>
<span id="cb50-3"><a href="point-data.html#cb50-3"></a>  <span class="dt">MEPS_prod         =</span> <span class="kw">rename</span>(s10m<span class="op">$</span>MEPS_prod, <span class="dt">forecast =</span> MEPS_prod_det),</span>
<span id="cb50-4"><a href="point-data.html#cb50-4"></a>  <span class="dt">.id =</span> <span class="st">&quot;mname&quot;</span></span>
<span id="cb50-5"><a href="point-data.html#cb50-5"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 99,416 x 11
##    mname fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##    &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 AROM… 1.55e9 00                0            63.9    NA S10m       1001 m/s  
##  2 AROM… 1.55e9 00                0             1.4    NA S10m       1002 m/s  
##  3 AROM… 1.55e9 00                0            24.9    NA S10m       1003 m/s  
##  4 AROM… 1.55e9 00                0           162.     NA S10m       1004 m/s  
##  5 AROM… 1.55e9 00                0            -2.7    NA S10m       1006 m/s  
##  6 AROM… 1.55e9 00                0            21.6    NA S10m       1007 m/s  
##  7 AROM… 1.55e9 00                0            67.2    NA S10m       1008 m/s  
##  8 AROM… 1.55e9 00                0             1.2    NA S10m       1009 m/s  
##  9 AROM… 1.55e9 00                0             3.3    NA S10m       1010 m/s  
## 10 AROM… 1.55e9 00                0            20.7    NA S10m       1011 m/s  
## # … with 99,406 more rows, and 2 more variables: validdate &lt;int&gt;,
## #   forecast &lt;dbl&gt;</code></pre>
<p>You will also find in R directory a function, <code>bind_fcst</code> that does this binding for you - this function will be part of harp soon.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="point-data.html#cb52-1"></a><span class="kw">bind_fcst</span>(s10m)</span></code></pre></div>
<pre><code>## # A tibble: 99,416 x 11
##    mname fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##    &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 AROM… 1.55e9 00                0            63.9    NA S10m       1001 m/s  
##  2 AROM… 1.55e9 00                0             1.4    NA S10m       1002 m/s  
##  3 AROM… 1.55e9 00                0            24.9    NA S10m       1003 m/s  
##  4 AROM… 1.55e9 00                0           162.     NA S10m       1004 m/s  
##  5 AROM… 1.55e9 00                0            -2.7    NA S10m       1006 m/s  
##  6 AROM… 1.55e9 00                0            21.6    NA S10m       1007 m/s  
##  7 AROM… 1.55e9 00                0            67.2    NA S10m       1008 m/s  
##  8 AROM… 1.55e9 00                0             1.2    NA S10m       1009 m/s  
##  9 AROM… 1.55e9 00                0             3.3    NA S10m       1010 m/s  
## 10 AROM… 1.55e9 00                0            20.7    NA S10m       1011 m/s  
## # … with 99,406 more rows, and 2 more variables: validdate &lt;int&gt;,
## #   forecast &lt;dbl&gt;</code></pre>
<p>Your turn:</p>
<ul>
<li>Plot the the forecast wind speed at REIPA for both AROME_Arctic_prod and MEPS_prod for each fcst_cycle as a function of validdate. [You can get the SID for REIPA from the built in list of stations which is in the variable station_list]</li>
</ul>
<p>Solution:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="point-data.html#cb54-1"></a>reipa_sid &lt;-<span class="st"> </span><span class="kw">filter</span>(station_list, name <span class="op">==</span><span class="st"> &quot;REIPA&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-2"><a href="point-data.html#cb54-2"></a><span class="st">  </span><span class="kw">pull</span>(SID)</span>
<span id="cb54-3"><a href="point-data.html#cb54-3"></a><span class="kw">bind_fcst</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-4"><a href="point-data.html#cb54-4"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span>reipa_sid) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-5"><a href="point-data.html#cb54-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-6"><a href="point-data.html#cb54-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(validdate, forecast, <span class="dt">colour =</span> fcst_cycle)) <span class="op">+</span></span>
<span id="cb54-7"><a href="point-data.html#cb54-7"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb54-8"><a href="point-data.html#cb54-8"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(mname), <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb54-9"><a href="point-data.html#cb54-9"></a><span class="st">    </span><span class="kw">scale_x_datetime</span>(</span>
<span id="cb54-10"><a href="point-data.html#cb54-10"></a>      <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">ymd_hm</span>(<span class="kw">seq_dates</span>(<span class="dv">2019021706</span>, <span class="dv">2019021918</span>, <span class="st">&quot;12h&quot;</span>))</span>
<span id="cb54-11"><a href="point-data.html#cb54-11"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb54-12"><a href="point-data.html#cb54-12"></a><span class="st">    </span><span class="kw">labs</span>(</span>
<span id="cb54-13"><a href="point-data.html#cb54-13"></a>      <span class="dt">x      =</span> <span class="st">&quot;Date-time&quot;</span>,</span>
<span id="cb54-14"><a href="point-data.html#cb54-14"></a>      <span class="dt">y      =</span> <span class="kw">bquote</span>(<span class="st">&quot;Wind speed [ms&quot;</span><span class="op">^-</span><span class="dv">1</span><span class="op">*</span><span class="st">&quot;]&quot;</span>),</span>
<span id="cb54-15"><a href="point-data.html#cb54-15"></a>      <span class="dt">colour =</span> <span class="st">&quot;Forecast cycle&quot;</span>,</span>
<span id="cb54-16"><a href="point-data.html#cb54-16"></a>      <span class="dt">title  =</span> <span class="st">&quot;Forecast Wind Speed at REIPA&quot;</span></span>
<span id="cb54-17"><a href="point-data.html#cb54-17"></a>    ) <span class="op">+</span></span>
<span id="cb54-18"><a href="point-data.html#cb54-18"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb54-19"><a href="point-data.html#cb54-19"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-27-1.png" width="912" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="point-data.html#cb55-1"></a><span class="kw">bind_fcst</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-2"><a href="point-data.html#cb55-2"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span>reipa_sid) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-3"><a href="point-data.html#cb55-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-4"><a href="point-data.html#cb55-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(validdate, forecast, <span class="dt">colour =</span> mname)) <span class="op">+</span></span>
<span id="cb55-5"><a href="point-data.html#cb55-5"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb55-6"><a href="point-data.html#cb55-6"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(fcst_cycle), <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb55-7"><a href="point-data.html#cb55-7"></a><span class="st">    </span><span class="kw">scale_x_datetime</span>(</span>
<span id="cb55-8"><a href="point-data.html#cb55-8"></a>      <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">ymd_hm</span>(<span class="kw">seq_dates</span>(<span class="dv">2019021706</span>, <span class="dv">2019021918</span>, <span class="st">&quot;12h&quot;</span>))</span>
<span id="cb55-9"><a href="point-data.html#cb55-9"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb55-10"><a href="point-data.html#cb55-10"></a><span class="st">    </span><span class="kw">labs</span>(</span>
<span id="cb55-11"><a href="point-data.html#cb55-11"></a>      <span class="dt">x      =</span> <span class="st">&quot;Date-time&quot;</span>,</span>
<span id="cb55-12"><a href="point-data.html#cb55-12"></a>      <span class="dt">y      =</span> <span class="kw">bquote</span>(<span class="st">&quot;Wind speed [ms&quot;</span><span class="op">^-</span><span class="dv">1</span><span class="op">*</span><span class="st">&quot;]&quot;</span>),</span>
<span id="cb55-13"><a href="point-data.html#cb55-13"></a>      <span class="dt">colour =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb55-14"><a href="point-data.html#cb55-14"></a>      <span class="dt">title  =</span> <span class="st">&quot;Forecast Wind Speed at REIPA&quot;</span></span>
<span id="cb55-15"><a href="point-data.html#cb55-15"></a>    ) <span class="op">+</span></span>
<span id="cb55-16"><a href="point-data.html#cb55-16"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb55-17"><a href="point-data.html#cb55-17"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-27-2.png" width="912" /></p>
<p>Now let’s read in some observations. To make sure we get the correct dates for the observations we can get the first and last validdates from the forecast. We could also extract the station IDs from the forecasts - which we can do with a little bit of “functional programming”.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="point-data.html#cb56-1"></a>station_ids &lt;-<span class="st"> </span><span class="kw">map</span>(s10m, pull, SID) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb56-2"><a href="point-data.html#cb56-2"></a><span class="st">  </span><span class="kw">reduce</span>(union)</span>
<span id="cb56-3"><a href="point-data.html#cb56-3"></a>obs &lt;-<span class="st"> </span><span class="kw">read_point_obs</span>(</span>
<span id="cb56-4"><a href="point-data.html#cb56-4"></a>  <span class="dt">start_date =</span> <span class="kw">first_validdate</span>(s10m),</span>
<span id="cb56-5"><a href="point-data.html#cb56-5"></a>  <span class="dt">end_date   =</span> <span class="kw">last_validdate</span>(s10m),</span>
<span id="cb56-6"><a href="point-data.html#cb56-6"></a>  <span class="dt">stations   =</span> station_ids,</span>
<span id="cb56-7"><a href="point-data.html#cb56-7"></a>  <span class="dt">parameter  =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb56-8"><a href="point-data.html#cb56-8"></a>  <span class="dt">obs_path   =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>) </span>
<span id="cb56-9"><a href="point-data.html#cb56-9"></a>)</span></code></pre></div>
<p>Now that we have the observations we can join them to our forecast data using the function <code>join_to_fcst</code>. This will take each of the data frames in our forecast list and perform an inner join with the observations - that means that only rows that are common to both data frames are kept.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="point-data.html#cb57-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(s10m, obs)</span></code></pre></div>
<p>We have now added an observations column to each of the forecasts, so we could also include the observations in our plots.</p>
<p>Your turn:</p>
<ul>
<li>Add observations as a geom_point to your plots. [hint: you can map an aesthetic to an individual geom]</li>
</ul>
<p>Solution:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="point-data.html#cb58-1"></a><span class="kw">bind_fcst</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-2"><a href="point-data.html#cb58-2"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span>reipa_sid) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-3"><a href="point-data.html#cb58-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-4"><a href="point-data.html#cb58-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(validdate, forecast, <span class="dt">colour =</span> mname)) <span class="op">+</span></span>
<span id="cb58-5"><a href="point-data.html#cb58-5"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb58-6"><a href="point-data.html#cb58-6"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> S10m, <span class="dt">shape =</span> <span class="st">&quot;Observation&quot;</span>), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb58-7"><a href="point-data.html#cb58-7"></a><span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb58-8"><a href="point-data.html#cb58-8"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(fcst_cycle), <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb58-9"><a href="point-data.html#cb58-9"></a><span class="st">    </span><span class="kw">scale_x_datetime</span>(</span>
<span id="cb58-10"><a href="point-data.html#cb58-10"></a>      <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">ymd_hm</span>(<span class="kw">seq_dates</span>(<span class="dv">2019021706</span>, <span class="dv">2019021918</span>, <span class="st">&quot;12h&quot;</span>))</span>
<span id="cb58-11"><a href="point-data.html#cb58-11"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb58-12"><a href="point-data.html#cb58-12"></a><span class="st">    </span><span class="kw">labs</span>(</span>
<span id="cb58-13"><a href="point-data.html#cb58-13"></a>      <span class="dt">x      =</span> <span class="st">&quot;Date-time&quot;</span>,</span>
<span id="cb58-14"><a href="point-data.html#cb58-14"></a>      <span class="dt">y      =</span> <span class="kw">bquote</span>(<span class="st">&quot;Wind speed [ms&quot;</span><span class="op">^-</span><span class="dv">1</span><span class="op">*</span><span class="st">&quot;]&quot;</span>),</span>
<span id="cb58-15"><a href="point-data.html#cb58-15"></a>      <span class="dt">colour =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb58-16"><a href="point-data.html#cb58-16"></a>      <span class="dt">title  =</span> <span class="st">&quot;Forecast Wind Speed at REIPA&quot;</span>,</span>
<span id="cb58-17"><a href="point-data.html#cb58-17"></a>      <span class="dt">shape  =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb58-18"><a href="point-data.html#cb58-18"></a>    ) <span class="op">+</span></span>
<span id="cb58-19"><a href="point-data.html#cb58-19"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb58-20"><a href="point-data.html#cb58-20"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-30-1.png" width="912" /></p>
<div id="verifying-deterministic-forecasts" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Verifying deterministic forecasts</h3>
<p>Now that we have both forecasts and observations we can verify the forecasts. This is very simple in harp - we just run the function <code>det_verify</code> giving that data and telling it which column has the observations:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="point-data.html#cb59-1"></a><span class="kw">det_verify</span>(s10m, S10m)</span></code></pre></div>
<pre><code>## $det_summary_scores
## # A tibble: 34 x 7
##    mname             leadtime num_cases   bias  rmse   mae  stde
##    &lt;chr&gt;                &lt;int&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 AROME_Arctic_prod        0       629 0.137   2.57  1.80  2.57
##  2 AROME_Arctic_prod        3       679 0.0580  2.34  1.60  2.34
##  3 AROME_Arctic_prod        6       622 0.0390  2.38  1.65  2.38
##  4 AROME_Arctic_prod        9       679 0.0942  2.08  1.42  2.08
##  5 AROME_Arctic_prod       12       628 0.169   2.24  1.53  2.24
##  6 AROME_Arctic_prod       15       675 0.295   2.17  1.53  2.15
##  7 AROME_Arctic_prod       18       630 0.319   2.22  1.53  2.20
##  8 AROME_Arctic_prod       21       676 0.480   2.23  1.61  2.17
##  9 AROME_Arctic_prod       24       628 0.388   2.34  1.61  2.31
## 10 AROME_Arctic_prod       27       674 0.538   2.39  1.69  2.33
## # … with 24 more rows
## 
## $det_threshold_scores
## data frame with 0 columns and 0 rows
## 
## attr(,&quot;parameter&quot;)
## [1] &quot;S10m&quot;
## attr(,&quot;start_date&quot;)
## [1] &quot;2019021700&quot;
## attr(,&quot;end_date&quot;)
## [1] &quot;2019021718&quot;
## attr(,&quot;num_stations&quot;)
## [1] 828</code></pre>
<p>You will see that the output is a list of two data frames - one fore summary scores and one for threshold scores. The threshold scores data frame contains only missing data as we didn’t give the function any thresholds to verify for. However, that is easily done:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="point-data.html#cb61-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">det_verify</span>(s10m, S10m, <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="fl">2.5</span>, <span class="fl">12.5</span>, <span class="fl">2.5</span>))</span>
<span id="cb61-2"><a href="point-data.html#cb61-2"></a>verif_s10m</span></code></pre></div>
<pre><code>## $det_summary_scores
## # A tibble: 34 x 7
##    mname             leadtime num_cases   bias  rmse   mae  stde
##    &lt;chr&gt;                &lt;int&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 AROME_Arctic_prod        0       629 0.137   2.57  1.80  2.57
##  2 AROME_Arctic_prod        3       679 0.0580  2.34  1.60  2.34
##  3 AROME_Arctic_prod        6       622 0.0390  2.38  1.65  2.38
##  4 AROME_Arctic_prod        9       679 0.0942  2.08  1.42  2.08
##  5 AROME_Arctic_prod       12       628 0.169   2.24  1.53  2.24
##  6 AROME_Arctic_prod       15       675 0.295   2.17  1.53  2.15
##  7 AROME_Arctic_prod       18       630 0.319   2.22  1.53  2.20
##  8 AROME_Arctic_prod       21       676 0.480   2.23  1.61  2.17
##  9 AROME_Arctic_prod       24       628 0.388   2.34  1.61  2.31
## 10 AROME_Arctic_prod       27       674 0.538   2.39  1.69  2.33
## # … with 24 more rows
## 
## $det_threshold_scores
## # A tibble: 170 x 40
##    mname leadtime threshold num_cases_for_t… num_cases_for_t… num_cases_for_t…
##    &lt;chr&gt;    &lt;int&gt;     &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 AROM…        0       2.5              461              418              421
##  2 AROM…        3       2.5              482              418              436
##  3 AROM…        6       2.5              410              348              358
##  4 AROM…        9       2.5              449              365              403
##  5 AROM…       12       2.5              410              328              363
##  6 AROM…       15       2.5              459              358              422
##  7 AROM…       18       2.5              437              338              389
##  8 AROM…       21       2.5              497              374              466
##  9 AROM…       24       2.5              452              348              413
## 10 AROM…       27       2.5              496              374              471
## # … with 160 more rows, and 34 more variables: cont_tab &lt;list&gt;,
## #   threat_score &lt;dbl&gt;, hit_rate &lt;dbl&gt;, miss_rate &lt;dbl&gt;,
## #   false_alarm_rate &lt;dbl&gt;, false_alarm_ratio &lt;dbl&gt;, heidke_skill_score &lt;dbl&gt;,
## #   pierce_skill_score &lt;dbl&gt;, kuiper_skill_score &lt;dbl&gt;, percent_correct &lt;dbl&gt;,
## #   frequency_bias &lt;dbl&gt;, equitable_threat_score &lt;dbl&gt;, odds_ratio &lt;dbl&gt;,
## #   log_odds_ratio &lt;dbl&gt;, odds_ratio_skill_score &lt;dbl&gt;,
## #   extreme_dependency_score &lt;dbl&gt;, symmetric_eds &lt;dbl&gt;,
## #   extreme_dependency_index &lt;dbl&gt;, symmetric_edi &lt;dbl&gt;,
## #   threat_score_std_error &lt;dbl&gt;, hit_rate_std_error &lt;dbl&gt;,
## #   false_alarm_rate_std_error &lt;dbl&gt;, false_alarm_ratio_std_error &lt;dbl&gt;,
## #   heidke_skill_score_std_error &lt;dbl&gt;, pierce_skill_score_std_error &lt;dbl&gt;,
## #   percent_correct_std_error &lt;dbl&gt;, equitable_threat_score_std_error &lt;dbl&gt;,
## #   log_odds_ratio_std_error &lt;dbl&gt;, log_odds_ratio_degrees_of_freedom &lt;dbl&gt;,
## #   odds_ratio_skill_score_std_error &lt;dbl&gt;,
## #   extreme_dependency_score_std_error &lt;dbl&gt;, symmetric_eds_std_error &lt;dbl&gt;,
## #   extreme_dependency_index_std_error &lt;dbl&gt;, symmetric_edi_std_error &lt;dbl&gt;
## 
## attr(,&quot;parameter&quot;)
## [1] &quot;S10m&quot;
## attr(,&quot;start_date&quot;)
## [1] &quot;2019021700&quot;
## attr(,&quot;end_date&quot;)
## [1] &quot;2019021718&quot;
## attr(,&quot;num_stations&quot;)
## [1] 828</code></pre>
<p>As you can see, a very large number of scores are computed. harp has a function for plotting point verification scores, <code>plot_point_verif</code>. For summary scores, you just need to give it the verification data and tell it which score you’d like to plot, as well as tell the function that it is deterministic verification data.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="point-data.html#cb63-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, bias, <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>One thing you’ll immediately notice is that the number of cases for MEPS_prod is much larger than for AROME_Arctic_prod. This means that in this verification we are not making a fair comparison - we should actually only be verifying the dates and locations that are common to both systems. harp provides the function <code>common_cases()</code> to do just that!</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="point-data.html#cb64-1"></a><span class="kw">common_cases</span>(s10m)</span></code></pre></div>
<pre><code>## ● AROME_Arctic_prod
## # A tibble: 10,170 x 14
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            63.9    NA S10m       1001 m/s  
##  2 1.55e9 00                0             3.3    NA S10m       1010 m/s  
##  3 1.55e9 00                0             0.5    NA S10m       1015 m/s  
##  4 1.55e9 00                0           169.     NA S10m       1018 m/s  
##  5 1.55e9 00                0            73.5    NA S10m       1023 m/s  
##  6 1.55e9 00                0            22.2    NA S10m       1025 m/s  
##  7 1.55e9 00                0            14.4    NA S10m       1026 m/s  
##  8 1.55e9 00                0            -2.6    NA S10m       1033 m/s  
##  9 1.55e9 00                0           125.     NA S10m       1036 m/s  
## 10 1.55e9 00                0           160.     NA S10m       1037 m/s  
## # … with 10,160 more rows, and 6 more variables: validdate &lt;int&gt;,
## #   AROME_Arctic_prod_det &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, S10m &lt;dbl&gt;
## 
## ● MEPS_prod
## # A tibble: 10,170 x 14
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s  
##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s  
##  3 1.55e9 00                0             2.6    NA S10m       1015 m/s  
##  4 1.55e9 00                0           152.     NA S10m       1018 m/s  
##  5 1.55e9 00                0            69.1    NA S10m       1023 m/s  
##  6 1.55e9 00                0             8.1    NA S10m       1025 m/s  
##  7 1.55e9 00                0             5.2    NA S10m       1026 m/s  
##  8 1.55e9 00                0            28.5    NA S10m       1033 m/s  
##  9 1.55e9 00                0           129      NA S10m       1036 m/s  
## 10 1.55e9 00                0            94.5    NA S10m       1037 m/s  
## # … with 10,160 more rows, and 6 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_det &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, S10m &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="point-data.html#cb66-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">common_cases</span>(s10m)</span></code></pre></div>
<p>You will see that now both AROME_Arctic_prod and MEPS_prod have the exact same number of rows in their data. Now if we run the verfication again and plot the same score we will see that both forecasting systems have the same number of cases.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="point-data.html#cb67-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">det_verify</span>(s10m, S10m, <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="fl">2.5</span>, <span class="fl">12.5</span>, <span class="fl">2.5</span>))</span>
<span id="cb67-2"><a href="point-data.html#cb67-2"></a><span class="kw">plot_point_verif</span>(verif_s10m, bias, <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Try plotting one of the threshold scores (frequency_bias, for example). Try to figure out wht the plot looks so weird</li>
</ul>
<p>Solution:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="point-data.html#cb68-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, frequency_bias, <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>The plot looks weird becasue it’s attempting to plot scores for all thresholds at the same time.</p>
<p>When we have more than one threshold, we need to tell <code>plot_point_verif</code> what to do - there are 2 options - to facet or to filter, with the arguments <code>facet_by</code> or <code>filter_by</code>. These arguments work in pretty much the same way as <code>facet_wrap</code>. For example if we wanted the facet the scores by threshold, we would do</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="point-data.html#cb69-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb69-2"><a href="point-data.html#cb69-2"></a>  verif_s10m, </span>
<span id="cb69-3"><a href="point-data.html#cb69-3"></a>  frequency_bias, </span>
<span id="cb69-4"><a href="point-data.html#cb69-4"></a>  <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb69-5"><a href="point-data.html#cb69-5"></a>  <span class="dt">facet_by   =</span> <span class="kw">vars</span>(threshold)</span>
<span id="cb69-6"><a href="point-data.html#cb69-6"></a>) </span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Or, if we just wanted the plot for a threshold of 7.5 ms<sup>-1</sup>, we would use <code>filter_by</code></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="point-data.html#cb70-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb70-2"><a href="point-data.html#cb70-2"></a>  verif_s10m, </span>
<span id="cb70-3"><a href="point-data.html#cb70-3"></a>  frequency_bias, </span>
<span id="cb70-4"><a href="point-data.html#cb70-4"></a>  <span class="dt">verif_type =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb70-5"><a href="point-data.html#cb70-5"></a>  <span class="dt">filter_by  =</span> <span class="kw">vars</span>(threshold <span class="op">==</span><span class="st"> </span><span class="fl">7.5</span>)</span>
<span id="cb70-6"><a href="point-data.html#cb70-6"></a>) </span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
<div id="verification-by-group" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Verification by group</h3>
<p>The default behaviour of harp verification functions is to compute the verification metrics for each lead time. However, you can also compute the scores for any groups of data, much in the same way as <code>group_by</code> enables you to do. In this case groups are specified in the <code>groupings</code> argument to the verification function, and unlike <code>group_by</code> the column names you wish to use for grouping variables must be quoted (this may change in the future for consistency with <code>group_by</code>) and if there are more than one in a charcater vector. We could for example compute scores for each valid time:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="point-data.html#cb71-1"></a>(verif_s10m &lt;-<span class="st"> </span><span class="kw">det_verify</span>(s10m, S10m, <span class="dt">groupings =</span> <span class="st">&quot;validdate&quot;</span>))</span></code></pre></div>
<pre><code>## $det_summary_scores
## # A tibble: 46 x 7
##    mname              validdate num_cases    bias  rmse   mae  stde
##    &lt;chr&gt;                  &lt;int&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 AROME_Arctic_prod 1550361600       147  0.276   3.04  2.28  3.04
##  2 AROME_Arctic_prod 1550372400       155  0.121   2.90  2.11  2.91
##  3 AROME_Arctic_prod 1550383200       270  0.0203  2.68  1.81  2.68
##  4 AROME_Arctic_prod 1550394000       312 -0.295   1.95  1.35  1.93
##  5 AROME_Arctic_prod 1550404800       459 -0.235   2.07  1.44  2.06
##  6 AROME_Arctic_prod 1550415600       468 -0.112   1.95  1.26  1.95
##  7 AROME_Arctic_prod 1550426400       572 -0.0128  1.84  1.30  1.84
##  8 AROME_Arctic_prod 1550437200       628  0.192   2.05  1.39  2.05
##  9 AROME_Arctic_prod 1550448000       560 -0.0470  2.25  1.53  2.25
## 10 AROME_Arctic_prod 1550458800       620  0.126   2.04  1.45  2.03
## # … with 36 more rows
## 
## $det_threshold_scores
## data frame with 0 columns and 0 rows
## 
## attr(,&quot;parameter&quot;)
## [1] &quot;S10m&quot;
## attr(,&quot;start_date&quot;)
## [1] &quot;2019021700&quot;
## attr(,&quot;end_date&quot;)
## [1] &quot;2019021718&quot;
## attr(,&quot;num_stations&quot;)
## [1] 167</code></pre>
<p>To plot the score, we then need to tell plot_point_verif to use validdate as the x-axis (the default is lead time)</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="point-data.html#cb73-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, bias, <span class="dt">x_axis =</span> validdate)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>If you want to change the date into a readable format, you can use the <code>mutate_list</code> function.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="point-data.html#cb74-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb74-2"><a href="point-data.html#cb74-2"></a>  <span class="kw">mutate_list</span>(verif_s10m, <span class="dt">date_time =</span> <span class="kw">unix2datetime</span>(validdate)), </span>
<span id="cb74-3"><a href="point-data.html#cb74-3"></a>  bias, </span>
<span id="cb74-4"><a href="point-data.html#cb74-4"></a>  <span class="dt">x_axis =</span> date_time</span>
<span id="cb74-5"><a href="point-data.html#cb74-5"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Compute verification scores for stations with elevations <span class="math inline">\(\geqslant 300 m\)</span> and those <span class="math inline">\(\lt 300 m\)</span>. for each lead time and thresholds of 2.5 - 12.5 ms<sup>-1</sup> every 2.5 ms<sup>-1</sup>. To classify the station heights, you can use</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="point-data.html#cb75-1"></a>stations &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb75-2"><a href="point-data.html#cb75-2"></a>  station_list, </span>
<span id="cb75-3"><a href="point-data.html#cb75-3"></a>  <span class="dt">station_height =</span> <span class="kw">cut</span>(elev, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">300</span>, <span class="ot">Inf</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;lt_300m&quot;</span>, <span class="st">&quot;ge_300m&quot;</span>))</span>
<span id="cb75-4"><a href="point-data.html#cb75-4"></a>)</span>
<span id="cb75-5"><a href="point-data.html#cb75-5"></a>s10m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(s10m, stations, <span class="dt">force_join =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<ul>
<li>Plot the equitable threat score for each threshold and station height group.</li>
</ul>
<p>Solutions</p>
<ul>
<li>Compute verification scores for stations with elevations <span class="math inline">\(\geqslant 300 m\)</span> and those <span class="math inline">\(\lt 300 m\)</span>. for each lead time and thresholds of 2.5 - 12.5 ms<sup>-1</sup> every 2.5 ms<sup>-1</sup>.</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="point-data.html#cb76-1"></a>stations &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb76-2"><a href="point-data.html#cb76-2"></a>  station_list, </span>
<span id="cb76-3"><a href="point-data.html#cb76-3"></a>  <span class="dt">station_height =</span> <span class="kw">cut</span>(elev, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">300</span>, <span class="ot">Inf</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&gt; 300m&quot;</span>, <span class="st">&quot;&gt;= 300m&quot;</span>))</span>
<span id="cb76-4"><a href="point-data.html#cb76-4"></a>)</span>
<span id="cb76-5"><a href="point-data.html#cb76-5"></a>(verif_s10m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(s10m, stations, <span class="dt">force_join =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb76-6"><a href="point-data.html#cb76-6"></a><span class="st">  </span><span class="kw">det_verify</span>(S10m, <span class="dt">groupings =</span> <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;station_height&quot;</span>), <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="fl">2.5</span>, <span class="fl">12.5</span>, <span class="fl">2.5</span>)))</span></code></pre></div>
<pre><code>## $det_summary_scores
## # A tibble: 0 x 8
## # … with 8 variables: mname &lt;chr&gt;, leadtime &lt;int&gt;, station_height &lt;fct&gt;,
## #   num_cases &lt;int&gt;, bias &lt;dbl&gt;, rmse &lt;dbl&gt;, mae &lt;dbl&gt;, stde &lt;dbl&gt;
## 
## $det_threshold_scores
## # A tibble: 0 x 41
## # … with 41 variables: mname &lt;chr&gt;, leadtime &lt;int&gt;, station_height &lt;fct&gt;,
## #   threshold &lt;dbl&gt;, num_cases_for_threshold_total &lt;dbl&gt;,
## #   num_cases_for_threshold_observed &lt;dbl&gt;,
## #   num_cases_for_threshold_forecast &lt;dbl&gt;, cont_tab &lt;list&gt;,
## #   threat_score &lt;dbl&gt;, hit_rate &lt;dbl&gt;, miss_rate &lt;dbl&gt;,
## #   false_alarm_rate &lt;dbl&gt;, false_alarm_ratio &lt;dbl&gt;, heidke_skill_score &lt;dbl&gt;,
## #   pierce_skill_score &lt;dbl&gt;, kuiper_skill_score &lt;dbl&gt;, percent_correct &lt;dbl&gt;,
## #   frequency_bias &lt;dbl&gt;, equitable_threat_score &lt;dbl&gt;, odds_ratio &lt;dbl&gt;,
## #   log_odds_ratio &lt;dbl&gt;, odds_ratio_skill_score &lt;dbl&gt;,
## #   extreme_dependency_score &lt;dbl&gt;, symmetric_eds &lt;dbl&gt;,
## #   extreme_dependency_index &lt;dbl&gt;, symmetric_edi &lt;dbl&gt;,
## #   threat_score_std_error &lt;dbl&gt;, hit_rate_std_error &lt;dbl&gt;,
## #   false_alarm_rate_std_error &lt;dbl&gt;, false_alarm_ratio_std_error &lt;dbl&gt;,
## #   heidke_skill_score_std_error &lt;dbl&gt;, pierce_skill_score_std_error &lt;dbl&gt;,
## #   percent_correct_std_error &lt;dbl&gt;, equitable_threat_score_std_error &lt;dbl&gt;,
## #   log_odds_ratio_std_error &lt;dbl&gt;, log_odds_ratio_degrees_of_freedom &lt;dbl&gt;,
## #   odds_ratio_skill_score_std_error &lt;dbl&gt;,
## #   extreme_dependency_score_std_error &lt;dbl&gt;, symmetric_eds_std_error &lt;dbl&gt;,
## #   extreme_dependency_index_std_error &lt;dbl&gt;, symmetric_edi_std_error &lt;dbl&gt;
## 
## attr(,&quot;parameter&quot;)
## [1] &quot;S10m&quot;
## attr(,&quot;start_date&quot;)
## [1] &quot;NANANANA&quot;
## attr(,&quot;end_date&quot;)
## [1] &quot;NANANANA&quot;
## attr(,&quot;num_stations&quot;)
## [1] 0</code></pre>
<ul>
<li>Plot the equitable threat score for each threshold and station height group.</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="point-data.html#cb78-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb78-2"><a href="point-data.html#cb78-2"></a>  <span class="kw">mutate_list</span>(</span>
<span id="cb78-3"><a href="point-data.html#cb78-3"></a>    verif_s10m,</span>
<span id="cb78-4"><a href="point-data.html#cb78-4"></a>    <span class="dt">threshold =</span> <span class="kw">paste</span>(<span class="st">&quot;Wind speed &gt;=&quot;</span>, threshold, <span class="st">&quot;m/s&quot;</span>),</span>
<span id="cb78-5"><a href="point-data.html#cb78-5"></a>    <span class="dt">station_height =</span> <span class="kw">paste</span>(<span class="st">&quot;Station altitude&quot;</span>, station_height)</span>
<span id="cb78-6"><a href="point-data.html#cb78-6"></a>  ),</span>
<span id="cb78-7"><a href="point-data.html#cb78-7"></a>  equitable_threat_score,</span>
<span id="cb78-8"><a href="point-data.html#cb78-8"></a>  <span class="dt">facet_by =</span> <span class="kw">vars</span>(<span class="kw">fct_inorder</span>(threshold), station_height), </span>
<span id="cb78-9"><a href="point-data.html#cb78-9"></a>  <span class="dt">num_facet_cols =</span> <span class="dv">2</span></span>
<span id="cb78-10"><a href="point-data.html#cb78-10"></a>)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>Bearing in mind the <code>plot_point_verif</code> uses ggplot, you could also do the faceting yourself and have more control - for example, you coud use <code>facet_grid</code></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="point-data.html#cb80-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb80-2"><a href="point-data.html#cb80-2"></a>  <span class="kw">mutate_list</span>(</span>
<span id="cb80-3"><a href="point-data.html#cb80-3"></a>    verif_s10m,</span>
<span id="cb80-4"><a href="point-data.html#cb80-4"></a>    <span class="dt">threshold =</span> <span class="kw">paste</span>(<span class="st">&quot;S10m &gt;=&quot;</span>, threshold, <span class="st">&quot;m/s&quot;</span>),</span>
<span id="cb80-5"><a href="point-data.html#cb80-5"></a>    <span class="dt">station_height =</span> <span class="kw">paste</span>(<span class="st">&quot;Station altitude&quot;</span>, station_height)</span>
<span id="cb80-6"><a href="point-data.html#cb80-6"></a>  ),</span>
<span id="cb80-7"><a href="point-data.html#cb80-7"></a>  equitable_threat_score</span>
<span id="cb80-8"><a href="point-data.html#cb80-8"></a>) <span class="op">+</span></span>
<span id="cb80-9"><a href="point-data.html#cb80-9"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">cols =</span> <span class="kw">vars</span>(station_height), <span class="dt">rows =</span> <span class="kw">vars</span>(<span class="kw">fct_inorder</span>(threshold)))</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="vertical-profiles" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Vertical profiles</h3>
<p>When we converted our data to sqlite, we also converted some upper air data for temperature and dew point temperature. To read in upper air data, we need to tell <code>read_point_forecast</code> and <code>read_point_obs</code> what the vertical coordinate is.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="point-data.html#cb82-1"></a>(t_upper &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb82-2"><a href="point-data.html#cb82-2"></a>  <span class="dt">start_date          =</span> <span class="dv">2019021700</span>,</span>
<span id="cb82-3"><a href="point-data.html#cb82-3"></a>  <span class="dt">end_date            =</span> <span class="dv">2019021718</span>,</span>
<span id="cb82-4"><a href="point-data.html#cb82-4"></a>  <span class="dt">fcst_model          =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb82-5"><a href="point-data.html#cb82-5"></a>  <span class="dt">fcst_type           =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb82-6"><a href="point-data.html#cb82-6"></a>  <span class="dt">parameter           =</span> <span class="st">&quot;T&quot;</span>,</span>
<span id="cb82-7"><a href="point-data.html#cb82-7"></a>  <span class="dt">file_path           =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>),</span>
<span id="cb82-8"><a href="point-data.html#cb82-8"></a>  <span class="dt">vertical_coordinate =</span> <span class="st">&quot;pressure&quot;</span></span>
<span id="cb82-9"><a href="point-data.html#cb82-9"></a>))</span></code></pre></div>
<pre><code>## ● AROME_Arctic_prod
## # A tibble: 6,967 x 10
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            50.6    50 T          1001 K    
##  2 1.55e9 00                0            50.6   100 T          1001 K    
##  3 1.55e9 00                0            50.6   150 T          1001 K    
##  4 1.55e9 00                0            50.6   200 T          1001 K    
##  5 1.55e9 00                0            50.6   250 T          1001 K    
##  6 1.55e9 00                0            50.6   300 T          1001 K    
##  7 1.55e9 00                0            50.6   400 T          1001 K    
##  8 1.55e9 00                0            50.6   500 T          1001 K    
##  9 1.55e9 00                0            50.6   700 T          1001 K    
## 10 1.55e9 00                0            50.6   850 T          1001 K    
## # … with 6,957 more rows, and 2 more variables: validdate &lt;int&gt;,
## #   AROME_Arctic_prod_det &lt;dbl&gt;
## 
## ● MEPS_prod
## # A tibble: 29,956 x 10
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            55.6    50 T          1001 K    
##  2 1.55e9 00                0            55.6   100 T          1001 K    
##  3 1.55e9 00                0            55.6   150 T          1001 K    
##  4 1.55e9 00                0            55.6   200 T          1001 K    
##  5 1.55e9 00                0            55.6   250 T          1001 K    
##  6 1.55e9 00                0            55.6   300 T          1001 K    
##  7 1.55e9 00                0            55.6   400 T          1001 K    
##  8 1.55e9 00                0            55.6   500 T          1001 K    
##  9 1.55e9 00                0            55.6   700 T          1001 K    
## 10 1.55e9 00                0            55.6   850 T          1001 K    
## # … with 29,946 more rows, and 2 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_det &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="point-data.html#cb84-1"></a>td_upper &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb84-2"><a href="point-data.html#cb84-2"></a>  <span class="dt">start_date          =</span> <span class="dv">2019021700</span>,</span>
<span id="cb84-3"><a href="point-data.html#cb84-3"></a>  <span class="dt">end_date            =</span> <span class="dv">2019021718</span>,</span>
<span id="cb84-4"><a href="point-data.html#cb84-4"></a>  <span class="dt">fcst_model          =</span> <span class="kw">c</span>(<span class="st">&quot;AROME_Arctic_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb84-5"><a href="point-data.html#cb84-5"></a>  <span class="dt">fcst_type           =</span> <span class="st">&quot;det&quot;</span>,</span>
<span id="cb84-6"><a href="point-data.html#cb84-6"></a>  <span class="dt">parameter           =</span> <span class="st">&quot;Td&quot;</span>,</span>
<span id="cb84-7"><a href="point-data.html#cb84-7"></a>  <span class="dt">file_path           =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/deterministic&quot;</span>),</span>
<span id="cb84-8"><a href="point-data.html#cb84-8"></a>  <span class="dt">vertical_coordinate =</span> <span class="st">&quot;pressure&quot;</span></span>
<span id="cb84-9"><a href="point-data.html#cb84-9"></a>)</span></code></pre></div>
<p>harp has a function for plotting vertical profile, that allows you compare the profiles from different models - but only for the same parameter.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="point-data.html#cb85-1"></a><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb85-2"><a href="point-data.html#cb85-2"></a>  t_upper, </span>
<span id="cb85-3"><a href="point-data.html#cb85-3"></a>  <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb85-4"><a href="point-data.html#cb85-4"></a>  <span class="dt">fcdate    =</span> <span class="dv">2019021712</span>,</span>
<span id="cb85-5"><a href="point-data.html#cb85-5"></a>  <span class="dt">lead_time =</span> <span class="dv">24</span></span>
<span id="cb85-6"><a href="point-data.html#cb85-6"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>You can also plot the profiles on skew-t / log P grid by setting <code>skew_t = TRUE</code>. However, it should be noted that temperatures need to be in °C rather than Kelvin. We can convert the units by using <code>scale_point_forecast</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="point-data.html#cb86-1"></a><span class="kw">scale_point_forecast</span>(t_upper, <span class="fl">-273.15</span>, <span class="dt">new_units =</span> <span class="st">&quot;degC&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb86-2"><a href="point-data.html#cb86-2"></a><span class="st">  </span><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb86-3"><a href="point-data.html#cb86-3"></a>    <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb86-4"><a href="point-data.html#cb86-4"></a>    <span class="dt">fcdate    =</span> <span class="dv">2019021712</span>,</span>
<span id="cb86-5"><a href="point-data.html#cb86-5"></a>    <span class="dt">lead_time =</span> <span class="dv">24</span>,</span>
<span id="cb86-6"><a href="point-data.html#cb86-6"></a>    <span class="dt">skew_t    =</span> <span class="ot">TRUE</span></span>
<span id="cb86-7"><a href="point-data.html#cb86-7"></a>  )</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>You can specify more than 1 station, date, and / or lead time in <code>plot_vertical_profile</code>. Experiment with making some multi panel plots.</li>
<li>Can you figure out how you would add the dew point temperature to the plots?</li>
</ul>
<p>Solution</p>
<ul>
<li>Experiment with making some multi panel plots.</li>
</ul>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="point-data.html#cb87-1"></a><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb87-2"><a href="point-data.html#cb87-2"></a>  t_upper, </span>
<span id="cb87-3"><a href="point-data.html#cb87-3"></a>  <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb87-4"><a href="point-data.html#cb87-4"></a>  <span class="dt">fcdate    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb87-5"><a href="point-data.html#cb87-5"></a>  <span class="dt">lead_time =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">6</span>),</span>
<span id="cb87-6"><a href="point-data.html#cb87-6"></a>  <span class="dt">facet_by  =</span> <span class="kw">vars</span>(leadtime)</span>
<span id="cb87-7"><a href="point-data.html#cb87-7"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<ul>
<li>Can you figure out how you would add the dew point temperature to the plots?</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="point-data.html#cb88-1"></a><span class="kw">plot_vertical_profile</span>(</span>
<span id="cb88-2"><a href="point-data.html#cb88-2"></a>  t_upper, </span>
<span id="cb88-3"><a href="point-data.html#cb88-3"></a>  <span class="dt">SID       =</span> <span class="dv">22113</span>, </span>
<span id="cb88-4"><a href="point-data.html#cb88-4"></a>  <span class="dt">fcdate    =</span> <span class="dv">2019021712</span>,</span>
<span id="cb88-5"><a href="point-data.html#cb88-5"></a>  <span class="dt">lead_time =</span> <span class="dv">24</span></span>
<span id="cb88-6"><a href="point-data.html#cb88-6"></a>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb88-7"><a href="point-data.html#cb88-7"></a><span class="st">  </span><span class="kw">geom_path</span>(</span>
<span id="cb88-8"><a href="point-data.html#cb88-8"></a>    <span class="dt">data =</span> <span class="kw">filter</span>(</span>
<span id="cb88-9"><a href="point-data.html#cb88-9"></a>      <span class="kw">bind_fcst</span>(td_upper), </span>
<span id="cb88-10"><a href="point-data.html#cb88-10"></a>      SID      <span class="op">==</span><span class="st"> </span><span class="dv">22113</span>, </span>
<span id="cb88-11"><a href="point-data.html#cb88-11"></a>      fcdate   <span class="op">==</span><span class="st"> </span><span class="kw">str_datetime_to_unixtime</span>(<span class="dv">2019021712</span>), </span>
<span id="cb88-12"><a href="point-data.html#cb88-12"></a>      leadtime <span class="op">==</span><span class="st"> </span><span class="dv">24</span></span>
<span id="cb88-13"><a href="point-data.html#cb88-13"></a>    ), </span>
<span id="cb88-14"><a href="point-data.html#cb88-14"></a>    <span class="kw">aes</span>(<span class="dt">linetype =</span> <span class="st">&quot;Dew Point&quot;</span>)</span>
<span id="cb88-15"><a href="point-data.html#cb88-15"></a>  ) <span class="op">+</span></span>
<span id="cb88-16"><a href="point-data.html#cb88-16"></a><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">values =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>

</div>
</div>
<div id="reading-in-ensemble-data" class="section level2">
<h2><span class="header-section-number">4.3</span> Reading in ensemble data</h2>
<p>Now we have seen harp in action with deterministic data, let’s move on to ensemble data. harp’s origins are in verification of ensemble data, so the functionality here is a little more mature. Many of the same functions that were introduced in the deterministic section can be used for ensemble data as well. There are also functions that currently only work with ensemble data and are in the process of being upgraded to handle deterministic forecasts as well.</p>
<p>We can use the same <code>read_point_forecast</code> function to read in ensemble data - we just need to tell it that we are reading ensemble data by setting <code>fcst_type = "eps"</code>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="point-data.html#cb89-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb89-2"><a href="point-data.html#cb89-2"></a><span class="kw">library</span>(here)</span>
<span id="cb89-3"><a href="point-data.html#cb89-3"></a><span class="kw">library</span>(harp)</span>
<span id="cb89-4"><a href="point-data.html#cb89-4"></a>(t2m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb89-5"><a href="point-data.html#cb89-5"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb89-6"><a href="point-data.html#cb89-6"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb89-7"><a href="point-data.html#cb89-7"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;MEPS_prod&quot;</span>,</span>
<span id="cb89-8"><a href="point-data.html#cb89-8"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb89-9"><a href="point-data.html#cb89-9"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb89-10"><a href="point-data.html#cb89-10"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb89-11"><a href="point-data.html#cb89-11"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb89-12"><a href="point-data.html#cb89-12"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb89-13"><a href="point-data.html#cb89-13"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb89-14"><a href="point-data.html#cb89-14"></a>))</span></code></pre></div>
<pre><code>## ● MEPS_prod
## # A tibble: 22,980 x 19
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA T2m        1001 K    
##  2 1.55e9 00                0             4.1    NA T2m        1010 K    
##  3 1.55e9 00                0            29.1    NA T2m        1014 K    
##  4 1.55e9 00                0             2.6    NA T2m        1015 K    
##  5 1.55e9 00                0           152.     NA T2m        1018 K    
##  6 1.55e9 00                0            69.1    NA T2m        1023 K    
##  7 1.55e9 00                0             8.1    NA T2m        1025 K    
##  8 1.55e9 00                0             5.2    NA T2m        1026 K    
##  9 1.55e9 00                0             5.2    NA T2m        1027 K    
## 10 1.55e9 00                0            28.5    NA T2m        1033 K    
## # … with 22,970 more rows, and 11 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;</code></pre>
<p>You will see that each ensemble member gets its own column in the data frame. This isn’t really tidy data - for the data to be tidy, the ensemble member would be a variable as well. However, when ensembles become large the slightly untidy format is advantageous - firstly, many of the verification functions we use expect the ensemble data as a matrix and continual pivoting slows these function down a lot and secondly, this format takes up less space in memory. We can, however, convert the data to a tidy format with the function <code>gather_members()</code></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="point-data.html#cb91-1"></a><span class="kw">gather_members</span>(t2m)</span></code></pre></div>
<pre><code>## ● MEPS_prod
## # A tibble: 229,800 x 12
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA T2m        1001 K    
##  2 1.55e9 00                0             4.1    NA T2m        1010 K    
##  3 1.55e9 00                0            29.1    NA T2m        1014 K    
##  4 1.55e9 00                0             2.6    NA T2m        1015 K    
##  5 1.55e9 00                0           152.     NA T2m        1018 K    
##  6 1.55e9 00                0            69.1    NA T2m        1023 K    
##  7 1.55e9 00                0             8.1    NA T2m        1025 K    
##  8 1.55e9 00                0             5.2    NA T2m        1026 K    
##  9 1.55e9 00                0             5.2    NA T2m        1027 K    
## 10 1.55e9 00                0            28.5    NA T2m        1033 K    
## # … with 229,790 more rows, and 4 more variables: validdate &lt;int&gt;,
## #   member &lt;chr&gt;, forecast &lt;dbl&gt;, sub_model &lt;chr&gt;</code></pre>
<p>With the members gathered together we can use <code>bind_fcst</code> in order to make basic plots from the data using ggplot.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="point-data.html#cb93-1"></a><span class="kw">bind_fcst</span>(t2m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-2"><a href="point-data.html#cb93-2"></a><span class="st">  </span><span class="kw">filter</span>(SID <span class="op">==</span><span class="st"> </span><span class="dv">1492</span>, fcdate <span class="op">==</span><span class="st"> </span><span class="kw">str_datetime_to_unixtime</span>(<span class="dv">2019021712</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-3"><a href="point-data.html#cb93-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">unix2datetime</span>(validdate), <span class="dt">y =</span> forecast, <span class="dt">colour =</span> member)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-4"><a href="point-data.html#cb93-4"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="point-data.html#cb94-1"></a><span class="kw">bind_fcst</span>(t2m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-2"><a href="point-data.html#cb94-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">leadtime =</span> <span class="kw">fct_inorder</span>(<span class="kw">paste0</span>(<span class="st">&quot;Lead time: &quot;</span>, leadtime, <span class="st">&quot;h&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-3"><a href="point-data.html#cb94-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(forecast, <span class="dt">colour =</span> leadtime, <span class="dt">fill =</span> leadtime)) <span class="op">+</span></span>
<span id="cb94-4"><a href="point-data.html#cb94-4"></a><span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb94-5"><a href="point-data.html#cb94-5"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(leadtime)) <span class="op">+</span></span>
<span id="cb94-6"><a href="point-data.html#cb94-6"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-53-2.png" width="672" /></p>
<p>There are also a number of different ways you can plot time series of ensemble forecasts for a station. This can be done with the function <code>plot_station_eps</code>. You give it the harp_fcst object and tell it what station and forecast start time you want the plot for, and optionally what sort of plot you want.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="point-data.html#cb95-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="point-data.html#cb96-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">type =</span> <span class="st">&quot;boxplot&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-54-2.png" width="672" /></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="point-data.html#cb97-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">type =</span> <span class="st">&quot;spaghetti&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-54-3.png" width="672" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="point-data.html#cb98-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">type =</span> <span class="st">&quot;ridge&quot;</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-54-4.png" width="672" /></p>
<p>There are other types of plot that are more suited to truncated distributions such as those that are bound at 0 for wind speed and precipitation. When we converted the precipitation data to SQLite, we do not take any accout of accumulation times - the data are as they are output from in the model as accumulation since the model start time. We can do the accumulation when we read in the data using <code>read_point_forecast</code> by prefixing the parameter name with “Acc” for accumulated and suffixing it with the accumulation time in hours, e.g. “6h”.</p>
<p>Your turn:</p>
<ul>
<li>Read in 3h accumulated precipitatino from MEPS. Use <code>show_harp_parameters()</code> if you need some guidance.</li>
<li>Find the time and station with the heighest forecast precipitation, and which forecast it s for.</li>
</ul>
<p>Solution:</p>
<ul>
<li>Read in 3h accumulated precipitatino from MEPS. Use <code>show_harp_parameters()</code> if you need some guidance.</li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="point-data.html#cb99-1"></a>(precip_3h &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb99-2"><a href="point-data.html#cb99-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb99-3"><a href="point-data.html#cb99-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb99-4"><a href="point-data.html#cb99-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;MEPS_prod&quot;</span>,</span>
<span id="cb99-5"><a href="point-data.html#cb99-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb99-6"><a href="point-data.html#cb99-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;AccPcp3h&quot;</span>,</span>
<span id="cb99-7"><a href="point-data.html#cb99-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb99-8"><a href="point-data.html#cb99-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb99-9"><a href="point-data.html#cb99-9"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb99-10"><a href="point-data.html#cb99-10"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb99-11"><a href="point-data.html#cb99-11"></a>))</span></code></pre></div>
<pre><code>## ● MEPS_prod
## # A tibble: 19,248 x 18
##    fcdate fcst_cycle leadtime model_elevation parameter   SID units validdate
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
##  1 1.55e9 00                3           -24.7 Pcp        1320 kg/m…    1.55e9
##  2 1.55e9 00                3           -12.1 Pcp        1043 kg/m…    1.55e9
##  3 1.55e9 00                3           -10.7 Pcp        1193 kg/m…    1.55e9
##  4 1.55e9 00                3            -7   Pcp        1117 kg/m…    1.55e9
##  5 1.55e9 00                3            -6.7 Pcp        1112 kg/m…    1.55e9
##  6 1.55e9 00                3            -5.8 Pcp        1161 kg/m…    1.55e9
##  7 1.55e9 00                3            -4.7 Pcp        1098 kg/m…    1.55e9
##  8 1.55e9 00                3            -4.7 Pcp        1162 kg/m…    1.55e9
##  9 1.55e9 00                3            -3.4 Pcp        3007 kg/m…    1.55e9
## 10 1.55e9 00                3            -2.7 Pcp        1476 kg/m…    1.55e9
## # … with 19,238 more rows, and 10 more variables: MEPS_prod_mbr000 &lt;dbl&gt;,
## #   MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;,
## #   MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;,
## #   MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;, MEPS_prod_mbr009 &lt;dbl&gt;</code></pre>
<ul>
<li>Find the time and station with the heighest forecast precipitation</li>
</ul>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="point-data.html#cb101-1"></a><span class="kw">bind_fcst</span>(precip_3h) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-2"><a href="point-data.html#cb101-2"></a><span class="st">  </span><span class="kw">group_by</span>(SID, fcdate, validdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-3"><a href="point-data.html#cb101-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">max_precip =</span> <span class="kw">max</span>(forecast)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-4"><a href="point-data.html#cb101-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(max_precip)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-5"><a href="point-data.html#cb101-5"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-6"><a href="point-data.html#cb101-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fcdate =</span> <span class="kw">unix2datetime</span>(fcdate), <span class="dt">validdate =</span> <span class="kw">unix2datetime</span>(validdate))</span></code></pre></div>
<pre><code>## # A tibble: 19,248 x 4
##      SID fcdate              validdate           max_precip
##    &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;                   &lt;dbl&gt;
##  1  1106 2019-02-17 06:00:00 2019-02-17 09:00:00      10.3 
##  2  1107 2019-02-17 06:00:00 2019-02-17 09:00:00      10.3 
##  3  1121 2019-02-17 00:00:00 2019-02-17 03:00:00       7.46
##  4 22113 2019-02-17 00:00:00 2019-02-17 06:00:00       6.16
##  5  1611 2019-02-17 00:00:00 2019-02-17 03:00:00       6.13
##  6  1015 2019-02-17 12:00:00 2019-02-17 21:00:00       5.77
##  7  1201 2019-02-17 12:00:00 2019-02-17 21:00:00       5.65
##  8  1611 2019-02-17 18:00:00 2019-02-18 06:00:00       5.64
##  9  1014 2019-02-17 06:00:00 2019-02-17 18:00:00       5.28
## 10  1122 2019-02-17 00:00:00 2019-02-17 03:00:00       5.27
## # … with 19,238 more rows</code></pre>
<p>Let’s plot a time series for that forecast.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="point-data.html#cb103-1"></a><span class="kw">plot_station_eps</span>(precip_3h, <span class="dv">1106</span>, <span class="dv">2019021706</span>, <span class="dt">type =</span> <span class="st">&quot;boxplot&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="point-data.html#cb104-1"></a><span class="kw">plot_station_eps</span>(precip_3h, <span class="dv">1106</span>, <span class="dv">2019021706</span>, <span class="dt">type =</span> <span class="st">&quot;stacked_prob&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-57-2.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Observations are read in the same way as we did for deterministic forecasts. Read in the observations for 2m temperature and 3h accumulated precipitation and join to the forecasts.</li>
</ul>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="point-data.html#cb105-1"></a>(t2m &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb105-2"><a href="point-data.html#cb105-2"></a>  t2m, </span>
<span id="cb105-3"><a href="point-data.html#cb105-3"></a>  <span class="kw">read_point_obs</span>(</span>
<span id="cb105-4"><a href="point-data.html#cb105-4"></a>    <span class="kw">first_validdate</span>(t2m),</span>
<span id="cb105-5"><a href="point-data.html#cb105-5"></a>    <span class="kw">last_validdate</span>(t2m),</span>
<span id="cb105-6"><a href="point-data.html#cb105-6"></a>    <span class="dt">parameter =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb105-7"><a href="point-data.html#cb105-7"></a>    <span class="dt">obs_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>)</span>
<span id="cb105-8"><a href="point-data.html#cb105-8"></a>  )</span>
<span id="cb105-9"><a href="point-data.html#cb105-9"></a>))</span></code></pre></div>
<pre><code>## ● MEPS_prod
## # A tibble: 15,963 x 23
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA T2m        1001 K    
##  2 1.55e9 00                0             4.1    NA T2m        1010 K    
##  3 1.55e9 00                0             2.6    NA T2m        1015 K    
##  4 1.55e9 00                0           152.     NA T2m        1018 K    
##  5 1.55e9 00                0            69.1    NA T2m        1023 K    
##  6 1.55e9 00                0             8.1    NA T2m        1025 K    
##  7 1.55e9 00                0             5.2    NA T2m        1026 K    
##  8 1.55e9 00                0             5.2    NA T2m        1027 K    
##  9 1.55e9 00                0            28.5    NA T2m        1033 K    
## 10 1.55e9 00                0           734.     NA T2m        1035 K    
## # … with 15,953 more rows, and 15 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="point-data.html#cb107-1"></a>(precip_3h &lt;-<span class="st"> </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb107-2"><a href="point-data.html#cb107-2"></a>  precip_3h, </span>
<span id="cb107-3"><a href="point-data.html#cb107-3"></a>  <span class="kw">read_point_obs</span>(</span>
<span id="cb107-4"><a href="point-data.html#cb107-4"></a>    <span class="kw">first_validdate</span>(precip_3h),</span>
<span id="cb107-5"><a href="point-data.html#cb107-5"></a>    <span class="kw">last_validdate</span>(precip_3h),</span>
<span id="cb107-6"><a href="point-data.html#cb107-6"></a>    <span class="dt">parameter =</span> <span class="st">&quot;AccPcp3h&quot;</span>,</span>
<span id="cb107-7"><a href="point-data.html#cb107-7"></a>    <span class="dt">obs_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>)</span>
<span id="cb107-8"><a href="point-data.html#cb107-8"></a>  )</span>
<span id="cb107-9"><a href="point-data.html#cb107-9"></a>))</span></code></pre></div>
<pre><code>## ● MEPS_prod
## # A tibble: 6,369 x 22
##    fcdate fcst_cycle leadtime model_elevation parameter   SID units validdate
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 1.55e9 00                3            -7   Pcp        1117 kg/m…    1.55e9
##  2 1.55e9 00                3            -4.7 Pcp        1098 kg/m…    1.55e9
##  3 1.55e9 00                3            -1.7 Pcp        6249 kg/m…    1.55e9
##  4 1.55e9 00                3            -1.4 Pcp        6286 kg/m…    1.55e9
##  5 1.55e9 00                3            -0.9 Pcp        2976 kg/m…    1.55e9
##  6 1.55e9 00                3            -0.8 Pcp        2382 kg/m…    1.55e9
##  7 1.55e9 00                3            -0.8 Pcp        2575 kg/m…    1.55e9
##  8 1.55e9 00                3            -0.8 Pcp        2667 kg/m…    1.55e9
##  9 1.55e9 00                3            -0.8 Pcp        2964 kg/m…    1.55e9
## 10 1.55e9 00                3            -0.7 Pcp        2498 kg/m…    1.55e9
## # … with 6,359 more rows, and 14 more variables: MEPS_prod_mbr000 &lt;dbl&gt;,
## #   MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;, MEPS_prod_mbr003 &lt;dbl&gt;,
## #   MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;, MEPS_prod_mbr006 &lt;dbl&gt;,
## #   MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;, MEPS_prod_mbr009 &lt;dbl&gt;,
## #   lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, AccPcp3h &lt;dbl&gt;</code></pre>
<p>We can now add the observations to our plots</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="point-data.html#cb109-1"></a><span class="kw">plot_station_eps</span>(t2m, <span class="dv">1492</span>, <span class="dv">2019021700</span>, <span class="dt">obs_column =</span> T2m, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>Note this function still needs more work, and doesn’t work well in all cases!</p>
<p>We can also make scatter plots of how forecasts compare with observations. They are made with hexbin plots and it is posisible to compare the whole ensemble with the observations or each ensemble member. The function is <code>plot_scatter</code> .</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="point-data.html#cb110-1"></a><span class="kw">plot_scatter</span>(t2m, <span class="st">&quot;MEPS_prod&quot;</span>, T2m)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>Your turn:</p>
<ul>
<li>Can you work out how to combine all members inta a single scatter plot. Check the help and note that the explanations are not complete!</li>
<li>Make a scatter plots for each member for observed 3h precipitation &gt; 0.25 mm.</li>
</ul>
<p>Solutions:</p>
<ul>
<li>Can you work out how to combine all members inta a single scatter plot. Check the help and note that the explanations are not complete!</li>
</ul>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="point-data.html#cb111-1"></a><span class="kw">plot_scatter</span>(t2m, <span class="st">&quot;MEPS_prod&quot;</span>, T2m, <span class="dt">facet_members =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<ul>
<li>Make a scatter plots for each member for observed 3h precipitation &gt; 0.25 mm.</li>
</ul>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="point-data.html#cb112-1"></a><span class="kw">plot_scatter</span>(<span class="kw">filter</span>(precip_3h, AccPcp3h <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.25</span>), <span class="st">&quot;MEPS_prod&quot;</span>, AccPcp3h)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<div id="multi-model-ensembles" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Multi model ensembles</h3>
<p>When we generated SQLite FCTABLE files for a fake multimodel ensemble we needed to specify a lot of details about the ensemble, such as the names and member numbers for each sub model. When we read those data in from the FCTABLE files, that information is already there. So, let’s read in our multi model ensemble and see what we get.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="point-data.html#cb113-1"></a><span class="kw">read_point_forecast</span>(</span>
<span id="cb113-2"><a href="point-data.html#cb113-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb113-3"><a href="point-data.html#cb113-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb113-4"><a href="point-data.html#cb113-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;awesome_multimodel_eps&quot;</span>,</span>
<span id="cb113-5"><a href="point-data.html#cb113-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb113-6"><a href="point-data.html#cb113-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb113-7"><a href="point-data.html#cb113-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb113-8"><a href="point-data.html#cb113-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb113-9"><a href="point-data.html#cb113-9"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb113-10"><a href="point-data.html#cb113-10"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb113-11"><a href="point-data.html#cb113-11"></a>)</span></code></pre></div>
<pre><code>## ● awesome_multimodel_eps
## ● AROME_Arctic_prod
## # A tibble: 4,580 x 6
##      SID     fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mbr000
##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;
##  1  1001 1550361600        0 1550361600 00                             270.
##  2  1010 1550361600        0 1550361600 00                             275.
##  3  1014 1550361600        0 1550361600 00                             273.
##  4  1015 1550361600        0 1550361600 00                             274.
##  5  1018 1550361600        0 1550361600 00                             271.
##  6  1023 1550361600        0 1550361600 00                             272.
##  7  1025 1550361600        0 1550361600 00                             272.
##  8  1026 1550361600        0 1550361600 00                             272.
##  9  1027 1550361600        0 1550361600 00                             273.
## 10  1033 1550361600        0 1550361600 00                             273.
## # … with 4,570 more rows
## 
## ● MEPS_prod
## # A tibble: 4,580 x 8
##      SID fcdate leadtime validdate fcst_cycle MEPS_prod_mbr000 MEPS_prod_mbr001
##    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 00                     268.             269.
##  2  1010 1.55e9        0    1.55e9 00                     275.             276.
##  3  1014 1.55e9        0    1.55e9 00                     273.             273.
##  4  1015 1.55e9        0    1.55e9 00                     275.             276.
##  5  1018 1.55e9        0    1.55e9 00                     271.             272.
##  6  1023 1.55e9        0    1.55e9 00                     272.             272.
##  7  1025 1.55e9        0    1.55e9 00                     272.             273.
##  8  1026 1.55e9        0    1.55e9 00                     272.             272.
##  9  1027 1.55e9        0    1.55e9 00                     273.             273.
## 10  1033 1.55e9        0    1.55e9 00                     274.             274.
## # … with 4,570 more rows, and 1 more variable: MEPS_prod_mbr002 &lt;dbl&gt;</code></pre>
<p>As you can see we get the two sub models - AROME_Arctic_prod with one member, and MEPS_prod with 3 members - but not the full ensemble. However, we can create the full ensemble with the function <code>merge_multimodel</code>.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="point-data.html#cb115-1"></a>(t2m_mm &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb115-2"><a href="point-data.html#cb115-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb115-3"><a href="point-data.html#cb115-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb115-4"><a href="point-data.html#cb115-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;awesome_multimodel_eps&quot;</span>,</span>
<span id="cb115-5"><a href="point-data.html#cb115-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb115-6"><a href="point-data.html#cb115-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb115-7"><a href="point-data.html#cb115-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb115-8"><a href="point-data.html#cb115-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb115-9"><a href="point-data.html#cb115-9"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb115-10"><a href="point-data.html#cb115-10"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb115-11"><a href="point-data.html#cb115-11"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-12"><a href="point-data.html#cb115-12"></a><span class="st">  </span><span class="kw">merge_multimodel</span>())</span></code></pre></div>
<pre><code>## ● awesome_multimodel_eps
## # A tibble: 4,580 x 9
##      SID fcdate leadtime validdate fcst_cycle AROME_Arctic_pr… MEPS_prod_mbr000
##    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 00                     270.             268.
##  2  1010 1.55e9        0    1.55e9 00                     275.             275.
##  3  1014 1.55e9        0    1.55e9 00                     273.             273.
##  4  1015 1.55e9        0    1.55e9 00                     274.             275.
##  5  1018 1.55e9        0    1.55e9 00                     271.             271.
##  6  1023 1.55e9        0    1.55e9 00                     272.             272.
##  7  1025 1.55e9        0    1.55e9 00                     272.             272.
##  8  1026 1.55e9        0    1.55e9 00                     272.             272.
##  9  1027 1.55e9        0    1.55e9 00                     273.             273.
## 10  1033 1.55e9        0    1.55e9 00                     273.             274.
## # … with 4,570 more rows, and 2 more variables: MEPS_prod_mbr001 &lt;dbl&gt;,
## #   MEPS_prod_mbr002 &lt;dbl&gt;
## 
## ● AROME_Arctic_prod(awesome_multimodel_eps)
## # A tibble: 4,580 x 6
##      SID     fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mbr000
##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;
##  1  1001 1550361600        0 1550361600 00                             270.
##  2  1010 1550361600        0 1550361600 00                             275.
##  3  1014 1550361600        0 1550361600 00                             273.
##  4  1015 1550361600        0 1550361600 00                             274.
##  5  1018 1550361600        0 1550361600 00                             271.
##  6  1023 1550361600        0 1550361600 00                             272.
##  7  1025 1550361600        0 1550361600 00                             272.
##  8  1026 1550361600        0 1550361600 00                             272.
##  9  1027 1550361600        0 1550361600 00                             273.
## 10  1033 1550361600        0 1550361600 00                             273.
## # … with 4,570 more rows
## 
## ● MEPS_prod(awesome_multimodel_eps)
## # A tibble: 4,580 x 8
##      SID fcdate leadtime validdate fcst_cycle MEPS_prod_mbr000 MEPS_prod_mbr001
##    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 00                     268.             269.
##  2  1010 1.55e9        0    1.55e9 00                     275.             276.
##  3  1014 1.55e9        0    1.55e9 00                     273.             273.
##  4  1015 1.55e9        0    1.55e9 00                     275.             276.
##  5  1018 1.55e9        0    1.55e9 00                     271.             272.
##  6  1023 1.55e9        0    1.55e9 00                     272.             272.
##  7  1025 1.55e9        0    1.55e9 00                     272.             273.
##  8  1026 1.55e9        0    1.55e9 00                     272.             272.
##  9  1027 1.55e9        0    1.55e9 00                     273.             273.
## 10  1033 1.55e9        0    1.55e9 00                     274.             274.
## # … with 4,570 more rows, and 1 more variable: MEPS_prod_mbr002 &lt;dbl&gt;</code></pre>
<p>Now we have the full multimodel ensemble and the two sub models, all as separate models in the harp_fcst object. You can, if you prefer, discard the sub models by setting <code>keep_sub_models = FALSE</code> in <code>merge_multimodel</code>.</p>
<p>Now we have two harp_fcst objects for 2m temperature, t2m and t2m_mm. We can easily combine them into a single harp_fcst using the standard concatenate function, <code>c</code></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="point-data.html#cb117-1"></a><span class="kw">c</span>(t2m, t2m_mm)</span></code></pre></div>
<pre><code>## ● MEPS_prod
## # A tibble: 15,963 x 23
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA T2m        1001 K    
##  2 1.55e9 00                0             4.1    NA T2m        1010 K    
##  3 1.55e9 00                0             2.6    NA T2m        1015 K    
##  4 1.55e9 00                0           152.     NA T2m        1018 K    
##  5 1.55e9 00                0            69.1    NA T2m        1023 K    
##  6 1.55e9 00                0             8.1    NA T2m        1025 K    
##  7 1.55e9 00                0             5.2    NA T2m        1026 K    
##  8 1.55e9 00                0             5.2    NA T2m        1027 K    
##  9 1.55e9 00                0            28.5    NA T2m        1033 K    
## 10 1.55e9 00                0           734.     NA T2m        1035 K    
## # … with 15,953 more rows, and 15 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;
## 
## ● awesome_multimodel_eps
## # A tibble: 4,580 x 9
##      SID fcdate leadtime validdate fcst_cycle AROME_Arctic_pr… MEPS_prod_mbr000
##    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 00                     270.             268.
##  2  1010 1.55e9        0    1.55e9 00                     275.             275.
##  3  1014 1.55e9        0    1.55e9 00                     273.             273.
##  4  1015 1.55e9        0    1.55e9 00                     274.             275.
##  5  1018 1.55e9        0    1.55e9 00                     271.             271.
##  6  1023 1.55e9        0    1.55e9 00                     272.             272.
##  7  1025 1.55e9        0    1.55e9 00                     272.             272.
##  8  1026 1.55e9        0    1.55e9 00                     272.             272.
##  9  1027 1.55e9        0    1.55e9 00                     273.             273.
## 10  1033 1.55e9        0    1.55e9 00                     273.             274.
## # … with 4,570 more rows, and 2 more variables: MEPS_prod_mbr001 &lt;dbl&gt;,
## #   MEPS_prod_mbr002 &lt;dbl&gt;
## 
## ● AROME_Arctic_prod(awesome_multimodel_eps)
## # A tibble: 4,580 x 6
##      SID     fcdate leadtime  validdate fcst_cycle AROME_Arctic_prod_mbr000
##    &lt;int&gt;      &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;
##  1  1001 1550361600        0 1550361600 00                             270.
##  2  1010 1550361600        0 1550361600 00                             275.
##  3  1014 1550361600        0 1550361600 00                             273.
##  4  1015 1550361600        0 1550361600 00                             274.
##  5  1018 1550361600        0 1550361600 00                             271.
##  6  1023 1550361600        0 1550361600 00                             272.
##  7  1025 1550361600        0 1550361600 00                             272.
##  8  1026 1550361600        0 1550361600 00                             272.
##  9  1027 1550361600        0 1550361600 00                             273.
## 10  1033 1550361600        0 1550361600 00                             273.
## # … with 4,570 more rows
## 
## ● MEPS_prod(awesome_multimodel_eps)
## # A tibble: 4,580 x 8
##      SID fcdate leadtime validdate fcst_cycle MEPS_prod_mbr000 MEPS_prod_mbr001
##    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 00                     268.             269.
##  2  1010 1.55e9        0    1.55e9 00                     275.             276.
##  3  1014 1.55e9        0    1.55e9 00                     273.             273.
##  4  1015 1.55e9        0    1.55e9 00                     275.             276.
##  5  1018 1.55e9        0    1.55e9 00                     271.             272.
##  6  1023 1.55e9        0    1.55e9 00                     272.             272.
##  7  1025 1.55e9        0    1.55e9 00                     272.             273.
##  8  1026 1.55e9        0    1.55e9 00                     272.             272.
##  9  1027 1.55e9        0    1.55e9 00                     273.             273.
## 10  1033 1.55e9        0    1.55e9 00                     274.             274.
## # … with 4,570 more rows, and 1 more variable: MEPS_prod_mbr002 &lt;dbl&gt;</code></pre>
</div>
<div id="lagged-ensembles-1" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Lagged ensembles</h3>
<p>Reading lagged ensembles from FCTABLE files is also easier than in the conversion to SQLite step. Since FCTABLE files were saved for each forecast cycle, and the members for that cycle in the file, all we need to do is tell read_point_forecast the appropriate lags. Here we need to be a bit careful about what we’re doing, especially if we are reading in data from other models at the same. In the case of CMEPS there is a new set of ensemble members every three hours, but if we want to compare it with MEPS, which has a full set of members every six hours, which should set the <code>by = "6h"</code> and use our lags specification to ensure we read in the correct amount of data for CMEPS, by ensuring there are lags from zero to five hours. This probably becomes clearer with an example…</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="point-data.html#cb119-1"></a>(t2m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb119-2"><a href="point-data.html#cb119-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb119-3"><a href="point-data.html#cb119-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb119-4"><a href="point-data.html#cb119-4"></a>  <span class="dt">fcst_model    =</span> <span class="kw">c</span>(<span class="st">&quot;CMEPS_prod&quot;</span>, <span class="st">&quot;MEPS_prod&quot;</span>),</span>
<span id="cb119-5"><a href="point-data.html#cb119-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb119-6"><a href="point-data.html#cb119-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb119-7"><a href="point-data.html#cb119-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb119-8"><a href="point-data.html#cb119-8"></a>  <span class="dt">by            =</span> <span class="st">&quot;6h&quot;</span>,</span>
<span id="cb119-9"><a href="point-data.html#cb119-9"></a>  <span class="dt">lags          =</span> <span class="kw">list</span>(</span>
<span id="cb119-10"><a href="point-data.html#cb119-10"></a>    <span class="dt">CMEPS_prod =</span> <span class="kw">paste0</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="st">&quot;h&quot;</span>),</span>
<span id="cb119-11"><a href="point-data.html#cb119-11"></a>    <span class="dt">MEPS_prod  =</span> <span class="st">&quot;0h&quot;</span></span>
<span id="cb119-12"><a href="point-data.html#cb119-12"></a>  ),</span>
<span id="cb119-13"><a href="point-data.html#cb119-13"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb119-14"><a href="point-data.html#cb119-14"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span>,</span>
<span id="cb119-15"><a href="point-data.html#cb119-15"></a>  <span class="dt">merge_lags    =</span> <span class="ot">FALSE</span> </span>
<span id="cb119-16"><a href="point-data.html#cb119-16"></a>))</span></code></pre></div>
<pre><code>## ● CMEPS_prod
## # A tibble: 110,304 x 15
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA T2m        1001 K    
##  2 1.55e9 00                0             4.1    NA T2m        1010 K    
##  3 1.55e9 00                0            29.1    NA T2m        1014 K    
##  4 1.55e9 00                0             2.6    NA T2m        1015 K    
##  5 1.55e9 00                0           152.     NA T2m        1018 K    
##  6 1.55e9 00                0            69.1    NA T2m        1023 K    
##  7 1.55e9 00                0             8.1    NA T2m        1025 K    
##  8 1.55e9 00                0             5.2    NA T2m        1026 K    
##  9 1.55e9 00                0             5.2    NA T2m        1027 K    
## 10 1.55e9 00                0            28.5    NA T2m        1033 K    
## # … with 110,294 more rows, and 7 more variables: validdate &lt;int&gt;,
## #   CMEPS_prod_mbr000 &lt;dbl&gt;, CMEPS_prod_mbr001 &lt;dbl&gt;, CMEPS_prod_mbr003 &lt;dbl&gt;,
## #   CMEPS_prod_mbr004 &lt;dbl&gt;, CMEPS_prod_mbr005 &lt;dbl&gt;, CMEPS_prod_mbr006 &lt;dbl&gt;
## 
## ● MEPS_prod
## # A tibble: 22,980 x 19
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA T2m        1001 K    
##  2 1.55e9 00                0             4.1    NA T2m        1010 K    
##  3 1.55e9 00                0            29.1    NA T2m        1014 K    
##  4 1.55e9 00                0             2.6    NA T2m        1015 K    
##  5 1.55e9 00                0           152.     NA T2m        1018 K    
##  6 1.55e9 00                0            69.1    NA T2m        1023 K    
##  7 1.55e9 00                0             8.1    NA T2m        1025 K    
##  8 1.55e9 00                0             5.2    NA T2m        1026 K    
##  9 1.55e9 00                0             5.2    NA T2m        1027 K    
## 10 1.55e9 00                0            28.5    NA T2m        1033 K    
## # … with 22,970 more rows, and 11 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;</code></pre>
<p>There was a warning about missing files. This is because we didn’t generate any FCTABLE files for the 21 cycle on the 16 Feb 2019 and they were also not uploaded to this project! However, this illustrates that when lagging is used, you have to be very clear in your mind exactly what you need to get the lagged ensemble you want.</p>
<p>You will also see that there a are lot of missing data - this is immediately apparent for members 5 and 6. This is becasuse, since we set merge_lags = FALSE, we have only read in lagged data, but haven’t created the lagged ensemble yet. We create the lagged ensemble with the function <code>lag_forecast</code>. We tell the function which cycles you want to be the “parent” cycles and the function will shift all of the members between the parent cycles to the parent cycle. By default, children are found by looking backwards in time, as would happen in an operational setting - for example, if the parent cycles are 0, 6, 12 and 18, the child cycles for the parent at 6 are at 5, 4, 3, 2, and 1, and so on for the other parents. You can look for children in the other direction by setting <code>direction = -1</code>. Note that when merge_lags = TRUE, the ensemble is created with the parent cycles set to be those generated from the start_date, end_date and by arguments.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="point-data.html#cb121-1"></a><span class="kw">lag_forecast</span>(</span>
<span id="cb121-2"><a href="point-data.html#cb121-2"></a>  t2m, </span>
<span id="cb121-3"><a href="point-data.html#cb121-3"></a>  <span class="dt">fcst_model =</span> <span class="st">&quot;CMEPS_prod&quot;</span>, </span>
<span id="cb121-4"><a href="point-data.html#cb121-4"></a>  <span class="dt">parent_cycles =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">3</span>)</span>
<span id="cb121-5"><a href="point-data.html#cb121-5"></a>)</span></code></pre></div>
<pre><code>## ● CMEPS_prod
## # A tibble: 36,768 x 14
##    fcst_cycle fcdate leadtime model_elevation parameter   SID units validdate
##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
##  1 00         1.55e9        0            36.4 T2m        1001 K        1.55e9
##  2 00         1.55e9        0             4.1 T2m        1010 K        1.55e9
##  3 00         1.55e9        0            29.1 T2m        1014 K        1.55e9
##  4 00         1.55e9        0             2.6 T2m        1015 K        1.55e9
##  5 00         1.55e9        0           152.  T2m        1018 K        1.55e9
##  6 00         1.55e9        0            69.1 T2m        1023 K        1.55e9
##  7 00         1.55e9        0             8.1 T2m        1025 K        1.55e9
##  8 00         1.55e9        0             5.2 T2m        1026 K        1.55e9
##  9 00         1.55e9        0             5.2 T2m        1027 K        1.55e9
## 10 00         1.55e9        0            28.5 T2m        1033 K        1.55e9
## # … with 36,758 more rows, and 6 more variables: CMEPS_prod_mbr000 &lt;dbl&gt;,
## #   CMEPS_prod_mbr001 &lt;dbl&gt;, CMEPS_prod_mbr003 &lt;dbl&gt;, CMEPS_prod_mbr004 &lt;dbl&gt;,
## #   CMEPS_prod_mbr005 &lt;dbl&gt;, CMEPS_prod_mbr006 &lt;dbl&gt;
## 
## ● MEPS_prod
## # A tibble: 22,980 x 19
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA T2m        1001 K    
##  2 1.55e9 00                0             4.1    NA T2m        1010 K    
##  3 1.55e9 00                0            29.1    NA T2m        1014 K    
##  4 1.55e9 00                0             2.6    NA T2m        1015 K    
##  5 1.55e9 00                0           152.     NA T2m        1018 K    
##  6 1.55e9 00                0            69.1    NA T2m        1023 K    
##  7 1.55e9 00                0             8.1    NA T2m        1025 K    
##  8 1.55e9 00                0             5.2    NA T2m        1026 K    
##  9 1.55e9 00                0             5.2    NA T2m        1027 K    
## 10 1.55e9 00                0            28.5    NA T2m        1033 K    
## # … with 22,970 more rows, and 11 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;</code></pre>
<p>Your turn:</p>
<ul>
<li>Use <code>pull(.fcst, fcst_cycle) %&gt;% map(unique) %&gt;% map(sort)</code> to see which cycles you are left with when you try different <code>parent_cycles</code> and <code>direction = 1</code> or <code>direction = -1</code>. Try to remember what we actually did when we ran <code>read_eps_interpolate</code> for CMEPS</li>
<li>Combine 2m temperature forecasts for the multimodel ensemble (including sub models), MEPS_prod and CMEPS(with parent_cycles of 6, 12 and 18) and select the common cases and join the observations (note you will have to run <code>set_units(t2m_mm, "K")</code> due to a bug in <code>read_point_forecast</code> that drops that units column for multi model ensembles)</li>
</ul>
<p>Solutions</p>
<ul>
<li>Use <code>pull(.fcst, fcst_cycle) %&gt;% map(unique) %&gt;% map(sort)</code> to see which cycles you are left with when you try different <code>parent_cycles</code> and <code>direction = 1</code> or <code>direction = -1</code>.</li>
</ul>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="point-data.html#cb123-1"></a><span class="kw">pull</span>(t2m, fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span></code></pre></div>
<pre><code>## $CMEPS_prod
##  [1] &quot;00&quot; &quot;01&quot; &quot;02&quot; &quot;03&quot; &quot;04&quot; &quot;05&quot; &quot;06&quot; &quot;07&quot; &quot;08&quot; &quot;09&quot; &quot;10&quot; &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot;
## [16] &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;22&quot; &quot;23&quot;
## 
## $MEPS_prod
## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="point-data.html#cb125-1"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">6</span>)), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span></code></pre></div>
<pre><code>## $CMEPS_prod
## [1] &quot;06&quot; &quot;12&quot; &quot;18&quot;
## 
## $MEPS_prod
## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="point-data.html#cb127-1"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">3</span>)), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span></code></pre></div>
<pre><code>## $CMEPS_prod
## [1] &quot;00&quot; &quot;03&quot; &quot;06&quot; &quot;09&quot; &quot;12&quot; &quot;15&quot; &quot;18&quot;
## 
## $MEPS_prod
## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="point-data.html#cb129-1"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">6</span>), <span class="dt">direction =</span> <span class="dv">-1</span>), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span></code></pre></div>
<pre><code>## $CMEPS_prod
## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot;
## 
## $MEPS_prod
## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="point-data.html#cb131-1"></a><span class="kw">pull</span>(<span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">3</span>), <span class="dt">direction =</span> <span class="dv">-1</span>), fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(sort)</span></code></pre></div>
<pre><code>## $CMEPS_prod
## [1] &quot;00&quot; &quot;03&quot; &quot;06&quot; &quot;09&quot; &quot;12&quot; &quot;15&quot;
## 
## $MEPS_prod
## [1] &quot;00&quot; &quot;06&quot; &quot;12&quot; &quot;18&quot;</code></pre>
<ul>
<li>Combine 2m temperature forecasts for the multimodel ensemble (including sub models), MEPS_prod and CMEPS(with parent_cycles of 0, 6, 12 and 18) and select the common cases</li>
</ul>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="point-data.html#cb133-1"></a>(t2m &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">set_units</span>(t2m_mm, <span class="st">&quot;K&quot;</span>), <span class="kw">lag_forecast</span>(t2m, <span class="st">&quot;CMEPS_prod&quot;</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">6</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-2"><a href="point-data.html#cb133-2"></a><span class="st">    </span><span class="kw">common_cases</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-3"><a href="point-data.html#cb133-3"></a><span class="st">    </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb133-4"><a href="point-data.html#cb133-4"></a>      <span class="kw">read_point_obs</span>(</span>
<span id="cb133-5"><a href="point-data.html#cb133-5"></a>        <span class="kw">first_validdate</span>(.),</span>
<span id="cb133-6"><a href="point-data.html#cb133-6"></a>        <span class="kw">last_validdate</span>(.),</span>
<span id="cb133-7"><a href="point-data.html#cb133-7"></a>        <span class="dt">parameter =</span> <span class="st">&quot;T2m&quot;</span>,</span>
<span id="cb133-8"><a href="point-data.html#cb133-8"></a>        <span class="dt">obs_path  =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>) </span>
<span id="cb133-9"><a href="point-data.html#cb133-9"></a>      )</span>
<span id="cb133-10"><a href="point-data.html#cb133-10"></a>    )</span>
<span id="cb133-11"><a href="point-data.html#cb133-11"></a>)</span></code></pre></div>
<pre><code>## ● awesome_multimodel_eps
## # A tibble: 1,955 x 14
##      SID fcdate leadtime validdate fcst_cycle units AROME_Arctic_pr…
##    &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 06         K                 271.
##  2  1010 1.55e9        0    1.55e9 06         K                 273.
##  3  1015 1.55e9        0    1.55e9 06         K                 274.
##  4  1018 1.55e9        0    1.55e9 06         K                 268.
##  5  1023 1.55e9        0    1.55e9 06         K                 269.
##  6  1025 1.55e9        0    1.55e9 06         K                 270.
##  7  1026 1.55e9        0    1.55e9 06         K                 269.
##  8  1027 1.55e9        0    1.55e9 06         K                 270.
##  9  1033 1.55e9        0    1.55e9 06         K                 272.
## 10  1035 1.55e9        0    1.55e9 06         K                 265.
## # … with 1,945 more rows, and 7 more variables: MEPS_prod_mbr000 &lt;dbl&gt;,
## #   MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;,
## #   elev &lt;dbl&gt;, T2m &lt;dbl&gt;
## 
## ● AROME_Arctic_prod(awesome_multimodel_eps)
## # A tibble: 1,955 x 11
##      SID fcdate leadtime validdate fcst_cycle units AROME_Arctic_pr…   lon   lat
##    &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 06         K                 271. -8.67  70.9
##  2  1010 1.55e9        0    1.55e9 06         K                 273. 16.1   69.3
##  3  1015 1.55e9        0    1.55e9 06         K                 274. 17.8   69.6
##  4  1018 1.55e9        0    1.55e9 06         K                 268. 16.0   69.2
##  5  1023 1.55e9        0    1.55e9 06         K                 269. 18.5   69.1
##  6  1025 1.55e9        0    1.55e9 06         K                 270. 18.9   69.7
##  7  1026 1.55e9        0    1.55e9 06         K                 269. 18.9   69.7
##  8  1027 1.55e9        0    1.55e9 06         K                 270. 18.9   69.7
##  9  1033 1.55e9        0    1.55e9 06         K                 272. 19.5   70.2
## 10  1035 1.55e9        0    1.55e9 06         K                 265. 20.1   69.6
## # … with 1,945 more rows, and 2 more variables: elev &lt;dbl&gt;, T2m &lt;dbl&gt;
## 
## ● MEPS_prod(awesome_multimodel_eps)
## # A tibble: 1,955 x 13
##      SID fcdate leadtime validdate fcst_cycle units MEPS_prod_mbr000
##    &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;
##  1  1001 1.55e9        0    1.55e9 06         K                 270.
##  2  1010 1.55e9        0    1.55e9 06         K                 273.
##  3  1015 1.55e9        0    1.55e9 06         K                 273.
##  4  1018 1.55e9        0    1.55e9 06         K                 269.
##  5  1023 1.55e9        0    1.55e9 06         K                 269.
##  6  1025 1.55e9        0    1.55e9 06         K                 269.
##  7  1026 1.55e9        0    1.55e9 06         K                 268.
##  8  1027 1.55e9        0    1.55e9 06         K                 269.
##  9  1033 1.55e9        0    1.55e9 06         K                 271.
## 10  1035 1.55e9        0    1.55e9 06         K                 265.
## # … with 1,945 more rows, and 6 more variables: MEPS_prod_mbr001 &lt;dbl&gt;,
## #   MEPS_prod_mbr002 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;
## 
## ● CMEPS_prod
## # A tibble: 1,955 x 24
##    fcst_cycle fcdate leadtime model_elevation parameter   SID units validdate
##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
##  1 06         1.55e9        0            36.4 T2m        1001 K        1.55e9
##  2 06         1.55e9        0             4.1 T2m        1010 K        1.55e9
##  3 06         1.55e9        0             2.6 T2m        1015 K        1.55e9
##  4 06         1.55e9        0           152.  T2m        1018 K        1.55e9
##  5 06         1.55e9        0            69.1 T2m        1023 K        1.55e9
##  6 06         1.55e9        0             8.1 T2m        1025 K        1.55e9
##  7 06         1.55e9        0             5.2 T2m        1026 K        1.55e9
##  8 06         1.55e9        0             5.2 T2m        1027 K        1.55e9
##  9 06         1.55e9        0            28.5 T2m        1033 K        1.55e9
## 10 06         1.55e9        0           734.  T2m        1035 K        1.55e9
## # … with 1,945 more rows, and 16 more variables: CMEPS_prod_mbr000 &lt;dbl&gt;,
## #   CMEPS_prod_mbr001 &lt;dbl&gt;, CMEPS_prod_mbr003 &lt;dbl&gt;, CMEPS_prod_mbr004 &lt;dbl&gt;,
## #   CMEPS_prod_mbr005 &lt;dbl&gt;, CMEPS_prod_mbr006 &lt;dbl&gt;,
## #   CMEPS_prod_mbr000_lag &lt;dbl&gt;, CMEPS_prod_mbr001_lag &lt;dbl&gt;,
## #   CMEPS_prod_mbr003_lag &lt;dbl&gt;, CMEPS_prod_mbr004_lag &lt;dbl&gt;,
## #   CMEPS_prod_mbr005_lag &lt;dbl&gt;, CMEPS_prod_mbr006_lag &lt;dbl&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;
## 
## ● MEPS_prod
## # A tibble: 1,955 x 23
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 06                0            36.4    NA T2m        1001 K    
##  2 1.55e9 06                0             4.1    NA T2m        1010 K    
##  3 1.55e9 06                0             2.6    NA T2m        1015 K    
##  4 1.55e9 06                0           152.     NA T2m        1018 K    
##  5 1.55e9 06                0            69.1    NA T2m        1023 K    
##  6 1.55e9 06                0             8.1    NA T2m        1025 K    
##  7 1.55e9 06                0             5.2    NA T2m        1026 K    
##  8 1.55e9 06                0             5.2    NA T2m        1027 K    
##  9 1.55e9 06                0            28.5    NA T2m        1033 K    
## 10 1.55e9 06                0           734.     NA T2m        1035 K    
## # … with 1,945 more rows, and 15 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, elev &lt;dbl&gt;, T2m &lt;dbl&gt;</code></pre>
<p>Now we can try plotting the ensmeble temperature evolution for REIPA again</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="point-data.html#cb135-1"></a><span class="kw">plot_station_eps</span>(</span>
<span id="cb135-2"><a href="point-data.html#cb135-2"></a>  t2m, </span>
<span id="cb135-3"><a href="point-data.html#cb135-3"></a>  <span class="dv">1114</span>, </span>
<span id="cb135-4"><a href="point-data.html#cb135-4"></a>  <span class="dv">2019021706</span>, </span>
<span id="cb135-5"><a href="point-data.html#cb135-5"></a>  <span class="dt">obs_column =</span> T2m, </span>
<span id="cb135-6"><a href="point-data.html#cb135-6"></a>  <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb135-7"><a href="point-data.html#cb135-7"></a>  <span class="dt">shape =</span> <span class="dv">21</span></span>
<span id="cb135-8"><a href="point-data.html#cb135-8"></a>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb135-9"><a href="point-data.html#cb135-9"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">9</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p>There are still a few problems with <code>plot_station_eps</code> so tread carefully!</p>
</div>
<div id="shifted-forecasts" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Shifted forecasts</h3>
<p>Let’s say you want to compare an ensmeble with another but with the time shifted. i.e. how does a forecast that is 6 hours old compare with the current forecast. We can do that by shifting the forecast - that means adjusting the forecast start time and the forecast lead time by 6 hours so the forecast appears to have been run at a different time. We can do this with <code>shift_forecast</code>.</p>
<p>To illustrate, we read in the MEPS_prod data, for 10m wind speed, just to be different!</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="point-data.html#cb136-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">read_point_forecast</span>(</span>
<span id="cb136-2"><a href="point-data.html#cb136-2"></a>  <span class="dt">start_date    =</span> <span class="dv">2019021700</span>,</span>
<span id="cb136-3"><a href="point-data.html#cb136-3"></a>  <span class="dt">end_date      =</span> <span class="dv">2019021718</span>,</span>
<span id="cb136-4"><a href="point-data.html#cb136-4"></a>  <span class="dt">fcst_model    =</span> <span class="st">&quot;MEPS_prod&quot;</span>, </span>
<span id="cb136-5"><a href="point-data.html#cb136-5"></a>  <span class="dt">fcst_type     =</span> <span class="st">&quot;EPS&quot;</span>,</span>
<span id="cb136-6"><a href="point-data.html#cb136-6"></a>  <span class="dt">parameter     =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb136-7"><a href="point-data.html#cb136-7"></a>  <span class="dt">lead_time     =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">3</span>),</span>
<span id="cb136-8"><a href="point-data.html#cb136-8"></a>  <span class="dt">file_path     =</span> <span class="kw">here</span>(<span class="st">&quot;data/FCTABLE/ensemble&quot;</span>),</span>
<span id="cb136-9"><a href="point-data.html#cb136-9"></a>  <span class="dt">file_template =</span> <span class="st">&quot;fctable_eps_all_leads&quot;</span></span>
<span id="cb136-10"><a href="point-data.html#cb136-10"></a>)</span></code></pre></div>
<p>And then we are going to create a new ensemble with MEPS_prod shifted by 6 hours, so the forecast that started at 00 UTC now appears to have started at 06 UTC etc. This means that the forecast with a lead time of 6 hours, that used to start at 00 UTC now appears to have started at 06 UTC and has a lead time of 0 hours.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="point-data.html#cb137-1"></a>(s10m &lt;-<span class="st"> </span><span class="kw">shift_forecast</span>(</span>
<span id="cb137-2"><a href="point-data.html#cb137-2"></a>  s10m,</span>
<span id="cb137-3"><a href="point-data.html#cb137-3"></a>  <span class="dt">fcst_shifts    =</span> <span class="kw">list</span>(<span class="dt">MEPS_prod =</span> <span class="dv">6</span>),</span>
<span id="cb137-4"><a href="point-data.html#cb137-4"></a>  <span class="dt">keep_unshifted =</span> <span class="ot">TRUE</span></span>
<span id="cb137-5"><a href="point-data.html#cb137-5"></a>))</span></code></pre></div>
<pre><code>## ● MEPS_prod
## # A tibble: 24,060 x 19
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;int&gt; &lt;chr&gt;         &lt;int&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 00                0            36.4    NA S10m       1001 m/s  
##  2 1.55e9 00                0             4.1    NA S10m       1010 m/s  
##  3 1.55e9 00                0            29.1    NA S10m       1014 m/s  
##  4 1.55e9 00                0             2.6    NA S10m       1015 m/s  
##  5 1.55e9 00                0           152.     NA S10m       1018 m/s  
##  6 1.55e9 00                0            16.4    NA S10m       1021 m/s  
##  7 1.55e9 00                0            39.5    NA S10m       1022 m/s  
##  8 1.55e9 00                0            69.1    NA S10m       1023 m/s  
##  9 1.55e9 00                0             8.1    NA S10m       1025 m/s  
## 10 1.55e9 00                0             5.2    NA S10m       1026 m/s  
## # … with 24,050 more rows, and 11 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;
## 
## ● MEPS_prod_shifted_6h
## # A tibble: 14,436 x 19
##    fcdate fcst_cycle leadtime model_elevation     p parameter   SID units
##     &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;
##  1 1.55e9 06                0            36.4    NA S10m       1001 m/s  
##  2 1.55e9 06                0             4.1    NA S10m       1010 m/s  
##  3 1.55e9 06                0            29.1    NA S10m       1014 m/s  
##  4 1.55e9 06                0             2.6    NA S10m       1015 m/s  
##  5 1.55e9 06                0           152.     NA S10m       1018 m/s  
##  6 1.55e9 06                0            16.4    NA S10m       1021 m/s  
##  7 1.55e9 06                0            39.5    NA S10m       1022 m/s  
##  8 1.55e9 06                0            69.1    NA S10m       1023 m/s  
##  9 1.55e9 06                0             8.1    NA S10m       1025 m/s  
## 10 1.55e9 06                0             5.2    NA S10m       1026 m/s  
## # … with 14,426 more rows, and 11 more variables: validdate &lt;int&gt;,
## #   MEPS_prod_mbr000 &lt;dbl&gt;, MEPS_prod_mbr001 &lt;dbl&gt;, MEPS_prod_mbr002 &lt;dbl&gt;,
## #   MEPS_prod_mbr003 &lt;dbl&gt;, MEPS_prod_mbr004 &lt;dbl&gt;, MEPS_prod_mbr005 &lt;dbl&gt;,
## #   MEPS_prod_mbr006 &lt;dbl&gt;, MEPS_prod_mbr007 &lt;dbl&gt;, MEPS_prod_mbr008 &lt;dbl&gt;,
## #   MEPS_prod_mbr009 &lt;dbl&gt;</code></pre>
<p>So now we have two ensembles in our data: MEPS_prod and MEPS_prod_shifted_6h. We can see that they are different by getting the start times (fcdate) and lead times from each of the forecasts.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="point-data.html#cb139-1"></a><span class="kw">transmute</span>(s10m, <span class="dt">fcdate =</span> <span class="kw">unix2datetime</span>(fcdate), leadtime) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(distinct)</span></code></pre></div>
<pre><code>## $MEPS_prod
## # A tibble: 20 x 2
##    fcdate              leadtime
##    &lt;dttm&gt;                 &lt;int&gt;
##  1 2019-02-17 00:00:00        0
##  2 2019-02-17 00:00:00        3
##  3 2019-02-17 00:00:00        6
##  4 2019-02-17 00:00:00        9
##  5 2019-02-17 00:00:00       12
##  6 2019-02-17 06:00:00        0
##  7 2019-02-17 06:00:00        3
##  8 2019-02-17 06:00:00        6
##  9 2019-02-17 06:00:00        9
## 10 2019-02-17 06:00:00       12
## 11 2019-02-17 12:00:00        0
## 12 2019-02-17 12:00:00        3
## 13 2019-02-17 12:00:00        6
## 14 2019-02-17 12:00:00        9
## 15 2019-02-17 12:00:00       12
## 16 2019-02-17 18:00:00        0
## 17 2019-02-17 18:00:00        3
## 18 2019-02-17 18:00:00        6
## 19 2019-02-17 18:00:00        9
## 20 2019-02-17 18:00:00       12
## 
## $MEPS_prod_shifted_6h
## # A tibble: 12 x 2
##    fcdate              leadtime
##    &lt;dttm&gt;                 &lt;dbl&gt;
##  1 2019-02-17 06:00:00        0
##  2 2019-02-17 06:00:00        3
##  3 2019-02-17 06:00:00        6
##  4 2019-02-17 12:00:00        0
##  5 2019-02-17 12:00:00        3
##  6 2019-02-17 12:00:00        6
##  7 2019-02-17 18:00:00        0
##  8 2019-02-17 18:00:00        3
##  9 2019-02-17 18:00:00        6
## 10 2019-02-18 00:00:00        0
## 11 2019-02-18 00:00:00        3
## 12 2019-02-18 00:00:00        6</code></pre>
<p>We’re going to want to verify s10m later, so let’s make sure we have the common cases and get the observations</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="point-data.html#cb141-1"></a>s10m &lt;-<span class="st"> </span><span class="kw">common_cases</span>(s10m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-2"><a href="point-data.html#cb141-2"></a><span class="st">  </span><span class="kw">join_to_fcst</span>(</span>
<span id="cb141-3"><a href="point-data.html#cb141-3"></a>    <span class="kw">read_point_obs</span>(</span>
<span id="cb141-4"><a href="point-data.html#cb141-4"></a>      <span class="kw">first_validdate</span>(s10m),</span>
<span id="cb141-5"><a href="point-data.html#cb141-5"></a>      <span class="kw">last_validdate</span>(s10m),</span>
<span id="cb141-6"><a href="point-data.html#cb141-6"></a>      <span class="dt">parameter =</span> <span class="st">&quot;S10m&quot;</span>,</span>
<span id="cb141-7"><a href="point-data.html#cb141-7"></a>      <span class="dt">obs_path  =</span> <span class="kw">here</span>(<span class="st">&quot;data/OBSTABLE&quot;</span>) </span>
<span id="cb141-8"><a href="point-data.html#cb141-8"></a>    )</span>
<span id="cb141-9"><a href="point-data.html#cb141-9"></a>  )</span></code></pre></div>
</div>
<div id="verification" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Verification</h3>
<p>For ensemble verification, the main verification function is <code>ens_verify</code>. Similar to <code>det_verify</code>, you give it the data and the column name of the observations.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="point-data.html#cb142-1"></a><span class="kw">ens_verify</span>(t2m, T2m)</span></code></pre></div>
<pre><code>## $ens_summary_scores
## # A tibble: 16 x 12
##    mname leadtime num_cases mean_bias  stde  rmse spread spread_skill_ra…
##    &lt;chr&gt;    &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;            &lt;dbl&gt;
##  1 awes…        0       467    0.177   1.40  1.41  0.744            0.526
##  2 awes…        3       509    0.552   2.09  2.16  0.713            0.330
##  3 awes…        6       472    0.596   2.34  2.42  0.710            0.294
##  4 awes…        9       507    0.782   2.33  2.46  0.798            0.325
##  5 MEPS…        0       467    0.187   1.55  1.56  0.756            0.486
##  6 MEPS…        3       509    0.572   2.09  2.16  0.754            0.348
##  7 MEPS…        6       472    0.612   2.35  2.42  0.734            0.303
##  8 MEPS…        9       507    0.798   2.32  2.45  0.811            0.330
##  9 CMEP…        0       467    0.0678  1.67  1.67  0.686            0.410
## 10 CMEP…        3       509    0.344   2.11  2.14  0.729            0.341
## 11 CMEP…        6       472    0.470   2.33  2.37  0.766            0.323
## 12 CMEP…        9       507    0.673   2.34  2.44  0.806            0.331
## 13 MEPS…        0       467    0.139   1.55  1.56  0.618            0.397
## 14 MEPS…        3       509    0.457   2.06  2.11  0.722            0.342
## 15 MEPS…        6       472    0.498   2.30  2.35  0.770            0.327
## 16 MEPS…        9       507    0.670   2.30  2.39  0.882            0.368
## # … with 4 more variables: rank_histogram &lt;list&gt;, crps &lt;dbl&gt;,
## #   crps_potential &lt;dbl&gt;, crps_reliability &lt;dbl&gt;
## 
## $ens_threshold_scores
## data frame with 0 columns and 0 rows
## 
## $det_summary_scores
## # A tibble: 120 x 9
##    mname        leadtime member sub_model    num_cases    bias  rmse   mae  stde
##    &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 awesome_mul…        0 mbr000 AROME_Arcti…       467  0.145   1.12 0.738  1.11
##  2 awesome_mul…        3 mbr000 AROME_Arcti…       509  0.493   2.24 1.48   2.19
##  3 awesome_mul…        6 mbr000 AROME_Arcti…       472  0.550   2.49 1.65   2.43
##  4 awesome_mul…        9 mbr000 AROME_Arcti…       507  0.733   2.58 1.72   2.47
##  5 awesome_mul…        0 mbr000 MEPS_prod          467  0.155   1.55 1.09   1.55
##  6 awesome_mul…        3 mbr000 MEPS_prod          509  0.479   2.11 1.42   2.05
##  7 awesome_mul…        6 mbr000 MEPS_prod          472  0.525   2.32 1.55   2.26
##  8 awesome_mul…        9 mbr000 MEPS_prod          507  0.689   2.39 1.63   2.30
##  9 awesome_mul…        0 mbr001 MEPS_prod          467 -0.0784  1.59 1.17   1.59
## 10 awesome_mul…        3 mbr001 MEPS_prod          509  0.399   2.03 1.39   1.99
## # … with 110 more rows
## 
## attr(,&quot;parameter&quot;)
## [1] &quot;T2m&quot;
## attr(,&quot;start_date&quot;)
## [1] &quot;2019021706&quot;
## attr(,&quot;end_date&quot;)
## [1] &quot;2019021718&quot;
## attr(,&quot;num_stations&quot;)
## [1] 180</code></pre>
<p>By default, summary deterministic verification scores will be computed for each member. We can also compute categorical ensemble scores based on thresholds (such as Brier Score, ROC, economic value etc.) if we pass some thresholds to the function</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="point-data.html#cb144-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(s10m, S10m, <span class="dt">thresholds =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>))</span></code></pre></div>
<p>You can also compute “fair” scores for CRPS and Brier Score, which take account differences in the number of members between ensembles by scaling them to an equal number of members. We do this by passing <code>num_ref_members</code>.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="point-data.html#cb145-1"></a>verif_t2m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(</span>
<span id="cb145-2"><a href="point-data.html#cb145-2"></a>  t2m, </span>
<span id="cb145-3"><a href="point-data.html#cb145-3"></a>  T2m, </span>
<span id="cb145-4"><a href="point-data.html#cb145-4"></a>  <span class="dt">thresholds      =</span> <span class="kw">seq</span>(<span class="dv">262</span>, <span class="dv">272</span>, <span class="dv">2</span>), </span>
<span id="cb145-5"><a href="point-data.html#cb145-5"></a>  <span class="dt">num_ref_members =</span> <span class="dv">10</span></span>
<span id="cb145-6"><a href="point-data.html#cb145-6"></a>)</span></code></pre></div>
<p>So now we can have a quick look at some score plots using <code>plot_point_verif</code> - the default for the type of verification is <code>verif_type = "ens"</code> so we don’t need to specify it (for now)</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="point-data.html#cb146-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, crps)</span>
<span id="cb146-2"><a href="point-data.html#cb146-2"></a><span class="kw">plot_point_verif</span>(verif_s10m, spread_skill)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="point-data.html#cb147-1"></a><span class="kw">plot_point_verif</span>(verif_s10m, rank_histogram)</span>
<span id="cb147-2"><a href="point-data.html#cb147-2"></a></span>
<span id="cb147-3"><a href="point-data.html#cb147-3"></a><span class="kw">plot_point_verif</span>(verif_t2m, spread_skill_ratio)</span>
<span id="cb147-4"><a href="point-data.html#cb147-4"></a><span class="kw">plot_point_verif</span>(verif_t2m, fair_crps)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-2.png" width="672" /></p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="point-data.html#cb148-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb148-2"><a href="point-data.html#cb148-2"></a>  verif_t2m, </span>
<span id="cb148-3"><a href="point-data.html#cb148-3"></a>  rank_histogram, </span>
<span id="cb148-4"><a href="point-data.html#cb148-4"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(leadtime), </span>
<span id="cb148-5"><a href="point-data.html#cb148-5"></a>  <span class="dt">num_facet_cols  =</span> <span class="dv">2</span>, </span>
<span id="cb148-6"><a href="point-data.html#cb148-6"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span></span>
<span id="cb148-7"><a href="point-data.html#cb148-7"></a>) <span class="op">+</span></span>
<span id="cb148-8"><a href="point-data.html#cb148-8"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-3.png" width="672" /></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="point-data.html#cb149-1"></a><span class="kw">plot_point_verif</span>(verif_t2m, brier_score, <span class="dt">facet_by =</span> <span class="kw">vars</span>(threshold))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-78-4.png" width="672" /></p>
<p>We can also set the colours / fill colours for our plots by passing a data frame with one column as mname and the other as colour. The easiest way to get the model names for the mname is either from the forecast object using names, or if that is not available at the time you can get if from the verification list.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="point-data.html#cb150-1"></a><span class="kw">names</span>(t2m)</span></code></pre></div>
<pre><code>## [1] &quot;awesome_multimodel_eps&quot;                   
## [2] &quot;AROME_Arctic_prod(awesome_multimodel_eps)&quot;
## [3] &quot;MEPS_prod(awesome_multimodel_eps)&quot;        
## [4] &quot;CMEPS_prod&quot;                               
## [5] &quot;MEPS_prod&quot;</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="point-data.html#cb152-1"></a><span class="kw">map</span>(verif_t2m, pull, mname) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(union)</span></code></pre></div>
<pre><code>## [1] &quot;awesome_multimodel_eps&quot;                   
## [2] &quot;MEPS_prod(awesome_multimodel_eps)&quot;        
## [3] &quot;CMEPS_prod&quot;                               
## [4] &quot;MEPS_prod&quot;                                
## [5] &quot;AROME_Arctic_prod(awesome_multimodel_eps)&quot;</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="point-data.html#cb154-1"></a>my_colours &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb154-2"><a href="point-data.html#cb154-2"></a>  <span class="dt">mname =</span> <span class="kw">names</span>(t2m),</span>
<span id="cb154-3"><a href="point-data.html#cb154-3"></a>  <span class="dt">colour =</span> <span class="kw">c</span>(<span class="st">&quot;darkblue&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;skyblue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>)</span>
<span id="cb154-4"><a href="point-data.html#cb154-4"></a>)</span></code></pre></div>
<p>We can also plot the deterministic scores for each member. Here we need to tell <code>plot_point_verif</code> to do faceting by mname and to colour the lines according to the ensemble member.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="point-data.html#cb155-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb155-2"><a href="point-data.html#cb155-2"></a>  verif_t2m, </span>
<span id="cb155-3"><a href="point-data.html#cb155-3"></a>  mae, </span>
<span id="cb155-4"><a href="point-data.html#cb155-4"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb155-5"><a href="point-data.html#cb155-5"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb155-6"><a href="point-data.html#cb155-6"></a>  <span class="dt">colour_by       =</span> member,</span>
<span id="cb155-7"><a href="point-data.html#cb155-7"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb155-8"><a href="point-data.html#cb155-8"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">20</span></span>
<span id="cb155-9"><a href="point-data.html#cb155-9"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>We’ve got quite a lot going on there and it’s not a useful for plot, put we can clean it up by adding some more grouping variables. First let’s differentiate between the control members and the perturbed members.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="point-data.html#cb156-1"></a>verif_t2m<span class="op">$</span>det_summary_scores &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb156-2"><a href="point-data.html#cb156-2"></a>  verif_t2m<span class="op">$</span>det_summary_scores,</span>
<span id="cb156-3"><a href="point-data.html#cb156-3"></a>  <span class="dt">member_type =</span> <span class="kw">case_when</span>(</span>
<span id="cb156-4"><a href="point-data.html#cb156-4"></a>    <span class="kw">grepl</span>(<span class="st">&quot;000&quot;</span>, member) <span class="op">~</span><span class="st"> &quot;control&quot;</span>,</span>
<span id="cb156-5"><a href="point-data.html#cb156-5"></a>    <span class="ot">TRUE</span>                 <span class="op">~</span><span class="st"> &quot;perturbed&quot;</span></span>
<span id="cb156-6"><a href="point-data.html#cb156-6"></a>  )</span>
<span id="cb156-7"><a href="point-data.html#cb156-7"></a>)</span>
<span id="cb156-8"><a href="point-data.html#cb156-8"></a></span>
<span id="cb156-9"><a href="point-data.html#cb156-9"></a>member_colours &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb156-10"><a href="point-data.html#cb156-10"></a>  <span class="op">~</span>member_type, <span class="op">~</span>colour,</span>
<span id="cb156-11"><a href="point-data.html#cb156-11"></a>  <span class="st">&quot;control&quot;</span>, <span class="st">&quot;red&quot;</span>, </span>
<span id="cb156-12"><a href="point-data.html#cb156-12"></a>  <span class="st">&quot;perturbed&quot;</span>, <span class="st">&quot;grey70&quot;</span></span>
<span id="cb156-13"><a href="point-data.html#cb156-13"></a>)</span>
<span id="cb156-14"><a href="point-data.html#cb156-14"></a></span>
<span id="cb156-15"><a href="point-data.html#cb156-15"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb156-16"><a href="point-data.html#cb156-16"></a>  verif_t2m, </span>
<span id="cb156-17"><a href="point-data.html#cb156-17"></a>  mae, </span>
<span id="cb156-18"><a href="point-data.html#cb156-18"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb156-19"><a href="point-data.html#cb156-19"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb156-20"><a href="point-data.html#cb156-20"></a>  <span class="dt">colour_by       =</span> member_type,</span>
<span id="cb156-21"><a href="point-data.html#cb156-21"></a>  <span class="dt">colour_table    =</span> member_colours, </span>
<span id="cb156-22"><a href="point-data.html#cb156-22"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb156-23"><a href="point-data.html#cb156-23"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span>,</span>
<span id="cb156-24"><a href="point-data.html#cb156-24"></a>  <span class="dt">group           =</span> member</span>
<span id="cb156-25"><a href="point-data.html#cb156-25"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>And then we’re going to add an extra column to the data frame so that we can give lagged members a different line type</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="point-data.html#cb157-1"></a>verif_t2m<span class="op">$</span>det_summary_scores &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb157-2"><a href="point-data.html#cb157-2"></a>  verif_t2m<span class="op">$</span>det_summary_scores,</span>
<span id="cb157-3"><a href="point-data.html#cb157-3"></a>  <span class="dt">lagging =</span> <span class="kw">case_when</span>(</span>
<span id="cb157-4"><a href="point-data.html#cb157-4"></a>    <span class="kw">grepl</span>(<span class="st">&quot;_lag$&quot;</span>, member) <span class="op">~</span><span class="st"> &quot;lagged&quot;</span>,</span>
<span id="cb157-5"><a href="point-data.html#cb157-5"></a>    <span class="ot">TRUE</span>                   <span class="op">~</span><span class="st"> &quot;unlagged&quot;</span></span>
<span id="cb157-6"><a href="point-data.html#cb157-6"></a>  )</span>
<span id="cb157-7"><a href="point-data.html#cb157-7"></a>)</span>
<span id="cb157-8"><a href="point-data.html#cb157-8"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb157-9"><a href="point-data.html#cb157-9"></a>  verif_t2m , </span>
<span id="cb157-10"><a href="point-data.html#cb157-10"></a>  mae, </span>
<span id="cb157-11"><a href="point-data.html#cb157-11"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb157-12"><a href="point-data.html#cb157-12"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb157-13"><a href="point-data.html#cb157-13"></a>  <span class="dt">colour_by       =</span> member_type,</span>
<span id="cb157-14"><a href="point-data.html#cb157-14"></a>  <span class="dt">colour_table    =</span> member_colours, </span>
<span id="cb157-15"><a href="point-data.html#cb157-15"></a>  <span class="dt">linetype_by     =</span> <span class="kw">fct_rev</span>(lagging), </span>
<span id="cb157-16"><a href="point-data.html#cb157-16"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb157-17"><a href="point-data.html#cb157-17"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span>,</span>
<span id="cb157-18"><a href="point-data.html#cb157-18"></a>  <span class="dt">group           =</span> member</span>
<span id="cb157-19"><a href="point-data.html#cb157-19"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>And finally, although our multi model ensemble plot looks strange, because it has 2 member 0s, that’s OK because we don’t need it as the data are in the plots for the sub models.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="point-data.html#cb158-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb158-2"><a href="point-data.html#cb158-2"></a>  verif_t2m , </span>
<span id="cb158-3"><a href="point-data.html#cb158-3"></a>  mae, </span>
<span id="cb158-4"><a href="point-data.html#cb158-4"></a>  <span class="dt">verif_type      =</span> <span class="st">&quot;det&quot;</span>, </span>
<span id="cb158-5"><a href="point-data.html#cb158-5"></a>  <span class="dt">facet_by        =</span> <span class="kw">vars</span>(mname), </span>
<span id="cb158-6"><a href="point-data.html#cb158-6"></a>  <span class="dt">colour_by       =</span> member_type,</span>
<span id="cb158-7"><a href="point-data.html#cb158-7"></a>  <span class="dt">colour_table    =</span> member_colours, </span>
<span id="cb158-8"><a href="point-data.html#cb158-8"></a>  <span class="dt">linetype_by     =</span> <span class="kw">fct_rev</span>(lagging), </span>
<span id="cb158-9"><a href="point-data.html#cb158-9"></a>  <span class="dt">legend_position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb158-10"><a href="point-data.html#cb158-10"></a>  <span class="dt">num_legend_rows =</span> <span class="dv">2</span>,</span>
<span id="cb158-11"><a href="point-data.html#cb158-11"></a>  <span class="dt">group           =</span> member,</span>
<span id="cb158-12"><a href="point-data.html#cb158-12"></a>  <span class="dt">filter_by       =</span> <span class="kw">vars</span>(mname <span class="op">!=</span><span class="st"> &quot;awesome_multimodel_eps&quot;</span>),</span>
<span id="cb158-13"><a href="point-data.html#cb158-13"></a>  <span class="dt">num_facet_cols  =</span> <span class="dv">2</span> </span>
<span id="cb158-14"><a href="point-data.html#cb158-14"></a>) <span class="op">+</span></span>
<span id="cb158-15"><a href="point-data.html#cb158-15"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">9</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
</div>
<div id="verification-by-groups" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Verification by groups</h3>
<p>As we mentioned in the deterministic section, we can compute verification scores for groups of data. So in our data we have forecasts from 3 different cycles: 06, 12, and 18 UTC. (Let’s forget for a moment that also means only 3 forecasts and assume that the data include forecasts from several days running with the same start times every day). We can use the <code>groupings</code> argument to say that we want to verify for each lead time for each forecast cycle.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="point-data.html#cb159-1"></a><span class="kw">ens_verify</span>(t2m, T2m, <span class="dt">groupings =</span> <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;fcst_cycle&quot;</span>))</span></code></pre></div>
<pre><code>## $ens_summary_scores
## # A tibble: 48 x 13
##    mname leadtime fcst_cycle num_cases mean_bias  stde  rmse spread
##    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 awes…        0 06               147    0.0532  1.02  1.01  0.525
##  2 awes…        0 12               166   -0.131   1.01  1.01  0.523
##  3 awes…        0 18               154    0.626   1.90  1.99  1.06 
##  4 awes…        3 06               170   -0.0961  1.33  1.33  0.505
##  5 awes…        3 12               169    0.825   1.76  1.93  0.542
##  6 awes…        3 18               170    0.929   2.77  2.91  0.988
##  7 awes…        6 06               166   -0.337   1.22  1.26  0.499
##  8 awes…        6 12               154    1.23    2.48  2.76  0.627
##  9 awes…        6 18               152    0.970   2.79  2.95  0.946
## 10 awes…        9 06               169    0.708   1.81  1.94  0.624
## # … with 38 more rows, and 5 more variables: spread_skill_ratio &lt;dbl&gt;,
## #   rank_histogram &lt;list&gt;, crps &lt;dbl&gt;, crps_potential &lt;dbl&gt;,
## #   crps_reliability &lt;dbl&gt;
## 
## $ens_threshold_scores
## data frame with 0 columns and 0 rows
## 
## $det_summary_scores
## # A tibble: 360 x 10
##    mname leadtime fcst_cycle member sub_model num_cases    bias  rmse   mae
##    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;         &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 awes…        0 06         mbr000 AROME_Ar…       147  0.0882 0.836 0.526
##  2 awes…        3 06         mbr000 AROME_Ar…       170 -0.139  1.36  1.03 
##  3 awes…        6 06         mbr000 AROME_Ar…       166 -0.307  1.30  0.981
##  4 awes…        9 06         mbr000 AROME_Ar…       169  0.708  1.91  1.34 
##  5 awes…        0 12         mbr000 AROME_Ar…       166  0.0626 0.825 0.560
##  6 awes…        3 12         mbr000 AROME_Ar…       169  0.788  1.97  1.37 
##  7 awes…        6 12         mbr000 AROME_Ar…       154  1.25   2.84  2.06 
##  8 awes…        9 12         mbr000 AROME_Ar…       170  0.907  3.26  2.25 
##  9 awes…        0 18         mbr000 AROME_Ar…       154  0.287  1.55  1.13 
## 10 awes…        3 18         mbr000 AROME_Ar…       170  0.830  3.05  2.05 
## # … with 350 more rows, and 1 more variable: stde &lt;dbl&gt;
## 
## attr(,&quot;parameter&quot;)
## [1] &quot;T2m&quot;
## attr(,&quot;start_date&quot;)
## [1] &quot;2019021706&quot;
## attr(,&quot;end_date&quot;)
## [1] &quot;2019021718&quot;
## attr(,&quot;num_stations&quot;)
## [1] 180</code></pre>
<p>But this only computes the scores for each forecast cycle and not for all of the cycles combined. We can rectify that by passing the groupings as a list with different grouping combinations</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="point-data.html#cb161-1"></a>verif_t2m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(</span>
<span id="cb161-2"><a href="point-data.html#cb161-2"></a>  t2m, </span>
<span id="cb161-3"><a href="point-data.html#cb161-3"></a>  T2m, </span>
<span id="cb161-4"><a href="point-data.html#cb161-4"></a>  <span class="dt">groupings  =</span> <span class="kw">list</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;fcst_cycle&quot;</span>)),</span>
<span id="cb161-5"><a href="point-data.html#cb161-5"></a>  <span class="dt">thresholds =</span> <span class="kw">seq</span>(<span class="dv">262</span>, <span class="dv">272</span>, <span class="dv">2</span>)</span>
<span id="cb161-6"><a href="point-data.html#cb161-6"></a>)</span></code></pre></div>
<p>If we pull out the fcst_cycle column, we will see that we now have a new entry for all cycles.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="point-data.html#cb162-1"></a><span class="kw">pull</span>(verif_t2m<span class="op">$</span>ens_summary_scores, fcst_cycle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()</span></code></pre></div>
<pre><code>## [1] &quot; 06; 12; 18&quot; &quot;06&quot;          &quot;12&quot;          &quot;18&quot;</code></pre>
<p>So we can plot for all forecast cycles</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="point-data.html#cb164-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb164-2"><a href="point-data.html#cb164-2"></a>  verif_t2m, </span>
<span id="cb164-3"><a href="point-data.html#cb164-3"></a>  brier_score_decomposition, </span>
<span id="cb164-4"><a href="point-data.html#cb164-4"></a>  <span class="dt">facet_by =</span> <span class="kw">vars</span>(fcst_cycle, threshold),</span>
<span id="cb164-5"><a href="point-data.html#cb164-5"></a>  <span class="dt">num_facet_cols =</span> <span class="dv">6</span></span>
<span id="cb164-6"><a href="point-data.html#cb164-6"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-87-1.png" width="864" /></p>
<p>If we’ve computed some different verifications and we want to plot them together, we can join those score objects using <code>bind_point_verif</code>. We have done verification for 2m temperature and 10m wind speed, so we can bind those together.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="point-data.html#cb165-1"></a>verif_s10m &lt;-<span class="st"> </span><span class="kw">ens_verify</span>(</span>
<span id="cb165-2"><a href="point-data.html#cb165-2"></a>  s10m, </span>
<span id="cb165-3"><a href="point-data.html#cb165-3"></a>  S10m, </span>
<span id="cb165-4"><a href="point-data.html#cb165-4"></a>  <span class="dt">thresholds =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>),</span>
<span id="cb165-5"><a href="point-data.html#cb165-5"></a>  <span class="dt">groupings  =</span> <span class="kw">list</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;leadtime&quot;</span>, <span class="st">&quot;fcst_cycle&quot;</span>))</span>
<span id="cb165-6"><a href="point-data.html#cb165-6"></a>)</span>
<span id="cb165-7"><a href="point-data.html#cb165-7"></a>verif_all &lt;-<span class="st"> </span><span class="kw">bind_point_verif</span>(verif_t2m, verif_s10m)</span></code></pre></div>
<p>And then we can plot those together with the same function</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="point-data.html#cb166-1"></a><span class="kw">plot_point_verif</span>(</span>
<span id="cb166-2"><a href="point-data.html#cb166-2"></a>  verif_all, </span>
<span id="cb166-3"><a href="point-data.html#cb166-3"></a>  crps, </span>
<span id="cb166-4"><a href="point-data.html#cb166-4"></a>  <span class="dt">facet_by       =</span> <span class="kw">vars</span>(parameter, fcst_cycle),</span>
<span id="cb166-5"><a href="point-data.html#cb166-5"></a>  <span class="dt">num_facet_cols =</span> <span class="dv">4</span></span>
<span id="cb166-6"><a href="point-data.html#cb166-6"></a>)</span></code></pre></div>
<p><img src="harp-book_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
</div>
<div id="saving-the-verification-data" class="section level3">
<h3><span class="header-section-number">4.3.6</span> Saving the verification data</h3>
<p>You can save your verification data with the function <code>save_point_verif</code>. You simply give it the data and the directory you want to save in. The filenames are generated from the data, so although you can provide a template, it is best not to.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="point-data.html#cb167-1"></a><span class="kw">save_point_verif</span>(verif_t2m, <span class="dt">verif_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/verification&quot;</span>))</span>
<span id="cb167-2"><a href="point-data.html#cb167-2"></a><span class="kw">save_point_verif</span>(verif_s10m, <span class="dt">verif_path =</span> <span class="kw">here</span>(<span class="st">&quot;data/verification&quot;</span>))</span></code></pre></div>
<p>Once the data are saved you can use a browser based app to view and interact with the data. This app is created in the R package <code>shiny</code>, so to launch it you run the function <code>shiny_plot_point_verif</code> and give it the starting directory to look for data.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="point-data.html#cb168-1"></a><span class="kw">shiny_plot_point_verif</span>(<span class="kw">here</span>(<span class="st">&quot;data/verification&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="to-be-added" class="section level2">
<h2><span class="header-section-number">4.4</span> TO BE ADDED</h2>
<div id="vertical-profiles-1" class="section level3">
<h3><span class="header-section-number">4.4.1</span> vertical profiles</h3>
</div>
<div id="verification-of-vertical-profiles" class="section level3">
<h3><span class="header-section-number">4.4.2</span> verification of vertical profiles</h3>
</div>
<div id="plot-vertical-verification" class="section level3">
<h3><span class="header-section-number">4.4.3</span> plot vertical verification</h3>
</div>
<div id="jitter-forecast" class="section level3">
<h3><span class="header-section-number">4.4.4</span> jitter forecast</h3>
</div>
<div id="conditional-verification" class="section level3">
<h3><span class="header-section-number">4.4.5</span> conditional verification</h3>
</div>
<div id="joint-probabilities-maybe" class="section level3">
<h3><span class="header-section-number">4.4.6</span> joint probabilities (maybe)</h3>
</div>
<div id="bootstrapping" class="section level3">
<h3><span class="header-section-number">4.4.7</span> bootstrapping</h3>
</div>
<div id="pooled-bootstrapping" class="section level3">
<h3><span class="header-section-number">4.4.8</span> pooled bootstrapping</h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="convert-observations-to-sqlite.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
